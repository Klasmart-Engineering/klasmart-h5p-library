/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
/******/ (function() { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "./src/entries/h5p-dialogcards.js":
/*!****************************************!*\
  !*** ./src/entries/h5p-dialogcards.js ***!
  \****************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _styles_h5p_dialogcards_css__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../styles/h5p-dialogcards.css */ \"./src/styles/h5p-dialogcards.css\");\n/* harmony import */ var _scripts_h5p_dialogcards_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../scripts/h5p-dialogcards.js */ \"./src/scripts/h5p-dialogcards.js\");\n\n // Load library\n// H5P = H5P || {};\n\nH5P.Dialogcards = _scripts_h5p_dialogcards_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"];//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZW50cmllcy9oNXAtZGlhbG9nY2FyZHMuanMuanMiLCJtYXBwaW5ncyI6Ijs7O0FBQUE7QUFDQTtBQUdBOztBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vaDVwLWRpYWxvZ2NhcmRzLy4vc3JjL2VudHJpZXMvaDVwLWRpYWxvZ2NhcmRzLmpzPzRmNWIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFwiLi4vc3R5bGVzL2g1cC1kaWFsb2djYXJkcy5jc3NcIjtcbmltcG9ydCBEaWFsb2djYXJkcyBmcm9tIFwiLi4vc2NyaXB0cy9oNXAtZGlhbG9nY2FyZHMuanNcIjtcblxuLy8gTG9hZCBsaWJyYXJ5XG4vLyBINVAgPSBINVAgfHwge307XG5INVAuRGlhbG9nY2FyZHMgPSBEaWFsb2djYXJkcztcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/entries/h5p-dialogcards.js\n");

/***/ }),

/***/ "./src/scripts/h5p-dialogcards-card-manager.js":
/*!*****************************************************!*\
  !*** ./src/scripts/h5p-dialogcards-card-manager.js ***!
  \*****************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _h5p_dialogcards_card_pool__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./h5p-dialogcards-card-pool */ \"./src/scripts/h5p-dialogcards-card-pool.js\");\n/* harmony import */ var _h5p_dialogcards_card_pile__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./h5p-dialogcards-card-pile */ \"./src/scripts/h5p-dialogcards-card-pile.js\");\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _iterableToArray(iter) { if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\n\n\n\nvar CardManager = /*#__PURE__*/function () {\n  /**\n   * @constructor\n   *\n   * @param {object} params Parameters from content type.\n   * @param {number} contentId Id of content.\n   * @param {object} callbacks Callbacks to parent.\n   */\n  function CardManager(params, contentId, callbacks) {\n    this.params = params;\n    this.cardPool = new _h5p_dialogcards_card_pool__WEBPACK_IMPORTED_MODULE_0__[\"default\"](params, contentId, callbacks);\n    this.reset(params.cardPiles);\n    return this;\n  }\n  /**\n   * Create a selection of card ids depending on mode.\n   *\n   * @return {object[]} Selection of card ids.\n   */\n\n\n  var _proto = CardManager.prototype;\n\n  _proto.createSelection = function createSelection() {\n    var selectionIds = [];\n\n    switch (this.params.mode) {\n      case 'repetition':\n        // Repetition mode\n        selectionIds = this.createSelectionRepetition();\n        break;\n\n      default:\n        // Normal mode\n        selectionIds = this.cardPool.getCardIds();\n    }\n\n    return selectionIds;\n  }\n  /**\n   * Create card piles depending on mode.\n   * @param {object} [cardPiles] Piles to set (from previous state).\n   */\n  ;\n\n  _proto.createPiles = function createPiles(cardPiles) {\n    if (cardPiles) {\n      this.cardPiles = cardPiles.map(function (cardPile) {\n        return new _h5p_dialogcards_card_pile__WEBPACK_IMPORTED_MODULE_1__[\"default\"](cardPile.cards);\n      });\n      return;\n    }\n\n    this.cardPiles = [];\n    var pool = this.cardPool.getCardIds();\n\n    switch (this.params.mode) {\n      case 'repetition':\n        // Repetition mode\n        for (var i = 0; i < this.params.behaviour.maxProficiency; i++) {\n          if (i === 0) {\n            this.cardPiles.push(new _h5p_dialogcards_card_pile__WEBPACK_IMPORTED_MODULE_1__[\"default\"](pool));\n          } else {\n            this.cardPiles.push(new _h5p_dialogcards_card_pile__WEBPACK_IMPORTED_MODULE_1__[\"default\"]());\n          }\n        }\n\n        break;\n\n      case 'normal':\n        // Normal mode. One pile only with all cards\n        this.cardPiles.push(new _h5p_dialogcards_card_pile__WEBPACK_IMPORTED_MODULE_1__[\"default\"](pool));\n    }\n  }\n  /**\n   * Update piles.\n   *\n   * Just one \"rule\" for now. Could be amended with more modes.\n   *\n   * @param {object[]} results Results.\n   * @param {number} results.cardId Card that result is reported for.\n   * @param {boolean} results.result Result for that card.\n   * @return {number[]} Card pile sizes.\n   */\n  ;\n\n  _proto.updatePiles = function updatePiles(results) {\n    var _this = this;\n\n    results.forEach(function (result) {\n      // Find card in pile\n      var pileId = _this.find(result.cardId);\n\n      if (pileId === -1) {\n        return;\n      } // Move card to next pile or first pile\n\n\n      var newPileId = result.result === true ? pileId + 1 : 0;\n      newPileId = Math.max(0, Math.min(newPileId, _this.cardPiles.length - 1));\n\n      _this.cardPiles[pileId].remove(result.cardId);\n\n      _this.cardPiles[newPileId].add(result.cardId, 'bottom');\n    });\n    return this.getPileSizes();\n  }\n  /**\n   * Create card selection for repetition mode.\n   *\n   * Draw all cards from first pile with cards, 1/2 of next, 1/3 of next, ...\n   * Don't draw cards from last pile\n   * Get cards from top - will be moved at the bottom of other pile according to results (LIFO)\n   *\n   * @return {object[]} Ids of selected cards from pool.\n   */\n  ;\n\n  _proto.createSelectionRepetition = function createSelectionRepetition() {\n    var selectionIds = [];\n    var firstPileWithCards = null;\n\n    for (var j = 0; j < this.cardPiles.length - 1; j++) {\n      var _selectionIds;\n\n      var pileAmount = this.cardPiles[j].length(); // Skip empty piles\n\n      if (firstPileWithCards === null && pileAmount === 0) {\n        continue;\n      } // Remember first pile with cards\n\n\n      if (firstPileWithCards === null) {\n        firstPileWithCards = j;\n      } // Draw cards favoring those of piles with low id\n\n\n      var drawAmount = Math.ceil(pileAmount * 1 / (1 + j - firstPileWithCards));\n      var cardsDrawn = this.cardPiles[j].peek(0, drawAmount);\n      selectionIds = (_selectionIds = selectionIds).concat.apply(_selectionIds, _toConsumableArray(cardsDrawn));\n    } // Shuffle selection\n\n\n    selectionIds = this.shuffle(selectionIds);\n    return selectionIds;\n  }\n  /**\n   * Shuffle items (not in place).\n   *\n   * @param {object[]} items Items.\n   * @return {object[]} Shuffled items.\n   */\n  ;\n\n  _proto.shuffle = function shuffle(items) {\n    var copies = items.slice();\n\n    for (var i = copies.length - 1; i > 0; i--) {\n      var j = Math.floor(Math.random() * (i + 1));\n      var _ref = [copies[j], copies[i]];\n      copies[i] = _ref[0];\n      copies[j] = _ref[1];\n    }\n\n    return copies;\n  }\n  /**\n   * Find id of pile that contains card with particular id.\n   *\n   * @param {number} id Id of card to be found.\n   * @return {number} Id of pile or -1.\n   */\n  ;\n\n  _proto.find = function find(id) {\n    var found = -1;\n    this.cardPiles.forEach(function (cardPile, index) {\n      if (found !== -1) {\n        return found;\n      }\n\n      if (cardPile.contains(id)) {\n        found = index;\n      }\n    });\n    return found;\n  }\n  /**\n   * Reset Card Manager.\n   * @param {object} [cardPiles] Piles to set (from previous state).\n   */\n  ;\n\n  _proto.reset = function reset(cardPiles) {\n    this.createPiles(cardPiles);\n  }\n  /**\n   * Retrieve card from pool. Will be loaded on call.\n   *\n   * @param {number} id Id of card to be retrieved.\n   */\n  ;\n\n  _proto.getCard = function getCard(id) {\n    return this.cardPool.getCard(id);\n  }\n  /**\n   * Retrieve the total number of cards available.\n   * @return {number} Total number of cards available.\n   */\n  ;\n\n  _proto.getSize = function getSize() {\n    return this.cardPool.getCardIds().length;\n  }\n  /**\n   * Retrieve all piles.\n   * @return {object[]} Piles.\n   */\n  ;\n\n  _proto.getPiles = function getPiles() {\n    return this.cardPiles;\n  }\n  /**\n   * Retrieve the size of each pile.\n   * @return {object[]} Pile sizes.\n   */\n  ;\n\n  _proto.getPileSizes = function getPileSizes() {\n    return this.cardPiles.map(function (pile) {\n      return pile.length();\n    });\n  };\n\n  return CardManager;\n}();\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (CardManager);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvc2NyaXB0cy9oNXAtZGlhbG9nY2FyZHMtY2FyZC1tYW5hZ2VyLmpzLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUNBO0FBQ0E7QUFDQTtBQVBBOztBQVVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTs7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFmQTtBQWlCQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUFBOztBQUNBO0FBQ0E7QUFDQTs7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7O0FBQ0E7O0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFFQTs7QUFDQTtBQUFBOztBQUNBOztBQUdBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBOztBQUNBO0FBQ0E7QUFEQTtBQUVBO0FBQUE7QUFDQTs7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7Ozs7O0FBR0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9oNXAtZGlhbG9nY2FyZHMvLi9zcmMvc2NyaXB0cy9oNXAtZGlhbG9nY2FyZHMtY2FyZC1tYW5hZ2VyLmpzPzAxYTciXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IENhcmRQb29sIGZyb20gJy4vaDVwLWRpYWxvZ2NhcmRzLWNhcmQtcG9vbCc7XG5pbXBvcnQgQ2FyZFBpbGUgZnJvbSAnLi9oNXAtZGlhbG9nY2FyZHMtY2FyZC1waWxlJztcblxuY2xhc3MgQ2FyZE1hbmFnZXIge1xuICAvKipcbiAgICogQGNvbnN0cnVjdG9yXG4gICAqXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBwYXJhbXMgUGFyYW1ldGVycyBmcm9tIGNvbnRlbnQgdHlwZS5cbiAgICogQHBhcmFtIHtudW1iZXJ9IGNvbnRlbnRJZCBJZCBvZiBjb250ZW50LlxuICAgKiBAcGFyYW0ge29iamVjdH0gY2FsbGJhY2tzIENhbGxiYWNrcyB0byBwYXJlbnQuXG4gICAqL1xuICBjb25zdHJ1Y3RvcihwYXJhbXMsIGNvbnRlbnRJZCwgY2FsbGJhY2tzKSB7XG4gICAgdGhpcy5wYXJhbXMgPSBwYXJhbXM7XG4gICAgdGhpcy5jYXJkUG9vbCA9IG5ldyBDYXJkUG9vbChwYXJhbXMsIGNvbnRlbnRJZCwgY2FsbGJhY2tzKTtcblxuICAgIHRoaXMucmVzZXQocGFyYW1zLmNhcmRQaWxlcyk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYSBzZWxlY3Rpb24gb2YgY2FyZCBpZHMgZGVwZW5kaW5nIG9uIG1vZGUuXG4gICAqXG4gICAqIEByZXR1cm4ge29iamVjdFtdfSBTZWxlY3Rpb24gb2YgY2FyZCBpZHMuXG4gICAqL1xuICBjcmVhdGVTZWxlY3Rpb24oKSB7XG4gICAgbGV0IHNlbGVjdGlvbklkcyA9IFtdO1xuXG4gICAgc3dpdGNoICh0aGlzLnBhcmFtcy5tb2RlKSB7XG4gICAgICBjYXNlICdyZXBldGl0aW9uJzpcbiAgICAgICAgLy8gUmVwZXRpdGlvbiBtb2RlXG4gICAgICAgIHNlbGVjdGlvbklkcyA9IHRoaXMuY3JlYXRlU2VsZWN0aW9uUmVwZXRpdGlvbigpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIC8vIE5vcm1hbCBtb2RlXG4gICAgICAgIHNlbGVjdGlvbklkcyA9IHRoaXMuY2FyZFBvb2wuZ2V0Q2FyZElkcygpO1xuICAgIH1cblxuICAgIHJldHVybiBzZWxlY3Rpb25JZHM7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGNhcmQgcGlsZXMgZGVwZW5kaW5nIG9uIG1vZGUuXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBbY2FyZFBpbGVzXSBQaWxlcyB0byBzZXQgKGZyb20gcHJldmlvdXMgc3RhdGUpLlxuICAgKi9cbiAgY3JlYXRlUGlsZXMoY2FyZFBpbGVzKSB7XG4gICAgaWYgKGNhcmRQaWxlcykge1xuICAgICAgdGhpcy5jYXJkUGlsZXMgPSBjYXJkUGlsZXMubWFwKGNhcmRQaWxlID0+IHtcbiAgICAgICAgcmV0dXJuIG5ldyBDYXJkUGlsZShjYXJkUGlsZS5jYXJkcyk7XG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuY2FyZFBpbGVzID0gW107XG4gICAgY29uc3QgcG9vbCA9IHRoaXMuY2FyZFBvb2wuZ2V0Q2FyZElkcygpO1xuXG4gICAgc3dpdGNoICh0aGlzLnBhcmFtcy5tb2RlKSB7XG4gICAgICBjYXNlICdyZXBldGl0aW9uJzpcbiAgICAgICAgLy8gUmVwZXRpdGlvbiBtb2RlXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wYXJhbXMuYmVoYXZpb3VyLm1heFByb2ZpY2llbmN5OyBpKyspIHtcbiAgICAgICAgICBpZiAoaSA9PT0gMCkge1xuICAgICAgICAgICAgdGhpcy5jYXJkUGlsZXMucHVzaChuZXcgQ2FyZFBpbGUocG9vbCkpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuY2FyZFBpbGVzLnB1c2gobmV3IENhcmRQaWxlKCkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSAnbm9ybWFsJzpcbiAgICAgICAgLy8gTm9ybWFsIG1vZGUuIE9uZSBwaWxlIG9ubHkgd2l0aCBhbGwgY2FyZHNcbiAgICAgICAgdGhpcy5jYXJkUGlsZXMucHVzaChuZXcgQ2FyZFBpbGUocG9vbCkpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgcGlsZXMuXG4gICAqXG4gICAqIEp1c3Qgb25lIFwicnVsZVwiIGZvciBub3cuIENvdWxkIGJlIGFtZW5kZWQgd2l0aCBtb3JlIG1vZGVzLlxuICAgKlxuICAgKiBAcGFyYW0ge29iamVjdFtdfSByZXN1bHRzIFJlc3VsdHMuXG4gICAqIEBwYXJhbSB7bnVtYmVyfSByZXN1bHRzLmNhcmRJZCBDYXJkIHRoYXQgcmVzdWx0IGlzIHJlcG9ydGVkIGZvci5cbiAgICogQHBhcmFtIHtib29sZWFufSByZXN1bHRzLnJlc3VsdCBSZXN1bHQgZm9yIHRoYXQgY2FyZC5cbiAgICogQHJldHVybiB7bnVtYmVyW119IENhcmQgcGlsZSBzaXplcy5cbiAgICovXG4gIHVwZGF0ZVBpbGVzKHJlc3VsdHMpIHtcbiAgICByZXN1bHRzLmZvckVhY2gocmVzdWx0ID0+IHtcbiAgICAgIC8vIEZpbmQgY2FyZCBpbiBwaWxlXG4gICAgICBjb25zdCBwaWxlSWQgPSB0aGlzLmZpbmQocmVzdWx0LmNhcmRJZCk7XG4gICAgICBpZiAocGlsZUlkID09PSAtMSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIE1vdmUgY2FyZCB0byBuZXh0IHBpbGUgb3IgZmlyc3QgcGlsZVxuICAgICAgbGV0IG5ld1BpbGVJZCA9IChyZXN1bHQucmVzdWx0ID09PSB0cnVlKSA/IHBpbGVJZCArIDEgOiAwO1xuICAgICAgbmV3UGlsZUlkID0gTWF0aC5tYXgoMCwgTWF0aC5taW4obmV3UGlsZUlkLCB0aGlzLmNhcmRQaWxlcy5sZW5ndGggLSAxKSk7XG4gICAgICB0aGlzLmNhcmRQaWxlc1twaWxlSWRdLnJlbW92ZShyZXN1bHQuY2FyZElkKTtcbiAgICAgIHRoaXMuY2FyZFBpbGVzW25ld1BpbGVJZF0uYWRkKHJlc3VsdC5jYXJkSWQsICdib3R0b20nKTtcbiAgICB9KTtcblxuICAgIHJldHVybiB0aGlzLmdldFBpbGVTaXplcygpO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBjYXJkIHNlbGVjdGlvbiBmb3IgcmVwZXRpdGlvbiBtb2RlLlxuICAgKlxuICAgKiBEcmF3IGFsbCBjYXJkcyBmcm9tIGZpcnN0IHBpbGUgd2l0aCBjYXJkcywgMS8yIG9mIG5leHQsIDEvMyBvZiBuZXh0LCAuLi5cbiAgICogRG9uJ3QgZHJhdyBjYXJkcyBmcm9tIGxhc3QgcGlsZVxuICAgKiBHZXQgY2FyZHMgZnJvbSB0b3AgLSB3aWxsIGJlIG1vdmVkIGF0IHRoZSBib3R0b20gb2Ygb3RoZXIgcGlsZSBhY2NvcmRpbmcgdG8gcmVzdWx0cyAoTElGTylcbiAgICpcbiAgICogQHJldHVybiB7b2JqZWN0W119IElkcyBvZiBzZWxlY3RlZCBjYXJkcyBmcm9tIHBvb2wuXG4gICAqL1xuICBjcmVhdGVTZWxlY3Rpb25SZXBldGl0aW9uKCkge1xuICAgIGxldCBzZWxlY3Rpb25JZHMgPSBbXTtcblxuICAgIGxldCBmaXJzdFBpbGVXaXRoQ2FyZHMgPSBudWxsO1xuICAgIGZvciAobGV0IGogPSAwOyBqIDwgdGhpcy5jYXJkUGlsZXMubGVuZ3RoIC0gMTsgaisrKSB7XG4gICAgICBjb25zdCBwaWxlQW1vdW50ID0gdGhpcy5jYXJkUGlsZXNbal0ubGVuZ3RoKCk7XG5cbiAgICAgIC8vIFNraXAgZW1wdHkgcGlsZXNcbiAgICAgIGlmIChmaXJzdFBpbGVXaXRoQ2FyZHMgPT09IG51bGwgJiYgcGlsZUFtb3VudCA9PT0gMCkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgLy8gUmVtZW1iZXIgZmlyc3QgcGlsZSB3aXRoIGNhcmRzXG4gICAgICBpZiAoZmlyc3RQaWxlV2l0aENhcmRzID09PSBudWxsKSB7XG4gICAgICAgIGZpcnN0UGlsZVdpdGhDYXJkcyA9IGo7XG4gICAgICB9XG5cbiAgICAgIC8vIERyYXcgY2FyZHMgZmF2b3JpbmcgdGhvc2Ugb2YgcGlsZXMgd2l0aCBsb3cgaWRcbiAgICAgIGNvbnN0IGRyYXdBbW91bnQgPSBNYXRoLmNlaWwocGlsZUFtb3VudCAqIDEgLyAoMSArIGogLSBmaXJzdFBpbGVXaXRoQ2FyZHMpKTtcbiAgICAgIGNvbnN0IGNhcmRzRHJhd24gPSB0aGlzLmNhcmRQaWxlc1tqXS5wZWVrKDAsIGRyYXdBbW91bnQpO1xuICAgICAgc2VsZWN0aW9uSWRzID0gc2VsZWN0aW9uSWRzLmNvbmNhdCguLi5jYXJkc0RyYXduKTtcbiAgICB9XG5cbiAgICAvLyBTaHVmZmxlIHNlbGVjdGlvblxuICAgIHNlbGVjdGlvbklkcyA9IHRoaXMuc2h1ZmZsZShzZWxlY3Rpb25JZHMpO1xuXG4gICAgcmV0dXJuIHNlbGVjdGlvbklkcztcbiAgfVxuXG4gIC8qKlxuICAgKiBTaHVmZmxlIGl0ZW1zIChub3QgaW4gcGxhY2UpLlxuICAgKlxuICAgKiBAcGFyYW0ge29iamVjdFtdfSBpdGVtcyBJdGVtcy5cbiAgICogQHJldHVybiB7b2JqZWN0W119IFNodWZmbGVkIGl0ZW1zLlxuICAgKi9cbiAgc2h1ZmZsZShpdGVtcykge1xuICAgIGNvbnN0IGNvcGllcyA9IGl0ZW1zLnNsaWNlKCk7XG4gICAgZm9yIChsZXQgaSA9IGNvcGllcy5sZW5ndGggLSAxOyBpID4gMDsgaS0tKSB7XG4gICAgICBjb25zdCBqID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKGkgKyAxKSk7XG4gICAgICBbY29waWVzW2ldLCBjb3BpZXNbal1dID0gW2NvcGllc1tqXSwgY29waWVzW2ldXTtcbiAgICB9XG4gICAgcmV0dXJuIGNvcGllcztcbiAgfVxuXG4gIC8qKlxuICAgKiBGaW5kIGlkIG9mIHBpbGUgdGhhdCBjb250YWlucyBjYXJkIHdpdGggcGFydGljdWxhciBpZC5cbiAgICpcbiAgICogQHBhcmFtIHtudW1iZXJ9IGlkIElkIG9mIGNhcmQgdG8gYmUgZm91bmQuXG4gICAqIEByZXR1cm4ge251bWJlcn0gSWQgb2YgcGlsZSBvciAtMS5cbiAgICovXG4gIGZpbmQoaWQpIHtcbiAgICBsZXQgZm91bmQgPSAtMTtcbiAgICB0aGlzLmNhcmRQaWxlcy5mb3JFYWNoKChjYXJkUGlsZSwgaW5kZXgpID0+IHtcbiAgICAgIGlmIChmb3VuZCAhPT0gLTEpIHtcbiAgICAgICAgcmV0dXJuIGZvdW5kO1xuICAgICAgfVxuICAgICAgaWYgKGNhcmRQaWxlLmNvbnRhaW5zKGlkKSkgIHtcbiAgICAgICAgZm91bmQgPSBpbmRleDtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gZm91bmQ7XG4gIH1cblxuICAvKipcbiAgICogUmVzZXQgQ2FyZCBNYW5hZ2VyLlxuICAgKiBAcGFyYW0ge29iamVjdH0gW2NhcmRQaWxlc10gUGlsZXMgdG8gc2V0IChmcm9tIHByZXZpb3VzIHN0YXRlKS5cbiAgICovXG4gIHJlc2V0KGNhcmRQaWxlcykge1xuICAgIHRoaXMuY3JlYXRlUGlsZXMoY2FyZFBpbGVzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZSBjYXJkIGZyb20gcG9vbC4gV2lsbCBiZSBsb2FkZWQgb24gY2FsbC5cbiAgICpcbiAgICogQHBhcmFtIHtudW1iZXJ9IGlkIElkIG9mIGNhcmQgdG8gYmUgcmV0cmlldmVkLlxuICAgKi9cbiAgZ2V0Q2FyZChpZCkge1xuICAgIHJldHVybiB0aGlzLmNhcmRQb29sLmdldENhcmQoaWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlIHRoZSB0b3RhbCBudW1iZXIgb2YgY2FyZHMgYXZhaWxhYmxlLlxuICAgKiBAcmV0dXJuIHtudW1iZXJ9IFRvdGFsIG51bWJlciBvZiBjYXJkcyBhdmFpbGFibGUuXG4gICAqL1xuICBnZXRTaXplKCkge1xuICAgIHJldHVybiB0aGlzLmNhcmRQb29sLmdldENhcmRJZHMoKS5sZW5ndGg7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmUgYWxsIHBpbGVzLlxuICAgKiBAcmV0dXJuIHtvYmplY3RbXX0gUGlsZXMuXG4gICAqL1xuICBnZXRQaWxlcygpIHtcbiAgICByZXR1cm4gdGhpcy5jYXJkUGlsZXM7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmUgdGhlIHNpemUgb2YgZWFjaCBwaWxlLlxuICAgKiBAcmV0dXJuIHtvYmplY3RbXX0gUGlsZSBzaXplcy5cbiAgICovXG4gIGdldFBpbGVTaXplcygpIHtcbiAgICByZXR1cm4gdGhpcy5jYXJkUGlsZXMubWFwKHBpbGUgPT4gcGlsZS5sZW5ndGgoKSk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgQ2FyZE1hbmFnZXI7XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/scripts/h5p-dialogcards-card-manager.js\n");

/***/ }),

/***/ "./src/scripts/h5p-dialogcards-card-pile.js":
/*!**************************************************!*\
  !*** ./src/scripts/h5p-dialogcards-card-pile.js ***!
  \**************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _iterableToArray(iter) { if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nvar CardPile = /*#__PURE__*/function () {\n  /**\n   * @constructor\n   *\n   * @params {object[]} cards Card Ids.\n   */\n  function CardPile() {\n    var cards = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    // Only use unique values\n    this.cards = cards.filter(function (item, index) {\n      return cards.indexOf(item) >= index;\n    });\n    return this;\n  }\n  /**\n   * Get complete card pile.\n   */\n\n\n  var _proto = CardPile.prototype;\n\n  _proto.getCards = function getCards() {\n    return this.cards;\n  }\n  /**\n   * Peek at card in pile.\n   *\n   * @param {number|string} position Position to peek at.\n   * @param {number} [amount=1] Number of cards to peek at.\n   */\n  ;\n\n  _proto.peek = function peek(position) {\n    var amount = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;\n    amount = Math.max(0, amount);\n\n    if (position === 'top') {\n      position = 0;\n    }\n\n    if (position === 'bottom') {\n      position = this.cards.length - amount;\n    }\n\n    if (position < 0 || position > this.cards.length - 1) {\n      return [];\n    }\n\n    return this.cards.slice(position, position + amount);\n  }\n  /**\n   * Add cards to the pile.\n   *\n   * @param {number|object[]} ids Id or array of card ids to be added.\n   * @param {number|string} [position='top'] Position to add cards to (top|bottom), can be amended.\n   */\n  ;\n\n  _proto.add = function add(ids) {\n    var _this = this;\n\n    var position = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'top';\n\n    if (typeof ids === 'number') {\n      ids = [ids];\n    }\n\n    ids.forEach(function (id) {\n      var _this$cards;\n\n      if (_this.cards.indexOf(id) !== -1) {\n        return;\n      }\n\n      if (position === 'top') {\n        position = 0;\n      } else if (position === 'bottom') {\n        position = _this.cards.length;\n      } else if (position === 'random') {\n        position = Math.floor(Math.random() * _this.cards.length);\n      }\n\n      (_this$cards = _this.cards).splice.apply(_this$cards, [position, 0].concat(_toConsumableArray(ids)));\n    });\n  }\n  /**\n   * Shorthand for adding cards to top.\n   *\n   * @param {number|object[]} ids Id or array of card ids to be added.\n   */\n  ;\n\n  _proto.push = function push(ids) {\n    this.add(ids, 'top');\n  }\n  /**\n   * Pull consecutive cards from the pile.\n   *\n   * @param {number} [amount=1] Amount of cards to be pulled.\n   * @param {number|string} [position='top'] Position to take cards from. Default top.\n   */\n  ;\n\n  _proto.pull = function pull() {\n    var amount = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;\n    var position = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'top';\n    amount = Math.max(1, Math.min(amount, this.cards.length));\n\n    if (position === 'top') {\n      position = 0;\n    }\n\n    if (position === 'bottom') {\n      position = -amount;\n    }\n\n    position = Math.max(0, Math.min(position, this.cards.length - 1));\n    return this.cards.splice(position, amount);\n  }\n  /**\n   * Remove cards from the pile.\n   *\n   * @param {number|object[]} ids Id or array of card ids to be removed.\n   */\n  ;\n\n  _proto.remove = function remove(ids) {\n    var _this2 = this;\n\n    if (typeof ids === 'number') {\n      ids = [ids];\n    }\n\n    ids.forEach(function (id) {\n      var position = _this2.cards.indexOf(id);\n\n      if (position > -1) {\n        _this2.cards.splice(position, 1);\n      }\n    });\n  }\n  /**\n   * Shuffle pile in place.\n   *\n   * @return {object[]} Shuffled cards.\n   */\n  ;\n\n  _proto.shuffle = function shuffle() {\n    for (var i = this.cards.length - 1; i > 0; i--) {\n      var j = Math.floor(Math.random() * (i + 1));\n      var _ref = [this.cards[j], this.cards[i]];\n      this.cards[i] = _ref[0];\n      this.cards[j] = _ref[1];\n    }\n\n    return this.cards;\n  }\n  /**\n   * Check if id is in pile.\n   *\n   * @return {boolean} True, if card is in pile.\n   */\n  ;\n\n  _proto.contains = function contains(id) {\n    return this.cards.indexOf(id) !== -1;\n  }\n  /**\n   * Get amount of cards on pile.\n   *\n   * @return {number} Amount of cards on pile.\n   */\n  ;\n\n  _proto.length = function length() {\n    return this.cards.length;\n  };\n\n  return CardPile;\n}();\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (CardPile);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvc2NyaXB0cy9oNXAtZGlhbG9nY2FyZHMtY2FyZC1waWxlLmpzLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBOzs7OztBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFBQTtBQUNBOztBQUNBO0FBQ0E7QUFDQTs7QUFDQTtBQUNBO0FBQ0E7O0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQUE7O0FBQUE7O0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQUE7O0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFBQTtBQUFBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUNBO0FBQ0E7QUFDQTs7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUFBOztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUVBO0FBQUE7QUFDQTs7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBOzs7OztBQUdBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vaDVwLWRpYWxvZ2NhcmRzLy4vc3JjL3NjcmlwdHMvaDVwLWRpYWxvZ2NhcmRzLWNhcmQtcGlsZS5qcz8xODlmIl0sInNvdXJjZXNDb250ZW50IjpbImNsYXNzIENhcmRQaWxlIHtcbiAgLyoqXG4gICAqIEBjb25zdHJ1Y3RvclxuICAgKlxuICAgKiBAcGFyYW1zIHtvYmplY3RbXX0gY2FyZHMgQ2FyZCBJZHMuXG4gICAqL1xuICBjb25zdHJ1Y3RvcihjYXJkcyA9IFtdKSB7XG4gICAgLy8gT25seSB1c2UgdW5pcXVlIHZhbHVlc1xuICAgIHRoaXMuY2FyZHMgPSBjYXJkcy5maWx0ZXIoKGl0ZW0sIGluZGV4KSA9PiBjYXJkcy5pbmRleE9mKGl0ZW0pID49IGluZGV4KTtcblxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjb21wbGV0ZSBjYXJkIHBpbGUuXG4gICAqL1xuICBnZXRDYXJkcygpIHtcbiAgICByZXR1cm4gdGhpcy5jYXJkcztcbiAgfVxuXG4gIC8qKlxuICAgKiBQZWVrIGF0IGNhcmQgaW4gcGlsZS5cbiAgICpcbiAgICogQHBhcmFtIHtudW1iZXJ8c3RyaW5nfSBwb3NpdGlvbiBQb3NpdGlvbiB0byBwZWVrIGF0LlxuICAgKiBAcGFyYW0ge251bWJlcn0gW2Ftb3VudD0xXSBOdW1iZXIgb2YgY2FyZHMgdG8gcGVlayBhdC5cbiAgICovXG4gIHBlZWsocG9zaXRpb24sIGFtb3VudCA9IDEpIHtcbiAgICBhbW91bnQgPSBNYXRoLm1heCgwLCBhbW91bnQpO1xuICAgIGlmIChwb3NpdGlvbiA9PT0gJ3RvcCcpIHtcbiAgICAgIHBvc2l0aW9uID0gMDtcbiAgICB9XG4gICAgaWYgKHBvc2l0aW9uID09PSAnYm90dG9tJykge1xuICAgICAgcG9zaXRpb24gPSB0aGlzLmNhcmRzLmxlbmd0aCAtIGFtb3VudDtcbiAgICB9XG4gICAgaWYgKHBvc2l0aW9uIDwgMCB8fCBwb3NpdGlvbiA+IHRoaXMuY2FyZHMubGVuZ3RoIC0gMSkge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmNhcmRzLnNsaWNlKHBvc2l0aW9uLCBwb3NpdGlvbiArIGFtb3VudCk7XG4gIH1cblxuICAvKipcbiAgICogQWRkIGNhcmRzIHRvIHRoZSBwaWxlLlxuICAgKlxuICAgKiBAcGFyYW0ge251bWJlcnxvYmplY3RbXX0gaWRzIElkIG9yIGFycmF5IG9mIGNhcmQgaWRzIHRvIGJlIGFkZGVkLlxuICAgKiBAcGFyYW0ge251bWJlcnxzdHJpbmd9IFtwb3NpdGlvbj0ndG9wJ10gUG9zaXRpb24gdG8gYWRkIGNhcmRzIHRvICh0b3B8Ym90dG9tKSwgY2FuIGJlIGFtZW5kZWQuXG4gICAqL1xuICBhZGQoaWRzLCBwb3NpdGlvbiA9ICd0b3AnKSB7XG4gICAgaWYgKHR5cGVvZiBpZHMgPT09ICdudW1iZXInKSB7XG4gICAgICBpZHMgPSBbaWRzXTtcbiAgICB9XG5cbiAgICBpZHMuZm9yRWFjaChpZCA9PiB7XG4gICAgICBpZiAodGhpcy5jYXJkcy5pbmRleE9mKGlkKSAhPT0gLTEpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAocG9zaXRpb24gPT09ICd0b3AnKSB7XG4gICAgICAgIHBvc2l0aW9uID0gMDtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKHBvc2l0aW9uID09PSAnYm90dG9tJykge1xuICAgICAgICBwb3NpdGlvbiA9IHRoaXMuY2FyZHMubGVuZ3RoO1xuICAgICAgfVxuICAgICAgZWxzZSBpZiAocG9zaXRpb24gPT09ICdyYW5kb20nKSB7XG4gICAgICAgIHBvc2l0aW9uID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKHRoaXMuY2FyZHMubGVuZ3RoKSk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuY2FyZHMuc3BsaWNlKHBvc2l0aW9uLCAwLCAuLi5pZHMpO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFNob3J0aGFuZCBmb3IgYWRkaW5nIGNhcmRzIHRvIHRvcC5cbiAgICpcbiAgICogQHBhcmFtIHtudW1iZXJ8b2JqZWN0W119IGlkcyBJZCBvciBhcnJheSBvZiBjYXJkIGlkcyB0byBiZSBhZGRlZC5cbiAgICovXG4gIHB1c2goaWRzKSB7XG4gICAgdGhpcy5hZGQoaWRzLCAndG9wJyk7XG4gIH1cblxuICAvKipcbiAgICogUHVsbCBjb25zZWN1dGl2ZSBjYXJkcyBmcm9tIHRoZSBwaWxlLlxuICAgKlxuICAgKiBAcGFyYW0ge251bWJlcn0gW2Ftb3VudD0xXSBBbW91bnQgb2YgY2FyZHMgdG8gYmUgcHVsbGVkLlxuICAgKiBAcGFyYW0ge251bWJlcnxzdHJpbmd9IFtwb3NpdGlvbj0ndG9wJ10gUG9zaXRpb24gdG8gdGFrZSBjYXJkcyBmcm9tLiBEZWZhdWx0IHRvcC5cbiAgICovXG4gIHB1bGwoYW1vdW50ID0gMSwgcG9zaXRpb24gPSAndG9wJykge1xuICAgIGFtb3VudCA9IE1hdGgubWF4KDEsIE1hdGgubWluKGFtb3VudCwgdGhpcy5jYXJkcy5sZW5ndGgpKTtcblxuICAgIGlmIChwb3NpdGlvbiA9PT0gJ3RvcCcpIHtcbiAgICAgIHBvc2l0aW9uID0gMDtcbiAgICB9XG4gICAgaWYgKHBvc2l0aW9uID09PSAnYm90dG9tJykge1xuICAgICAgcG9zaXRpb24gPSAtYW1vdW50O1xuICAgIH1cbiAgICBwb3NpdGlvbiA9IE1hdGgubWF4KDAsIE1hdGgubWluKHBvc2l0aW9uLCB0aGlzLmNhcmRzLmxlbmd0aCAtIDEpKTtcblxuICAgIHJldHVybiB0aGlzLmNhcmRzLnNwbGljZShwb3NpdGlvbiwgYW1vdW50KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW1vdmUgY2FyZHMgZnJvbSB0aGUgcGlsZS5cbiAgICpcbiAgICogQHBhcmFtIHtudW1iZXJ8b2JqZWN0W119IGlkcyBJZCBvciBhcnJheSBvZiBjYXJkIGlkcyB0byBiZSByZW1vdmVkLlxuICAgKi9cbiAgcmVtb3ZlKGlkcykge1xuICAgIGlmICh0eXBlb2YgaWRzID09PSAnbnVtYmVyJykge1xuICAgICAgaWRzID0gW2lkc107XG4gICAgfVxuXG4gICAgaWRzLmZvckVhY2goaWQgPT4ge1xuICAgICAgY29uc3QgcG9zaXRpb24gPSB0aGlzLmNhcmRzLmluZGV4T2YoaWQpO1xuICAgICAgaWYgKHBvc2l0aW9uID4gLTEpIHtcbiAgICAgICAgdGhpcy5jYXJkcy5zcGxpY2UocG9zaXRpb24sIDEpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFNodWZmbGUgcGlsZSBpbiBwbGFjZS5cbiAgICpcbiAgICogQHJldHVybiB7b2JqZWN0W119IFNodWZmbGVkIGNhcmRzLlxuICAgKi9cbiAgc2h1ZmZsZSgpIHtcbiAgICBmb3IgKGxldCBpID0gdGhpcy5jYXJkcy5sZW5ndGggLSAxOyBpID4gMDsgaS0tKSB7XG4gICAgICBjb25zdCBqID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKGkgKyAxKSk7XG4gICAgICBbdGhpcy5jYXJkc1tpXSwgdGhpcy5jYXJkc1tqXV0gPSBbdGhpcy5jYXJkc1tqXSwgdGhpcy5jYXJkc1tpXV07XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuY2FyZHM7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgaWQgaXMgaW4gcGlsZS5cbiAgICpcbiAgICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSwgaWYgY2FyZCBpcyBpbiBwaWxlLlxuICAgKi9cbiAgY29udGFpbnMoaWQpIHtcbiAgICByZXR1cm4gdGhpcy5jYXJkcy5pbmRleE9mKGlkKSAhPT0gLTE7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGFtb3VudCBvZiBjYXJkcyBvbiBwaWxlLlxuICAgKlxuICAgKiBAcmV0dXJuIHtudW1iZXJ9IEFtb3VudCBvZiBjYXJkcyBvbiBwaWxlLlxuICAgKi9cbiAgbGVuZ3RoKCkge1xuICAgIHJldHVybiB0aGlzLmNhcmRzLmxlbmd0aDtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBDYXJkUGlsZTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/scripts/h5p-dialogcards-card-pile.js\n");

/***/ }),

/***/ "./src/scripts/h5p-dialogcards-card-pool.js":
/*!**************************************************!*\
  !*** ./src/scripts/h5p-dialogcards-card-pool.js ***!
  \**************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _h5p_dialogcards_card__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./h5p-dialogcards-card */ \"./src/scripts/h5p-dialogcards-card.js\");\n\n\nvar CardPool = /*#__PURE__*/function () {\n  /**\n   * @constructor\n   *\n   * @param {object} params Parameters from content type.\n   * @param {number} contentId Id of content.\n   * @param {object} callbacks Callbacks to main component.\n   */\n  function CardPool(params, contentId, callbacks) {\n    var _this = this;\n\n    this.params = params;\n    this.contentId = contentId;\n    this.callbacks = callbacks;\n    this.cards = [];\n    this.params.dialogs.forEach(function (dialog, index) {\n      dialog.id = index;\n\n      _this.cards.push(index);\n    });\n    return this;\n  }\n  /**\n   * Retrieve a card.\n   *\n   * @param {number} id Id of card to retrieve.\n   */\n\n\n  var _proto = CardPool.prototype;\n\n  _proto.getCard = function getCard(id) {\n    if (id < 0 || id > this.cards.length) {\n      return;\n    } // Replace id with card object if necessary.\n\n\n    if (typeof this.cards[id] === 'number') {\n      this.loadCard(id);\n    }\n\n    return this.cards[id];\n  }\n  /**\n   * Get initial card ids.\n   *\n   * @return {object[]} Card ids.\n   */\n  ;\n\n  _proto.getCardIds = function getCardIds() {\n    return this.cards.map(function (card, index) {\n      return index;\n    });\n  }\n  /**\n   * Load a card if not loaded yet.\n   *\n   * @param {number} id Id of card to load.\n   */\n  ;\n\n  _proto.loadCard = function loadCard(id) {\n    if (id < 0 || id > this.cards.length) {\n      return;\n    }\n\n    if (typeof this.cards[id] === 'number') {\n      this.cards[id] = new _h5p_dialogcards_card__WEBPACK_IMPORTED_MODULE_0__[\"default\"](this.params.dialogs[id], this.params, id, this.contentId, this.callbacks);\n    }\n  };\n\n  return CardPool;\n}();\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (CardPool);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvc2NyaXB0cy9oNXAtZGlhbG9nY2FyZHMtY2FyZC1wb29sLmpzLmpzIiwibWFwcGluZ3MiOiI7O0FBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBOztBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBSUEiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9oNXAtZGlhbG9nY2FyZHMvLi9zcmMvc2NyaXB0cy9oNXAtZGlhbG9nY2FyZHMtY2FyZC1wb29sLmpzP2UwNDEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IENhcmQgZnJvbSAnLi9oNXAtZGlhbG9nY2FyZHMtY2FyZCc7XG5cbmNsYXNzIENhcmRQb29sIHtcbiAgLyoqXG4gICAqIEBjb25zdHJ1Y3RvclxuICAgKlxuICAgKiBAcGFyYW0ge29iamVjdH0gcGFyYW1zIFBhcmFtZXRlcnMgZnJvbSBjb250ZW50IHR5cGUuXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBjb250ZW50SWQgSWQgb2YgY29udGVudC5cbiAgICogQHBhcmFtIHtvYmplY3R9IGNhbGxiYWNrcyBDYWxsYmFja3MgdG8gbWFpbiBjb21wb25lbnQuXG4gICAqL1xuICBjb25zdHJ1Y3RvcihwYXJhbXMsIGNvbnRlbnRJZCwgY2FsbGJhY2tzKSB7XG4gICAgdGhpcy5wYXJhbXMgPSBwYXJhbXM7XG4gICAgdGhpcy5jb250ZW50SWQgPSBjb250ZW50SWQ7XG4gICAgdGhpcy5jYWxsYmFja3MgPSBjYWxsYmFja3M7XG4gICAgdGhpcy5jYXJkcyA9IFtdO1xuXG4gICAgdGhpcy5wYXJhbXMuZGlhbG9ncy5mb3JFYWNoKChkaWFsb2csIGluZGV4KSA9PiB7XG4gICAgICBkaWFsb2cuaWQgPSBpbmRleDtcbiAgICAgIHRoaXMuY2FyZHMucHVzaChpbmRleCk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZSBhIGNhcmQuXG4gICAqXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBpZCBJZCBvZiBjYXJkIHRvIHJldHJpZXZlLlxuICAgKi9cbiAgZ2V0Q2FyZChpZCkge1xuICAgIGlmIChpZCA8IDAgfHwgaWQgPiB0aGlzLmNhcmRzLmxlbmd0aCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIFJlcGxhY2UgaWQgd2l0aCBjYXJkIG9iamVjdCBpZiBuZWNlc3NhcnkuXG4gICAgaWYgKHR5cGVvZiB0aGlzLmNhcmRzW2lkXSA9PT0gJ251bWJlcicpIHtcbiAgICAgIHRoaXMubG9hZENhcmQoaWQpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmNhcmRzW2lkXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgaW5pdGlhbCBjYXJkIGlkcy5cbiAgICpcbiAgICogQHJldHVybiB7b2JqZWN0W119IENhcmQgaWRzLlxuICAgKi9cbiAgZ2V0Q2FyZElkcygpICB7XG4gICAgcmV0dXJuIHRoaXMuY2FyZHMubWFwKChjYXJkLCBpbmRleCkgPT4gaW5kZXgpO1xuICB9XG5cbiAgLyoqXG4gICAqIExvYWQgYSBjYXJkIGlmIG5vdCBsb2FkZWQgeWV0LlxuICAgKlxuICAgKiBAcGFyYW0ge251bWJlcn0gaWQgSWQgb2YgY2FyZCB0byBsb2FkLlxuICAgKi9cbiAgbG9hZENhcmQoaWQpIHtcbiAgICBpZiAoaWQgPCAwIHx8IGlkID4gdGhpcy5jYXJkcy5sZW5ndGgpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAodHlwZW9mIHRoaXMuY2FyZHNbaWRdID09PSAnbnVtYmVyJykge1xuICAgICAgdGhpcy5jYXJkc1tpZF0gPSBuZXcgQ2FyZCh0aGlzLnBhcmFtcy5kaWFsb2dzW2lkXSwgdGhpcy5wYXJhbXMsIGlkLCB0aGlzLmNvbnRlbnRJZCwgdGhpcy5jYWxsYmFja3MpO1xuICAgIH1cbiAgfVxuXG59XG5cbmV4cG9ydCBkZWZhdWx0IENhcmRQb29sO1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/scripts/h5p-dialogcards-card-pool.js\n");

/***/ }),

/***/ "./src/scripts/h5p-dialogcards-card.js":
/*!*********************************************!*\
  !*** ./src/scripts/h5p-dialogcards-card.js ***!
  \*********************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\nvar $ = H5P.jQuery;\n\nvar Card = /*#__PURE__*/function () {\n  /**\n   * @constructor\n   *\n   * @param {object} card Card parameters\n   * @param {object} params Parent's params\n   * @param {number} id Card number in order of appearance\n   * @param {object} [callbacks] Callbacks.\n   * @param {function} [callbacks.onCardSize] Call when card needs resize.\n   * @param {function} [callbacks.onCardTurned] Call when card was turned.\n   */\n  function Card(card, params, id, contentId) {\n    var callbacks = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : {};\n    this.card = card;\n    this.params = params || {};\n    this.id = id;\n    this.contentId = contentId;\n    this.callbacks = callbacks; // Check if to use front settings for back, too\n\n    if (this.card.back.useImageFromFront) {\n      this.card.back.image = this.card.front.image;\n      this.card.back.imageAltText = this.card.front.imageAltText;\n    }\n\n    if (this.card.back.useAudioFromFront) {\n      this.card.back.audio = this.card.front.audio;\n    }\n\n    this.audios = {};\n    this.$audioWrappers = {};\n    this.$cardWrapper = $('<div>', {\n      'class': 'h5p-dialogcards-cardwrap',\n      'role': 'group',\n      'tabindex': '-1'\n    });\n\n    if (this.params.mode !== 'repetition') {\n      this.$cardWrapper.attr('aria-labelledby', 'h5p-dialogcards-progress-' + H5P.Dialogcards.idCounter);\n    }\n\n    this.$cardHolder = $('<div>', {\n      'class': 'h5p-dialogcards-cardholder'\n    }).appendTo(this.$cardWrapper);\n    this.createCardContent(card).appendTo(this.$cardHolder);\n    return this;\n  }\n  /**\n   * Create content for a card\n   *\n   * @param {object} card Card parameters\n   * @returns {*|jQuery|HTMLElement} Card content wrapper\n   */\n\n\n  var _proto = Card.prototype;\n\n  _proto.createCardContent = function createCardContent(card) {\n    var $cardContent = $('<div>', {\n      'class': 'h5p-dialogcards-card-content'\n    }); // Images\n\n    this.$imageWrapper = $('<div>', {\n      'class': 'h5p-dialogcards-image-wrapper'\n    });\n    this.createCardImage(card, 'front').appendTo(this.$imageWrapper);\n    this.createCardImage(card, 'back').appendTo(this.$imageWrapper);\n    this.$imageWrapper.appendTo($cardContent);\n    var $cardTextWrapper = $('<div>', {\n      'class': 'h5p-dialogcards-card-text-wrapper'\n    }).appendTo($cardContent);\n    var $cardTextInner = $('<div>', {\n      'class': 'h5p-dialogcards-card-text-inner'\n    }).appendTo($cardTextWrapper);\n    var $cardTextInnerContent = $('<div>', {\n      'class': 'h5p-dialogcards-card-text-inner-content'\n    }).appendTo($cardTextInner); // Front audio\n\n    this.$audioWrappers.front = this.createCardAudio(card, 'front').appendTo($cardTextInnerContent); // Back audio\n\n    this.$audioWrappers.back = this.createCardAudio(card, 'back').appendTo($cardTextInnerContent);\n    var $cardText = $('<div>', {\n      'class': 'h5p-dialogcards-card-text'\n    }).appendTo($cardTextInnerContent);\n    this.$cardTextArea = $('<div>', {\n      'class': 'h5p-dialogcards-card-text-area',\n      'tabindex': '-1',\n      'html': card.front.text\n    }).appendTo($cardText);\n    this.createCardFooter().appendTo($cardTextWrapper);\n    return $cardContent;\n  }\n  /**\n   * Create card image\n   *\n   * @param {object} card Card parameters\n   * @param {string} side Side, either front or back.\n   * @returns {*|jQuery|HTMLElement} Card image wrapper\n   */\n  ;\n\n  _proto.createCardImage = function createCardImage(card, side) {\n    var $image;\n\n    if (card[side].image !== undefined) {\n      $image = $('<img class=\"h5p-dialogcards-image\" src=\"' + H5P.getPath(card[side].image.path, this.contentId) + '\"/>');\n      $image.addClass(\"h5p-dialogcards-image-\".concat(side)); // KidsLoop customization to prevent dragging the image\n\n      $image.get(0).addEventListener('dragstart', function (event) {\n        event.preventDefault();\n      });\n      /*\n       * KidsLoop customization to prevent saving images on Android. Cannot\n       * use CSS `pointer-events: none`, because it interferes with dragstart\n       */\n\n      $image.get(0).addEventListener('contextmenu', function (event) {\n        event.preventDefault();\n        return false;\n      }); // KidsLoop customization to prevent dragging the image on iOS\n\n      $image.css({\n        'user-select': 'none',\n        '-webkit-user-select': 'none',\n        '-webkit-touch-callout': 'none'\n      });\n\n      if (card[side].imageAltText) {\n        $image.attr('alt', card[side].imageAltText);\n      }\n    } else {\n      $image = $('<div class=\"h5p-dialogcards-image\"></div>');\n    }\n\n    return $image;\n  }\n  /**\n   * Create card audio.\n   *\n   * @param {object} card Card parameters.\n   * @param {string} side Side, either front or back.\n   * @returns {*|jQuery|HTMLElement} Card audio element.\n   */\n  ;\n\n  _proto.createCardAudio = function createCardAudio(card) {\n    var side = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'front';\n    var $audioWrapper = $('<div>').addClass('h5p-dialogcards-audio-wrapper').addClass(\"h5p-dialogcards-audio-wrapper-\".concat(side));\n\n    if (!card[side].text || card[side].text === '') {\n      $audioWrapper.addClass('h5p-no-text');\n    }\n\n    if (card[side].audio !== undefined) {\n      var audioDefaults = {\n        files: card[side].audio,\n        audioNotSupported: this.params.audioNotSupported\n      };\n      var audio = new H5P.Audio(audioDefaults, this.contentId);\n      this.audios[side] = audio;\n      audio.attach($audioWrapper); // Have to stop else audio will take up a socket pending forever in chrome.\n\n      if (audio.audio && audio.audio.preload) {\n        audio.audio.preload = 'none';\n      }\n    } else {\n      $audioWrapper.addClass('hide');\n    }\n\n    return $audioWrapper;\n  }\n  /**\n   * Create card footer\n   *\n   * @returns {*|jQuery|HTMLElement} Card footer element\n   */\n  ;\n\n  _proto.createCardFooter = function createCardFooter() {\n    var $cardFooter = $('<div>', {\n      'class': 'h5p-dialogcards-card-footer'\n    });\n    var classesRepetition = 'h5p-dialogcards-button-hidden';\n    var attributeTabindex = '-1';\n\n    if (this.params.mode === 'repetition') {\n      classesRepetition = '';\n\n      if (this.params.behaviour.quickProgression) {\n        classesRepetition = 'h5p-dialogcards-quick-progression';\n        attributeTabindex = '0';\n      }\n\n      $cardFooter.addClass('h5p-repetition');\n    }\n\n    this.$buttonTurn = H5P.JoubelUI.createButton({\n      'class': 'h5p-dialogcards-turn',\n      'html': this.params.answer\n    }).appendTo($cardFooter);\n    this.$buttonShowSummary = H5P.JoubelUI.createButton({\n      'class': 'h5p-dialogcards-show-summary h5p-dialogcards-button-gone',\n      'html': this.params.showSummary\n    }).appendTo($cardFooter);\n    this.$buttonIncorrect = H5P.JoubelUI.createButton({\n      'class': 'h5p-dialogcards-answer-button',\n      'html': this.params.incorrectAnswer\n    }).addClass('incorrect').addClass(classesRepetition).attr('tabindex', attributeTabindex).appendTo($cardFooter);\n    this.$buttonCorrect = H5P.JoubelUI.createButton({\n      'class': 'h5p-dialogcards-answer-button',\n      'html': this.params.correctAnswer\n    }).addClass('correct').addClass(classesRepetition).attr('tabindex', attributeTabindex).appendTo($cardFooter);\n    return $cardFooter;\n  }\n  /**\n   * Create button listeners.\n   * Will be lost when the element is removed from DOM.\n   */\n  ;\n\n  _proto.createButtonListeners = function createButtonListeners() {\n    var _this = this;\n\n    this.$buttonIncorrect.unbind('click').click(function (event) {\n      if (!event.target.classList.contains('h5p-dialogcards-quick-progression')) {\n        return;\n      }\n\n      _this.callbacks.onNextCard({\n        cardId: _this.id,\n        result: false\n      });\n    });\n    this.$buttonTurn.unbind('click').click(function () {\n      _this.turnCard();\n    });\n    this.$buttonCorrect.unbind('click').click(function (event) {\n      if (!event.target.classList.contains('h5p-dialogcards-quick-progression')) {\n        return;\n      }\n\n      _this.callbacks.onNextCard({\n        cardId: _this.id,\n        result: true\n      });\n    });\n  }\n  /**\n   * Show summary button on last card.\n   *\n   * @param {function} callback Callback called on button click.\n   */\n  ;\n\n  _proto.showSummaryButton = function showSummaryButton(callback) {\n    // Hide answer buttons\n    this.getDOM().find('.h5p-dialogcards-answer-button').addClass('h5p-dialogcards-button-hidden').attr('tabindex', '-1'); // Swap turn button with show summary button\n\n    this.$buttonTurn.addClass('h5p-dialogcards-button-gone');\n    this.$buttonShowSummary.click(function () {\n      return callback();\n    }).removeClass('h5p-dialogcards-button-gone').focus();\n  }\n  /**\n   * Hide summary button and show answer buttons again.\n   */\n  ;\n\n  _proto.hideSummaryButton = function hideSummaryButton() {\n    if (this.params.mode === 'normal') {\n      return;\n    }\n\n    this.getDOM().find('.h5p-dialogcards-answer-button').removeClass('h5p-dialogcards-button-hidden').attr('tabindex', '0'); // Swap turn button with show summary button\n\n    this.$buttonTurn.removeClass('h5p-dialogcards-button-gone');\n    this.$buttonShowSummary.addClass('h5p-dialogcards-button-gone');\n  }\n  /**\n   * Show the opposite side of the card.\n   */\n  ;\n\n  _proto.turnCard = function turnCard() {\n    var _this2 = this;\n\n    var $card = this.getDOM();\n    var $c = $card.find('.h5p-dialogcards-card-content');\n    var $ch = $card.find('.h5p-dialogcards-cardholder').addClass('h5p-dialogcards-collapse'); // Removes tip, since it destroys the animation:\n\n    $c.find('.joubel-tip-container').remove();\n    setTimeout(function () {\n      // Check if card has been turned before\n      var turned = _this2.isTurned(); // Update HTML class for card\n\n\n      $c.toggleClass('h5p-dialogcards-turned', !turned);\n      $ch.removeClass('h5p-dialogcards-collapse');\n\n      _this2.changeText(turned ? _this2.getText() : _this2.getAnswer()); // Image shown/hidden via CSS\n      // Audio buttons shown/hidden via CSS\n\n\n      _this2.stopAudio(); // Toggle state for knowledge confirmation buttons\n\n\n      if (_this2.params.mode === 'repetition' && !_this2.params.behaviour.quickProgression) {\n        var $answerButtons = $card.find('.h5p-dialogcards-answer-button'); // Don't revoke quick progression after card was turned.\n\n        if ($answerButtons.hasClass('h5p-dialogcards-quick-progression') === false) {\n          $answerButtons.addClass('h5p-dialogcards-quick-progression').attr('tabindex', 0);\n        }\n      } // Add backside tip\n      // Had to wait a little, if not Chrome will displace tip icon\n\n\n      setTimeout(function () {\n        _this2.addTipToCard($c, turned ? 'front' : 'back');\n\n        if (typeof _this2.callbacks.onCardTurned === 'function') {\n          _this2.callbacks.onCardTurned(turned);\n        }\n      }, 200);\n\n      _this2.resizeOverflowingText(); // Focus text\n\n\n      _this2.$cardTextArea.focus();\n    }, 200);\n  }\n  /**\n   * Change text of card, used when turning cards.\n   *\n   * @param {string} text Text to set.\n   */\n  ;\n\n  _proto.changeText = function changeText(text) {\n    this.$cardTextArea.html(text);\n    this.$cardTextArea.toggleClass('hide', !text || !text.length);\n  }\n  /**\n   * Set progress for assistive technologies.\n   * @param {number} position Position.\n   * @param {number} max Maximum position.\n   */\n  ;\n\n  _proto.setProgressText = function setProgressText(position, total) {\n    if (this.params.mode !== 'repetition') {\n      return;\n    }\n\n    var progressText = this.params.progressText.replace('@card', position.toString()).replace('@total', total.toString());\n    this.$cardWrapper.attr('aria-label', progressText);\n  }\n  /**\n   * Resize the font-size of text areas that tend to overflow when dialog cards\n   * is squeezed into a tiny container.\n   */\n  ;\n\n  _proto.resizeOverflowingText = function resizeOverflowingText() {\n    if (!this.params.behaviour.scaleTextNotCard) {\n      return; // No text scaling today\n    } // Resize card text if needed\n\n\n    var $textContainer = this.getDOM().find('.h5p-dialogcards-card-text');\n    var $text = $textContainer.children();\n    this.resizeTextToFitContainer($textContainer, $text);\n  }\n  /**\n   * Increase or decrease font size so text wil fit inside container.\n   *\n   * @param {jQuery} $textContainer Outer container, must have a set size.\n   * @param {jQuery} $text Inner text container\n   */\n  ;\n\n  _proto.resizeTextToFitContainer = function resizeTextToFitContainer($textContainer, $text) {\n    // Reset text size\n    $text.css('font-size', '');\n\n    if (window.orientation === 90) {\n      var textInner = this.getDOM().find('.h5p-dialogcards-card-text-inner').get(0);\n\n      if (textInner.clientHeight < textInner.scrollHeight) {\n        var fontSize = parseFloat($text.css('font-size'));\n\n        while (fontSize > Card.MINSCALE && textInner.clientHeight < textInner.scrollHeight) {\n          fontSize -= Card.SCALEINTERVAL;\n          $text.css('font-size', \"\".concat(fontSize, \"px\"));\n        }\n      }\n    } else {\n      // Measure container and text height\n      var currentTextContainerHeight = $textContainer.get(0).getBoundingClientRect().height;\n      var currentTextHeight = $text.get(0).getBoundingClientRect().height;\n      var parentFontSize = parseFloat($textContainer.css('font-size'));\n\n      var _fontSize = parseFloat($text.css('font-size'));\n\n      var $inner = this.getDOM().closest('.h5p-container');\n      var mainFontSize = parseFloat($inner.css('font-size')); // Decrease font size\n\n      if (currentTextHeight > currentTextContainerHeight) {\n        var decreaseFontSize = true;\n\n        while (decreaseFontSize) {\n          _fontSize -= Card.SCALEINTERVAL;\n\n          if (_fontSize < Card.MINSCALE) {\n            decreaseFontSize = false;\n            break;\n          }\n\n          $text.css('font-size', _fontSize / parentFontSize + 'em');\n          currentTextHeight = $text.get(0).getBoundingClientRect().height;\n\n          if (currentTextHeight <= currentTextContainerHeight) {\n            decreaseFontSize = false;\n          }\n        }\n      } else {\n        // Increase font size\n        var increaseFontSize = true;\n\n        while (increaseFontSize) {\n          _fontSize += Card.SCALEINTERVAL; // Cap at  16px\n\n          if (_fontSize > mainFontSize) {\n            increaseFontSize = false;\n            break;\n          } // Set relative font size to scale with full screen.\n\n\n          $text.css('font-size', _fontSize / parentFontSize + 'em');\n          currentTextHeight = $text.get(0).getBoundingClientRect().height;\n\n          if (currentTextHeight >= currentTextContainerHeight) {\n            increaseFontSize = false;\n            _fontSize = _fontSize - Card.SCALEINTERVAL;\n            $text.css('font-size', _fontSize / parentFontSize + 'em');\n          }\n        }\n      }\n    }\n  }\n  /**\n   * Adds tip to a card\n   *\n   * @param {jQuery} $card The card\n   * @param {String} [side=front] Which side of the card\n   * @param {Number} [index] Index of card\n   */\n  ;\n\n  _proto.addTipToCard = function addTipToCard($card, side, index) {\n    // Make sure we have a side\n    if (side !== 'back') {\n      side = 'front';\n    } // Make sure we have an index\n\n\n    if (index === undefined) {\n      index = this.id;\n    } // Remove any old tips\n\n\n    $card.find('.joubel-tip-container').remove(); // Add new tip if set and has length after trim\n\n    var tip = (this.card[side].tip || '').trim();\n\n    if (tip.length) {\n      $card.find('.h5p-dialogcards-card-text-wrapper .h5p-dialogcards-card-text-inner').after(H5P.JoubelUI.createTip(tip, {\n        tipLabel: this.params.tipButtonLabel\n      }));\n    }\n  }\n  /**\n   * Set focus to a given card.\n   * @param {boolean} force If true, don't wait for transition.\n   */\n  ;\n\n  _proto.setCardFocus = function setCardFocus(force) {\n    if (force === true) {\n      this.$cardTextArea.focus();\n    } else {\n      // Wait for transition, then set focus\n      var $card = this.getDOM();\n      $card.one('transitionend', function () {\n        $card.focus();\n      });\n    }\n  }\n  /**\n   * Stop audio of card.\n   */\n  ;\n\n  _proto.stopAudio = function stopAudio() {\n    var _this3 = this;\n\n    var sides = ['front', 'back'];\n    sides.forEach(function (side) {\n      if (!_this3.audios[side] || !_this3.audios[side].audio) {\n        return;\n      }\n      /*\n       * We need to reset the audio button to its initial visual state, but it\n       * doesn't have a function to to that -> force ended event and reload.\n       */\n\n\n      if (_this3.audios[side].audio.duration > 0) {\n        _this3.audios[side].audio.pause();\n\n        _this3.audios[side].audio.currentTime = Math.floor(_this3.audios[side].audio.duration);\n      }\n\n      if (_this3.audios[side].audio.load) {\n        setTimeout(function () {\n          _this3.audios[side].audio.load();\n        }, 100);\n      }\n    });\n  }\n  /**\n   * Get card's DOM\n   *\n   * @return {jQuery} Card's DOM.\n   */\n  ;\n\n  _proto.getDOM = function getDOM() {\n    return this.$cardWrapper;\n  }\n  /**\n   * Set no text mode.\n   */\n  ;\n\n  _proto.setNoText = function setNoText() {\n    this.getDOM().addClass('h5p-no-text');\n  }\n  /**\n   * Get card's text.\n   *\n   * @return {string} Card's text.\n   */\n  ;\n\n  _proto.getText = function getText() {\n    return this.card.front.text;\n  }\n  /**\n   * Get card's answer.\n   *\n   * @return {string} Card's answer.\n   */\n  ;\n\n  _proto.getAnswer = function getAnswer() {\n    return this.card.back.text;\n  }\n  /**\n   * Get card's image wrapper.\n   *\n   * @return {jQuery} Card's image.\n   */\n  ;\n\n  _proto.getImageWrapper = function getImageWrapper() {\n    return this.$imageWrapper;\n  }\n  /**\n   * Set card image height.\n   * @param {string} height CSS height value.\n   */\n  ;\n\n  _proto.setImageHeight = function setImageHeight(height) {\n    this.$imageWrapper.css('height', height);\n  }\n  /**\n   * Get card's Audio.\n   *\n   * @return {Element} Card's audio.\n   */\n  ;\n\n  _proto.getAudio = function getAudio() {\n    return this.isTurned() ? this.$audioWrappers.back : this.$audioWrappers.front;\n  }\n  /**\n   * Detect whether card is turned.\n   * @return {boolean} True, if card is turned.\n   */\n  ;\n\n  _proto.isTurned = function isTurned() {\n    return this.getDOM().find('.h5p-dialogcards-card-content').hasClass('h5p-dialogcards-turned');\n  }\n  /**\n   * Reset card.\n   */\n  ;\n\n  _proto.reset = function reset() {\n    var $card = this.getDOM();\n    $card.removeClass('h5p-dialogcards-previous');\n    $card.removeClass('h5p-dialogcards-current');\n    this.changeText(this.getText());\n    var $cardContent = $card.find('.h5p-dialogcards-card-content');\n    $cardContent.removeClass('h5p-dialogcards-turned');\n    this.addTipToCard($cardContent, 'front', this.id);\n\n    if (!this.params.behaviour.quickProgression) {\n      $card.find('.h5p-dialogcards-answer-button').removeClass('h5p-dialogcards-quick-progression');\n    }\n\n    this.hideSummaryButton();\n  };\n\n  return Card;\n}(); // Constants\n\n\nCard.SCALEINTERVAL = 0.2;\nCard.MAXSCALE = 16;\nCard.MINSCALE = 4;\n/* harmony default export */ __webpack_exports__[\"default\"] = (Card);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvc2NyaXB0cy9oNXAtZGlhbG9nY2FyZHMtY2FyZC5qcy5qcyIsIm1hcHBpbmdzIjoiO0FBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUdBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFIQTs7QUFLQTtBQUNBO0FBQ0E7O0FBRUE7QUFBQTtBQUFBO0FBR0E7QUFHQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQUNBO0FBQ0E7QUFDQTtBQURBOztBQUtBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFEQTtBQUlBO0FBQ0E7QUFEQTtBQUlBO0FBQ0E7QUFEQTs7QUFLQTs7QUFJQTtBQUdBO0FBQ0E7QUFEQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFNQTtBQUdBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFIQTs7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUFBO0FBQ0E7O0FBSUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFLQTtBQUNBO0FBQ0E7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUlBO0FBQ0E7O0FBRUE7QUFDQTs7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUZBO0FBS0E7QUFDQTtBQUNBO0FBRkE7QUFLQTtBQUNBO0FBQ0E7QUFGQTtBQVFBO0FBQ0E7QUFDQTtBQUZBO0FBUUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUFBOztBQUNBO0FBR0E7QUFDQTtBQUNBOztBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFFQTtBQUdBO0FBQ0E7QUFFQTtBQUdBO0FBQ0E7QUFDQTs7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7O0FBTUE7QUFHQTtBQUNBO0FBQUE7QUFHQTtBQUVBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBTUE7QUFHQTtBQUVBO0FBRUE7QUFDQTtBQUNBOzs7QUFDQTtBQUFBOztBQUNBO0FBQ0E7QUFDQTs7QUFHQTtBQUVBO0FBQ0E7QUFDQTs7O0FBR0E7QUFFQTs7QUFDQTtBQUlBOzs7QUFDQTs7O0FBR0E7QUFDQTs7QUFHQTtBQUNBO0FBR0E7QUFDQTtBQUdBOzs7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOzs7QUFHQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBSUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBQ0E7O0FBRUE7QUFDQTs7QUFHQTtBQUNBOztBQUNBO0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFFQTs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTs7QUFDQTtBQUNBOztBQUdBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBOztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFJQTtBQUNBO0FBQ0E7OztBQUdBOztBQUdBOztBQUNBO0FBQ0E7QUFFQTtBQURBO0FBR0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBOzs7QUFDQTtBQUFBOztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTs7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFHQTtBQUVBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBQ0E7QUFDQTs7O0FBR0E7OztBQUNBO0FBQ0E7QUFDQTtBQUVBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vaDVwLWRpYWxvZ2NhcmRzLy4vc3JjL3NjcmlwdHMvaDVwLWRpYWxvZ2NhcmRzLWNhcmQuanM/ZTA4MiJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCAkID0gSDVQLmpRdWVyeTtcblxuY2xhc3MgQ2FyZCB7XG4gIC8qKlxuICAgKiBAY29uc3RydWN0b3JcbiAgICpcbiAgICogQHBhcmFtIHtvYmplY3R9IGNhcmQgQ2FyZCBwYXJhbWV0ZXJzXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBwYXJhbXMgUGFyZW50J3MgcGFyYW1zXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBpZCBDYXJkIG51bWJlciBpbiBvcmRlciBvZiBhcHBlYXJhbmNlXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBbY2FsbGJhY2tzXSBDYWxsYmFja3MuXG4gICAqIEBwYXJhbSB7ZnVuY3Rpb259IFtjYWxsYmFja3Mub25DYXJkU2l6ZV0gQ2FsbCB3aGVuIGNhcmQgbmVlZHMgcmVzaXplLlxuICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBbY2FsbGJhY2tzLm9uQ2FyZFR1cm5lZF0gQ2FsbCB3aGVuIGNhcmQgd2FzIHR1cm5lZC5cbiAgICovXG4gIGNvbnN0cnVjdG9yKGNhcmQsIHBhcmFtcywgaWQsIGNvbnRlbnRJZCwgY2FsbGJhY2tzID0ge30pIHtcbiAgICB0aGlzLmNhcmQgPSBjYXJkO1xuICAgIHRoaXMucGFyYW1zID0gcGFyYW1zIHx8IHt9O1xuICAgIHRoaXMuaWQgPSBpZDtcbiAgICB0aGlzLmNvbnRlbnRJZCA9IGNvbnRlbnRJZDtcbiAgICB0aGlzLmNhbGxiYWNrcyA9IGNhbGxiYWNrcztcblxuICAgIC8vIENoZWNrIGlmIHRvIHVzZSBmcm9udCBzZXR0aW5ncyBmb3IgYmFjaywgdG9vXG4gICAgaWYgKHRoaXMuY2FyZC5iYWNrLnVzZUltYWdlRnJvbUZyb250KSB7XG4gICAgICB0aGlzLmNhcmQuYmFjay5pbWFnZSA9IHRoaXMuY2FyZC5mcm9udC5pbWFnZTtcbiAgICAgIHRoaXMuY2FyZC5iYWNrLmltYWdlQWx0VGV4dCA9IHRoaXMuY2FyZC5mcm9udC5pbWFnZUFsdFRleHQ7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuY2FyZC5iYWNrLnVzZUF1ZGlvRnJvbUZyb250KSB7XG4gICAgICB0aGlzLmNhcmQuYmFjay5hdWRpbyA9IHRoaXMuY2FyZC5mcm9udC5hdWRpbztcbiAgICB9XG5cbiAgICB0aGlzLmF1ZGlvcyA9IHt9O1xuICAgIHRoaXMuJGF1ZGlvV3JhcHBlcnMgPSB7fTtcblxuICAgIHRoaXMuJGNhcmRXcmFwcGVyID0gJCgnPGRpdj4nLCB7XG4gICAgICAnY2xhc3MnOiAnaDVwLWRpYWxvZ2NhcmRzLWNhcmR3cmFwJyxcbiAgICAgICdyb2xlJzogJ2dyb3VwJyxcbiAgICAgICd0YWJpbmRleCc6ICctMSdcbiAgICB9KTtcbiAgICBpZiAodGhpcy5wYXJhbXMubW9kZSAhPT0gJ3JlcGV0aXRpb24nKSB7XG4gICAgICB0aGlzLiRjYXJkV3JhcHBlci5hdHRyKCdhcmlhLWxhYmVsbGVkYnknLCAnaDVwLWRpYWxvZ2NhcmRzLXByb2dyZXNzLScgKyBINVAuRGlhbG9nY2FyZHMuaWRDb3VudGVyKTtcbiAgICB9XG5cbiAgICB0aGlzLiRjYXJkSG9sZGVyID0gJCgnPGRpdj4nLCB7J2NsYXNzJzogJ2g1cC1kaWFsb2djYXJkcy1jYXJkaG9sZGVyJ30pXG4gICAgICAuYXBwZW5kVG8odGhpcy4kY2FyZFdyYXBwZXIpO1xuXG4gICAgdGhpcy5jcmVhdGVDYXJkQ29udGVudChjYXJkKVxuICAgICAgLmFwcGVuZFRvKHRoaXMuJGNhcmRIb2xkZXIpO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGNvbnRlbnQgZm9yIGEgY2FyZFxuICAgKlxuICAgKiBAcGFyYW0ge29iamVjdH0gY2FyZCBDYXJkIHBhcmFtZXRlcnNcbiAgICogQHJldHVybnMgeyp8alF1ZXJ5fEhUTUxFbGVtZW50fSBDYXJkIGNvbnRlbnQgd3JhcHBlclxuICAgKi9cbiAgY3JlYXRlQ2FyZENvbnRlbnQoY2FyZCkge1xuICAgIGNvbnN0ICRjYXJkQ29udGVudCA9ICQoJzxkaXY+Jywge1xuICAgICAgJ2NsYXNzJzogJ2g1cC1kaWFsb2djYXJkcy1jYXJkLWNvbnRlbnQnXG4gICAgfSk7XG5cbiAgICAvLyBJbWFnZXNcbiAgICB0aGlzLiRpbWFnZVdyYXBwZXIgPSAkKCc8ZGl2PicsIHtcbiAgICAgICdjbGFzcyc6ICdoNXAtZGlhbG9nY2FyZHMtaW1hZ2Utd3JhcHBlcidcbiAgICB9KTtcbiAgICB0aGlzLmNyZWF0ZUNhcmRJbWFnZShjYXJkLCAnZnJvbnQnKS5hcHBlbmRUbyh0aGlzLiRpbWFnZVdyYXBwZXIpO1xuICAgIHRoaXMuY3JlYXRlQ2FyZEltYWdlKGNhcmQsICdiYWNrJykuYXBwZW5kVG8odGhpcy4kaW1hZ2VXcmFwcGVyKTtcbiAgICB0aGlzLiRpbWFnZVdyYXBwZXIuYXBwZW5kVG8oJGNhcmRDb250ZW50KTtcblxuICAgIGNvbnN0ICRjYXJkVGV4dFdyYXBwZXIgPSAkKCc8ZGl2PicsIHtcbiAgICAgICdjbGFzcyc6ICdoNXAtZGlhbG9nY2FyZHMtY2FyZC10ZXh0LXdyYXBwZXInXG4gICAgfSkuYXBwZW5kVG8oJGNhcmRDb250ZW50KTtcblxuICAgIGNvbnN0ICRjYXJkVGV4dElubmVyID0gJCgnPGRpdj4nLCB7XG4gICAgICAnY2xhc3MnOiAnaDVwLWRpYWxvZ2NhcmRzLWNhcmQtdGV4dC1pbm5lcidcbiAgICB9KS5hcHBlbmRUbygkY2FyZFRleHRXcmFwcGVyKTtcblxuICAgIGNvbnN0ICRjYXJkVGV4dElubmVyQ29udGVudCA9ICQoJzxkaXY+Jywge1xuICAgICAgJ2NsYXNzJzogJ2g1cC1kaWFsb2djYXJkcy1jYXJkLXRleHQtaW5uZXItY29udGVudCdcbiAgICB9KS5hcHBlbmRUbygkY2FyZFRleHRJbm5lcik7XG5cbiAgICAvLyBGcm9udCBhdWRpb1xuICAgIHRoaXMuJGF1ZGlvV3JhcHBlcnMuZnJvbnQgPSB0aGlzLmNyZWF0ZUNhcmRBdWRpbyhjYXJkLCAnZnJvbnQnKVxuICAgICAgLmFwcGVuZFRvKCRjYXJkVGV4dElubmVyQ29udGVudCk7XG5cbiAgICAvLyBCYWNrIGF1ZGlvXG4gICAgdGhpcy4kYXVkaW9XcmFwcGVycy5iYWNrID0gdGhpcy5jcmVhdGVDYXJkQXVkaW8oY2FyZCwgJ2JhY2snKVxuICAgICAgLmFwcGVuZFRvKCRjYXJkVGV4dElubmVyQ29udGVudCk7XG5cbiAgICBjb25zdCAkY2FyZFRleHQgPSAkKCc8ZGl2PicsIHtcbiAgICAgICdjbGFzcyc6ICdoNXAtZGlhbG9nY2FyZHMtY2FyZC10ZXh0J1xuICAgIH0pLmFwcGVuZFRvKCRjYXJkVGV4dElubmVyQ29udGVudCk7XG5cbiAgICB0aGlzLiRjYXJkVGV4dEFyZWEgPSAkKCc8ZGl2PicsIHtcbiAgICAgICdjbGFzcyc6ICdoNXAtZGlhbG9nY2FyZHMtY2FyZC10ZXh0LWFyZWEnLFxuICAgICAgJ3RhYmluZGV4JzogJy0xJyxcbiAgICAgICdodG1sJzogY2FyZC5mcm9udC50ZXh0XG4gICAgfSkuYXBwZW5kVG8oJGNhcmRUZXh0KTtcblxuICAgIHRoaXMuY3JlYXRlQ2FyZEZvb3RlcigpXG4gICAgICAuYXBwZW5kVG8oJGNhcmRUZXh0V3JhcHBlcik7XG5cbiAgICByZXR1cm4gJGNhcmRDb250ZW50O1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBjYXJkIGltYWdlXG4gICAqXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBjYXJkIENhcmQgcGFyYW1ldGVyc1xuICAgKiBAcGFyYW0ge3N0cmluZ30gc2lkZSBTaWRlLCBlaXRoZXIgZnJvbnQgb3IgYmFjay5cbiAgICogQHJldHVybnMgeyp8alF1ZXJ5fEhUTUxFbGVtZW50fSBDYXJkIGltYWdlIHdyYXBwZXJcbiAgICovXG4gIGNyZWF0ZUNhcmRJbWFnZShjYXJkLCBzaWRlKSB7XG4gICAgbGV0ICRpbWFnZTtcblxuICAgIGlmIChjYXJkW3NpZGVdLmltYWdlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICRpbWFnZSA9ICQoJzxpbWcgY2xhc3M9XCJoNXAtZGlhbG9nY2FyZHMtaW1hZ2VcIiBzcmM9XCInICsgSDVQLmdldFBhdGgoY2FyZFtzaWRlXS5pbWFnZS5wYXRoLCB0aGlzLmNvbnRlbnRJZCkgKyAnXCIvPicpO1xuICAgICAgJGltYWdlLmFkZENsYXNzKGBoNXAtZGlhbG9nY2FyZHMtaW1hZ2UtJHtzaWRlfWApO1xuXG4gICAgICAvLyBLaWRzTG9vcCBjdXN0b21pemF0aW9uIHRvIHByZXZlbnQgZHJhZ2dpbmcgdGhlIGltYWdlXG4gICAgICAkaW1hZ2UuZ2V0KDApLmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdzdGFydCcsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgfSk7XG4gICAgICAvKlxuICAgICAgICogS2lkc0xvb3AgY3VzdG9taXphdGlvbiB0byBwcmV2ZW50IHNhdmluZyBpbWFnZXMgb24gQW5kcm9pZC4gQ2Fubm90XG4gICAgICAgKiB1c2UgQ1NTIGBwb2ludGVyLWV2ZW50czogbm9uZWAsIGJlY2F1c2UgaXQgaW50ZXJmZXJlcyB3aXRoIGRyYWdzdGFydFxuICAgICAgICovXG4gICAgICAkaW1hZ2UuZ2V0KDApLmFkZEV2ZW50TGlzdGVuZXIoJ2NvbnRleHRtZW51JywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH0pO1xuICAgICAgLy8gS2lkc0xvb3AgY3VzdG9taXphdGlvbiB0byBwcmV2ZW50IGRyYWdnaW5nIHRoZSBpbWFnZSBvbiBpT1NcbiAgICAgICRpbWFnZS5jc3Moe1xuICAgICAgICAndXNlci1zZWxlY3QnOiAnbm9uZScsXG4gICAgICAgICctd2Via2l0LXVzZXItc2VsZWN0JzogJ25vbmUnLFxuICAgICAgICAnLXdlYmtpdC10b3VjaC1jYWxsb3V0JzogJ25vbmUnXG4gICAgICB9KTtcblxuICAgICAgaWYgKGNhcmRbc2lkZV0uaW1hZ2VBbHRUZXh0KSB7XG4gICAgICAgICRpbWFnZS5hdHRyKCdhbHQnLCBjYXJkW3NpZGVdLmltYWdlQWx0VGV4dCk7XG4gICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgJGltYWdlID0gJCgnPGRpdiBjbGFzcz1cImg1cC1kaWFsb2djYXJkcy1pbWFnZVwiPjwvZGl2PicpO1xuICAgIH1cblxuICAgIHJldHVybiAkaW1hZ2U7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGNhcmQgYXVkaW8uXG4gICAqXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBjYXJkIENhcmQgcGFyYW1ldGVycy5cbiAgICogQHBhcmFtIHtzdHJpbmd9IHNpZGUgU2lkZSwgZWl0aGVyIGZyb250IG9yIGJhY2suXG4gICAqIEByZXR1cm5zIHsqfGpRdWVyeXxIVE1MRWxlbWVudH0gQ2FyZCBhdWRpbyBlbGVtZW50LlxuICAgKi9cbiAgY3JlYXRlQ2FyZEF1ZGlvKGNhcmQsIHNpZGUgPSAnZnJvbnQnKSB7XG4gICAgY29uc3QgJGF1ZGlvV3JhcHBlciA9ICQoJzxkaXY+JylcbiAgICAgIC5hZGRDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLWF1ZGlvLXdyYXBwZXInKVxuICAgICAgLmFkZENsYXNzKGBoNXAtZGlhbG9nY2FyZHMtYXVkaW8td3JhcHBlci0ke3NpZGV9YCk7XG5cbiAgICBpZiAoIWNhcmRbc2lkZV0udGV4dCB8fCBjYXJkW3NpZGVdLnRleHQgPT09ICcnKSB7XG4gICAgICAkYXVkaW9XcmFwcGVyLmFkZENsYXNzKCdoNXAtbm8tdGV4dCcpO1xuICAgIH1cblxuICAgIGlmIChjYXJkW3NpZGVdLmF1ZGlvICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGNvbnN0IGF1ZGlvRGVmYXVsdHMgPSB7XG4gICAgICAgIGZpbGVzOiBjYXJkW3NpZGVdLmF1ZGlvLFxuICAgICAgICBhdWRpb05vdFN1cHBvcnRlZDogdGhpcy5wYXJhbXMuYXVkaW9Ob3RTdXBwb3J0ZWRcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IGF1ZGlvID0gbmV3IEg1UC5BdWRpbyhhdWRpb0RlZmF1bHRzLCB0aGlzLmNvbnRlbnRJZCk7XG4gICAgICB0aGlzLmF1ZGlvc1tzaWRlXSA9IGF1ZGlvO1xuICAgICAgYXVkaW8uYXR0YWNoKCRhdWRpb1dyYXBwZXIpO1xuXG4gICAgICAvLyBIYXZlIHRvIHN0b3AgZWxzZSBhdWRpbyB3aWxsIHRha2UgdXAgYSBzb2NrZXQgcGVuZGluZyBmb3JldmVyIGluIGNocm9tZS5cbiAgICAgIGlmIChhdWRpby5hdWRpbyAmJiBhdWRpby5hdWRpby5wcmVsb2FkKSB7XG4gICAgICAgIGF1ZGlvLmF1ZGlvLnByZWxvYWQgPSAnbm9uZSc7XG4gICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgJGF1ZGlvV3JhcHBlci5hZGRDbGFzcygnaGlkZScpO1xuICAgIH1cblxuICAgIHJldHVybiAkYXVkaW9XcmFwcGVyO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBjYXJkIGZvb3RlclxuICAgKlxuICAgKiBAcmV0dXJucyB7KnxqUXVlcnl8SFRNTEVsZW1lbnR9IENhcmQgZm9vdGVyIGVsZW1lbnRcbiAgICovXG4gIGNyZWF0ZUNhcmRGb290ZXIoKSB7XG4gICAgY29uc3QgJGNhcmRGb290ZXIgPSAkKCc8ZGl2PicsIHtcbiAgICAgICdjbGFzcyc6ICdoNXAtZGlhbG9nY2FyZHMtY2FyZC1mb290ZXInXG4gICAgfSk7XG5cbiAgICBsZXQgY2xhc3Nlc1JlcGV0aXRpb24gPSAnaDVwLWRpYWxvZ2NhcmRzLWJ1dHRvbi1oaWRkZW4nO1xuICAgIGxldCBhdHRyaWJ1dGVUYWJpbmRleCA9ICctMSc7XG5cbiAgICBpZiAodGhpcy5wYXJhbXMubW9kZSA9PT0gJ3JlcGV0aXRpb24nKSB7XG4gICAgICBjbGFzc2VzUmVwZXRpdGlvbiA9ICcnO1xuICAgICAgaWYgKHRoaXMucGFyYW1zLmJlaGF2aW91ci5xdWlja1Byb2dyZXNzaW9uKSB7XG4gICAgICAgIGNsYXNzZXNSZXBldGl0aW9uID0gJ2g1cC1kaWFsb2djYXJkcy1xdWljay1wcm9ncmVzc2lvbic7XG4gICAgICAgIGF0dHJpYnV0ZVRhYmluZGV4ID0gJzAnO1xuICAgICAgfVxuXG4gICAgICAkY2FyZEZvb3Rlci5hZGRDbGFzcygnaDVwLXJlcGV0aXRpb24nKTtcbiAgICB9XG5cbiAgICB0aGlzLiRidXR0b25UdXJuID0gSDVQLkpvdWJlbFVJLmNyZWF0ZUJ1dHRvbih7XG4gICAgICAnY2xhc3MnOiAnaDVwLWRpYWxvZ2NhcmRzLXR1cm4nLFxuICAgICAgJ2h0bWwnOiB0aGlzLnBhcmFtcy5hbnN3ZXJcbiAgICB9KS5hcHBlbmRUbygkY2FyZEZvb3Rlcik7XG5cbiAgICB0aGlzLiRidXR0b25TaG93U3VtbWFyeSA9IEg1UC5Kb3ViZWxVSS5jcmVhdGVCdXR0b24oe1xuICAgICAgJ2NsYXNzJzogJ2g1cC1kaWFsb2djYXJkcy1zaG93LXN1bW1hcnkgaDVwLWRpYWxvZ2NhcmRzLWJ1dHRvbi1nb25lJyxcbiAgICAgICdodG1sJzogdGhpcy5wYXJhbXMuc2hvd1N1bW1hcnlcbiAgICB9KS5hcHBlbmRUbygkY2FyZEZvb3Rlcik7XG5cbiAgICB0aGlzLiRidXR0b25JbmNvcnJlY3QgPSBINVAuSm91YmVsVUkuY3JlYXRlQnV0dG9uKHtcbiAgICAgICdjbGFzcyc6ICdoNXAtZGlhbG9nY2FyZHMtYW5zd2VyLWJ1dHRvbicsXG4gICAgICAnaHRtbCc6IHRoaXMucGFyYW1zLmluY29ycmVjdEFuc3dlclxuICAgIH0pLmFkZENsYXNzKCdpbmNvcnJlY3QnKVxuICAgICAgLmFkZENsYXNzKGNsYXNzZXNSZXBldGl0aW9uKVxuICAgICAgLmF0dHIoJ3RhYmluZGV4JywgYXR0cmlidXRlVGFiaW5kZXgpXG4gICAgICAuYXBwZW5kVG8oJGNhcmRGb290ZXIpO1xuXG4gICAgdGhpcy4kYnV0dG9uQ29ycmVjdCA9IEg1UC5Kb3ViZWxVSS5jcmVhdGVCdXR0b24oe1xuICAgICAgJ2NsYXNzJzogJ2g1cC1kaWFsb2djYXJkcy1hbnN3ZXItYnV0dG9uJyxcbiAgICAgICdodG1sJzogdGhpcy5wYXJhbXMuY29ycmVjdEFuc3dlclxuICAgIH0pLmFkZENsYXNzKCdjb3JyZWN0JylcbiAgICAgIC5hZGRDbGFzcyhjbGFzc2VzUmVwZXRpdGlvbilcbiAgICAgIC5hdHRyKCd0YWJpbmRleCcsIGF0dHJpYnV0ZVRhYmluZGV4KVxuICAgICAgLmFwcGVuZFRvKCRjYXJkRm9vdGVyKTtcblxuICAgIHJldHVybiAkY2FyZEZvb3RlcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYnV0dG9uIGxpc3RlbmVycy5cbiAgICogV2lsbCBiZSBsb3N0IHdoZW4gdGhlIGVsZW1lbnQgaXMgcmVtb3ZlZCBmcm9tIERPTS5cbiAgICovXG4gIGNyZWF0ZUJ1dHRvbkxpc3RlbmVycygpIHtcbiAgICB0aGlzLiRidXR0b25JbmNvcnJlY3RcbiAgICAgIC51bmJpbmQoJ2NsaWNrJylcbiAgICAgIC5jbGljayhldmVudCA9PiB7XG4gICAgICAgIGlmICghZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnaDVwLWRpYWxvZ2NhcmRzLXF1aWNrLXByb2dyZXNzaW9uJykpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jYWxsYmFja3Mub25OZXh0Q2FyZCh7Y2FyZElkOiB0aGlzLmlkLCByZXN1bHQ6IGZhbHNlfSk7XG4gICAgICB9KTtcblxuICAgIHRoaXMuJGJ1dHRvblR1cm5cbiAgICAgIC51bmJpbmQoJ2NsaWNrJylcbiAgICAgIC5jbGljaygoKSA9PiB7XG4gICAgICAgIHRoaXMudHVybkNhcmQoKTtcbiAgICAgIH0pO1xuXG4gICAgdGhpcy4kYnV0dG9uQ29ycmVjdFxuICAgICAgLnVuYmluZCgnY2xpY2snKVxuICAgICAgLmNsaWNrKGV2ZW50ID0+IHtcbiAgICAgICAgaWYgKCFldmVudC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdoNXAtZGlhbG9nY2FyZHMtcXVpY2stcHJvZ3Jlc3Npb24nKSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNhbGxiYWNrcy5vbk5leHRDYXJkKHtjYXJkSWQ6IHRoaXMuaWQsIHJlc3VsdDogdHJ1ZX0pO1xuICAgICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogU2hvdyBzdW1tYXJ5IGJ1dHRvbiBvbiBsYXN0IGNhcmQuXG4gICAqXG4gICAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGNhbGxlZCBvbiBidXR0b24gY2xpY2suXG4gICAqL1xuICBzaG93U3VtbWFyeUJ1dHRvbihjYWxsYmFjaykge1xuICAgIC8vIEhpZGUgYW5zd2VyIGJ1dHRvbnNcbiAgICB0aGlzLmdldERPTSgpXG4gICAgICAuZmluZCgnLmg1cC1kaWFsb2djYXJkcy1hbnN3ZXItYnV0dG9uJylcbiAgICAgIC5hZGRDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLWJ1dHRvbi1oaWRkZW4nKVxuICAgICAgLmF0dHIoJ3RhYmluZGV4JywgJy0xJyk7XG5cbiAgICAvLyBTd2FwIHR1cm4gYnV0dG9uIHdpdGggc2hvdyBzdW1tYXJ5IGJ1dHRvblxuICAgIHRoaXMuJGJ1dHRvblR1cm5cbiAgICAgIC5hZGRDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLWJ1dHRvbi1nb25lJyk7XG5cbiAgICB0aGlzLiRidXR0b25TaG93U3VtbWFyeVxuICAgICAgLmNsaWNrKCgpID0+IGNhbGxiYWNrKCkpXG4gICAgICAucmVtb3ZlQ2xhc3MoJ2g1cC1kaWFsb2djYXJkcy1idXR0b24tZ29uZScpXG4gICAgICAuZm9jdXMoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIaWRlIHN1bW1hcnkgYnV0dG9uIGFuZCBzaG93IGFuc3dlciBidXR0b25zIGFnYWluLlxuICAgKi9cbiAgaGlkZVN1bW1hcnlCdXR0b24oKSB7XG4gICAgaWYgKHRoaXMucGFyYW1zLm1vZGUgPT09ICdub3JtYWwnKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5nZXRET00oKVxuICAgICAgLmZpbmQoJy5oNXAtZGlhbG9nY2FyZHMtYW5zd2VyLWJ1dHRvbicpXG4gICAgICAucmVtb3ZlQ2xhc3MoJ2g1cC1kaWFsb2djYXJkcy1idXR0b24taGlkZGVuJylcbiAgICAgIC5hdHRyKCd0YWJpbmRleCcsICcwJyk7XG5cbiAgICAvLyBTd2FwIHR1cm4gYnV0dG9uIHdpdGggc2hvdyBzdW1tYXJ5IGJ1dHRvblxuICAgIHRoaXMuJGJ1dHRvblR1cm5cbiAgICAgIC5yZW1vdmVDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLWJ1dHRvbi1nb25lJyk7XG5cbiAgICB0aGlzLiRidXR0b25TaG93U3VtbWFyeVxuICAgICAgLmFkZENsYXNzKCdoNXAtZGlhbG9nY2FyZHMtYnV0dG9uLWdvbmUnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTaG93IHRoZSBvcHBvc2l0ZSBzaWRlIG9mIHRoZSBjYXJkLlxuICAgKi9cbiAgdHVybkNhcmQoKSB7XG4gICAgY29uc3QgJGNhcmQgPSB0aGlzLmdldERPTSgpO1xuICAgIGNvbnN0ICRjID0gJGNhcmQuZmluZCgnLmg1cC1kaWFsb2djYXJkcy1jYXJkLWNvbnRlbnQnKTtcbiAgICBjb25zdCAkY2ggPSAkY2FyZC5maW5kKCcuaDVwLWRpYWxvZ2NhcmRzLWNhcmRob2xkZXInKS5hZGRDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLWNvbGxhcHNlJyk7XG5cbiAgICAvLyBSZW1vdmVzIHRpcCwgc2luY2UgaXQgZGVzdHJveXMgdGhlIGFuaW1hdGlvbjpcbiAgICAkYy5maW5kKCcuam91YmVsLXRpcC1jb250YWluZXInKS5yZW1vdmUoKTtcblxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgLy8gQ2hlY2sgaWYgY2FyZCBoYXMgYmVlbiB0dXJuZWQgYmVmb3JlXG4gICAgICBjb25zdCB0dXJuZWQgPSB0aGlzLmlzVHVybmVkKCk7XG5cbiAgICAgIC8vIFVwZGF0ZSBIVE1MIGNsYXNzIGZvciBjYXJkXG4gICAgICAkYy50b2dnbGVDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLXR1cm5lZCcsICF0dXJuZWQpO1xuXG4gICAgICAkY2gucmVtb3ZlQ2xhc3MoJ2g1cC1kaWFsb2djYXJkcy1jb2xsYXBzZScpO1xuICAgICAgdGhpcy5jaGFuZ2VUZXh0KHR1cm5lZCA/IHRoaXMuZ2V0VGV4dCgpIDogdGhpcy5nZXRBbnN3ZXIoKSk7XG5cbiAgICAgIC8vIEltYWdlIHNob3duL2hpZGRlbiB2aWEgQ1NTXG5cbiAgICAgIC8vIEF1ZGlvIGJ1dHRvbnMgc2hvd24vaGlkZGVuIHZpYSBDU1NcbiAgICAgIHRoaXMuc3RvcEF1ZGlvKCk7XG5cbiAgICAgIC8vIFRvZ2dsZSBzdGF0ZSBmb3Iga25vd2xlZGdlIGNvbmZpcm1hdGlvbiBidXR0b25zXG4gICAgICBpZiAodGhpcy5wYXJhbXMubW9kZSA9PT0gJ3JlcGV0aXRpb24nICYmICF0aGlzLnBhcmFtcy5iZWhhdmlvdXIucXVpY2tQcm9ncmVzc2lvbikge1xuICAgICAgICBjb25zdCAkYW5zd2VyQnV0dG9ucyA9ICRjYXJkLmZpbmQoJy5oNXAtZGlhbG9nY2FyZHMtYW5zd2VyLWJ1dHRvbicpO1xuXG4gICAgICAgIC8vIERvbid0IHJldm9rZSBxdWljayBwcm9ncmVzc2lvbiBhZnRlciBjYXJkIHdhcyB0dXJuZWQuXG4gICAgICAgIGlmICgkYW5zd2VyQnV0dG9ucy5oYXNDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLXF1aWNrLXByb2dyZXNzaW9uJykgPT09IGZhbHNlKSB7XG4gICAgICAgICAgJGFuc3dlckJ1dHRvbnNcbiAgICAgICAgICAgIC5hZGRDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLXF1aWNrLXByb2dyZXNzaW9uJylcbiAgICAgICAgICAgIC5hdHRyKCd0YWJpbmRleCcsIDApO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIEFkZCBiYWNrc2lkZSB0aXBcbiAgICAgIC8vIEhhZCB0byB3YWl0IGEgbGl0dGxlLCBpZiBub3QgQ2hyb21lIHdpbGwgZGlzcGxhY2UgdGlwIGljb25cbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICB0aGlzLmFkZFRpcFRvQ2FyZCgkYywgdHVybmVkID8gJ2Zyb250JyA6ICdiYWNrJyk7XG5cbiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLmNhbGxiYWNrcy5vbkNhcmRUdXJuZWQgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICB0aGlzLmNhbGxiYWNrcy5vbkNhcmRUdXJuZWQodHVybmVkKTtcbiAgICAgICAgfVxuICAgICAgfSwgMjAwKTtcblxuICAgICAgdGhpcy5yZXNpemVPdmVyZmxvd2luZ1RleHQoKTtcblxuICAgICAgLy8gRm9jdXMgdGV4dFxuICAgICAgdGhpcy4kY2FyZFRleHRBcmVhLmZvY3VzKCk7XG4gICAgfSwgMjAwKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGFuZ2UgdGV4dCBvZiBjYXJkLCB1c2VkIHdoZW4gdHVybmluZyBjYXJkcy5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IHRleHQgVGV4dCB0byBzZXQuXG4gICAqL1xuICBjaGFuZ2VUZXh0KHRleHQpIHtcbiAgICB0aGlzLiRjYXJkVGV4dEFyZWEuaHRtbCh0ZXh0KTtcbiAgICB0aGlzLiRjYXJkVGV4dEFyZWEudG9nZ2xlQ2xhc3MoJ2hpZGUnLCAoIXRleHQgfHwgIXRleHQubGVuZ3RoKSk7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHByb2dyZXNzIGZvciBhc3Npc3RpdmUgdGVjaG5vbG9naWVzLlxuICAgKiBAcGFyYW0ge251bWJlcn0gcG9zaXRpb24gUG9zaXRpb24uXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBtYXggTWF4aW11bSBwb3NpdGlvbi5cbiAgICovXG4gIHNldFByb2dyZXNzVGV4dChwb3NpdGlvbiwgdG90YWwpIHtcbiAgICBpZiAodGhpcy5wYXJhbXMubW9kZSAhPT0gJ3JlcGV0aXRpb24nKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgcHJvZ3Jlc3NUZXh0ID0gdGhpcy5wYXJhbXMucHJvZ3Jlc3NUZXh0XG4gICAgICAucmVwbGFjZSgnQGNhcmQnLCAocG9zaXRpb24pLnRvU3RyaW5nKCkpXG4gICAgICAucmVwbGFjZSgnQHRvdGFsJywgKHRvdGFsKS50b1N0cmluZygpKTtcblxuICAgIHRoaXMuJGNhcmRXcmFwcGVyLmF0dHIoJ2FyaWEtbGFiZWwnLCBwcm9ncmVzc1RleHQpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlc2l6ZSB0aGUgZm9udC1zaXplIG9mIHRleHQgYXJlYXMgdGhhdCB0ZW5kIHRvIG92ZXJmbG93IHdoZW4gZGlhbG9nIGNhcmRzXG4gICAqIGlzIHNxdWVlemVkIGludG8gYSB0aW55IGNvbnRhaW5lci5cbiAgICovXG4gIHJlc2l6ZU92ZXJmbG93aW5nVGV4dCgpIHtcbiAgICBpZiAoIXRoaXMucGFyYW1zLmJlaGF2aW91ci5zY2FsZVRleHROb3RDYXJkKSB7XG4gICAgICByZXR1cm47IC8vIE5vIHRleHQgc2NhbGluZyB0b2RheVxuICAgIH1cblxuICAgIC8vIFJlc2l6ZSBjYXJkIHRleHQgaWYgbmVlZGVkXG4gICAgY29uc3QgJHRleHRDb250YWluZXIgPSB0aGlzLmdldERPTSgpLmZpbmQoJy5oNXAtZGlhbG9nY2FyZHMtY2FyZC10ZXh0Jyk7XG4gICAgY29uc3QgJHRleHQgPSAkdGV4dENvbnRhaW5lci5jaGlsZHJlbigpO1xuICAgIHRoaXMucmVzaXplVGV4dFRvRml0Q29udGFpbmVyKCR0ZXh0Q29udGFpbmVyLCAkdGV4dCk7XG4gIH1cblxuICAvKipcbiAgICogSW5jcmVhc2Ugb3IgZGVjcmVhc2UgZm9udCBzaXplIHNvIHRleHQgd2lsIGZpdCBpbnNpZGUgY29udGFpbmVyLlxuICAgKlxuICAgKiBAcGFyYW0ge2pRdWVyeX0gJHRleHRDb250YWluZXIgT3V0ZXIgY29udGFpbmVyLCBtdXN0IGhhdmUgYSBzZXQgc2l6ZS5cbiAgICogQHBhcmFtIHtqUXVlcnl9ICR0ZXh0IElubmVyIHRleHQgY29udGFpbmVyXG4gICAqL1xuICByZXNpemVUZXh0VG9GaXRDb250YWluZXIoJHRleHRDb250YWluZXIsICR0ZXh0KSB7XG4gICAgLy8gUmVzZXQgdGV4dCBzaXplXG4gICAgJHRleHQuY3NzKCdmb250LXNpemUnLCAnJyk7XG5cbiAgICBpZiAod2luZG93Lm9yaWVudGF0aW9uID09PSA5MCkge1xuICAgICAgY29uc3QgdGV4dElubmVyID0gdGhpcy5nZXRET00oKS5maW5kKCcuaDVwLWRpYWxvZ2NhcmRzLWNhcmQtdGV4dC1pbm5lcicpLmdldCgwKTtcblxuICAgICAgaWYgKHRleHRJbm5lci5jbGllbnRIZWlnaHQgPCB0ZXh0SW5uZXIuc2Nyb2xsSGVpZ2h0KSB7XG4gICAgICAgIGxldCBmb250U2l6ZSA9IHBhcnNlRmxvYXQoJHRleHQuY3NzKCdmb250LXNpemUnKSk7XG4gICAgICAgIHdoaWxlIChmb250U2l6ZSA+IENhcmQuTUlOU0NBTEUgJiYgdGV4dElubmVyLmNsaWVudEhlaWdodCA8IHRleHRJbm5lci5zY3JvbGxIZWlnaHQpIHtcbiAgICAgICAgICBmb250U2l6ZSAtPSBDYXJkLlNDQUxFSU5URVJWQUw7XG4gICAgICAgICAgJHRleHQuY3NzKCdmb250LXNpemUnLCBgJHtmb250U2l6ZX1weGApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgLy8gTWVhc3VyZSBjb250YWluZXIgYW5kIHRleHQgaGVpZ2h0XG4gICAgICBjb25zdCBjdXJyZW50VGV4dENvbnRhaW5lckhlaWdodCA9ICR0ZXh0Q29udGFpbmVyLmdldCgwKS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5oZWlnaHQ7XG4gICAgICBsZXQgY3VycmVudFRleHRIZWlnaHQgPSAkdGV4dC5nZXQoMCkuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkuaGVpZ2h0O1xuICAgICAgY29uc3QgcGFyZW50Rm9udFNpemUgPSBwYXJzZUZsb2F0KCR0ZXh0Q29udGFpbmVyLmNzcygnZm9udC1zaXplJykpO1xuICAgICAgbGV0IGZvbnRTaXplID0gcGFyc2VGbG9hdCgkdGV4dC5jc3MoJ2ZvbnQtc2l6ZScpKTtcblxuICAgICAgY29uc3QgJGlubmVyID0gdGhpcy5nZXRET00oKS5jbG9zZXN0KCcuaDVwLWNvbnRhaW5lcicpO1xuICAgICAgY29uc3QgbWFpbkZvbnRTaXplID0gcGFyc2VGbG9hdCgkaW5uZXIuY3NzKCdmb250LXNpemUnKSk7XG5cbiAgICAgIC8vIERlY3JlYXNlIGZvbnQgc2l6ZVxuICAgICAgaWYgKGN1cnJlbnRUZXh0SGVpZ2h0ID4gY3VycmVudFRleHRDb250YWluZXJIZWlnaHQpIHtcbiAgICAgICAgbGV0IGRlY3JlYXNlRm9udFNpemUgPSB0cnVlO1xuICAgICAgICB3aGlsZSAoZGVjcmVhc2VGb250U2l6ZSkge1xuXG4gICAgICAgICAgZm9udFNpemUgLT0gQ2FyZC5TQ0FMRUlOVEVSVkFMO1xuXG4gICAgICAgICAgaWYgKGZvbnRTaXplIDwgQ2FyZC5NSU5TQ0FMRSkge1xuICAgICAgICAgICAgZGVjcmVhc2VGb250U2l6ZSA9IGZhbHNlO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgJHRleHQuY3NzKCdmb250LXNpemUnLCAoZm9udFNpemUgLyBwYXJlbnRGb250U2l6ZSkgKyAnZW0nKTtcblxuICAgICAgICAgIGN1cnJlbnRUZXh0SGVpZ2h0ID0gJHRleHQuZ2V0KDApLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmhlaWdodDtcbiAgICAgICAgICBpZiAoY3VycmVudFRleHRIZWlnaHQgPD0gY3VycmVudFRleHRDb250YWluZXJIZWlnaHQpIHtcbiAgICAgICAgICAgIGRlY3JlYXNlRm9udFNpemUgPSBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgfVxuICAgICAgZWxzZSB7IC8vIEluY3JlYXNlIGZvbnQgc2l6ZVxuICAgICAgICBsZXQgaW5jcmVhc2VGb250U2l6ZSA9IHRydWU7XG4gICAgICAgIHdoaWxlIChpbmNyZWFzZUZvbnRTaXplKSB7XG4gICAgICAgICAgZm9udFNpemUgKz0gQ2FyZC5TQ0FMRUlOVEVSVkFMO1xuXG4gICAgICAgICAgLy8gQ2FwIGF0ICAxNnB4XG4gICAgICAgICAgaWYgKGZvbnRTaXplID4gbWFpbkZvbnRTaXplKSB7XG4gICAgICAgICAgICBpbmNyZWFzZUZvbnRTaXplID0gZmFsc2U7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBTZXQgcmVsYXRpdmUgZm9udCBzaXplIHRvIHNjYWxlIHdpdGggZnVsbCBzY3JlZW4uXG4gICAgICAgICAgJHRleHQuY3NzKCdmb250LXNpemUnLCBmb250U2l6ZSAvIHBhcmVudEZvbnRTaXplICsgJ2VtJyk7XG4gICAgICAgICAgY3VycmVudFRleHRIZWlnaHQgPSAkdGV4dC5nZXQoMCkuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkuaGVpZ2h0O1xuICAgICAgICAgIGlmIChjdXJyZW50VGV4dEhlaWdodCA+PSBjdXJyZW50VGV4dENvbnRhaW5lckhlaWdodCkge1xuICAgICAgICAgICAgaW5jcmVhc2VGb250U2l6ZSA9IGZhbHNlO1xuICAgICAgICAgICAgZm9udFNpemUgPSBmb250U2l6ZSAtIENhcmQuU0NBTEVJTlRFUlZBTDtcbiAgICAgICAgICAgICR0ZXh0LmNzcygnZm9udC1zaXplJywgZm9udFNpemUgLyBwYXJlbnRGb250U2l6ZSArICdlbScpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBBZGRzIHRpcCB0byBhIGNhcmRcbiAgICpcbiAgICogQHBhcmFtIHtqUXVlcnl9ICRjYXJkIFRoZSBjYXJkXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBbc2lkZT1mcm9udF0gV2hpY2ggc2lkZSBvZiB0aGUgY2FyZFxuICAgKiBAcGFyYW0ge051bWJlcn0gW2luZGV4XSBJbmRleCBvZiBjYXJkXG4gICAqL1xuICBhZGRUaXBUb0NhcmQoJGNhcmQsIHNpZGUsIGluZGV4KSB7XG4gICAgLy8gTWFrZSBzdXJlIHdlIGhhdmUgYSBzaWRlXG4gICAgaWYgKHNpZGUgIT09ICdiYWNrJykge1xuICAgICAgc2lkZSA9ICdmcm9udCc7XG4gICAgfVxuXG4gICAgLy8gTWFrZSBzdXJlIHdlIGhhdmUgYW4gaW5kZXhcblxuICAgIGlmIChpbmRleCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBpbmRleCA9IHRoaXMuaWQ7XG4gICAgfVxuXG4gICAgLy8gUmVtb3ZlIGFueSBvbGQgdGlwc1xuICAgICRjYXJkLmZpbmQoJy5qb3ViZWwtdGlwLWNvbnRhaW5lcicpLnJlbW92ZSgpO1xuXG4gICAgLy8gQWRkIG5ldyB0aXAgaWYgc2V0IGFuZCBoYXMgbGVuZ3RoIGFmdGVyIHRyaW1cbiAgICBjb25zdCB0aXAgPSAodGhpcy5jYXJkW3NpZGVdLnRpcCB8fCAnJykudHJpbSgpO1xuICAgIGlmICh0aXAubGVuZ3RoKSB7XG4gICAgICAkY2FyZC5maW5kKCcuaDVwLWRpYWxvZ2NhcmRzLWNhcmQtdGV4dC13cmFwcGVyIC5oNXAtZGlhbG9nY2FyZHMtY2FyZC10ZXh0LWlubmVyJylcbiAgICAgICAgLmFmdGVyKEg1UC5Kb3ViZWxVSS5jcmVhdGVUaXAodGlwLCB7XG4gICAgICAgICAgdGlwTGFiZWw6IHRoaXMucGFyYW1zLnRpcEJ1dHRvbkxhYmVsXG4gICAgICAgIH0pKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2V0IGZvY3VzIHRvIGEgZ2l2ZW4gY2FyZC5cbiAgICogQHBhcmFtIHtib29sZWFufSBmb3JjZSBJZiB0cnVlLCBkb24ndCB3YWl0IGZvciB0cmFuc2l0aW9uLlxuICAgKi9cbiAgc2V0Q2FyZEZvY3VzKGZvcmNlKSB7XG4gICAgaWYgKGZvcmNlID09PSB0cnVlKSB7XG4gICAgICB0aGlzLiRjYXJkVGV4dEFyZWEuZm9jdXMoKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAvLyBXYWl0IGZvciB0cmFuc2l0aW9uLCB0aGVuIHNldCBmb2N1c1xuICAgICAgY29uc3QgJGNhcmQgPSB0aGlzLmdldERPTSgpO1xuICAgICAgJGNhcmQub25lKCd0cmFuc2l0aW9uZW5kJywgKCkgPT4ge1xuICAgICAgICAkY2FyZC5mb2N1cygpO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFN0b3AgYXVkaW8gb2YgY2FyZC5cbiAgICovXG4gIHN0b3BBdWRpbygpIHtcbiAgICBjb25zdCBzaWRlcyA9IFsnZnJvbnQnLCAnYmFjayddO1xuICAgIHNpZGVzLmZvckVhY2goc2lkZSA9PiB7XG4gICAgICBpZiAoIXRoaXMuYXVkaW9zW3NpZGVdIHx8ICF0aGlzLmF1ZGlvc1tzaWRlXS5hdWRpbykge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8qXG4gICAgICAgKiBXZSBuZWVkIHRvIHJlc2V0IHRoZSBhdWRpbyBidXR0b24gdG8gaXRzIGluaXRpYWwgdmlzdWFsIHN0YXRlLCBidXQgaXRcbiAgICAgICAqIGRvZXNuJ3QgaGF2ZSBhIGZ1bmN0aW9uIHRvIHRvIHRoYXQgLT4gZm9yY2UgZW5kZWQgZXZlbnQgYW5kIHJlbG9hZC5cbiAgICAgICAqL1xuICAgICAgaWYgKHRoaXMuYXVkaW9zW3NpZGVdLmF1ZGlvLmR1cmF0aW9uID4gMCkge1xuICAgICAgICB0aGlzLmF1ZGlvc1tzaWRlXS5hdWRpby5wYXVzZSgpO1xuICAgICAgICB0aGlzLmF1ZGlvc1tzaWRlXS5hdWRpby5jdXJyZW50VGltZSA9IE1hdGguZmxvb3IodGhpcy5hdWRpb3Nbc2lkZV0uYXVkaW8uZHVyYXRpb24pO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5hdWRpb3Nbc2lkZV0uYXVkaW8ubG9hZCkge1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICB0aGlzLmF1ZGlvc1tzaWRlXS5hdWRpby5sb2FkKCk7XG4gICAgICAgIH0sIDEwMCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGNhcmQncyBET01cbiAgICpcbiAgICogQHJldHVybiB7alF1ZXJ5fSBDYXJkJ3MgRE9NLlxuICAgKi9cbiAgZ2V0RE9NKCkge1xuICAgIHJldHVybiB0aGlzLiRjYXJkV3JhcHBlcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgbm8gdGV4dCBtb2RlLlxuICAgKi9cbiAgc2V0Tm9UZXh0KCkge1xuICAgIHRoaXMuZ2V0RE9NKCkuYWRkQ2xhc3MoJ2g1cC1uby10ZXh0Jyk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGNhcmQncyB0ZXh0LlxuICAgKlxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IENhcmQncyB0ZXh0LlxuICAgKi9cbiAgZ2V0VGV4dCgpIHtcbiAgICByZXR1cm4gdGhpcy5jYXJkLmZyb250LnRleHQ7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGNhcmQncyBhbnN3ZXIuXG4gICAqXG4gICAqIEByZXR1cm4ge3N0cmluZ30gQ2FyZCdzIGFuc3dlci5cbiAgICovXG4gIGdldEFuc3dlcigpIHtcbiAgICByZXR1cm4gdGhpcy5jYXJkLmJhY2sudGV4dDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgY2FyZCdzIGltYWdlIHdyYXBwZXIuXG4gICAqXG4gICAqIEByZXR1cm4ge2pRdWVyeX0gQ2FyZCdzIGltYWdlLlxuICAgKi9cbiAgZ2V0SW1hZ2VXcmFwcGVyKCkge1xuICAgIHJldHVybiB0aGlzLiRpbWFnZVdyYXBwZXI7XG4gIH1cblxuICAvKipcbiAgICogU2V0IGNhcmQgaW1hZ2UgaGVpZ2h0LlxuICAgKiBAcGFyYW0ge3N0cmluZ30gaGVpZ2h0IENTUyBoZWlnaHQgdmFsdWUuXG4gICAqL1xuICBzZXRJbWFnZUhlaWdodChoZWlnaHQpIHtcbiAgICB0aGlzLiRpbWFnZVdyYXBwZXIuY3NzKCdoZWlnaHQnLCBoZWlnaHQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjYXJkJ3MgQXVkaW8uXG4gICAqXG4gICAqIEByZXR1cm4ge0VsZW1lbnR9IENhcmQncyBhdWRpby5cbiAgICovXG4gIGdldEF1ZGlvKCkge1xuICAgIHJldHVybiB0aGlzLmlzVHVybmVkKCkgPyB0aGlzLiRhdWRpb1dyYXBwZXJzLmJhY2sgOiB0aGlzLiRhdWRpb1dyYXBwZXJzLmZyb250O1xuICB9XG5cbiAgLyoqXG4gICAqIERldGVjdCB3aGV0aGVyIGNhcmQgaXMgdHVybmVkLlxuICAgKiBAcmV0dXJuIHtib29sZWFufSBUcnVlLCBpZiBjYXJkIGlzIHR1cm5lZC5cbiAgICovXG4gIGlzVHVybmVkKCkge1xuICAgIHJldHVybiB0aGlzLmdldERPTSgpXG4gICAgICAuZmluZCgnLmg1cC1kaWFsb2djYXJkcy1jYXJkLWNvbnRlbnQnKVxuICAgICAgLmhhc0NsYXNzKCdoNXAtZGlhbG9nY2FyZHMtdHVybmVkJyk7XG4gIH1cblxuICAvKipcbiAgICogUmVzZXQgY2FyZC5cbiAgICovXG4gIHJlc2V0KCkge1xuICAgIGNvbnN0ICRjYXJkID0gdGhpcy5nZXRET00oKTtcblxuICAgICRjYXJkLnJlbW92ZUNsYXNzKCdoNXAtZGlhbG9nY2FyZHMtcHJldmlvdXMnKTtcbiAgICAkY2FyZC5yZW1vdmVDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLWN1cnJlbnQnKTtcblxuICAgIHRoaXMuY2hhbmdlVGV4dCh0aGlzLmdldFRleHQoKSk7XG5cbiAgICBjb25zdCAkY2FyZENvbnRlbnQgPSAkY2FyZC5maW5kKCcuaDVwLWRpYWxvZ2NhcmRzLWNhcmQtY29udGVudCcpO1xuICAgICRjYXJkQ29udGVudC5yZW1vdmVDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLXR1cm5lZCcpO1xuICAgIHRoaXMuYWRkVGlwVG9DYXJkKCRjYXJkQ29udGVudCwgJ2Zyb250JywgdGhpcy5pZCk7XG5cbiAgICBpZiAoIXRoaXMucGFyYW1zLmJlaGF2aW91ci5xdWlja1Byb2dyZXNzaW9uKSB7XG4gICAgICAkY2FyZC5maW5kKCcuaDVwLWRpYWxvZ2NhcmRzLWFuc3dlci1idXR0b24nKS5yZW1vdmVDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLXF1aWNrLXByb2dyZXNzaW9uJyk7XG4gICAgfVxuICAgIHRoaXMuaGlkZVN1bW1hcnlCdXR0b24oKTtcbiAgfVxufVxuXG4vLyBDb25zdGFudHNcbkNhcmQuU0NBTEVJTlRFUlZBTCA9IDAuMjtcbkNhcmQuTUFYU0NBTEUgPSAxNjtcbkNhcmQuTUlOU0NBTEUgPSA0O1xuXG5leHBvcnQgZGVmYXVsdCBDYXJkO1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/scripts/h5p-dialogcards-card.js\n");

/***/ }),

/***/ "./src/scripts/h5p-dialogcards-summary-screen.js":
/*!*******************************************************!*\
  !*** ./src/scripts/h5p-dialogcards-summary-screen.js ***!
  \*******************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\nvar SummaryScreen = /*#__PURE__*/function () {\n  /**\n   * @constructor\n   */\n  function SummaryScreen(params, callbacks) {\n    var _this = this;\n\n    this.params = params;\n    this.callbacks = callbacks;\n    this.currentCallback = callbacks.nextRound;\n    this.fields = [];\n    this.container = document.createElement('div');\n    this.container.classList.add('h5p-dialogcards-summary-screen');\n    var containerRound = this.createContainerDOM(params.summary);\n    this.fields['round'] = containerRound.getElementsByClassName('h5p-dialogcards-summary-subheader')[0];\n    this.fields['h5p-dialogcards-round-cards-right'] = this.addTableRow(containerRound, {\n      category: this.params.summaryCardsRight,\n      symbol: 'h5p-dialogcards-check'\n    });\n    this.fields['h5p-dialogcards-round-cards-wrong'] = this.addTableRow(containerRound, {\n      category: this.params.summaryCardsWrong,\n      symbol: 'h5p-dialogcards-times'\n    });\n    this.fields['h5p-dialogcards-round-cards-not-shown'] = this.addTableRow(containerRound, {\n      category: this.params.summaryCardsNotShown\n    });\n    var containerOverall = this.createContainerDOM(params.summaryOverallScore);\n    this.fields['h5p-dialogcards-overall-cards-completed'] = this.addTableRow(containerOverall, {\n      category: this.params.summaryCardsCompleted,\n      symbol: 'h5p-dialogcards-check'\n    });\n    this.fields['h5p-dialogcards-overall-completed-rounds'] = this.addTableRow(containerOverall, {\n      category: this.params.summaryCompletedRounds,\n      symbol: ''\n    });\n    var message = document.createElement('div');\n    message.classList.add('h5p-dialogcards-summary-message');\n    this.fields['message'] = message;\n    var buttonNextRound = H5P.JoubelUI.createButton({\n      'class': 'h5p-dialogcards-buttonNextRound',\n      'title': this.params.nextRound.replace('@round', 2),\n      'html': this.params.nextRound.replace('@round', 2)\n    }).click(this.currentCallback).get(0);\n    this.fields['button'] = buttonNextRound; // Button to start over including confirmation dialog\n\n    var buttonStartOver = H5P.JoubelUI.createButton({\n      'class': 'h5p-dialogcards-button-restart',\n      'title': this.params.startOver,\n      'html': this.params.startOver\n    }).get(0);\n    var confirmationDialog = this.createConfirmationDialog({\n      l10n: this.params.confirmStartingOver,\n      instance: this\n    }, function () {\n      // Stop interference with confirm dialog animation and goto animation\n      setTimeout(function () {\n        _this.callbacks.retry();\n      }, 100);\n    });\n    /*\n     * For some reason, using $.click to add the listener in the line above\n     * leads to losing the listener when button reappears on next summary screen\n     */\n\n    buttonStartOver.addEventListener('click', function (event) {\n      confirmationDialog.show(event.target.offsetTop);\n    });\n    this.fields['buttonStartOver'] = buttonStartOver; // Footer\n\n    var footer = document.createElement('div');\n    footer.classList.add('h5p-dialogcards-summary-footer');\n    footer.appendChild(buttonStartOver);\n    footer.appendChild(buttonNextRound);\n    this.container.appendChild(containerRound);\n    this.container.appendChild(containerOverall);\n    this.container.appendChild(message);\n    this.container.appendChild(footer);\n    this.hide();\n    return this;\n  }\n  /**\n   * Get DOM of summary screen.\n   * @return {object} Summary screen DOM.\n   */\n\n\n  var _proto = SummaryScreen.prototype;\n\n  _proto.getDOM = function getDOM() {\n    return this.container;\n  }\n  /**\n   * Create container DOM.\n   * @param {string} headerText Header text.\n   * @param {string} [subheaderText=''] Sub-Header text.\n   * @return {object} Container DOM.\n   */\n  ;\n\n  _proto.createContainerDOM = function createContainerDOM(headerText) {\n    var subheaderText = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n    var container = document.createElement('div');\n    container.classList.add('h5p-dialogcards-summary-container');\n    var header = document.createElement('div');\n    header.classList.add('h5p-dialogcards-summary-header');\n    header.innerHTML = headerText;\n    container.appendChild(header);\n    var subheader = document.createElement('div');\n    subheader.classList.add('h5p-dialogcards-summary-subheader');\n    subheader.innerHTML = subheaderText;\n    container.appendChild(subheader);\n    var table = document.createElement('table');\n    table.classList.add('h5p-dialogcards-summary-table');\n    container.appendChild(table);\n    return container;\n  }\n  /**\n   * Add row to a table.\n   * @param {object} container Container to add table to.\n   * @param {object} cols Columns.\n   * @param {string} cols.category Category text.\n   * @param {string} [cols.symbol=''] Symbol.\n   * @param {object} [cols.score] Score value and maximum value.\n   * @param {number|string} [cols.score.value=''] Value.\n   * @param {number|string} [cols.score.max] Maximum value.\n   * @return {object} Score field for updating later.\n   */\n  ;\n\n  _proto.addTableRow = function addTableRow(container, cols) {\n    var table = container.getElementsByClassName('h5p-dialogcards-summary-table')[0];\n    var row = document.createElement('tr');\n    var category = document.createElement('td');\n    category.classList.add('h5p-dialogcards-summary-table-row-category');\n    category.innerHTML = cols.category;\n    row.appendChild(category);\n    var symbol = document.createElement('td');\n    symbol.classList.add('h5p-dialogcards-summary-table-row-symbol');\n\n    if (cols.symbol !== undefined && cols.symbol !== '') {\n      symbol.classList.add(cols.symbol);\n    }\n\n    row.appendChild(symbol);\n    var score = document.createElement('td');\n    score.classList.add('h5p-dialogcards-summary-table-row-score');\n    row.appendChild(score);\n    table.appendChild(row);\n    return score;\n  }\n  /**\n   * Update fields.\n   * @param {object} [args] Arguments.\n   * @param {boolean} [args.done] If true, learner is done.\n   * @param {number} [args.round] Round number.\n   * @param {string} [args.message] Message text.\n   * @param {object[]} [args.results] Results.\n   * @param {string} [args.results.field] Field identifier.\n   * @param {object} [args.results.score] Score for field.\n   * @param {number} [args.results.score.value] Score value for field.\n   * @param {number} [args.results.score.max] Score max value for field.\n   */\n  ;\n\n  _proto.update = function update() {\n    var _this2 = this;\n\n    var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n        _ref$done = _ref.done,\n        done = _ref$done === void 0 ? false : _ref$done,\n        _ref$round = _ref.round,\n        round = _ref$round === void 0 ? undefined : _ref$round,\n        _ref$message = _ref.message,\n        message = _ref$message === void 0 ? undefined : _ref$message,\n        _ref$results = _ref.results,\n        results = _ref$results === void 0 ? [] : _ref$results;\n\n    if (done === true) {\n      this.fields['buttonStartOver'].classList.add('h5p-dialogcards-button-gone');\n\n      if (this.params.behaviour.enableRetry) {\n        this.fields['button'].classList.remove('h5p-dialogcards-button-next-round');\n        this.fields['button'].classList.add('h5p-dialogcards-button-restart');\n        this.fields['button'].innerHTML = this.params.retry;\n        this.fields['button'].title = this.params.retry;\n        this.currentCallback = this.callbacks.retry;\n      } else {\n        this.fields['button'].classList.add('h5p-dialogcards-button-gone');\n      }\n    } else {\n      this.fields['buttonStartOver'].classList.remove('h5p-dialogcards-button-gone');\n      this.fields['button'].classList.add('h5p-dialogcards-button-next-round');\n      this.fields['button'].classList.remove('h5p-dialogcards-button-restart');\n      this.fields['button'].innerHTML = this.params.nextRound;\n      this.fields['button'].title = this.params.nextRound;\n      this.currentCallback = this.callbacks.nextRound;\n    }\n\n    H5P.jQuery(this.fields['button']).unbind('click').click(this.currentCallback);\n    this.fields['round'].innerHTML = this.params.round.replace('@round', round);\n\n    if (!done && round !== undefined) {\n      this.fields['button'].innerHTML = this.params.nextRound.replace('@round', round + 1);\n      this.fields['button'].title = this.params.nextRound.replace('@round', round + 1);\n    }\n\n    if (done && message !== undefined && message !== '') {\n      this.fields['message'].classList.remove('h5p-dialogcards-gone');\n      this.fields['message'].innerHTML = message;\n    } else {\n      this.fields['message'].classList.add('h5p-dialogcards-gone');\n    }\n\n    results.forEach(function (result) {\n      var scoreHTML = result.score.value !== undefined ? result.score.value : '';\n\n      if (result.score.max !== undefined) {\n        scoreHTML = \"\".concat(scoreHTML, \"&nbsp;<span class=\\\"h5p-dialogcards-summary-table-row-score-divider\\\">/</span>&nbsp;\").concat(result.score.max);\n      }\n\n      _this2.fields[result.field].innerHTML = scoreHTML;\n    });\n  }\n  /**\n   * Show DOM.\n   */\n  ;\n\n  _proto.show = function show() {\n    this.container.classList.remove('h5p-dialogcards-gone');\n    this.fields['button'].focus();\n  }\n  /**\n   * Hide DOM.\n   */\n  ;\n\n  _proto.hide = function hide() {\n    this.container.classList.add('h5p-dialogcards-gone');\n  }\n  /**\n   * Add confirmation dialog to button.\n   * @param {object} options Dialog options.\n   * @param {function} clicked Callback for confirmation button.\n   * @return {H5P.ConfirmationDialog|undefined} Confirmation dialog.\n   */\n  ;\n\n  _proto.createConfirmationDialog = function createConfirmationDialog(options, clicked) {\n    options = options || {};\n    var confirmationDialog = new H5P.ConfirmationDialog({\n      instance: options.instance,\n      headerText: options.l10n.header,\n      dialogText: options.l10n.body,\n      cancelText: options.l10n.cancelLabel,\n      confirmText: options.l10n.confirmLabel\n    });\n    confirmationDialog.on('confirmed', function () {\n      clicked();\n    });\n    confirmationDialog.appendTo(this.getContainer());\n    return confirmationDialog;\n  }\n  /**\n   * Find container to attach dialogs to.\n   * @return {HTMLElement} Container to attach dialogs to.\n   */\n  ;\n\n  _proto.getContainer = function getContainer() {\n    var $content = H5P.jQuery('[data-content-id=\"' + self.contentId + '\"].h5p-content');\n    var $containerParents = $content.parents('.h5p-container');\n    var $container;\n\n    if ($containerParents.length !== 0) {\n      // use parent highest up if any\n      $container = $containerParents.last();\n    } else if ($content.length !== 0) {\n      $container = $content;\n    } else {\n      $container = H5P.jQuery(document.body);\n    }\n\n    return $container.get(0);\n  };\n\n  return SummaryScreen;\n}();\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (SummaryScreen);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvc2NyaXB0cy9oNXAtZGlhbG9nY2FyZHMtc3VtbWFyeS1zY3JlZW4uanMuanMiLCJtYXBwaW5ncyI6IjtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTs7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFNQTs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBTUE7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBQ0E7QUFDQTtBQUNBO0FBRUE7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTs7QUFDQTtBQUNBO0FBQ0E7O0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQUE7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBOztBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFDQTtBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUNBO0FBQ0E7QUFDQTs7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFMQTtBQVFBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFFQTs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBOztBQUVBO0FBQ0E7Ozs7O0FBR0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9oNXAtZGlhbG9nY2FyZHMvLi9zcmMvc2NyaXB0cy9oNXAtZGlhbG9nY2FyZHMtc3VtbWFyeS1zY3JlZW4uanM/YjFmZSJdLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBTdW1tYXJ5U2NyZWVuIHtcbiAgLyoqXG4gICAqIEBjb25zdHJ1Y3RvclxuICAgKi9cbiAgY29uc3RydWN0b3IocGFyYW1zLCBjYWxsYmFja3MpIHtcbiAgICB0aGlzLnBhcmFtcyA9IHBhcmFtcztcbiAgICB0aGlzLmNhbGxiYWNrcyA9IGNhbGxiYWNrcztcblxuICAgIHRoaXMuY3VycmVudENhbGxiYWNrID0gY2FsbGJhY2tzLm5leHRSb3VuZDtcblxuICAgIHRoaXMuZmllbGRzID0gW107XG5cbiAgICB0aGlzLmNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2g1cC1kaWFsb2djYXJkcy1zdW1tYXJ5LXNjcmVlbicpO1xuXG4gICAgY29uc3QgY29udGFpbmVyUm91bmQgPSB0aGlzLmNyZWF0ZUNvbnRhaW5lckRPTShwYXJhbXMuc3VtbWFyeSk7XG4gICAgdGhpcy5maWVsZHNbJ3JvdW5kJ10gPSBjb250YWluZXJSb3VuZC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdoNXAtZGlhbG9nY2FyZHMtc3VtbWFyeS1zdWJoZWFkZXInKVswXTtcblxuICAgIHRoaXMuZmllbGRzWydoNXAtZGlhbG9nY2FyZHMtcm91bmQtY2FyZHMtcmlnaHQnXSA9IHRoaXMuYWRkVGFibGVSb3coXG4gICAgICBjb250YWluZXJSb3VuZCwge2NhdGVnb3J5OiB0aGlzLnBhcmFtcy5zdW1tYXJ5Q2FyZHNSaWdodCwgc3ltYm9sOiAnaDVwLWRpYWxvZ2NhcmRzLWNoZWNrJ30pO1xuICAgIHRoaXMuZmllbGRzWydoNXAtZGlhbG9nY2FyZHMtcm91bmQtY2FyZHMtd3JvbmcnXSA9IHRoaXMuYWRkVGFibGVSb3coXG4gICAgICBjb250YWluZXJSb3VuZCwge2NhdGVnb3J5OiB0aGlzLnBhcmFtcy5zdW1tYXJ5Q2FyZHNXcm9uZywgc3ltYm9sOiAnaDVwLWRpYWxvZ2NhcmRzLXRpbWVzJ30pO1xuICAgIHRoaXMuZmllbGRzWydoNXAtZGlhbG9nY2FyZHMtcm91bmQtY2FyZHMtbm90LXNob3duJ10gPSB0aGlzLmFkZFRhYmxlUm93KFxuICAgICAgY29udGFpbmVyUm91bmQsIHtjYXRlZ29yeTogdGhpcy5wYXJhbXMuc3VtbWFyeUNhcmRzTm90U2hvd259KTtcblxuICAgIGNvbnN0IGNvbnRhaW5lck92ZXJhbGwgPSB0aGlzLmNyZWF0ZUNvbnRhaW5lckRPTShwYXJhbXMuc3VtbWFyeU92ZXJhbGxTY29yZSk7XG4gICAgdGhpcy5maWVsZHNbJ2g1cC1kaWFsb2djYXJkcy1vdmVyYWxsLWNhcmRzLWNvbXBsZXRlZCddID0gdGhpcy5hZGRUYWJsZVJvdyhcbiAgICAgIGNvbnRhaW5lck92ZXJhbGwsIHtjYXRlZ29yeTogdGhpcy5wYXJhbXMuc3VtbWFyeUNhcmRzQ29tcGxldGVkLCBzeW1ib2w6ICdoNXAtZGlhbG9nY2FyZHMtY2hlY2snfSk7XG4gICAgdGhpcy5maWVsZHNbJ2g1cC1kaWFsb2djYXJkcy1vdmVyYWxsLWNvbXBsZXRlZC1yb3VuZHMnXSA9IHRoaXMuYWRkVGFibGVSb3coXG4gICAgICBjb250YWluZXJPdmVyYWxsLCB7Y2F0ZWdvcnk6IHRoaXMucGFyYW1zLnN1bW1hcnlDb21wbGV0ZWRSb3VuZHMsIHN5bWJvbDogJyd9KTtcblxuICAgIGNvbnN0IG1lc3NhZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBtZXNzYWdlLmNsYXNzTGlzdC5hZGQoJ2g1cC1kaWFsb2djYXJkcy1zdW1tYXJ5LW1lc3NhZ2UnKTtcblxuICAgIHRoaXMuZmllbGRzWydtZXNzYWdlJ10gPSBtZXNzYWdlO1xuXG4gICAgY29uc3QgYnV0dG9uTmV4dFJvdW5kID0gSDVQLkpvdWJlbFVJLmNyZWF0ZUJ1dHRvbih7XG4gICAgICAnY2xhc3MnOiAnaDVwLWRpYWxvZ2NhcmRzLWJ1dHRvbk5leHRSb3VuZCcsXG4gICAgICAndGl0bGUnOiB0aGlzLnBhcmFtcy5uZXh0Um91bmQucmVwbGFjZSgnQHJvdW5kJywgMiksXG4gICAgICAnaHRtbCc6IHRoaXMucGFyYW1zLm5leHRSb3VuZC5yZXBsYWNlKCdAcm91bmQnLCAyKVxuICAgIH0pLmNsaWNrKHRoaXMuY3VycmVudENhbGxiYWNrKS5nZXQoMCk7XG5cbiAgICB0aGlzLmZpZWxkc1snYnV0dG9uJ10gPSBidXR0b25OZXh0Um91bmQ7XG5cbiAgICAvLyBCdXR0b24gdG8gc3RhcnQgb3ZlciBpbmNsdWRpbmcgY29uZmlybWF0aW9uIGRpYWxvZ1xuICAgIGNvbnN0IGJ1dHRvblN0YXJ0T3ZlciA9IEg1UC5Kb3ViZWxVSS5jcmVhdGVCdXR0b24oe1xuICAgICAgJ2NsYXNzJzogJ2g1cC1kaWFsb2djYXJkcy1idXR0b24tcmVzdGFydCcsXG4gICAgICAndGl0bGUnOiB0aGlzLnBhcmFtcy5zdGFydE92ZXIsXG4gICAgICAnaHRtbCc6IHRoaXMucGFyYW1zLnN0YXJ0T3ZlclxuICAgIH0pLmdldCgwKTtcblxuICAgIGNvbnN0IGNvbmZpcm1hdGlvbkRpYWxvZyA9IHRoaXMuY3JlYXRlQ29uZmlybWF0aW9uRGlhbG9nKHtcbiAgICAgIGwxMG46IHRoaXMucGFyYW1zLmNvbmZpcm1TdGFydGluZ092ZXIsXG4gICAgICBpbnN0YW5jZTogdGhpc1xuICAgIH0sICgpID0+IHtcbiAgICAgIC8vIFN0b3AgaW50ZXJmZXJlbmNlIHdpdGggY29uZmlybSBkaWFsb2cgYW5pbWF0aW9uIGFuZCBnb3RvIGFuaW1hdGlvblxuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHRoaXMuY2FsbGJhY2tzLnJldHJ5KCk7XG4gICAgICB9LCAxMDApO1xuICAgIH0pO1xuXG4gICAgLypcbiAgICAgKiBGb3Igc29tZSByZWFzb24sIHVzaW5nICQuY2xpY2sgdG8gYWRkIHRoZSBsaXN0ZW5lciBpbiB0aGUgbGluZSBhYm92ZVxuICAgICAqIGxlYWRzIHRvIGxvc2luZyB0aGUgbGlzdGVuZXIgd2hlbiBidXR0b24gcmVhcHBlYXJzIG9uIG5leHQgc3VtbWFyeSBzY3JlZW5cbiAgICAgKi9cbiAgICBidXR0b25TdGFydE92ZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXZlbnQpID0+IHtcbiAgICAgIGNvbmZpcm1hdGlvbkRpYWxvZy5zaG93KGV2ZW50LnRhcmdldC5vZmZzZXRUb3ApO1xuICAgIH0pO1xuXG4gICAgdGhpcy5maWVsZHNbJ2J1dHRvblN0YXJ0T3ZlciddID0gYnV0dG9uU3RhcnRPdmVyO1xuXG4gICAgLy8gRm9vdGVyXG4gICAgY29uc3QgZm9vdGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgZm9vdGVyLmNsYXNzTGlzdC5hZGQoJ2g1cC1kaWFsb2djYXJkcy1zdW1tYXJ5LWZvb3RlcicpO1xuICAgIGZvb3Rlci5hcHBlbmRDaGlsZChidXR0b25TdGFydE92ZXIpO1xuICAgIGZvb3Rlci5hcHBlbmRDaGlsZChidXR0b25OZXh0Um91bmQpO1xuXG4gICAgdGhpcy5jb250YWluZXIuYXBwZW5kQ2hpbGQoY29udGFpbmVyUm91bmQpO1xuICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKGNvbnRhaW5lck92ZXJhbGwpO1xuICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKG1lc3NhZ2UpO1xuICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKGZvb3Rlcik7XG5cbiAgICB0aGlzLmhpZGUoKTtcblxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBET00gb2Ygc3VtbWFyeSBzY3JlZW4uXG4gICAqIEByZXR1cm4ge29iamVjdH0gU3VtbWFyeSBzY3JlZW4gRE9NLlxuICAgKi9cbiAgZ2V0RE9NKCkge1xuICAgIHJldHVybiB0aGlzLmNvbnRhaW5lcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgY29udGFpbmVyIERPTS5cbiAgICogQHBhcmFtIHtzdHJpbmd9IGhlYWRlclRleHQgSGVhZGVyIHRleHQuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBbc3ViaGVhZGVyVGV4dD0nJ10gU3ViLUhlYWRlciB0ZXh0LlxuICAgKiBAcmV0dXJuIHtvYmplY3R9IENvbnRhaW5lciBET00uXG4gICAqL1xuICBjcmVhdGVDb250YWluZXJET00oaGVhZGVyVGV4dCwgc3ViaGVhZGVyVGV4dCA9ICcnKSB7XG4gICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2g1cC1kaWFsb2djYXJkcy1zdW1tYXJ5LWNvbnRhaW5lcicpO1xuXG4gICAgY29uc3QgaGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgaGVhZGVyLmNsYXNzTGlzdC5hZGQoJ2g1cC1kaWFsb2djYXJkcy1zdW1tYXJ5LWhlYWRlcicpO1xuICAgIGhlYWRlci5pbm5lckhUTUwgPSBoZWFkZXJUZXh0O1xuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChoZWFkZXIpO1xuXG4gICAgY29uc3Qgc3ViaGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgc3ViaGVhZGVyLmNsYXNzTGlzdC5hZGQoJ2g1cC1kaWFsb2djYXJkcy1zdW1tYXJ5LXN1YmhlYWRlcicpO1xuICAgIHN1YmhlYWRlci5pbm5lckhUTUwgPSBzdWJoZWFkZXJUZXh0O1xuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChzdWJoZWFkZXIpO1xuXG4gICAgY29uc3QgdGFibGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0YWJsZScpO1xuICAgIHRhYmxlLmNsYXNzTGlzdC5hZGQoJ2g1cC1kaWFsb2djYXJkcy1zdW1tYXJ5LXRhYmxlJyk7XG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHRhYmxlKTtcblxuICAgIHJldHVybiBjb250YWluZXI7XG4gIH1cblxuICAvKipcbiAgICogQWRkIHJvdyB0byBhIHRhYmxlLlxuICAgKiBAcGFyYW0ge29iamVjdH0gY29udGFpbmVyIENvbnRhaW5lciB0byBhZGQgdGFibGUgdG8uXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBjb2xzIENvbHVtbnMuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBjb2xzLmNhdGVnb3J5IENhdGVnb3J5IHRleHQuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBbY29scy5zeW1ib2w9JyddIFN5bWJvbC5cbiAgICogQHBhcmFtIHtvYmplY3R9IFtjb2xzLnNjb3JlXSBTY29yZSB2YWx1ZSBhbmQgbWF4aW11bSB2YWx1ZS5cbiAgICogQHBhcmFtIHtudW1iZXJ8c3RyaW5nfSBbY29scy5zY29yZS52YWx1ZT0nJ10gVmFsdWUuXG4gICAqIEBwYXJhbSB7bnVtYmVyfHN0cmluZ30gW2NvbHMuc2NvcmUubWF4XSBNYXhpbXVtIHZhbHVlLlxuICAgKiBAcmV0dXJuIHtvYmplY3R9IFNjb3JlIGZpZWxkIGZvciB1cGRhdGluZyBsYXRlci5cbiAgICovXG4gIGFkZFRhYmxlUm93KGNvbnRhaW5lciwgY29scykge1xuICAgIGNvbnN0IHRhYmxlID0gY29udGFpbmVyLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2g1cC1kaWFsb2djYXJkcy1zdW1tYXJ5LXRhYmxlJylbMF07XG5cbiAgICBjb25zdCByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpO1xuXG4gICAgY29uc3QgY2F0ZWdvcnkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuICAgIGNhdGVnb3J5LmNsYXNzTGlzdC5hZGQoJ2g1cC1kaWFsb2djYXJkcy1zdW1tYXJ5LXRhYmxlLXJvdy1jYXRlZ29yeScpO1xuICAgIGNhdGVnb3J5LmlubmVySFRNTCA9IGNvbHMuY2F0ZWdvcnk7XG4gICAgcm93LmFwcGVuZENoaWxkKGNhdGVnb3J5KTtcblxuICAgIGNvbnN0IHN5bWJvbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG4gICAgc3ltYm9sLmNsYXNzTGlzdC5hZGQoJ2g1cC1kaWFsb2djYXJkcy1zdW1tYXJ5LXRhYmxlLXJvdy1zeW1ib2wnKTtcbiAgICBpZiAoY29scy5zeW1ib2wgIT09IHVuZGVmaW5lZCAmJiBjb2xzLnN5bWJvbCAhPT0gJycpIHtcbiAgICAgIHN5bWJvbC5jbGFzc0xpc3QuYWRkKGNvbHMuc3ltYm9sKTtcbiAgICB9XG4gICAgcm93LmFwcGVuZENoaWxkKHN5bWJvbCk7XG5cbiAgICBjb25zdCBzY29yZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG4gICAgc2NvcmUuY2xhc3NMaXN0LmFkZCgnaDVwLWRpYWxvZ2NhcmRzLXN1bW1hcnktdGFibGUtcm93LXNjb3JlJyk7XG4gICAgcm93LmFwcGVuZENoaWxkKHNjb3JlKTtcblxuICAgIHRhYmxlLmFwcGVuZENoaWxkKHJvdyk7XG5cbiAgICByZXR1cm4gc2NvcmU7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIGZpZWxkcy5cbiAgICogQHBhcmFtIHtvYmplY3R9IFthcmdzXSBBcmd1bWVudHMuXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2FyZ3MuZG9uZV0gSWYgdHJ1ZSwgbGVhcm5lciBpcyBkb25lLlxuICAgKiBAcGFyYW0ge251bWJlcn0gW2FyZ3Mucm91bmRdIFJvdW5kIG51bWJlci5cbiAgICogQHBhcmFtIHtzdHJpbmd9IFthcmdzLm1lc3NhZ2VdIE1lc3NhZ2UgdGV4dC5cbiAgICogQHBhcmFtIHtvYmplY3RbXX0gW2FyZ3MucmVzdWx0c10gUmVzdWx0cy5cbiAgICogQHBhcmFtIHtzdHJpbmd9IFthcmdzLnJlc3VsdHMuZmllbGRdIEZpZWxkIGlkZW50aWZpZXIuXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBbYXJncy5yZXN1bHRzLnNjb3JlXSBTY29yZSBmb3IgZmllbGQuXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBbYXJncy5yZXN1bHRzLnNjb3JlLnZhbHVlXSBTY29yZSB2YWx1ZSBmb3IgZmllbGQuXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBbYXJncy5yZXN1bHRzLnNjb3JlLm1heF0gU2NvcmUgbWF4IHZhbHVlIGZvciBmaWVsZC5cbiAgICovXG4gIHVwZGF0ZSh7ZG9uZSA9IGZhbHNlLCByb3VuZCA9IHVuZGVmaW5lZCwgbWVzc2FnZSA9IHVuZGVmaW5lZCwgcmVzdWx0cyA9IFtdfSA9IHt9KSB7XG4gICAgaWYgKGRvbmUgPT09IHRydWUpIHtcbiAgICAgIHRoaXMuZmllbGRzWydidXR0b25TdGFydE92ZXInXS5jbGFzc0xpc3QuYWRkKCdoNXAtZGlhbG9nY2FyZHMtYnV0dG9uLWdvbmUnKTtcblxuICAgICAgaWYgKHRoaXMucGFyYW1zLmJlaGF2aW91ci5lbmFibGVSZXRyeSkge1xuICAgICAgICB0aGlzLmZpZWxkc1snYnV0dG9uJ10uY2xhc3NMaXN0LnJlbW92ZSgnaDVwLWRpYWxvZ2NhcmRzLWJ1dHRvbi1uZXh0LXJvdW5kJyk7XG4gICAgICAgIHRoaXMuZmllbGRzWydidXR0b24nXS5jbGFzc0xpc3QuYWRkKCdoNXAtZGlhbG9nY2FyZHMtYnV0dG9uLXJlc3RhcnQnKTtcbiAgICAgICAgdGhpcy5maWVsZHNbJ2J1dHRvbiddLmlubmVySFRNTCA9IHRoaXMucGFyYW1zLnJldHJ5O1xuICAgICAgICB0aGlzLmZpZWxkc1snYnV0dG9uJ10udGl0bGUgPSB0aGlzLnBhcmFtcy5yZXRyeTtcbiAgICAgICAgdGhpcy5jdXJyZW50Q2FsbGJhY2sgPSB0aGlzLmNhbGxiYWNrcy5yZXRyeTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICB0aGlzLmZpZWxkc1snYnV0dG9uJ10uY2xhc3NMaXN0LmFkZCgnaDVwLWRpYWxvZ2NhcmRzLWJ1dHRvbi1nb25lJyk7XG4gICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgdGhpcy5maWVsZHNbJ2J1dHRvblN0YXJ0T3ZlciddLmNsYXNzTGlzdC5yZW1vdmUoJ2g1cC1kaWFsb2djYXJkcy1idXR0b24tZ29uZScpO1xuXG4gICAgICB0aGlzLmZpZWxkc1snYnV0dG9uJ10uY2xhc3NMaXN0LmFkZCgnaDVwLWRpYWxvZ2NhcmRzLWJ1dHRvbi1uZXh0LXJvdW5kJyk7XG4gICAgICB0aGlzLmZpZWxkc1snYnV0dG9uJ10uY2xhc3NMaXN0LnJlbW92ZSgnaDVwLWRpYWxvZ2NhcmRzLWJ1dHRvbi1yZXN0YXJ0Jyk7XG4gICAgICB0aGlzLmZpZWxkc1snYnV0dG9uJ10uaW5uZXJIVE1MID0gdGhpcy5wYXJhbXMubmV4dFJvdW5kO1xuICAgICAgdGhpcy5maWVsZHNbJ2J1dHRvbiddLnRpdGxlID0gdGhpcy5wYXJhbXMubmV4dFJvdW5kO1xuICAgICAgdGhpcy5jdXJyZW50Q2FsbGJhY2sgPSB0aGlzLmNhbGxiYWNrcy5uZXh0Um91bmQ7XG4gICAgfVxuICAgIEg1UC5qUXVlcnkodGhpcy5maWVsZHNbJ2J1dHRvbiddKS51bmJpbmQoJ2NsaWNrJykuY2xpY2sodGhpcy5jdXJyZW50Q2FsbGJhY2spO1xuXG4gICAgdGhpcy5maWVsZHNbJ3JvdW5kJ10uaW5uZXJIVE1MID0gdGhpcy5wYXJhbXMucm91bmQucmVwbGFjZSgnQHJvdW5kJywgcm91bmQpO1xuXG4gICAgaWYgKCFkb25lICYmIHJvdW5kICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHRoaXMuZmllbGRzWydidXR0b24nXS5pbm5lckhUTUwgPSB0aGlzLnBhcmFtcy5uZXh0Um91bmQucmVwbGFjZSgnQHJvdW5kJywgcm91bmQgKyAxKTtcbiAgICAgIHRoaXMuZmllbGRzWydidXR0b24nXS50aXRsZSA9IHRoaXMucGFyYW1zLm5leHRSb3VuZC5yZXBsYWNlKCdAcm91bmQnLCByb3VuZCArIDEpO1xuICAgIH1cblxuICAgIGlmIChkb25lICYmIG1lc3NhZ2UgIT09IHVuZGVmaW5lZCAmJiBtZXNzYWdlICE9PSAnJykge1xuICAgICAgdGhpcy5maWVsZHNbJ21lc3NhZ2UnXS5jbGFzc0xpc3QucmVtb3ZlKCdoNXAtZGlhbG9nY2FyZHMtZ29uZScpO1xuICAgICAgdGhpcy5maWVsZHNbJ21lc3NhZ2UnXS5pbm5lckhUTUwgPSBtZXNzYWdlO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHRoaXMuZmllbGRzWydtZXNzYWdlJ10uY2xhc3NMaXN0LmFkZCgnaDVwLWRpYWxvZ2NhcmRzLWdvbmUnKTtcbiAgICB9XG5cbiAgICByZXN1bHRzLmZvckVhY2gocmVzdWx0ID0+IHtcbiAgICAgIGxldCBzY29yZUhUTUwgPSAocmVzdWx0LnNjb3JlLnZhbHVlICE9PSB1bmRlZmluZWQpID8gcmVzdWx0LnNjb3JlLnZhbHVlIDogJyc7XG4gICAgICBpZiAocmVzdWx0LnNjb3JlLm1heCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHNjb3JlSFRNTCA9IGAke3Njb3JlSFRNTH0mbmJzcDs8c3BhbiBjbGFzcz1cImg1cC1kaWFsb2djYXJkcy1zdW1tYXJ5LXRhYmxlLXJvdy1zY29yZS1kaXZpZGVyXCI+Lzwvc3Bhbj4mbmJzcDske3Jlc3VsdC5zY29yZS5tYXh9YDtcbiAgICAgIH1cbiAgICAgIHRoaXMuZmllbGRzW3Jlc3VsdC5maWVsZF0uaW5uZXJIVE1MID0gc2NvcmVIVE1MO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFNob3cgRE9NLlxuICAgKi9cbiAgc2hvdygpIHtcbiAgICB0aGlzLmNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCdoNXAtZGlhbG9nY2FyZHMtZ29uZScpO1xuICAgIHRoaXMuZmllbGRzWydidXR0b24nXS5mb2N1cygpO1xuICB9XG5cbiAgLyoqXG4gICAqIEhpZGUgRE9NLlxuICAgKi9cbiAgaGlkZSgpIHtcbiAgICB0aGlzLmNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdoNXAtZGlhbG9nY2FyZHMtZ29uZScpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBjb25maXJtYXRpb24gZGlhbG9nIHRvIGJ1dHRvbi5cbiAgICogQHBhcmFtIHtvYmplY3R9IG9wdGlvbnMgRGlhbG9nIG9wdGlvbnMuXG4gICAqIEBwYXJhbSB7ZnVuY3Rpb259IGNsaWNrZWQgQ2FsbGJhY2sgZm9yIGNvbmZpcm1hdGlvbiBidXR0b24uXG4gICAqIEByZXR1cm4ge0g1UC5Db25maXJtYXRpb25EaWFsb2d8dW5kZWZpbmVkfSBDb25maXJtYXRpb24gZGlhbG9nLlxuICAgKi9cbiAgY3JlYXRlQ29uZmlybWF0aW9uRGlhbG9nKG9wdGlvbnMsIGNsaWNrZWQpIHtcbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcblxuICAgIHZhciBjb25maXJtYXRpb25EaWFsb2cgPSBuZXcgSDVQLkNvbmZpcm1hdGlvbkRpYWxvZyh7XG4gICAgICBpbnN0YW5jZTogb3B0aW9ucy5pbnN0YW5jZSxcbiAgICAgIGhlYWRlclRleHQ6IG9wdGlvbnMubDEwbi5oZWFkZXIsXG4gICAgICBkaWFsb2dUZXh0OiBvcHRpb25zLmwxMG4uYm9keSxcbiAgICAgIGNhbmNlbFRleHQ6IG9wdGlvbnMubDEwbi5jYW5jZWxMYWJlbCxcbiAgICAgIGNvbmZpcm1UZXh0OiBvcHRpb25zLmwxMG4uY29uZmlybUxhYmVsXG4gICAgfSk7XG5cbiAgICBjb25maXJtYXRpb25EaWFsb2cub24oJ2NvbmZpcm1lZCcsICgpID0+IHtcbiAgICAgIGNsaWNrZWQoKTtcbiAgICB9KTtcblxuICAgIGNvbmZpcm1hdGlvbkRpYWxvZy5hcHBlbmRUbyh0aGlzLmdldENvbnRhaW5lcigpKTtcblxuICAgIHJldHVybiBjb25maXJtYXRpb25EaWFsb2c7XG4gIH1cblxuICAvKipcbiAgICogRmluZCBjb250YWluZXIgdG8gYXR0YWNoIGRpYWxvZ3MgdG8uXG4gICAqIEByZXR1cm4ge0hUTUxFbGVtZW50fSBDb250YWluZXIgdG8gYXR0YWNoIGRpYWxvZ3MgdG8uXG4gICAqL1xuICBnZXRDb250YWluZXIoKSB7XG4gICAgY29uc3QgJGNvbnRlbnQgPSBINVAualF1ZXJ5KCdbZGF0YS1jb250ZW50LWlkPVwiJyArIHNlbGYuY29udGVudElkICsgJ1wiXS5oNXAtY29udGVudCcpO1xuICAgIGNvbnN0ICRjb250YWluZXJQYXJlbnRzID0gJGNvbnRlbnQucGFyZW50cygnLmg1cC1jb250YWluZXInKTtcblxuICAgIGxldCAkY29udGFpbmVyO1xuICAgIGlmICgkY29udGFpbmVyUGFyZW50cy5sZW5ndGggIT09IDApIHtcbiAgICAgIC8vIHVzZSBwYXJlbnQgaGlnaGVzdCB1cCBpZiBhbnlcbiAgICAgICRjb250YWluZXIgPSAkY29udGFpbmVyUGFyZW50cy5sYXN0KCk7XG4gICAgfVxuICAgIGVsc2UgaWYgKCRjb250ZW50Lmxlbmd0aCAhPT0gMCkge1xuICAgICAgJGNvbnRhaW5lciA9ICRjb250ZW50O1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICRjb250YWluZXIgPSBINVAualF1ZXJ5KGRvY3VtZW50LmJvZHkpO1xuICAgIH1cblxuICAgIHJldHVybiAkY29udGFpbmVyLmdldCgwKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBTdW1tYXJ5U2NyZWVuO1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/scripts/h5p-dialogcards-summary-screen.js\n");

/***/ }),

/***/ "./src/scripts/h5p-dialogcards.js":
/*!****************************************!*\
  !*** ./src/scripts/h5p-dialogcards.js ***!
  \****************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _h5p_dialogcards_card_manager__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./h5p-dialogcards-card-manager */ \"./src/scripts/h5p-dialogcards-card-manager.js\");\n/* harmony import */ var _h5p_dialogcards_summary_screen__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./h5p-dialogcards-summary-screen */ \"./src/scripts/h5p-dialogcards-summary-screen.js\");\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\n\n\nvar $ = H5P.jQuery;\nvar JoubelUI = H5P.JoubelUI;\n\nvar Dialogcards = /*#__PURE__*/function (_H5P$EventDispatcher) {\n  _inheritsLoose(Dialogcards, _H5P$EventDispatcher);\n\n  /**\n   * Initialize module.\n   *\n   * @constructor\n   *\n   * @param {Object} params Parameters.\n   * @param {Number} id Content id.\n   * @param {Object} contentData Content data, e.g. for saveContentState\n   * @returns {DialogCards} self\n   */\n  function Dialogcards(params, id, contentData) {\n    var _this;\n\n    Dialogcards.idCounter++;\n    _this = _H5P$EventDispatcher.call(this) || this;\n    _this.contentId = _this.id = id;\n    _this.previousState = contentData.previousState || {}; // Var cardOrder stores order of cards to allow resuming of card set.\n    // Var progress stores current card index.\n\n    _this.contentData = contentData || {}; // Strip cards with empty sides\n\n    params.dialogs = params.dialogs || [];\n    params.dialogs = params.dialogs.filter(function (dialog) {\n      if (!dialog.front || !dialog.back) {\n        return false;\n      } // Empty front?\n\n\n      if (!dialog.front.text && !dialog.front.image && !dialog.front.audio) {\n        return false;\n      } // Empty back?\n\n\n      var noBackText = !dialog.back.text;\n      var noBackImage = dialog.back.useImageFromFront && !dialog.front.image || !dialog.back.useImageFromFront && !dialog.back.image;\n      var noBackAudio = dialog.back.useAudioFromFront && !dialog.front.audio || !dialog.back.useAudioFromFront && !dialog.back.audio;\n\n      if (noBackText && noBackImage && noBackAudio) {\n        return false;\n      }\n\n      return true;\n    }); // Set default behavior.\n\n    _this.params = $.extend(true, {\n      title: '',\n      mode: 'normal',\n      description: \"Sit in pairs and make up sentences where you include the expressions below.<br/>Example: I should have said yes, HOWEVER I kept my mouth shut.\",\n      next: \"Next\",\n      prev: \"Previous\",\n      retry: \"Retry\",\n      answer: \"Turn\",\n      correctAnswer: 'I got it right!',\n      incorrectAnswer: 'I got it wrong',\n      round: 'Round @round',\n      cardsLeft: 'Cards left: @number',\n      nextRound: 'Proceed to round @round',\n      startOver: 'Start over',\n      showSummary: 'Next',\n      summary: 'Summary',\n      summaryCardsRight: 'Cards you got right:',\n      summaryCardsWrong: 'Cards you got wrong:',\n      summaryCardsNotShown: 'Cards in pool not shown:',\n      summaryOverallScore: 'Overall Score',\n      summaryCardsCompleted: 'Cards you have completed learning:',\n      summaryCompletedRounds: 'Completed rounds:',\n      summaryAllDone: 'Well done! You got all @cards cards correct @max times in a row each!',\n      progressText: \"Card @card of @total\",\n      cardFrontLabel: \"Card front\",\n      cardBackLabel: \"Card back\",\n      tipButtonLabel: 'Show tip',\n      audioNotSupported: 'Your browser does not support this audio',\n      confirmStartingOver: {\n        header: 'Start over?',\n        body: 'All progress will be lost. Are you sure you want to start over?',\n        cancelLabel: 'Cancel',\n        confirmLabel: 'Start over'\n      },\n      dialogs: [{\n        front: {\n          text: 'Horse'\n        },\n        back: {\n          text: 'Hest',\n          useImageFromFront: true,\n          useAudioFromFront: false\n        }\n      } // {\n      //   front: {\n      //     text: 'Cow'\n      //   },\n      //   back: {\n      //     text: 'Ku',\n      //     useImageFromFront: true,\n      //     useAudioFromFront: false\n      //   }\n      // }\n      ],\n      behaviour: {\n        enableRetry: true,\n        disableBackwardsNavigation: false,\n        scaleTextNotCard: false,\n        randomCards: false,\n        maxProficiency: 5,\n        quickProgression: false\n      }\n    }, params); // Check for no texts at all\n\n    _this.hasNoTexts = _this.params.dialogs.every(function (dialog) {\n      return dialog.front.text === '' && dialog.back.text === '';\n    }); // Check for no audios at all\n\n    _this.hasNoAudios = !_this.params.dialogs.some(function (dialog) {\n      return dialog.front.audio || dialog.back.audio && !dialog.back.useAudioFromFront;\n    }); // TODO: Translations\n\n    _this.cards = [];\n    _this.currentCardId = 0;\n    _this.round = 0; // 0 indicates that DOM needs to be set up\n\n    _this.results = _this.previousState.results || []; // Workaround for iOS\n\n    if (screen.orientation) {\n      screen.orientation.addEventListener('change', function () {\n        _this.handleOrientationChange();\n      });\n    } else {\n      window.addEventListener('orientationchange', function () {\n        _this.handleOrientationChange();\n      });\n    }\n    /*\n     * Workaround (hopefully temporary) for KidsLoopLive that for whatever\n     * reason does not use h5p-resizer.js.\n     */\n\n\n    window.addEventListener('resize', function () {\n      _this.resize();\n    });\n    /**\n     * Attach h5p inside the given container.\n     *\n     * @param {jQuery} $container Container.\n     */\n\n    _this.attach = function ($container) {\n      _this.$inner = $container.addClass('h5p-dialogcards');\n\n      if (_this.params.behaviour.scaleTextNotCard) {\n        $container.addClass('h5p-text-scaling');\n      } // KidsLoop customization to prevent dragging the image\n\n\n      _this.$inner.get(0).addEventListener('dragstart', function (event) {\n        event.preventDefault();\n      }); // Only pass what's necessary\n\n\n      var managerParams = {\n        mode: _this.params.mode,\n        dialogs: _this.params.dialogs,\n        audioNotSupported: _this.params.audioNotSupported,\n        answer: _this.params.answer,\n        showSummary: _this.params.showSummary,\n        incorrectAnswer: _this.params.incorrectAnswer,\n        correctAnswer: _this.params.correctAnswer,\n        progressText: _this.params.progressText,\n        tipButtonLabel: _this.params.tipButtonLabel,\n        behaviour: {\n          scaleTextNotCard: _this.params.behaviour.scaleTextNotCard,\n          maxProficiency: _this.params.behaviour.maxProficiency,\n          quickProgression: _this.params.behaviour.quickProgression\n        },\n        cardPiles: _this.previousState.cardPiles\n      };\n      _this.cardManager = new _h5p_dialogcards_card_manager__WEBPACK_IMPORTED_MODULE_0__[\"default\"](managerParams, _this.id, {\n        onCardTurned: _this.handleCardTurned,\n        onNextCard: _this.nextCard\n      });\n\n      _this.createDOM(_this.round === 0);\n      /*\n       * Goto previously viewed card. It was possible to also recover the turned\n       * state, but it feels sensible to let the previously viewed card be\n       * reviewed starting with the front.\n       */\n\n\n      if (_this.previousState.currentCardId !== undefined) {\n        _this.gotoCard(_this.previousState.currentCardId); // Show summary if previous round was completed but next round not started.\n\n\n        if (_this.params.mode === 'repetition' && _this.results.length === _this.cardIds.length) {\n          _this.showSummary(true);\n        }\n      }\n\n      _this.updateNavigation();\n\n      _this.trigger('resize');\n    };\n    /**\n     * Create DOM.\n     * @param {boolean} firstCall Is first call?\n     */\n\n\n    _this.createDOM = function (firstCall) {\n      _this.cardIds = firstCall && _this.previousState.cardIds ? _this.previousState.cardIds : _this.cardManager.createSelection();\n      _this.cardPoolSize = _this.cardPoolSize || _this.cardManager.getSize();\n\n      if (firstCall === true) {\n        var title = $('<div>' + _this.params.title + '</div>').text().trim();\n        _this.$header = $((title ? '<div class=\"h5p-dialogcards-title\"><div class=\"h5p-dialogcards-title-inner\">' + _this.params.title + '</div></div>' : '') + '<div class=\"h5p-dialogcards-description\">' + _this.params.description + '</div>');\n        _this.summaryScreen = new _h5p_dialogcards_summary_screen__WEBPACK_IMPORTED_MODULE_1__[\"default\"](_this.params, {\n          nextRound: _this.nextRound,\n          retry: _this.restartRepetition\n        });\n      }\n\n      if (firstCall === true) {\n        _this.$cardwrapperSet = _this.initCards(_this.cardIds);\n      } else {\n        _this.$cardwrapperSet.detach();\n\n        _this.$cardwrapperSet = _this.initCards(_this.cardIds);\n\n        _this.$cardSideAnnouncer.before(_this.$cardwrapperSet);\n      }\n\n      _this.$cardwrapperSet.prepend(_this.summaryScreen.getDOM());\n\n      if (firstCall === true) {\n        _this.$cardSideAnnouncer = $('<div>', {\n          html: _this.params.cardFrontLabel,\n          'class': 'h5p-dialogcards-card-side-announcer',\n          'aria-live': 'polite',\n          'aria-hidden': 'true'\n        });\n        _this.$footer = _this.createFooter();\n        _this.$mainContent = $('<div>').append(_this.$header).append(_this.$cardwrapperSet).append(_this.$cardSideAnnouncer).append(_this.$footer).appendTo(_this.$inner); // No card has texts\n\n        if (_this.hasNoTexts) {\n          _this.cards.forEach(function (card) {\n            card.setNoText();\n          });\n        }\n\n        _this.on('reset', function () {\n          this.reset();\n        });\n\n        _this.on('resize', _this.resize); // Set round to previous state if available\n\n\n        _this.round = _this.previousState.round !== undefined ? _this.previousState.round : 1;\n      }\n    };\n    /**\n     * Create footer/navigation line\n     *\n     * @returns {*|jQuery|HTMLElement} Footer element\n     */\n\n\n    _this.createFooter = function () {\n      var $footer = $('<nav>', {\n        'class': 'h5p-dialogcards-footer',\n        'role': 'navigation'\n      });\n\n      if (_this.params.mode === 'normal') {\n        _this.$prev = JoubelUI.createButton({\n          'class': 'h5p-dialogcards-footer-button h5p-dialogcards-prev truncated',\n          'aria-label': _this.params.prev,\n          'title': _this.params.prev\n        }).click(function () {\n          _this.prevCard();\n        }).appendTo($footer);\n        _this.$next = JoubelUI.createButton({\n          'class': 'h5p-dialogcards-footer-button h5p-dialogcards-next truncated',\n          'aria-label': _this.params.next,\n          'title': _this.params.next\n        }).click(function () {\n          _this.nextCard();\n        }).appendTo($footer);\n        _this.$retry = JoubelUI.createButton({\n          'class': 'h5p-dialogcards-footer-button h5p-dialogcards-retry h5p-dialogcards-disabled',\n          'title': _this.params.retry,\n          'html': _this.params.retry\n        }).click(function () {\n          _this.trigger('reset');\n        }).appendTo($footer);\n        _this.$progress = $('<div>', {\n          'id': 'h5p-dialogcards-progress-' + Dialogcards.idCounter,\n          'class': 'h5p-dialogcards-progress',\n          'aria-live': 'assertive'\n        }).appendTo($footer);\n      } else {\n        _this.$round = $('<div>', {\n          'class': 'h5p-dialogcards-round'\n        }).appendTo($footer);\n        _this.$progress = $('<div>', {\n          'class': 'h5p-dialogcards-cards-left',\n          'aria-live': 'assertive'\n        }).appendTo($footer);\n      }\n\n      return $footer;\n    };\n    /**\n     * Called when all cards has been loaded.\n     */\n\n\n    _this.updateImageSize = function () {\n      // Find highest card content\n      var relativeHeightCap = 15;\n      var height = 0;\n\n      var $currentCardContent = _this.cards[_this.currentCardId].getDOM().find('.h5p-dialogcards-card-content');\n\n      _this.params.dialogs.forEach(function (dialog) {\n        var imageHeight;\n\n        if (dialog.front.image) {\n          imageHeight = dialog.front.image.height / dialog.front.image.width * $currentCardContent.get(0).getBoundingClientRect().width;\n\n          if (imageHeight > height) {\n            height = imageHeight;\n          }\n        }\n\n        if (dialog.back.image) {\n          imageHeight = dialog.back.image.height / dialog.back.image.width * $currentCardContent.get(0).getBoundingClientRect().width;\n\n          if (imageHeight > height) {\n            height = imageHeight;\n          }\n        }\n      });\n\n      if (height > 0) {\n        var relativeImageHeight = height / parseFloat(_this.$inner.css('font-size'));\n\n        if (relativeImageHeight > relativeHeightCap) {\n          relativeImageHeight = relativeHeightCap;\n        }\n\n        _this.cards.forEach(function (card) {\n          card.setImageHeight(\"\".concat(relativeImageHeight, \"em\"));\n        });\n      }\n    };\n    /**\n     * Creates all cards and appends them to card wrapper.\n     *\n     * @param {object[]} cardIds Card ids.\n     * @returns {*|jQuery|HTMLElement} Card wrapper set\n     */\n\n\n    _this.initCards = function (cardIds) {\n      var initLoad = 2;\n      _this.cards = [];\n      _this.currentCardId = 0; // Randomize cards order\n\n      if (_this.params.behaviour.randomCards) {\n        cardIds = H5P.shuffleArray(cardIds);\n      }\n\n      var $cardwrapperSet = $('<div>', {\n        'class': 'h5p-dialogcards-cardwrap-set'\n      });\n\n      for (var i = 0; i < cardIds.length; i++) {\n        // Load cards progressively\n        if (i >= initLoad) {\n          break;\n        }\n\n        var card = _this.getCard(cardIds[i]);\n\n        card.setProgressText(i + 1, cardIds.length);\n\n        _this.cards.push(card);\n\n        var $cardWrapper = card.getDOM(); // Set current card\n\n        if (i === _this.currentCardId) {\n          $cardWrapper.addClass('h5p-dialogcards-current');\n          _this.$current = $cardWrapper;\n        }\n\n        card.addTipToCard($cardWrapper.find('.h5p-dialogcards-card-content'), 'front', i);\n        $cardwrapperSet.append($cardWrapper);\n      }\n\n      return $cardwrapperSet;\n    };\n    /**\n     * Handle card turned.\n     *\n     * @param {boolean} turned - True, if card is turned.\n     */\n\n\n    _this.handleCardTurned = function (turned) {\n      // a11y notification\n      _this.$cardSideAnnouncer.html(turned ? _this.params.cardFrontLabel : _this.params.cardBackLabel); // retry button\n\n\n      if (_this.params.behaviour.enableRetry && _this.currentCardId + 1 === _this.cardIds.length) {\n        if (_this.$retry) {\n          _this.$retry.removeClass('h5p-dialogcards-disabled');\n\n          _this.truncateRetryButton();\n        }\n      }\n    };\n    /**\n     * Update navigation text and show or hide buttons.\n     */\n\n\n    _this.updateNavigation = function () {\n      if (_this.params.mode === 'normal') {\n        // Final card\n        if (_this.getCurrentSelectionIndex() < _this.cardIds.length - 1) {\n          _this.$next.removeClass('h5p-dialogcards-disabled');\n\n          _this.$retry.addClass('h5p-dialogcards-disabled');\n        } else {\n          _this.$next.addClass('h5p-dialogcards-disabled');\n        } // First card\n\n\n        if (_this.currentCardId > 0 && !_this.params.behaviour.disableBackwardsNavigation) {\n          _this.$prev.removeClass('h5p-dialogcards-disabled');\n        } else {\n          _this.$prev.addClass('h5p-dialogcards-disabled');\n        }\n\n        _this.$progress.text(_this.params.progressText.replace('@card', _this.getCurrentSelectionIndex() + 1).replace('@total', _this.cardIds.length)); // Looks strange, but the Ids get mixed up elsewhere\n\n\n        _this.cards[_this.findCardPosition(_this.cards[_this.currentCardId].id)].resizeOverflowingText();\n      } else {\n        _this.$round.text(_this.params.round.replace('@round', _this.round));\n\n        var selectionIndex = _this.getCurrentSelectionIndex();\n\n        _this.$progress.text(_this.params.cardsLeft.replace('@number', _this.cardIds.length - selectionIndex));\n      }\n\n      _this.trigger('resize');\n    };\n    /**\n     * Show summary screen.\n     * @param {boolean} [previousState = false] If true, piles will not be updated.\n     */\n\n\n    _this.showSummary = function () {\n      var previousState = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n      // Update piles and retrieve the new pile sizes\n      var newPileSizes = previousState ? _this.cardManager.getPileSizes() : _this.cardManager.updatePiles(_this.results);\n\n      var right = _this.results.filter(function (result) {\n        return result.result === true;\n      }).length;\n\n      var wrong = _this.results.length - right;\n      var notShown = _this.cardPoolSize - right - wrong;\n      var completed = newPileSizes.slice(-1)[0];\n      var done = completed === _this.cardPoolSize;\n      var summary = {\n        round: _this.round,\n        results: [{\n          field: 'h5p-dialogcards-round-cards-right',\n          score: {\n            value: right,\n            max: wrong + right\n          }\n        }, {\n          field: 'h5p-dialogcards-round-cards-wrong',\n          score: {\n            value: wrong,\n            max: wrong + right\n          }\n        }, {\n          field: 'h5p-dialogcards-round-cards-not-shown',\n          score: {\n            value: notShown\n          }\n        }, {\n          field: 'h5p-dialogcards-overall-cards-completed',\n          score: {\n            value: completed,\n            max: _this.cardPoolSize\n          }\n        }, {\n          field: 'h5p-dialogcards-overall-completed-rounds',\n          score: {\n            value: _this.round\n          }\n        }]\n      };\n\n      if (done) {\n        summary.done = true;\n        summary.message = _this.params.summaryAllDone.replace('@cards', _this.cardPoolSize).replace('@max', _this.params.behaviour.maxProficiency - 1);\n      }\n\n      _this.summaryScreen.update(summary);\n\n      _this.summaryScreen.show();\n\n      _this.hideCards();\n\n      _this.trigger('resize');\n    };\n    /**\n     * Show main content.\n     */\n\n\n    _this.showCards = function () {\n      _this.$cardwrapperSet.find('.h5p-dialogcards-cardwrap').removeClass('h5p-dialogcards-gone');\n\n      _this.$footer.removeClass('h5p-dialogcards-gone');\n\n      _this.cardsShown = true;\n    };\n    /**\n     * Hide main content.\n     */\n\n\n    _this.hideCards = function () {\n      _this.$cardwrapperSet.find('.h5p-dialogcards-cardwrap').addClass('h5p-dialogcards-gone');\n\n      _this.$footer.addClass('h5p-dialogcards-gone');\n\n      _this.cardsShown = false;\n    };\n    /**\n     * Show next card.\n     *\n     * @param {object} [result] Optional result of repetition mode.\n     */\n\n\n    _this.nextCard = function (result) {\n      if (typeof result !== 'undefined') {\n        _this.results.push(result);\n      }\n\n      _this.cards[_this.currentCardId].stopAudio(); // On final card\n\n\n      if (_this.cardIds.length - _this.getCurrentSelectionIndex() === 1) {\n        if (_this.params.mode === 'repetition') {\n          _this.$progress.text(_this.params.cardsLeft.replace('@number', 0));\n\n          _this.cards[_this.currentCardId].showSummaryButton(_this.showSummary);\n        }\n\n        return;\n      }\n\n      _this.gotoCard(_this.getCurrentSelectionIndex() + 1);\n    };\n    /**\n     * Get card from card manager.\n     * @param {number} id Card's Id.\n     * @return {object} Card.\n     */\n\n\n    _this.getCard = function (id) {\n      var card = _this.cardManager.getCard(id);\n\n      card.createButtonListeners();\n      return card;\n    };\n    /**\n     * Find the position of a loaded card.\n     * @param {number} cardId CardId to look for.\n     * @return {number} Position or undefined.\n     */\n\n\n    _this.findCardPosition = function (cardId) {\n      var position;\n\n      _this.cards.forEach(function (card, index) {\n        if (!position && card.id === cardId) {\n          position = index;\n        }\n      });\n\n      return position;\n    };\n    /**\n     * Insert a card into the DOM.\n     * @param {Card} card Card to insert.\n     * @param {number} [index] Position to insert card at.\n     */\n\n\n    _this.insertCardToDOM = function (card, index) {\n      var $node = card.getDOM(); // Put at appropriate position.\n\n      if (index === undefined) {\n        $node.appendTo(_this.$cardwrapperSet);\n      } else if (index === 0) {\n        _this.$cardwrapperSet.prepend($node);\n      } else {\n        _this.$cardwrapperSet.children().eq(index).after($node);\n      } // Add hints\n\n\n      card.addTipToCard($node.find('.h5p-dialogcards-card-content'), 'front', index);\n    };\n    /**\n     * Go to a specific card in the selection. Cards may need to be loaded.\n     * @param {number} targetPosition Target card position.\n     */\n\n\n    _this.gotoCard = function (targetPosition) {\n      if (targetPosition < 0 || targetPosition >= _this.cardIds.length) {\n        return;\n      } // Stop action on current card\n\n\n      var currentCard = _this.cards[_this.currentCardId];\n      currentCard.stopAudio();\n      currentCard.getDOM().removeClass('h5p-dialogcards-current'); // Get card positions to check for being loaded\n\n      var checkLoaded = [];\n\n      if (targetPosition > 0) {\n        checkLoaded.push(targetPosition - 1);\n      }\n\n      checkLoaded.push(targetPosition);\n\n      if (targetPosition + 1 < _this.cardIds.length) {\n        checkLoaded.push(targetPosition + 1);\n      } // Load and insert target card, predecessor and successor if required.\n\n\n      checkLoaded.forEach(function (position) {\n        var loadedPosition = _this.findCardPosition(_this.cardIds[position]);\n\n        if (loadedPosition === undefined) {\n          // Card has not been loaded. Load now.\n          var card = _this.getCard(_this.cardIds[position]);\n\n          card.setProgressText(position + 1, _this.cardIds.length);\n          /*\n           * Try to find successor card in loaded pile and insert before\n           * or put to the end of the loaded pile.\n           */\n\n          var successorId = Math.min(position + 1, _this.cardIds.length - 1);\n\n          var successor = _this.findCardPosition(_this.cardIds[successorId]);\n\n          var insertPosition = successor || _this.cards.length;\n\n          _this.cards.splice(insertPosition, 0, card);\n\n          _this.insertCardToDOM(card, insertPosition);\n        }\n      });\n\n      _this.resize(); // Retrieve position of id now in *loaded cards*\n\n\n      targetPosition = _this.findCardPosition(_this.cardIds[targetPosition]); // Set classes for card order/display\n\n      _this.cards.forEach(function (card, index) {\n        if (index < targetPosition) {\n          card.getDOM().addClass('h5p-dialogcards-previous');\n        } else {\n          card.getDOM().removeClass('h5p-dialogcards-previous');\n\n          if (index === targetPosition) {\n            card.getDOM().addClass('h5p-dialogcards-current');\n          }\n        }\n      });\n\n      _this.currentCardId = targetPosition;\n\n      _this.updateNavigation();\n\n      _this.cards[_this.currentCardId].setCardFocus();\n    };\n    /**\n     * Show previous card.\n     */\n\n\n    _this.prevCard = function () {\n      _this.gotoCard(_this.getCurrentSelectionIndex() - 1);\n    };\n    /**\n     * Show all audio buttons\n     */\n\n\n    _this.showAllAudio = function () {\n      _this.$cardwrapperSet.find('.h5p-audio-inner').removeClass('hide');\n    };\n\n    _this.restartRepetition = function () {\n      _this.cardManager.reset();\n\n      _this.round = 0;\n\n      _this.nextRound();\n    };\n\n    _this.nextRound = function () {\n      _this.round++;\n\n      _this.summaryScreen.hide();\n\n      _this.showCards();\n\n      _this.reset();\n\n      _this.createDOM();\n\n      _this.updateNavigation();\n\n      _this.cards[_this.currentCardId].setCardFocus(true);\n\n      _this.trigger('resize');\n    };\n    /**\n     * Reset the task so that the user can do it again.\n     */\n\n\n    _this.reset = function () {\n      _this.results = [];\n\n      _this.cards[_this.currentCardId].stopAudio(_this.$current.index()); // Turn all cards to front\n\n\n      _this.cards.forEach(function (card) {\n        card.reset();\n      }); // Show first card\n\n\n      _this.currentCardId = 0;\n\n      if (_this.params.mode === 'normal') {\n        _this.cards[_this.currentCardId].getDOM().addClass('h5p-dialogcards-current');\n      }\n\n      _this.updateNavigation();\n\n      if (_this.$retry) {\n        _this.$retry.addClass('h5p-dialogcards-disabled');\n      }\n\n      _this.showAllAudio();\n\n      _this.cards[_this.currentCardId].resizeOverflowingText();\n\n      _this.cards[_this.currentCardId].setCardFocus();\n    };\n    /**\n     * Update the dimensions of the task when resizing the task.\n     */\n\n\n    _this.resize = function () {\n      var _displayLimits3;\n\n      console.log('DIALOGCARDS: resize');\n      console.log('DIALOGCARDS ($cardWrapperSet)', _this.$cardwrapperSet, _this.$cardwrapperSet.outerHeight());\n      console.log('DIALOGCARDS (container)', _this.$inner, _this.$inner.outerHeight());\n\n      _this.handleOrientationChange();\n\n      var displayLimits = null;\n      var titleHeight = _this.$inner.find('.h5p-dialogcards-title').outerHeight() || 0;\n      var descriptionHeight = _this.$inner.find('.h5p-dialogcards-description').outerHeight(true) || 0;\n      var footerHeight = _this.$footer.outerHeight() || 0;\n      var nonCardHeight = titleHeight + descriptionHeight + footerHeight;\n\n      var isMobileLandscape = _this.isMobileLandscape();\n\n      if (parseInt(_this.$cardwrapperSet.css('height')) === 0) {\n        console.log('DIALOGCARDS (titleHeight, descriptionHeight, footerHeight, nonCardHeight, isMobileLandscape)', titleHeight, descriptionHeight, footerHeight, nonCardHeight, isMobileLandscape);\n      } // Change landscape layout on mobile\n\n\n      if (typeof window.orientation === 'number' && _this.$cardwrapperSet.find('.h5p-dialogcards-summary-screen').hasClass('h5p-dialogcards-gone') && _this.params.behaviour.scaleTextNotCard) {\n        _this.$inner.toggleClass('h5p-landscape', isMobileLandscape);\n\n        if (isMobileLandscape) {\n          var _displayLimits, _displayLimits2;\n\n          displayLimits = _this.isRoot() ? _this.computeDisplayLimitsKLL() : null;\n          var screenHeight = _this.isIOS() && isMobileLandscape ? screen.width : screen.height;\n\n          if (((_displayLimits = displayLimits) === null || _displayLimits === void 0 ? void 0 : _displayLimits.height) === 1) {\n            displayLimits.height = screenHeight;\n          }\n\n          if ((_displayLimits2 = displayLimits) !== null && _displayLimits2 !== void 0 && _displayLimits2.height) {\n            _this.$cardwrapperSet.css('max-height', \"\".concat(displayLimits.height - nonCardHeight, \"px\"));\n          } else {\n            _this.$cardwrapperSet.css('max-height', '');\n          }\n        }\n      } else {\n        _this.$cardwrapperSet.css('max-height', '');\n      }\n\n      var maxHeight = 0;\n\n      if (!displayLimits || !isMobileLandscape || !_this.params.behaviour.scaleTextNotCard) {\n        _this.updateImageSize();\n      } else {\n        _this.cards.forEach(function (card) {\n          card.setImageHeight('');\n        });\n      }\n\n      if (!_this.params.behaviour.scaleTextNotCard && _this.cardsShown !== false) {\n        _this.determineCardSizes();\n      }\n\n      if (!_this.params.behaviour.scaleTextNotCard || !isMobileLandscape || !((_displayLimits3 = displayLimits) !== null && _displayLimits3 !== void 0 && _displayLimits3.height) || !_this.$cardwrapperSet.find('.h5p-dialogcards-summary-screen').hasClass('h5p-dialogcards-gone')) {\n        // Reset card-wrapper-set height\n        _this.$cardwrapperSet.css('height', 'auto'); // Find max required height for all cards\n\n\n        _this.$cardwrapperSet.children(':not(.h5p-dialogcards-gone)').each(function () {\n          var wrapperHeight = $(this).css('height', '').outerHeight();\n          var computedHeight = parseFloat($(this).find('.h5p-dialogcards-card-content').css('padding-top')) + parseFloat($(this).find('.h5p-dialogcards-card-content').css('padding-bottom')) + $(this).find('.h5p-dialogcards-image-wrapper').outerHeight() + $(this).find('.h5p-dialogcards-card-text-wrapper').outerHeight();\n          console.log(wrapperHeight, 'vs', computedHeight);\n          $(this).css('height', 'inherit');\n          maxHeight = Math.max(wrapperHeight, maxHeight); // Check height\n\n          if (!$(this).next('.h5p-dialogcards-cardwrap').length) {\n            var initialHeight = $(this).find('.h5p-dialogcards-cardholder').css('height', 'initial').outerHeight();\n            maxHeight = Math.max(initialHeight, maxHeight);\n            $(this).find('.h5p-dialogcards-cardholder').css('height', 'inherit');\n          }\n        });\n\n        var relativeMaxHeight = maxHeight / parseFloat(_this.$cardwrapperSet.css('font-size'));\n        console.log('DIALOGCARDS (relativeMaxHeight)', relativeMaxHeight + 'em');\n\n        _this.$cardwrapperSet.css('height', relativeMaxHeight + 'em');\n      } else {\n        var _displayLimits4;\n\n        if (((_displayLimits4 = displayLimits) === null || _displayLimits4 === void 0 ? void 0 : _displayLimits4.height) - nonCardHeight > 1) {\n          var _displayLimits5;\n\n          _this.$cardwrapperSet.css('height', \"\".concat(((_displayLimits5 = displayLimits) === null || _displayLimits5 === void 0 ? void 0 : _displayLimits5.height) - nonCardHeight, \"px\"));\n        }\n      }\n\n      _this.scaleToFitHeight();\n\n      _this.truncateRetryButton();\n\n      _this.cards[_this.currentCardId].resizeOverflowingText();\n    };\n    /**\n     * Resizes each card to fit its text\n     */\n\n\n    _this.determineCardSizes = function () {\n      var self = _assertThisInitialized(_this);\n\n      if (_this.cardSizeDetermined === undefined) {\n        // Keep track of which cards we've already determined size for\n        _this.cardSizeDetermined = [];\n      } // Go through each card\n\n\n      _this.$cardwrapperSet.children(':visible').each(function (i) {\n        var cardId = self.cards[i].id;\n\n        if (self.cardSizeDetermined.indexOf(cardId) !== -1) {\n          return; // Already determined, no need to determine again.\n        }\n\n        self.cardSizeDetermined.push(cardId); // Here \"this\" references the jQuery object\n\n        var $content = $('.h5p-dialogcards-card-content', this);\n        var $text = $('.h5p-dialogcards-card-text-inner-content', $content); // Grab size with text\n\n        var textHeight = $text[0].getBoundingClientRect().height; // Change to answer\n\n        var currentCard = self.cards[i];\n        currentCard.changeText(currentCard.getAnswer()); // Grab size with answer\n\n        var answerHeight = $text[0].getBoundingClientRect().height; // Use highest\n\n        var useHeight = textHeight > answerHeight ? textHeight : answerHeight; // Min. limit\n\n        var minHeight = parseFloat($text.parent().parent().css('minHeight'));\n\n        if (useHeight < minHeight) {\n          useHeight = minHeight;\n        } // None of the cards has text, shrink text area, leave space for audio\n\n\n        if (self.hasNoTexts) {\n          var $cardText = $text.find('.h5p-dialogcards-card-text');\n          useHeight = self.hasNoAudios ? 0 : useHeight - parseFloat($cardText.css('height'));\n          $cardText.css('height', 0);\n        } // Convert to em\n\n\n        var fontSize = parseFloat($content.css('fontSize'));\n        useHeight /= fontSize; // Set height\n\n        $text.parent().css('height', useHeight + 'em'); // Change back to text\n\n        currentCard.changeText(currentCard.getText());\n      });\n    };\n    /**\n     * Scales the card contents.\n     */\n\n\n    _this.scaleToFitHeight = function () {\n      if (!_this.$cardwrapperSet || !_this.$cardwrapperSet.is(':visible') || !_this.params.behaviour.scaleTextNotCard) {\n        return;\n      } // Resize font size to fit inside CP\n\n\n      if (_this.$inner.parents('.h5p-course-presentation').length) {\n        var $parentContainer = _this.$inner.parent();\n\n        if (_this.$inner.parents('.h5p-popup-container').length) {\n          $parentContainer = _this.$inner.parents('.h5p-popup-container');\n        }\n\n        var containerHeight = $parentContainer.get(0).getBoundingClientRect().height;\n\n        var getContentHeight = function getContentHeight() {\n          var contentHeight = 0;\n\n          _this.$inner.children().each(function () {\n            // Here \"this\" references the jQuery object\n            var $child = $(this);\n            contentHeight += this.getBoundingClientRect().height + parseFloat($child.css('margin-top')) + parseFloat($child.css('margin-bottom'));\n          });\n\n          return contentHeight;\n        };\n\n        var contentHeight = getContentHeight();\n        var parentFontSize = parseFloat(_this.$inner.parent().css('font-size'));\n        var newFontSize = parseFloat(_this.$inner.css('font-size')); // Decrease font size\n\n        if (containerHeight < contentHeight) {\n          while (containerHeight < contentHeight) {\n            newFontSize -= Dialogcards.SCALEINTERVAL; // Cap at min font size\n\n            if (newFontSize < Dialogcards.MINSCALE) {\n              break;\n            } // Set relative font size to scale with full screen.\n\n\n            _this.$inner.css('font-size', newFontSize / parentFontSize + 'em');\n\n            contentHeight = getContentHeight();\n          }\n        } else {\n          // Increase font size\n          var increaseFontSize = true;\n\n          while (increaseFontSize) {\n            newFontSize += Dialogcards.SCALEINTERVAL; // Cap max font size\n\n            if (newFontSize > Dialogcards.MAXSCALE) {\n              increaseFontSize = false;\n              break;\n            } // Set relative font size to scale with full screen.\n\n\n            var relativeFontSize = newFontSize / parentFontSize;\n\n            _this.$inner.css('font-size', relativeFontSize + 'em');\n\n            contentHeight = getContentHeight();\n\n            if (containerHeight <= contentHeight) {\n              increaseFontSize = false;\n              relativeFontSize = (newFontSize - Dialogcards.SCALEINTERVAL) / parentFontSize;\n\n              _this.$inner.css('font-size', relativeFontSize + 'em');\n            }\n          }\n        }\n      } else {\n        // Resize mobile view\n        _this.cards[_this.currentCardId].resizeOverflowingText();\n      }\n    };\n    /**\n     * Truncate retry button if width is small.\n     */\n\n\n    _this.truncateRetryButton = function () {\n      if (!_this.$retry) {\n        return;\n      } // Reset button to full size\n\n\n      _this.$retry.removeClass('truncated');\n\n      _this.$retry.html(_this.params.retry); // Measure button\n\n\n      var maxWidthPercentages = 0.3;\n      var retryWidth = _this.$retry.get(0).getBoundingClientRect().width + parseFloat(_this.$retry.css('margin-left')) + parseFloat(_this.$retry.css('margin-right'));\n\n      var retryWidthPercentage = retryWidth / _this.$retry.parent().get(0).getBoundingClientRect().width; // Truncate button\n\n\n      if (retryWidthPercentage > maxWidthPercentages) {\n        _this.$retry.addClass('truncated');\n\n        _this.$retry.html('');\n      }\n    };\n    /**\n     * Retrieve index of card in selection, not loaded cards.\n     */\n\n\n    _this.getCurrentSelectionIndex = function () {\n      return _this.cardIds.indexOf(_this.cards[_this.currentCardId].id);\n    };\n    /**\n     * Get the content type title.\n     *\n     * @return {string} title.\n     */\n\n\n    _this.getTitle = function () {\n      return H5P.createTitle(_this.contentData && _this.contentData.metadata && _this.contentData.metadata.title ? _this.contentData.metadata.title : 'Dialog Cards');\n    };\n    /**\n     * Save the current state to be restored later.\n     */\n\n\n    _this.getCurrentState = function () {\n      return {\n        cardPiles: _this.cardManager.getPiles(),\n        cardIds: _this.cardIds,\n        round: _this.round,\n        currentCardId: _this.getCurrentSelectionIndex(),\n        results: _this.results\n      };\n    };\n\n    return _this;\n  }\n  /**\n   * Compute display limits.\n   * @return {object|null} Height and width in px or null if cannot be determined.\n   */\n\n\n  var _proto = Dialogcards.prototype;\n\n  _proto.computeDisplayLimits = function computeDisplayLimits() {\n    var topWindow = this.getTopWindow(); // iOS doesn't change screen dimensions on rotation\n\n    var screenSize = this.isIOS() && this.getOrientation() === 'landscape' ? {\n      height: screen.width,\n      width: screen.height\n    } : {\n      height: screen.height,\n      width: screen.width\n    };\n    topWindow = topWindow || {\n      innerHeight: screenSize.height,\n      innerWidth: screenSize.width\n    }; // Smallest value of viewport and container wins\n\n    return {\n      height: Math.min(topWindow.innerHeight, screenSize.height),\n      width: Math.min(topWindow.innerWidth, this.$inner.get(0).offsetWidth)\n    };\n  }\n  /**\n   * Compute display limits for KidsLoop Live.\n   * @return {object|null} Height and width in px or null if cannot be determined.\n   */\n  ;\n\n  _proto.computeDisplayLimitsKLL = function computeDisplayLimitsKLL() {\n    var displayLimits = this.computeDisplayLimits(); // This only works because KLL enforces height on H5P's iframe\n\n    displayLimits.height = Math.min(displayLimits.height, document.body.offsetHeight);\n    return displayLimits;\n  }\n  /**\n   * Detect whether user is running iOS.\n   * @return {boolean} True, if user is running iOS.\n   */\n  ;\n\n  _proto.isIOS = function isIOS() {\n    return ['iPad Simulator', 'iPhone Simulator', 'iPod Simulator', 'iPad', 'iPhone', 'iPod'].includes(navigator.platform) || navigator.userAgent.includes('Mac') && 'ontouchend' in document;\n  }\n  /**\n   * Determine whether mobile device in landscape orientation.\n   * @return {boolean} True, if mobile device in landscape orientation.\n   */\n  ;\n\n  _proto.isMobileLandscape = function isMobileLandscape() {\n    return this.isMobileDevice() && this.getOrientation() === 'landscape';\n  }\n  /**\n   * Detect mobile devices (http://detectmobilebrowsers.com/)\n   * @returns {boolean} True if running on a mobile device.\n   */\n  ;\n\n  _proto.isMobileDevice = function isMobileDevice() {\n    var check = false;\n\n    (function (a) {\n      if (/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(a.substr(0, 4))) check = true;\n    })(navigator.userAgent || navigator.vendor || window.opera);\n\n    return check;\n  }\n  /**\n   * Get device orientation.\n   * @return {string} 'portrait' or 'landscape'.\n   */\n  ;\n\n  _proto.getOrientation = function getOrientation() {\n    if (screen.orientation && screen.orientation.type) {\n      if (screen.orientation.type.includes('portrait')) {\n        return 'portrait';\n      } else if (screen.orientation.type.includes('landscape')) {\n        return 'landscape';\n      }\n    } // Unreliable, as not clear what device's natural orientation is\n\n\n    if (typeof window.orientation === 'number') {\n      if (window.orientation === 0 || window.orientation === 180) {\n        return 'portrait';\n      } else if (window.orientation === 90 || window.orientation === -90 || window.orientation === 270) {\n        return 'landscape';\n      }\n    }\n\n    return 'landscape'; // Assume default\n  }\n  /**\n  * Get top DOM Window object.\n  * @param {Window} [startWindow=window] Window to start looking from.\n  * @return {Window|null} Top window.\n  */\n  ;\n\n  _proto.getTopWindow = function getTopWindow(startWindow) {\n    var sameOrigin;\n    startWindow = startWindow || window; // H5P iframe may be on different domain than iframe content\n\n    try {\n      sameOrigin = startWindow.parent.location.host === window.location.host;\n    } catch (error) {\n      sameOrigin = null;\n    }\n\n    if (!sameOrigin) {\n      return null;\n    }\n\n    if (startWindow.parent === startWindow || !startWindow.parent) {\n      return startWindow;\n    }\n\n    return this.getTopWindow(startWindow.parent);\n  }\n  /**\n   * Handle orientation change.\n   */\n  ;\n\n  _proto.handleOrientationChange = function handleOrientationChange() {\n    var _this2 = this;\n\n    if (!this.params.behaviour.scaleTextNotCard) {\n      return;\n    }\n\n    var isMobileLandscape = this.isMobileLandscape();\n    this.cards.forEach(function (card) {\n      if (_this2.params.mode === 'repetition') {\n        card.$buttonTurn.text(isMobileLandscape ? '' : _this2.params.answer);\n        card.$buttonCorrect.text(isMobileLandscape ? '' : _this2.params.correctAnswer);\n        card.$buttonIncorrect.text(isMobileLandscape ? '' : _this2.params.incorrectAnswer);\n      }\n\n      if (!isMobileLandscape) {\n        _this2.$cardwrapperSet.css('max-height', '');\n      }\n    });\n  };\n\n  return Dialogcards;\n}(H5P.EventDispatcher);\n\nDialogcards.idCounter = 0; // Constants\n\nDialogcards.SCALEINTERVAL = 0.2;\nDialogcards.MAXSCALE = 16;\nDialogcards.MINSCALE = 4;\n/* harmony default export */ __webpack_exports__[\"default\"] = (Dialogcards);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvc2NyaXB0cy9oNXAtZGlhbG9nY2FyZHMuanMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUVBO0FBQ0E7O0FBRUE7OztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTs7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUdBOztBQUNBOztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBOztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFFQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBSkE7QUFXQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFwQkE7QUFzQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFOQTtBQXhEQTs7QUFtRUE7QUFBQTtBQUFBOztBQUdBO0FBQUE7QUFBQTs7QUFJQTtBQUVBO0FBQ0E7O0FBQ0E7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBQ0E7QUFDQTs7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFmQTtBQWtCQTtBQUNBO0FBQ0E7QUFGQTs7QUFLQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUlBOztBQUVBO0FBQ0E7QUFDQTtBQUdBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBRUE7O0FBQ0E7O0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU9BO0FBRUE7O0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7OztBQUdBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFFQTtBQUNBO0FBREE7QUFJQTtBQUNBO0FBQ0E7QUFGQTtBQUlBOztBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFDQTtBQUNBO0FBQ0E7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBR0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFEQTs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUNBOztBQUVBOztBQUNBOztBQUdBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBQ0E7QUFDQTtBQUVBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7O0FBRUE7OztBQU1BO0FBQ0E7QUFFQTs7QUFDQTs7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFBQTtBQUNBO0FBQ0E7O0FBSUE7QUFBQTtBQUFBOztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUZBO0FBS0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUZBO0FBS0E7QUFDQTtBQUFBO0FBQUE7QUFGQTtBQUtBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFGQTtBQUtBO0FBQ0E7QUFBQTtBQUFBO0FBRkE7QUFuQkE7O0FBMEJBO0FBQ0E7QUFDQTtBQUdBOztBQUVBOztBQUNBOztBQUNBOztBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7O0FBQ0E7O0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTs7QUFDQTs7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7OztBQUdBO0FBQ0E7QUFDQTs7QUFDQTtBQUNBOztBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7O0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBOztBQUdBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBOzs7QUFHQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7O0FBR0E7O0FBQ0E7QUFDQTtBQUNBOztBQUNBOztBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTs7QUFDQTtBQUVBO0FBQ0E7O0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7OztBQUdBOztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFDQTs7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFFQTs7QUFFQTtBQUNBOztBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBOzs7QUFDQTtBQUNBOztBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7OztBQUdBOztBQUNBO0FBQ0E7QUFDQTs7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBQ0E7O0FBRUE7O0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFBQTs7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7OztBQUdBO0FBS0E7O0FBRUE7QUFBQTs7QUFDQTtBQUVBOztBQUlBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUVBO0FBS0E7QUFFQTtBQUNBOztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUNBO0FBQ0E7QUFDQTs7QUFDQTtBQUFBOztBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFDQTs7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBOzs7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFDQTs7QUFHQTtBQUNBOztBQUdBOztBQUdBO0FBQ0E7O0FBR0E7O0FBR0E7O0FBR0E7O0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBOztBQUdBOztBQUdBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7O0FBQ0E7QUFDQTtBQUNBOztBQUNBOztBQUNBO0FBQ0E7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTs7QUFDQTtBQUNBOztBQUNBO0FBQ0E7QUFDQTs7QUFHQTtBQUNBO0FBQ0E7O0FBR0E7QUFDQTtBQUNBOzs7QUFHQTs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUNBO0FBQ0E7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBOztBQUNBOztBQUNBOztBQUNBO0FBQ0E7QUFDQTs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTs7QUFDQTs7O0FBR0E7QUFDQTs7QUFFQTs7O0FBR0E7QUFDQTs7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7OztBQUNBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFMQTtBQU9BOztBQTlnQ0E7QUErZ0NBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBQ0E7QUFDQTs7QUFHQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUZBOztBQU1BO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTs7QUFHQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUlBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBOztBQUNBO0FBQ0E7QUFDQTs7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7O0FBR0E7QUFDQTtBQUNBO0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7OztBQUNBO0FBQUE7O0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQTFxQ0E7O0FBNnFDQTs7QUFHQTtBQUNBO0FBQ0E7QUFFQSIsInNvdXJjZXMiOlsid2VicGFjazovL2g1cC1kaWFsb2djYXJkcy8uL3NyYy9zY3JpcHRzL2g1cC1kaWFsb2djYXJkcy5qcz85Nzk0Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBDYXJkTWFuYWdlciBmcm9tICcuL2g1cC1kaWFsb2djYXJkcy1jYXJkLW1hbmFnZXInO1xuaW1wb3J0IFN1bW1hcnlTY3JlZW4gZnJvbSAnLi9oNXAtZGlhbG9nY2FyZHMtc3VtbWFyeS1zY3JlZW4nO1xuXG5jb25zdCAkID0gSDVQLmpRdWVyeTtcbmNvbnN0IEpvdWJlbFVJID0gSDVQLkpvdWJlbFVJO1xuXG5jbGFzcyBEaWFsb2djYXJkcyBleHRlbmRzIEg1UC5FdmVudERpc3BhdGNoZXIge1xuICAvKipcbiAgICogSW5pdGlhbGl6ZSBtb2R1bGUuXG4gICAqXG4gICAqIEBjb25zdHJ1Y3RvclxuICAgKlxuICAgKiBAcGFyYW0ge09iamVjdH0gcGFyYW1zIFBhcmFtZXRlcnMuXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBpZCBDb250ZW50IGlkLlxuICAgKiBAcGFyYW0ge09iamVjdH0gY29udGVudERhdGEgQ29udGVudCBkYXRhLCBlLmcuIGZvciBzYXZlQ29udGVudFN0YXRlXG4gICAqIEByZXR1cm5zIHtEaWFsb2dDYXJkc30gc2VsZlxuICAgKi9cbiAgY29uc3RydWN0b3IocGFyYW1zLCBpZCwgY29udGVudERhdGEpIHtcbiAgICBEaWFsb2djYXJkcy5pZENvdW50ZXIrKztcbiAgICBzdXBlcigpO1xuXG4gICAgdGhpcy5jb250ZW50SWQgPSB0aGlzLmlkID0gaWQ7XG4gICAgdGhpcy5wcmV2aW91c1N0YXRlID0gY29udGVudERhdGEucHJldmlvdXNTdGF0ZSB8fCB7fTtcblxuICAgIC8vIFZhciBjYXJkT3JkZXIgc3RvcmVzIG9yZGVyIG9mIGNhcmRzIHRvIGFsbG93IHJlc3VtaW5nIG9mIGNhcmQgc2V0LlxuICAgIC8vIFZhciBwcm9ncmVzcyBzdG9yZXMgY3VycmVudCBjYXJkIGluZGV4LlxuICAgIHRoaXMuY29udGVudERhdGEgPSBjb250ZW50RGF0YSB8fCB7fTtcblxuICAgIC8vIFN0cmlwIGNhcmRzIHdpdGggZW1wdHkgc2lkZXNcbiAgICBwYXJhbXMuZGlhbG9ncyA9IHBhcmFtcy5kaWFsb2dzIHx8IFtdO1xuICAgIHBhcmFtcy5kaWFsb2dzID0gcGFyYW1zLmRpYWxvZ3MuZmlsdGVyKGRpYWxvZyA9PiB7XG4gICAgICBpZiAoIWRpYWxvZy5mcm9udCB8fCAhZGlhbG9nLmJhY2spIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuXG4gICAgICAvLyBFbXB0eSBmcm9udD9cbiAgICAgIGlmICghZGlhbG9nLmZyb250LnRleHQgJiYgIWRpYWxvZy5mcm9udC5pbWFnZSAmJiAhZGlhbG9nLmZyb250LmF1ZGlvKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgLy8gRW1wdHkgYmFjaz9cbiAgICAgIGNvbnN0IG5vQmFja1RleHQgPSAhZGlhbG9nLmJhY2sudGV4dDtcbiAgICAgIGNvbnN0IG5vQmFja0ltYWdlID0gKChkaWFsb2cuYmFjay51c2VJbWFnZUZyb21Gcm9udCAmJiAhZGlhbG9nLmZyb250LmltYWdlKSB8fCAoIWRpYWxvZy5iYWNrLnVzZUltYWdlRnJvbUZyb250ICYmICFkaWFsb2cuYmFjay5pbWFnZSkpO1xuICAgICAgY29uc3Qgbm9CYWNrQXVkaW8gPSAoKGRpYWxvZy5iYWNrLnVzZUF1ZGlvRnJvbUZyb250ICYmICFkaWFsb2cuZnJvbnQuYXVkaW8pIHx8ICghZGlhbG9nLmJhY2sudXNlQXVkaW9Gcm9tRnJvbnQgJiYgIWRpYWxvZy5iYWNrLmF1ZGlvKSk7XG4gICAgICBpZiAobm9CYWNrVGV4dCAmJiBub0JhY2tJbWFnZSAmJiBub0JhY2tBdWRpbykge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0pO1xuXG4gICAgLy8gU2V0IGRlZmF1bHQgYmVoYXZpb3IuXG4gICAgdGhpcy5wYXJhbXMgPSAkLmV4dGVuZCh0cnVlLCB7XG4gICAgICB0aXRsZTogJycsXG4gICAgICBtb2RlOiAnbm9ybWFsJyxcbiAgICAgIGRlc2NyaXB0aW9uOiBcIlNpdCBpbiBwYWlycyBhbmQgbWFrZSB1cCBzZW50ZW5jZXMgd2hlcmUgeW91IGluY2x1ZGUgdGhlIGV4cHJlc3Npb25zIGJlbG93Ljxici8+RXhhbXBsZTogSSBzaG91bGQgaGF2ZSBzYWlkIHllcywgSE9XRVZFUiBJIGtlcHQgbXkgbW91dGggc2h1dC5cIixcbiAgICAgIG5leHQ6IFwiTmV4dFwiLFxuICAgICAgcHJldjogXCJQcmV2aW91c1wiLFxuICAgICAgcmV0cnk6IFwiUmV0cnlcIixcbiAgICAgIGFuc3dlcjogXCJUdXJuXCIsXG4gICAgICBjb3JyZWN0QW5zd2VyOiAnSSBnb3QgaXQgcmlnaHQhJyxcbiAgICAgIGluY29ycmVjdEFuc3dlcjogJ0kgZ290IGl0IHdyb25nJyxcbiAgICAgIHJvdW5kOiAnUm91bmQgQHJvdW5kJyxcbiAgICAgIGNhcmRzTGVmdDogJ0NhcmRzIGxlZnQ6IEBudW1iZXInLFxuICAgICAgbmV4dFJvdW5kOiAnUHJvY2VlZCB0byByb3VuZCBAcm91bmQnLFxuICAgICAgc3RhcnRPdmVyOiAnU3RhcnQgb3ZlcicsXG4gICAgICBzaG93U3VtbWFyeTogJ05leHQnLFxuICAgICAgc3VtbWFyeTogJ1N1bW1hcnknLFxuICAgICAgc3VtbWFyeUNhcmRzUmlnaHQ6ICdDYXJkcyB5b3UgZ290IHJpZ2h0OicsXG4gICAgICBzdW1tYXJ5Q2FyZHNXcm9uZzogJ0NhcmRzIHlvdSBnb3Qgd3Jvbmc6JyxcbiAgICAgIHN1bW1hcnlDYXJkc05vdFNob3duOiAnQ2FyZHMgaW4gcG9vbCBub3Qgc2hvd246JyxcbiAgICAgIHN1bW1hcnlPdmVyYWxsU2NvcmU6ICdPdmVyYWxsIFNjb3JlJyxcbiAgICAgIHN1bW1hcnlDYXJkc0NvbXBsZXRlZDogJ0NhcmRzIHlvdSBoYXZlIGNvbXBsZXRlZCBsZWFybmluZzonLFxuICAgICAgc3VtbWFyeUNvbXBsZXRlZFJvdW5kczogJ0NvbXBsZXRlZCByb3VuZHM6JyxcbiAgICAgIHN1bW1hcnlBbGxEb25lOiAnV2VsbCBkb25lISBZb3UgZ290IGFsbCBAY2FyZHMgY2FyZHMgY29ycmVjdCBAbWF4IHRpbWVzIGluIGEgcm93IGVhY2ghJyxcbiAgICAgIHByb2dyZXNzVGV4dDogXCJDYXJkIEBjYXJkIG9mIEB0b3RhbFwiLFxuICAgICAgY2FyZEZyb250TGFiZWw6IFwiQ2FyZCBmcm9udFwiLFxuICAgICAgY2FyZEJhY2tMYWJlbDogXCJDYXJkIGJhY2tcIixcbiAgICAgIHRpcEJ1dHRvbkxhYmVsOiAnU2hvdyB0aXAnLFxuICAgICAgYXVkaW9Ob3RTdXBwb3J0ZWQ6ICdZb3VyIGJyb3dzZXIgZG9lcyBub3Qgc3VwcG9ydCB0aGlzIGF1ZGlvJyxcbiAgICAgIGNvbmZpcm1TdGFydGluZ092ZXI6IHtcbiAgICAgICAgaGVhZGVyOiAnU3RhcnQgb3Zlcj8nLFxuICAgICAgICBib2R5OiAnQWxsIHByb2dyZXNzIHdpbGwgYmUgbG9zdC4gQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIHN0YXJ0IG92ZXI/JyxcbiAgICAgICAgY2FuY2VsTGFiZWw6ICdDYW5jZWwnLFxuICAgICAgICBjb25maXJtTGFiZWw6ICdTdGFydCBvdmVyJ1xuICAgICAgfSxcbiAgICAgIGRpYWxvZ3M6IFtcbiAgICAgICAge1xuICAgICAgICAgIGZyb250OiB7XG4gICAgICAgICAgICB0ZXh0OiAnSG9yc2UnXG4gICAgICAgICAgfSxcbiAgICAgICAgICBiYWNrOiB7XG4gICAgICAgICAgICB0ZXh0OiAnSGVzdCcsXG4gICAgICAgICAgICB1c2VJbWFnZUZyb21Gcm9udDogdHJ1ZSxcbiAgICAgICAgICAgIHVzZUF1ZGlvRnJvbUZyb250OiBmYWxzZVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyB7XG4gICAgICAgIC8vICAgZnJvbnQ6IHtcbiAgICAgICAgLy8gICAgIHRleHQ6ICdDb3cnXG4gICAgICAgIC8vICAgfSxcbiAgICAgICAgLy8gICBiYWNrOiB7XG4gICAgICAgIC8vICAgICB0ZXh0OiAnS3UnLFxuICAgICAgICAvLyAgICAgdXNlSW1hZ2VGcm9tRnJvbnQ6IHRydWUsXG4gICAgICAgIC8vICAgICB1c2VBdWRpb0Zyb21Gcm9udDogZmFsc2VcbiAgICAgICAgLy8gICB9XG4gICAgICAgIC8vIH1cbiAgICAgIF0sXG4gICAgICBiZWhhdmlvdXI6IHtcbiAgICAgICAgZW5hYmxlUmV0cnk6IHRydWUsXG4gICAgICAgIGRpc2FibGVCYWNrd2FyZHNOYXZpZ2F0aW9uOiBmYWxzZSxcbiAgICAgICAgc2NhbGVUZXh0Tm90Q2FyZDogZmFsc2UsXG4gICAgICAgIHJhbmRvbUNhcmRzOiBmYWxzZSxcbiAgICAgICAgbWF4UHJvZmljaWVuY3k6IDUsXG4gICAgICAgIHF1aWNrUHJvZ3Jlc3Npb246IGZhbHNlXG4gICAgICB9XG4gICAgfSwgcGFyYW1zKTtcblxuICAgIC8vIENoZWNrIGZvciBubyB0ZXh0cyBhdCBhbGxcbiAgICB0aGlzLmhhc05vVGV4dHMgPSB0aGlzLnBhcmFtcy5kaWFsb2dzLmV2ZXJ5KGRpYWxvZyA9PiBkaWFsb2cuZnJvbnQudGV4dCA9PT0gJycgJiYgZGlhbG9nLmJhY2sudGV4dCA9PT0gJycpO1xuXG4gICAgLy8gQ2hlY2sgZm9yIG5vIGF1ZGlvcyBhdCBhbGxcbiAgICB0aGlzLmhhc05vQXVkaW9zID0gIXRoaXMucGFyYW1zLmRpYWxvZ3Muc29tZShkaWFsb2cgPT4gZGlhbG9nLmZyb250LmF1ZGlvIHx8IChkaWFsb2cuYmFjay5hdWRpbyAmJiAhZGlhbG9nLmJhY2sudXNlQXVkaW9Gcm9tRnJvbnQpKTtcblxuICAgIC8vIFRPRE86IFRyYW5zbGF0aW9uc1xuXG4gICAgdGhpcy5jYXJkcyA9IFtdO1xuXG4gICAgdGhpcy5jdXJyZW50Q2FyZElkID0gMDtcbiAgICB0aGlzLnJvdW5kID0gMDsgLy8gMCBpbmRpY2F0ZXMgdGhhdCBET00gbmVlZHMgdG8gYmUgc2V0IHVwXG4gICAgdGhpcy5yZXN1bHRzID0gdGhpcy5wcmV2aW91c1N0YXRlLnJlc3VsdHMgfHwgW107XG5cbiAgICAvLyBXb3JrYXJvdW5kIGZvciBpT1NcbiAgICBpZiAoc2NyZWVuLm9yaWVudGF0aW9uKSB7XG4gICAgICBzY3JlZW4ub3JpZW50YXRpb24uYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKCkgPT4ge1xuICAgICAgICB0aGlzLmhhbmRsZU9yaWVudGF0aW9uQ2hhbmdlKCk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignb3JpZW50YXRpb25jaGFuZ2UnLCAoKSA9PiB7XG4gICAgICAgIHRoaXMuaGFuZGxlT3JpZW50YXRpb25DaGFuZ2UoKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qXG4gICAgICogV29ya2Fyb3VuZCAoaG9wZWZ1bGx5IHRlbXBvcmFyeSkgZm9yIEtpZHNMb29wTGl2ZSB0aGF0IGZvciB3aGF0ZXZlclxuICAgICAqIHJlYXNvbiBkb2VzIG5vdCB1c2UgaDVwLXJlc2l6ZXIuanMuXG4gICAgICovXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsICgpID0+IHtcbiAgICAgIHRoaXMucmVzaXplKCk7XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiBBdHRhY2ggaDVwIGluc2lkZSB0aGUgZ2l2ZW4gY29udGFpbmVyLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtqUXVlcnl9ICRjb250YWluZXIgQ29udGFpbmVyLlxuICAgICAqL1xuICAgIHRoaXMuYXR0YWNoID0gKCRjb250YWluZXIpID0+IHtcbiAgICAgIHRoaXMuJGlubmVyID0gJGNvbnRhaW5lci5hZGRDbGFzcygnaDVwLWRpYWxvZ2NhcmRzJyk7XG4gICAgICBpZiAodGhpcy5wYXJhbXMuYmVoYXZpb3VyLnNjYWxlVGV4dE5vdENhcmQpIHtcbiAgICAgICAgJGNvbnRhaW5lci5hZGRDbGFzcygnaDVwLXRleHQtc2NhbGluZycpO1xuICAgICAgfVxuXG4gICAgICAvLyBLaWRzTG9vcCBjdXN0b21pemF0aW9uIHRvIHByZXZlbnQgZHJhZ2dpbmcgdGhlIGltYWdlXG4gICAgICB0aGlzLiRpbm5lci5nZXQoMCkuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ3N0YXJ0JywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB9KTtcblxuICAgICAgLy8gT25seSBwYXNzIHdoYXQncyBuZWNlc3NhcnlcbiAgICAgIGNvbnN0IG1hbmFnZXJQYXJhbXMgPSB7XG4gICAgICAgIG1vZGU6IHRoaXMucGFyYW1zLm1vZGUsXG4gICAgICAgIGRpYWxvZ3M6IHRoaXMucGFyYW1zLmRpYWxvZ3MsXG4gICAgICAgIGF1ZGlvTm90U3VwcG9ydGVkOiB0aGlzLnBhcmFtcy5hdWRpb05vdFN1cHBvcnRlZCxcbiAgICAgICAgYW5zd2VyOiB0aGlzLnBhcmFtcy5hbnN3ZXIsXG4gICAgICAgIHNob3dTdW1tYXJ5OiB0aGlzLnBhcmFtcy5zaG93U3VtbWFyeSxcbiAgICAgICAgaW5jb3JyZWN0QW5zd2VyOiB0aGlzLnBhcmFtcy5pbmNvcnJlY3RBbnN3ZXIsXG4gICAgICAgIGNvcnJlY3RBbnN3ZXI6IHRoaXMucGFyYW1zLmNvcnJlY3RBbnN3ZXIsXG4gICAgICAgIHByb2dyZXNzVGV4dDogdGhpcy5wYXJhbXMucHJvZ3Jlc3NUZXh0LFxuICAgICAgICB0aXBCdXR0b25MYWJlbDogdGhpcy5wYXJhbXMudGlwQnV0dG9uTGFiZWwsXG4gICAgICAgIGJlaGF2aW91cjoge1xuICAgICAgICAgIHNjYWxlVGV4dE5vdENhcmQ6IHRoaXMucGFyYW1zLmJlaGF2aW91ci5zY2FsZVRleHROb3RDYXJkLFxuICAgICAgICAgIG1heFByb2ZpY2llbmN5OiB0aGlzLnBhcmFtcy5iZWhhdmlvdXIubWF4UHJvZmljaWVuY3ksXG4gICAgICAgICAgcXVpY2tQcm9ncmVzc2lvbjogdGhpcy5wYXJhbXMuYmVoYXZpb3VyLnF1aWNrUHJvZ3Jlc3Npb25cbiAgICAgICAgfSxcbiAgICAgICAgY2FyZFBpbGVzOiB0aGlzLnByZXZpb3VzU3RhdGUuY2FyZFBpbGVzXG4gICAgICB9O1xuXG4gICAgICB0aGlzLmNhcmRNYW5hZ2VyID0gbmV3IENhcmRNYW5hZ2VyKG1hbmFnZXJQYXJhbXMsIHRoaXMuaWQsIHtcbiAgICAgICAgb25DYXJkVHVybmVkOiB0aGlzLmhhbmRsZUNhcmRUdXJuZWQsXG4gICAgICAgIG9uTmV4dENhcmQ6IHRoaXMubmV4dENhcmRcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLmNyZWF0ZURPTSh0aGlzLnJvdW5kID09PSAwKTtcblxuICAgICAgLypcbiAgICAgICAqIEdvdG8gcHJldmlvdXNseSB2aWV3ZWQgY2FyZC4gSXQgd2FzIHBvc3NpYmxlIHRvIGFsc28gcmVjb3ZlciB0aGUgdHVybmVkXG4gICAgICAgKiBzdGF0ZSwgYnV0IGl0IGZlZWxzIHNlbnNpYmxlIHRvIGxldCB0aGUgcHJldmlvdXNseSB2aWV3ZWQgY2FyZCBiZVxuICAgICAgICogcmV2aWV3ZWQgc3RhcnRpbmcgd2l0aCB0aGUgZnJvbnQuXG4gICAgICAgKi9cbiAgICAgIGlmICh0aGlzLnByZXZpb3VzU3RhdGUuY3VycmVudENhcmRJZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRoaXMuZ290b0NhcmQodGhpcy5wcmV2aW91c1N0YXRlLmN1cnJlbnRDYXJkSWQpO1xuXG4gICAgICAgIC8vIFNob3cgc3VtbWFyeSBpZiBwcmV2aW91cyByb3VuZCB3YXMgY29tcGxldGVkIGJ1dCBuZXh0IHJvdW5kIG5vdCBzdGFydGVkLlxuICAgICAgICBpZiAodGhpcy5wYXJhbXMubW9kZSA9PT0gJ3JlcGV0aXRpb24nICYmIHRoaXMucmVzdWx0cy5sZW5ndGggPT09IHRoaXMuY2FyZElkcy5sZW5ndGgpIHtcbiAgICAgICAgICB0aGlzLnNob3dTdW1tYXJ5KHRydWUpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHRoaXMudXBkYXRlTmF2aWdhdGlvbigpO1xuICAgICAgdGhpcy50cmlnZ2VyKCdyZXNpemUnKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlIERPTS5cbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IGZpcnN0Q2FsbCBJcyBmaXJzdCBjYWxsP1xuICAgICAqL1xuICAgIHRoaXMuY3JlYXRlRE9NID0gKGZpcnN0Q2FsbCkgPT4ge1xuICAgICAgdGhpcy5jYXJkSWRzID0gKGZpcnN0Q2FsbCAmJiB0aGlzLnByZXZpb3VzU3RhdGUuY2FyZElkcykgP1xuICAgICAgICB0aGlzLnByZXZpb3VzU3RhdGUuY2FyZElkcyA6XG4gICAgICAgIHRoaXMuY2FyZE1hbmFnZXIuY3JlYXRlU2VsZWN0aW9uKCk7XG5cbiAgICAgIHRoaXMuY2FyZFBvb2xTaXplID0gdGhpcy5jYXJkUG9vbFNpemUgfHwgdGhpcy5jYXJkTWFuYWdlci5nZXRTaXplKCk7XG5cbiAgICAgIGlmIChmaXJzdENhbGwgPT09IHRydWUpIHtcbiAgICAgICAgY29uc3QgdGl0bGUgPSAkKCc8ZGl2PicgKyB0aGlzLnBhcmFtcy50aXRsZSArICc8L2Rpdj4nKS50ZXh0KCkudHJpbSgpO1xuICAgICAgICB0aGlzLiRoZWFkZXIgPSAkKCh0aXRsZSA/ICc8ZGl2IGNsYXNzPVwiaDVwLWRpYWxvZ2NhcmRzLXRpdGxlXCI+PGRpdiBjbGFzcz1cImg1cC1kaWFsb2djYXJkcy10aXRsZS1pbm5lclwiPicgKyB0aGlzLnBhcmFtcy50aXRsZSArICc8L2Rpdj48L2Rpdj4nIDogJycpICtcbiAgICAgICAgICAnPGRpdiBjbGFzcz1cImg1cC1kaWFsb2djYXJkcy1kZXNjcmlwdGlvblwiPicgKyB0aGlzLnBhcmFtcy5kZXNjcmlwdGlvbiArICc8L2Rpdj4nKTtcblxuICAgICAgICB0aGlzLnN1bW1hcnlTY3JlZW4gPSBuZXcgU3VtbWFyeVNjcmVlbih0aGlzLnBhcmFtcywge25leHRSb3VuZDogdGhpcy5uZXh0Um91bmQsIHJldHJ5OiB0aGlzLnJlc3RhcnRSZXBldGl0aW9ufSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChmaXJzdENhbGwgPT09IHRydWUpIHtcbiAgICAgICAgdGhpcy4kY2FyZHdyYXBwZXJTZXQgPSB0aGlzLmluaXRDYXJkcyh0aGlzLmNhcmRJZHMpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHRoaXMuJGNhcmR3cmFwcGVyU2V0LmRldGFjaCgpO1xuICAgICAgICB0aGlzLiRjYXJkd3JhcHBlclNldCA9IHRoaXMuaW5pdENhcmRzKHRoaXMuY2FyZElkcyk7XG4gICAgICAgIHRoaXMuJGNhcmRTaWRlQW5ub3VuY2VyLmJlZm9yZSh0aGlzLiRjYXJkd3JhcHBlclNldCk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuJGNhcmR3cmFwcGVyU2V0LnByZXBlbmQodGhpcy5zdW1tYXJ5U2NyZWVuLmdldERPTSgpKTtcblxuICAgICAgaWYgKGZpcnN0Q2FsbCA9PT0gdHJ1ZSkge1xuICAgICAgICB0aGlzLiRjYXJkU2lkZUFubm91bmNlciA9ICQoJzxkaXY+Jywge1xuICAgICAgICAgIGh0bWw6IHRoaXMucGFyYW1zLmNhcmRGcm9udExhYmVsLFxuICAgICAgICAgICdjbGFzcyc6ICdoNXAtZGlhbG9nY2FyZHMtY2FyZC1zaWRlLWFubm91bmNlcicsXG4gICAgICAgICAgJ2FyaWEtbGl2ZSc6ICdwb2xpdGUnLFxuICAgICAgICAgICdhcmlhLWhpZGRlbic6ICd0cnVlJ1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLiRmb290ZXIgPSB0aGlzLmNyZWF0ZUZvb3RlcigpO1xuXG4gICAgICAgIHRoaXMuJG1haW5Db250ZW50ID0gJCgnPGRpdj4nKVxuICAgICAgICAgIC5hcHBlbmQodGhpcy4kaGVhZGVyKVxuICAgICAgICAgIC5hcHBlbmQodGhpcy4kY2FyZHdyYXBwZXJTZXQpXG4gICAgICAgICAgLmFwcGVuZCh0aGlzLiRjYXJkU2lkZUFubm91bmNlcilcbiAgICAgICAgICAuYXBwZW5kKHRoaXMuJGZvb3RlcilcbiAgICAgICAgICAuYXBwZW5kVG8odGhpcy4kaW5uZXIpO1xuXG4gICAgICAgIC8vIE5vIGNhcmQgaGFzIHRleHRzXG4gICAgICAgIGlmICh0aGlzLmhhc05vVGV4dHMpIHtcbiAgICAgICAgICB0aGlzLmNhcmRzLmZvckVhY2goY2FyZCA9PiB7XG4gICAgICAgICAgICBjYXJkLnNldE5vVGV4dCgpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5vbigncmVzZXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgdGhpcy5yZXNldCgpO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLm9uKCdyZXNpemUnLCB0aGlzLnJlc2l6ZSk7XG5cbiAgICAgICAgLy8gU2V0IHJvdW5kIHRvIHByZXZpb3VzIHN0YXRlIGlmIGF2YWlsYWJsZVxuICAgICAgICB0aGlzLnJvdW5kID0gKHRoaXMucHJldmlvdXNTdGF0ZS5yb3VuZCAhPT0gdW5kZWZpbmVkKSA/IHRoaXMucHJldmlvdXNTdGF0ZS5yb3VuZCA6IDE7XG4gICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBmb290ZXIvbmF2aWdhdGlvbiBsaW5lXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7KnxqUXVlcnl8SFRNTEVsZW1lbnR9IEZvb3RlciBlbGVtZW50XG4gICAgICovXG4gICAgdGhpcy5jcmVhdGVGb290ZXIgPSAoKSA9PiB7XG4gICAgICBjb25zdCAkZm9vdGVyID0gJCgnPG5hdj4nLCB7XG4gICAgICAgICdjbGFzcyc6ICdoNXAtZGlhbG9nY2FyZHMtZm9vdGVyJyxcbiAgICAgICAgJ3JvbGUnOiAnbmF2aWdhdGlvbidcbiAgICAgIH0pO1xuXG4gICAgICBpZiAodGhpcy5wYXJhbXMubW9kZSA9PT0gJ25vcm1hbCcpIHtcbiAgICAgICAgdGhpcy4kcHJldiA9IEpvdWJlbFVJLmNyZWF0ZUJ1dHRvbih7XG4gICAgICAgICAgJ2NsYXNzJzogJ2g1cC1kaWFsb2djYXJkcy1mb290ZXItYnV0dG9uIGg1cC1kaWFsb2djYXJkcy1wcmV2IHRydW5jYXRlZCcsXG4gICAgICAgICAgJ2FyaWEtbGFiZWwnOiB0aGlzLnBhcmFtcy5wcmV2LFxuICAgICAgICAgICd0aXRsZSc6IHRoaXMucGFyYW1zLnByZXZcbiAgICAgICAgfSkuY2xpY2soKCkgPT4ge1xuICAgICAgICAgIHRoaXMucHJldkNhcmQoKTtcbiAgICAgICAgfSkuYXBwZW5kVG8oJGZvb3Rlcik7XG5cbiAgICAgICAgdGhpcy4kbmV4dCA9IEpvdWJlbFVJLmNyZWF0ZUJ1dHRvbih7XG4gICAgICAgICAgJ2NsYXNzJzogJ2g1cC1kaWFsb2djYXJkcy1mb290ZXItYnV0dG9uIGg1cC1kaWFsb2djYXJkcy1uZXh0IHRydW5jYXRlZCcsXG4gICAgICAgICAgJ2FyaWEtbGFiZWwnOiB0aGlzLnBhcmFtcy5uZXh0LFxuICAgICAgICAgICd0aXRsZSc6IHRoaXMucGFyYW1zLm5leHRcbiAgICAgICAgfSkuY2xpY2soKCkgPT4ge1xuICAgICAgICAgIHRoaXMubmV4dENhcmQoKTtcbiAgICAgICAgfSkuYXBwZW5kVG8oJGZvb3Rlcik7XG5cbiAgICAgICAgdGhpcy4kcmV0cnkgPSBKb3ViZWxVSS5jcmVhdGVCdXR0b24oe1xuICAgICAgICAgICdjbGFzcyc6ICdoNXAtZGlhbG9nY2FyZHMtZm9vdGVyLWJ1dHRvbiBoNXAtZGlhbG9nY2FyZHMtcmV0cnkgaDVwLWRpYWxvZ2NhcmRzLWRpc2FibGVkJyxcbiAgICAgICAgICAndGl0bGUnOiB0aGlzLnBhcmFtcy5yZXRyeSxcbiAgICAgICAgICAnaHRtbCc6IHRoaXMucGFyYW1zLnJldHJ5XG4gICAgICAgIH0pLmNsaWNrKCgpID0+IHtcbiAgICAgICAgICB0aGlzLnRyaWdnZXIoJ3Jlc2V0Jyk7XG4gICAgICAgIH0pLmFwcGVuZFRvKCRmb290ZXIpO1xuXG4gICAgICAgIHRoaXMuJHByb2dyZXNzID0gJCgnPGRpdj4nLCB7XG4gICAgICAgICAgJ2lkJzogJ2g1cC1kaWFsb2djYXJkcy1wcm9ncmVzcy0nICsgRGlhbG9nY2FyZHMuaWRDb3VudGVyLFxuICAgICAgICAgICdjbGFzcyc6ICdoNXAtZGlhbG9nY2FyZHMtcHJvZ3Jlc3MnLFxuICAgICAgICAgICdhcmlhLWxpdmUnOiAnYXNzZXJ0aXZlJ1xuICAgICAgICB9KS5hcHBlbmRUbygkZm9vdGVyKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICB0aGlzLiRyb3VuZCA9ICQoJzxkaXY+Jywge1xuICAgICAgICAgICdjbGFzcyc6ICdoNXAtZGlhbG9nY2FyZHMtcm91bmQnXG4gICAgICAgIH0pLmFwcGVuZFRvKCRmb290ZXIpO1xuXG4gICAgICAgIHRoaXMuJHByb2dyZXNzID0gJCgnPGRpdj4nLCB7XG4gICAgICAgICAgJ2NsYXNzJzogJ2g1cC1kaWFsb2djYXJkcy1jYXJkcy1sZWZ0JyxcbiAgICAgICAgICAnYXJpYS1saXZlJzogJ2Fzc2VydGl2ZSdcbiAgICAgICAgfSkuYXBwZW5kVG8oJGZvb3Rlcik7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiAkZm9vdGVyO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBDYWxsZWQgd2hlbiBhbGwgY2FyZHMgaGFzIGJlZW4gbG9hZGVkLlxuICAgICAqL1xuICAgIHRoaXMudXBkYXRlSW1hZ2VTaXplID0gKCkgPT4ge1xuICAgICAgLy8gRmluZCBoaWdoZXN0IGNhcmQgY29udGVudFxuICAgICAgbGV0IHJlbGF0aXZlSGVpZ2h0Q2FwID0gMTU7XG4gICAgICBsZXQgaGVpZ2h0ID0gMDtcblxuICAgICAgY29uc3QgJGN1cnJlbnRDYXJkQ29udGVudCA9IHRoaXMuY2FyZHNbdGhpcy5jdXJyZW50Q2FyZElkXS5nZXRET00oKS5maW5kKCcuaDVwLWRpYWxvZ2NhcmRzLWNhcmQtY29udGVudCcpO1xuXG4gICAgICB0aGlzLnBhcmFtcy5kaWFsb2dzLmZvckVhY2goZGlhbG9nID0+IHtcbiAgICAgICAgbGV0IGltYWdlSGVpZ2h0O1xuXG4gICAgICAgIGlmIChkaWFsb2cuZnJvbnQuaW1hZ2UpIHtcbiAgICAgICAgICBpbWFnZUhlaWdodCA9IGRpYWxvZy5mcm9udC5pbWFnZS5oZWlnaHQgLyBkaWFsb2cuZnJvbnQuaW1hZ2Uud2lkdGggKiAkY3VycmVudENhcmRDb250ZW50LmdldCgwKS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aDtcbiAgICAgICAgICBpZiAoaW1hZ2VIZWlnaHQgPiBoZWlnaHQpIHtcbiAgICAgICAgICAgIGhlaWdodCA9IGltYWdlSGVpZ2h0O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChkaWFsb2cuYmFjay5pbWFnZSkge1xuICAgICAgICAgIGltYWdlSGVpZ2h0ID0gZGlhbG9nLmJhY2suaW1hZ2UuaGVpZ2h0IC8gZGlhbG9nLmJhY2suaW1hZ2Uud2lkdGggKiAkY3VycmVudENhcmRDb250ZW50LmdldCgwKS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aDtcbiAgICAgICAgICBpZiAoaW1hZ2VIZWlnaHQgPiBoZWlnaHQpIHtcbiAgICAgICAgICAgIGhlaWdodCA9IGltYWdlSGVpZ2h0O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIGlmIChoZWlnaHQgPiAwKSB7XG4gICAgICAgIGxldCByZWxhdGl2ZUltYWdlSGVpZ2h0ID0gaGVpZ2h0IC8gcGFyc2VGbG9hdCh0aGlzLiRpbm5lci5jc3MoJ2ZvbnQtc2l6ZScpKTtcbiAgICAgICAgaWYgKHJlbGF0aXZlSW1hZ2VIZWlnaHQgPiByZWxhdGl2ZUhlaWdodENhcCkge1xuICAgICAgICAgIHJlbGF0aXZlSW1hZ2VIZWlnaHQgPSByZWxhdGl2ZUhlaWdodENhcDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNhcmRzLmZvckVhY2goY2FyZCA9PiB7XG4gICAgICAgICAgY2FyZC5zZXRJbWFnZUhlaWdodChgJHtyZWxhdGl2ZUltYWdlSGVpZ2h0fWVtYCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGFsbCBjYXJkcyBhbmQgYXBwZW5kcyB0aGVtIHRvIGNhcmQgd3JhcHBlci5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7b2JqZWN0W119IGNhcmRJZHMgQ2FyZCBpZHMuXG4gICAgICogQHJldHVybnMgeyp8alF1ZXJ5fEhUTUxFbGVtZW50fSBDYXJkIHdyYXBwZXIgc2V0XG4gICAgICovXG4gICAgdGhpcy5pbml0Q2FyZHMgPSAoY2FyZElkcykgPT4ge1xuICAgICAgY29uc3QgaW5pdExvYWQgPSAyO1xuICAgICAgdGhpcy5jYXJkcyA9IFtdO1xuICAgICAgdGhpcy5jdXJyZW50Q2FyZElkID0gMDtcblxuICAgICAgLy8gUmFuZG9taXplIGNhcmRzIG9yZGVyXG4gICAgICBpZiAodGhpcy5wYXJhbXMuYmVoYXZpb3VyLnJhbmRvbUNhcmRzKSB7XG4gICAgICAgIGNhcmRJZHMgPSBINVAuc2h1ZmZsZUFycmF5KGNhcmRJZHMpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCAkY2FyZHdyYXBwZXJTZXQgPSAkKCc8ZGl2PicsIHtcbiAgICAgICAgJ2NsYXNzJzogJ2g1cC1kaWFsb2djYXJkcy1jYXJkd3JhcC1zZXQnXG4gICAgICB9KTtcblxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjYXJkSWRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIC8vIExvYWQgY2FyZHMgcHJvZ3Jlc3NpdmVseVxuICAgICAgICBpZiAoaSA+PSBpbml0TG9hZCkge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgY2FyZCA9IHRoaXMuZ2V0Q2FyZChjYXJkSWRzW2ldKTtcbiAgICAgICAgY2FyZC5zZXRQcm9ncmVzc1RleHQoaSArIDEsIGNhcmRJZHMubGVuZ3RoKTtcblxuICAgICAgICB0aGlzLmNhcmRzLnB1c2goY2FyZCk7XG4gICAgICAgIGNvbnN0ICRjYXJkV3JhcHBlciA9IGNhcmQuZ2V0RE9NKCk7XG5cbiAgICAgICAgLy8gU2V0IGN1cnJlbnQgY2FyZFxuICAgICAgICBpZiAoaSA9PT0gdGhpcy5jdXJyZW50Q2FyZElkKSB7XG4gICAgICAgICAgJGNhcmRXcmFwcGVyLmFkZENsYXNzKCdoNXAtZGlhbG9nY2FyZHMtY3VycmVudCcpO1xuICAgICAgICAgIHRoaXMuJGN1cnJlbnQgPSAkY2FyZFdyYXBwZXI7XG4gICAgICAgIH1cblxuICAgICAgICBjYXJkLmFkZFRpcFRvQ2FyZCgkY2FyZFdyYXBwZXIuZmluZCgnLmg1cC1kaWFsb2djYXJkcy1jYXJkLWNvbnRlbnQnKSwgJ2Zyb250JywgaSk7XG5cbiAgICAgICAgJGNhcmR3cmFwcGVyU2V0LmFwcGVuZCgkY2FyZFdyYXBwZXIpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gJGNhcmR3cmFwcGVyU2V0O1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBIYW5kbGUgY2FyZCB0dXJuZWQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IHR1cm5lZCAtIFRydWUsIGlmIGNhcmQgaXMgdHVybmVkLlxuICAgICAqL1xuICAgIHRoaXMuaGFuZGxlQ2FyZFR1cm5lZCA9ICh0dXJuZWQpID0+IHtcbiAgICAgIC8vIGExMXkgbm90aWZpY2F0aW9uXG4gICAgICB0aGlzLiRjYXJkU2lkZUFubm91bmNlci5odG1sKHR1cm5lZCA/IHRoaXMucGFyYW1zLmNhcmRGcm9udExhYmVsIDogdGhpcy5wYXJhbXMuY2FyZEJhY2tMYWJlbCk7XG5cbiAgICAgIC8vIHJldHJ5IGJ1dHRvblxuICAgICAgaWYgKHRoaXMucGFyYW1zLmJlaGF2aW91ci5lbmFibGVSZXRyeSAmJiB0aGlzLmN1cnJlbnRDYXJkSWQgKyAxID09PSB0aGlzLmNhcmRJZHMubGVuZ3RoKSB7XG4gICAgICAgIGlmICh0aGlzLiRyZXRyeSkge1xuICAgICAgICAgIHRoaXMuJHJldHJ5LnJlbW92ZUNsYXNzKCdoNXAtZGlhbG9nY2FyZHMtZGlzYWJsZWQnKTtcbiAgICAgICAgICB0aGlzLnRydW5jYXRlUmV0cnlCdXR0b24oKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBVcGRhdGUgbmF2aWdhdGlvbiB0ZXh0IGFuZCBzaG93IG9yIGhpZGUgYnV0dG9ucy5cbiAgICAgKi9cbiAgICB0aGlzLnVwZGF0ZU5hdmlnYXRpb24gPSAoKSA9PiB7XG4gICAgICBpZiAodGhpcy5wYXJhbXMubW9kZSA9PT0gJ25vcm1hbCcpIHtcbiAgICAgICAgLy8gRmluYWwgY2FyZFxuICAgICAgICBpZiAodGhpcy5nZXRDdXJyZW50U2VsZWN0aW9uSW5kZXgoKSA8IHRoaXMuY2FyZElkcy5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgdGhpcy4kbmV4dC5yZW1vdmVDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLWRpc2FibGVkJyk7XG4gICAgICAgICAgdGhpcy4kcmV0cnkuYWRkQ2xhc3MoJ2g1cC1kaWFsb2djYXJkcy1kaXNhYmxlZCcpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIHRoaXMuJG5leHQuYWRkQ2xhc3MoJ2g1cC1kaWFsb2djYXJkcy1kaXNhYmxlZCcpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRmlyc3QgY2FyZFxuICAgICAgICBpZiAodGhpcy5jdXJyZW50Q2FyZElkID4gMCAmJiAhdGhpcy5wYXJhbXMuYmVoYXZpb3VyLmRpc2FibGVCYWNrd2FyZHNOYXZpZ2F0aW9uKSB7XG4gICAgICAgICAgdGhpcy4kcHJldi5yZW1vdmVDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLWRpc2FibGVkJyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgdGhpcy4kcHJldi5hZGRDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLWRpc2FibGVkJyk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLiRwcm9ncmVzcy50ZXh0KHRoaXMucGFyYW1zLnByb2dyZXNzVGV4dFxuICAgICAgICAgIC5yZXBsYWNlKCdAY2FyZCcsIHRoaXMuZ2V0Q3VycmVudFNlbGVjdGlvbkluZGV4KCkgKyAxKVxuICAgICAgICAgIC5yZXBsYWNlKCdAdG90YWwnLCB0aGlzLmNhcmRJZHMubGVuZ3RoKVxuICAgICAgICApO1xuXG4gICAgICAgIC8vIExvb2tzIHN0cmFuZ2UsIGJ1dCB0aGUgSWRzIGdldCBtaXhlZCB1cCBlbHNld2hlcmVcbiAgICAgICAgdGhpcy5jYXJkc1t0aGlzLmZpbmRDYXJkUG9zaXRpb24odGhpcy5jYXJkc1t0aGlzLmN1cnJlbnRDYXJkSWRdLmlkKV0ucmVzaXplT3ZlcmZsb3dpbmdUZXh0KCk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgdGhpcy4kcm91bmQudGV4dCh0aGlzLnBhcmFtcy5yb3VuZC5yZXBsYWNlKCdAcm91bmQnLCB0aGlzLnJvdW5kKSk7XG4gICAgICAgIGNvbnN0IHNlbGVjdGlvbkluZGV4ID0gdGhpcy5nZXRDdXJyZW50U2VsZWN0aW9uSW5kZXgoKTtcbiAgICAgICAgdGhpcy4kcHJvZ3Jlc3MudGV4dCh0aGlzLnBhcmFtcy5jYXJkc0xlZnQucmVwbGFjZSgnQG51bWJlcicsIHRoaXMuY2FyZElkcy5sZW5ndGggLSBzZWxlY3Rpb25JbmRleCkpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLnRyaWdnZXIoJ3Jlc2l6ZScpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBTaG93IHN1bW1hcnkgc2NyZWVuLlxuICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW3ByZXZpb3VzU3RhdGUgPSBmYWxzZV0gSWYgdHJ1ZSwgcGlsZXMgd2lsbCBub3QgYmUgdXBkYXRlZC5cbiAgICAgKi9cbiAgICB0aGlzLnNob3dTdW1tYXJ5ID0gKHByZXZpb3VzU3RhdGUgPSBmYWxzZSkgPT4ge1xuICAgICAgLy8gVXBkYXRlIHBpbGVzIGFuZCByZXRyaWV2ZSB0aGUgbmV3IHBpbGUgc2l6ZXNcbiAgICAgIGNvbnN0IG5ld1BpbGVTaXplcyA9IChwcmV2aW91c1N0YXRlKSA/XG4gICAgICAgIHRoaXMuY2FyZE1hbmFnZXIuZ2V0UGlsZVNpemVzKCkgOlxuICAgICAgICB0aGlzLmNhcmRNYW5hZ2VyLnVwZGF0ZVBpbGVzKHRoaXMucmVzdWx0cyk7XG5cbiAgICAgIGNvbnN0IHJpZ2h0ID0gdGhpcy5yZXN1bHRzLmZpbHRlcihyZXN1bHQgPT4gcmVzdWx0LnJlc3VsdCA9PT0gdHJ1ZSkubGVuZ3RoO1xuICAgICAgY29uc3Qgd3JvbmcgPSB0aGlzLnJlc3VsdHMubGVuZ3RoIC0gcmlnaHQ7XG4gICAgICBjb25zdCBub3RTaG93biA9IHRoaXMuY2FyZFBvb2xTaXplIC0gcmlnaHQgLSB3cm9uZztcbiAgICAgIGNvbnN0IGNvbXBsZXRlZCA9IG5ld1BpbGVTaXplcy5zbGljZSgtMSlbMF07XG4gICAgICBjb25zdCBkb25lID0gY29tcGxldGVkID09PSB0aGlzLmNhcmRQb29sU2l6ZTtcblxuICAgICAgY29uc3Qgc3VtbWFyeSA9IHtcbiAgICAgICAgcm91bmQ6IHRoaXMucm91bmQsXG4gICAgICAgIHJlc3VsdHM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBmaWVsZDogJ2g1cC1kaWFsb2djYXJkcy1yb3VuZC1jYXJkcy1yaWdodCcsXG4gICAgICAgICAgICBzY29yZToge3ZhbHVlOiByaWdodCwgbWF4OiB3cm9uZyArIHJpZ2h0fVxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgZmllbGQ6ICdoNXAtZGlhbG9nY2FyZHMtcm91bmQtY2FyZHMtd3JvbmcnLFxuICAgICAgICAgICAgc2NvcmU6IHt2YWx1ZTogd3JvbmcsIG1heDogd3JvbmcgKyByaWdodH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGZpZWxkOiAnaDVwLWRpYWxvZ2NhcmRzLXJvdW5kLWNhcmRzLW5vdC1zaG93bicsXG4gICAgICAgICAgICBzY29yZToge3ZhbHVlOiBub3RTaG93bn1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGZpZWxkOiAnaDVwLWRpYWxvZ2NhcmRzLW92ZXJhbGwtY2FyZHMtY29tcGxldGVkJyxcbiAgICAgICAgICAgIHNjb3JlOiB7dmFsdWU6IGNvbXBsZXRlZCwgbWF4OiB0aGlzLmNhcmRQb29sU2l6ZX1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGZpZWxkOiAnaDVwLWRpYWxvZ2NhcmRzLW92ZXJhbGwtY29tcGxldGVkLXJvdW5kcycsXG4gICAgICAgICAgICBzY29yZToge3ZhbHVlOiB0aGlzLnJvdW5kfVxuICAgICAgICAgIH1cbiAgICAgICAgXVxuICAgICAgfTtcblxuICAgICAgaWYgKGRvbmUpIHtcbiAgICAgICAgc3VtbWFyeS5kb25lID0gdHJ1ZTtcbiAgICAgICAgc3VtbWFyeS5tZXNzYWdlID0gdGhpcy5wYXJhbXMuc3VtbWFyeUFsbERvbmVcbiAgICAgICAgICAucmVwbGFjZSgnQGNhcmRzJywgdGhpcy5jYXJkUG9vbFNpemUpXG4gICAgICAgICAgLnJlcGxhY2UoJ0BtYXgnLCB0aGlzLnBhcmFtcy5iZWhhdmlvdXIubWF4UHJvZmljaWVuY3kgLSAxKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5zdW1tYXJ5U2NyZWVuLnVwZGF0ZShzdW1tYXJ5KTtcbiAgICAgIHRoaXMuc3VtbWFyeVNjcmVlbi5zaG93KCk7XG4gICAgICB0aGlzLmhpZGVDYXJkcygpO1xuXG4gICAgICB0aGlzLnRyaWdnZXIoJ3Jlc2l6ZScpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBTaG93IG1haW4gY29udGVudC5cbiAgICAgKi9cbiAgICB0aGlzLnNob3dDYXJkcyA9ICgpID0+IHtcbiAgICAgIHRoaXMuJGNhcmR3cmFwcGVyU2V0LmZpbmQoJy5oNXAtZGlhbG9nY2FyZHMtY2FyZHdyYXAnKS5yZW1vdmVDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLWdvbmUnKTtcbiAgICAgIHRoaXMuJGZvb3Rlci5yZW1vdmVDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLWdvbmUnKTtcbiAgICAgIHRoaXMuY2FyZHNTaG93biA9IHRydWU7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEhpZGUgbWFpbiBjb250ZW50LlxuICAgICAqL1xuICAgIHRoaXMuaGlkZUNhcmRzID0gKCkgPT4ge1xuICAgICAgdGhpcy4kY2FyZHdyYXBwZXJTZXQuZmluZCgnLmg1cC1kaWFsb2djYXJkcy1jYXJkd3JhcCcpLmFkZENsYXNzKCdoNXAtZGlhbG9nY2FyZHMtZ29uZScpO1xuICAgICAgdGhpcy4kZm9vdGVyLmFkZENsYXNzKCdoNXAtZGlhbG9nY2FyZHMtZ29uZScpO1xuICAgICAgdGhpcy5jYXJkc1Nob3duID0gZmFsc2U7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFNob3cgbmV4dCBjYXJkLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtvYmplY3R9IFtyZXN1bHRdIE9wdGlvbmFsIHJlc3VsdCBvZiByZXBldGl0aW9uIG1vZGUuXG4gICAgICovXG4gICAgdGhpcy5uZXh0Q2FyZCA9IChyZXN1bHQpID0+IHtcbiAgICAgIGlmICh0eXBlb2YocmVzdWx0KSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgdGhpcy5yZXN1bHRzLnB1c2gocmVzdWx0KTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5jYXJkc1t0aGlzLmN1cnJlbnRDYXJkSWRdLnN0b3BBdWRpbygpO1xuXG4gICAgICAvLyBPbiBmaW5hbCBjYXJkXG4gICAgICBpZiAodGhpcy5jYXJkSWRzLmxlbmd0aCAtIHRoaXMuZ2V0Q3VycmVudFNlbGVjdGlvbkluZGV4KCkgPT09IDEpIHtcbiAgICAgICAgaWYgKHRoaXMucGFyYW1zLm1vZGUgPT09ICdyZXBldGl0aW9uJykge1xuICAgICAgICAgIHRoaXMuJHByb2dyZXNzLnRleHQodGhpcy5wYXJhbXMuY2FyZHNMZWZ0LnJlcGxhY2UoJ0BudW1iZXInLCAwKSk7XG4gICAgICAgICAgdGhpcy5jYXJkc1t0aGlzLmN1cnJlbnRDYXJkSWRdLnNob3dTdW1tYXJ5QnV0dG9uKHRoaXMuc2hvd1N1bW1hcnkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdGhpcy5nb3RvQ2FyZCh0aGlzLmdldEN1cnJlbnRTZWxlY3Rpb25JbmRleCgpICsgMSk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEdldCBjYXJkIGZyb20gY2FyZCBtYW5hZ2VyLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBpZCBDYXJkJ3MgSWQuXG4gICAgICogQHJldHVybiB7b2JqZWN0fSBDYXJkLlxuICAgICAqL1xuICAgIHRoaXMuZ2V0Q2FyZCA9IChpZCkgPT4ge1xuICAgICAgY29uc3QgY2FyZCA9IHRoaXMuY2FyZE1hbmFnZXIuZ2V0Q2FyZChpZCk7XG4gICAgICBjYXJkLmNyZWF0ZUJ1dHRvbkxpc3RlbmVycygpO1xuXG4gICAgICByZXR1cm4gY2FyZDtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogRmluZCB0aGUgcG9zaXRpb24gb2YgYSBsb2FkZWQgY2FyZC5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gY2FyZElkIENhcmRJZCB0byBsb29rIGZvci5cbiAgICAgKiBAcmV0dXJuIHtudW1iZXJ9IFBvc2l0aW9uIG9yIHVuZGVmaW5lZC5cbiAgICAgKi9cbiAgICB0aGlzLmZpbmRDYXJkUG9zaXRpb24gPSAoY2FyZElkKSA9PiB7XG4gICAgICBsZXQgcG9zaXRpb247XG5cbiAgICAgIHRoaXMuY2FyZHMuZm9yRWFjaCgoY2FyZCwgaW5kZXgpID0+IHtcbiAgICAgICAgaWYgKCFwb3NpdGlvbiAmJiBjYXJkLmlkID09PSBjYXJkSWQpIHtcbiAgICAgICAgICBwb3NpdGlvbiA9IGluZGV4O1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIHBvc2l0aW9uO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBJbnNlcnQgYSBjYXJkIGludG8gdGhlIERPTS5cbiAgICAgKiBAcGFyYW0ge0NhcmR9IGNhcmQgQ2FyZCB0byBpbnNlcnQuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IFtpbmRleF0gUG9zaXRpb24gdG8gaW5zZXJ0IGNhcmQgYXQuXG4gICAgICovXG4gICAgdGhpcy5pbnNlcnRDYXJkVG9ET00gPSAoY2FyZCwgaW5kZXgpID0+IHtcbiAgICAgIGNvbnN0ICRub2RlID0gY2FyZC5nZXRET00oKTtcblxuICAgICAgLy8gUHV0IGF0IGFwcHJvcHJpYXRlIHBvc2l0aW9uLlxuICAgICAgaWYgKGluZGV4ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgJG5vZGUuYXBwZW5kVG8odGhpcy4kY2FyZHdyYXBwZXJTZXQpO1xuICAgICAgfVxuICAgICAgZWxzZSBpZiAoaW5kZXggPT09IDApIHtcbiAgICAgICAgdGhpcy4kY2FyZHdyYXBwZXJTZXQucHJlcGVuZCgkbm9kZSk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgdGhpcy4kY2FyZHdyYXBwZXJTZXQuY2hpbGRyZW4oKS5lcShpbmRleCkuYWZ0ZXIoJG5vZGUpO1xuICAgICAgfVxuXG4gICAgICAvLyBBZGQgaGludHNcbiAgICAgIGNhcmQuYWRkVGlwVG9DYXJkKCRub2RlLmZpbmQoJy5oNXAtZGlhbG9nY2FyZHMtY2FyZC1jb250ZW50JyksICdmcm9udCcsIGluZGV4KTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogR28gdG8gYSBzcGVjaWZpYyBjYXJkIGluIHRoZSBzZWxlY3Rpb24uIENhcmRzIG1heSBuZWVkIHRvIGJlIGxvYWRlZC5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gdGFyZ2V0UG9zaXRpb24gVGFyZ2V0IGNhcmQgcG9zaXRpb24uXG4gICAgICovXG4gICAgdGhpcy5nb3RvQ2FyZCA9ICh0YXJnZXRQb3NpdGlvbikgPT4ge1xuICAgICAgaWYgKHRhcmdldFBvc2l0aW9uIDwgMCB8fCB0YXJnZXRQb3NpdGlvbiA+PSB0aGlzLmNhcmRJZHMubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgLy8gU3RvcCBhY3Rpb24gb24gY3VycmVudCBjYXJkXG4gICAgICBjb25zdCBjdXJyZW50Q2FyZCA9IHRoaXMuY2FyZHNbdGhpcy5jdXJyZW50Q2FyZElkXTtcbiAgICAgIGN1cnJlbnRDYXJkLnN0b3BBdWRpbygpO1xuICAgICAgY3VycmVudENhcmQuZ2V0RE9NKCkucmVtb3ZlQ2xhc3MoJ2g1cC1kaWFsb2djYXJkcy1jdXJyZW50Jyk7XG5cbiAgICAgIC8vIEdldCBjYXJkIHBvc2l0aW9ucyB0byBjaGVjayBmb3IgYmVpbmcgbG9hZGVkXG4gICAgICBjb25zdCBjaGVja0xvYWRlZCA9IFtdO1xuICAgICAgaWYgKHRhcmdldFBvc2l0aW9uID4gMCkge1xuICAgICAgICBjaGVja0xvYWRlZC5wdXNoKHRhcmdldFBvc2l0aW9uIC0gMSk7XG4gICAgICB9XG4gICAgICBjaGVja0xvYWRlZC5wdXNoKHRhcmdldFBvc2l0aW9uKTtcbiAgICAgIGlmICh0YXJnZXRQb3NpdGlvbiArIDEgPCB0aGlzLmNhcmRJZHMubGVuZ3RoKSB7XG4gICAgICAgIGNoZWNrTG9hZGVkLnB1c2godGFyZ2V0UG9zaXRpb24gKyAxKTtcbiAgICAgIH1cblxuICAgICAgLy8gTG9hZCBhbmQgaW5zZXJ0IHRhcmdldCBjYXJkLCBwcmVkZWNlc3NvciBhbmQgc3VjY2Vzc29yIGlmIHJlcXVpcmVkLlxuICAgICAgY2hlY2tMb2FkZWQuZm9yRWFjaChwb3NpdGlvbiA9PiB7XG4gICAgICAgIGNvbnN0IGxvYWRlZFBvc2l0aW9uID0gdGhpcy5maW5kQ2FyZFBvc2l0aW9uKHRoaXMuY2FyZElkc1twb3NpdGlvbl0pO1xuICAgICAgICBpZiAobG9hZGVkUG9zaXRpb24gPT09IHVuZGVmaW5lZCkge1xuXG4gICAgICAgICAgLy8gQ2FyZCBoYXMgbm90IGJlZW4gbG9hZGVkLiBMb2FkIG5vdy5cbiAgICAgICAgICBjb25zdCBjYXJkID0gdGhpcy5nZXRDYXJkKHRoaXMuY2FyZElkc1twb3NpdGlvbl0pO1xuICAgICAgICAgIGNhcmQuc2V0UHJvZ3Jlc3NUZXh0KHBvc2l0aW9uICsgMSwgdGhpcy5jYXJkSWRzLmxlbmd0aCk7XG5cbiAgICAgICAgICAvKlxuICAgICAgICAgICAqIFRyeSB0byBmaW5kIHN1Y2Nlc3NvciBjYXJkIGluIGxvYWRlZCBwaWxlIGFuZCBpbnNlcnQgYmVmb3JlXG4gICAgICAgICAgICogb3IgcHV0IHRvIHRoZSBlbmQgb2YgdGhlIGxvYWRlZCBwaWxlLlxuICAgICAgICAgICAqL1xuICAgICAgICAgIGNvbnN0IHN1Y2Nlc3NvcklkID0gTWF0aC5taW4ocG9zaXRpb24gKyAxLCB0aGlzLmNhcmRJZHMubGVuZ3RoIC0gMSk7XG4gICAgICAgICAgY29uc3Qgc3VjY2Vzc29yID0gdGhpcy5maW5kQ2FyZFBvc2l0aW9uKHRoaXMuY2FyZElkc1tzdWNjZXNzb3JJZF0pO1xuICAgICAgICAgIGNvbnN0IGluc2VydFBvc2l0aW9uID0gc3VjY2Vzc29yIHx8IHRoaXMuY2FyZHMubGVuZ3RoO1xuXG4gICAgICAgICAgdGhpcy5jYXJkcy5zcGxpY2UoaW5zZXJ0UG9zaXRpb24sIDAsIGNhcmQpO1xuICAgICAgICAgIHRoaXMuaW5zZXJ0Q2FyZFRvRE9NKGNhcmQsIGluc2VydFBvc2l0aW9uKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMucmVzaXplKCk7XG5cbiAgICAgIC8vIFJldHJpZXZlIHBvc2l0aW9uIG9mIGlkIG5vdyBpbiAqbG9hZGVkIGNhcmRzKlxuICAgICAgdGFyZ2V0UG9zaXRpb24gPSB0aGlzLmZpbmRDYXJkUG9zaXRpb24odGhpcy5jYXJkSWRzW3RhcmdldFBvc2l0aW9uXSk7XG5cbiAgICAgIC8vIFNldCBjbGFzc2VzIGZvciBjYXJkIG9yZGVyL2Rpc3BsYXlcbiAgICAgIHRoaXMuY2FyZHMuZm9yRWFjaCgoY2FyZCwgaW5kZXgpID0+IHtcbiAgICAgICAgaWYgKGluZGV4IDwgdGFyZ2V0UG9zaXRpb24pIHtcbiAgICAgICAgICBjYXJkLmdldERPTSgpLmFkZENsYXNzKCdoNXAtZGlhbG9nY2FyZHMtcHJldmlvdXMnKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICBjYXJkLmdldERPTSgpLnJlbW92ZUNsYXNzKCdoNXAtZGlhbG9nY2FyZHMtcHJldmlvdXMnKTtcblxuICAgICAgICAgIGlmIChpbmRleCA9PT0gdGFyZ2V0UG9zaXRpb24pIHtcbiAgICAgICAgICAgIGNhcmQuZ2V0RE9NKCkuYWRkQ2xhc3MoJ2g1cC1kaWFsb2djYXJkcy1jdXJyZW50Jyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgdGhpcy5jdXJyZW50Q2FyZElkID0gdGFyZ2V0UG9zaXRpb247XG4gICAgICB0aGlzLnVwZGF0ZU5hdmlnYXRpb24oKTtcbiAgICAgIHRoaXMuY2FyZHNbdGhpcy5jdXJyZW50Q2FyZElkXS5zZXRDYXJkRm9jdXMoKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogU2hvdyBwcmV2aW91cyBjYXJkLlxuICAgICAqL1xuICAgIHRoaXMucHJldkNhcmQgPSAoKSA9PiB7XG4gICAgICB0aGlzLmdvdG9DYXJkKHRoaXMuZ2V0Q3VycmVudFNlbGVjdGlvbkluZGV4KCkgLSAxKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogU2hvdyBhbGwgYXVkaW8gYnV0dG9uc1xuICAgICAqL1xuICAgIHRoaXMuc2hvd0FsbEF1ZGlvID0gKCkgPT4ge1xuICAgICAgdGhpcy4kY2FyZHdyYXBwZXJTZXQuZmluZCgnLmg1cC1hdWRpby1pbm5lcicpXG4gICAgICAgIC5yZW1vdmVDbGFzcygnaGlkZScpO1xuICAgIH07XG5cbiAgICB0aGlzLnJlc3RhcnRSZXBldGl0aW9uID0gKCkgPT4ge1xuICAgICAgdGhpcy5jYXJkTWFuYWdlci5yZXNldCgpO1xuICAgICAgdGhpcy5yb3VuZCA9IDA7XG5cbiAgICAgIHRoaXMubmV4dFJvdW5kKCk7XG4gICAgfTtcblxuICAgIHRoaXMubmV4dFJvdW5kID0gKCkgPT4ge1xuICAgICAgdGhpcy5yb3VuZCsrO1xuICAgICAgdGhpcy5zdW1tYXJ5U2NyZWVuLmhpZGUoKTtcbiAgICAgIHRoaXMuc2hvd0NhcmRzKCk7XG5cbiAgICAgIHRoaXMucmVzZXQoKTtcbiAgICAgIHRoaXMuY3JlYXRlRE9NKCk7XG5cbiAgICAgIHRoaXMudXBkYXRlTmF2aWdhdGlvbigpO1xuICAgICAgdGhpcy5jYXJkc1t0aGlzLmN1cnJlbnRDYXJkSWRdLnNldENhcmRGb2N1cyh0cnVlKTtcblxuICAgICAgdGhpcy50cmlnZ2VyKCdyZXNpemUnKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogUmVzZXQgdGhlIHRhc2sgc28gdGhhdCB0aGUgdXNlciBjYW4gZG8gaXQgYWdhaW4uXG4gICAgICovXG4gICAgdGhpcy5yZXNldCA9ICgpID0+IHtcbiAgICAgIHRoaXMucmVzdWx0cyA9IFtdO1xuICAgICAgdGhpcy5jYXJkc1t0aGlzLmN1cnJlbnRDYXJkSWRdLnN0b3BBdWRpbyh0aGlzLiRjdXJyZW50LmluZGV4KCkpO1xuXG4gICAgICAvLyBUdXJuIGFsbCBjYXJkcyB0byBmcm9udFxuICAgICAgdGhpcy5jYXJkcy5mb3JFYWNoKGNhcmQgPT4ge1xuICAgICAgICBjYXJkLnJlc2V0KCk7XG4gICAgICB9KTtcblxuICAgICAgLy8gU2hvdyBmaXJzdCBjYXJkXG4gICAgICB0aGlzLmN1cnJlbnRDYXJkSWQgPSAwO1xuICAgICAgaWYgKHRoaXMucGFyYW1zLm1vZGUgPT09ICdub3JtYWwnKSB7XG4gICAgICAgIHRoaXMuY2FyZHNbdGhpcy5jdXJyZW50Q2FyZElkXS5nZXRET00oKS5hZGRDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLWN1cnJlbnQnKTtcbiAgICAgIH1cbiAgICAgIHRoaXMudXBkYXRlTmF2aWdhdGlvbigpO1xuXG4gICAgICBpZiAodGhpcy4kcmV0cnkpIHtcbiAgICAgICAgdGhpcy4kcmV0cnkuYWRkQ2xhc3MoJ2g1cC1kaWFsb2djYXJkcy1kaXNhYmxlZCcpO1xuICAgICAgfVxuICAgICAgdGhpcy5zaG93QWxsQXVkaW8oKTtcblxuICAgICAgdGhpcy5jYXJkc1t0aGlzLmN1cnJlbnRDYXJkSWRdLnJlc2l6ZU92ZXJmbG93aW5nVGV4dCgpO1xuICAgICAgdGhpcy5jYXJkc1t0aGlzLmN1cnJlbnRDYXJkSWRdLnNldENhcmRGb2N1cygpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBVcGRhdGUgdGhlIGRpbWVuc2lvbnMgb2YgdGhlIHRhc2sgd2hlbiByZXNpemluZyB0aGUgdGFzay5cbiAgICAgKi9cbiAgICB0aGlzLnJlc2l6ZSA9ICgpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKCdESUFMT0dDQVJEUzogcmVzaXplJyk7XG4gICAgICBjb25zb2xlLmxvZygnRElBTE9HQ0FSRFMgKCRjYXJkV3JhcHBlclNldCknLCB0aGlzLiRjYXJkd3JhcHBlclNldCwgdGhpcy4kY2FyZHdyYXBwZXJTZXQub3V0ZXJIZWlnaHQoKSk7XG4gICAgICBjb25zb2xlLmxvZygnRElBTE9HQ0FSRFMgKGNvbnRhaW5lciknLCB0aGlzLiRpbm5lciwgdGhpcy4kaW5uZXIub3V0ZXJIZWlnaHQoKSk7XG5cbiAgICAgIHRoaXMuaGFuZGxlT3JpZW50YXRpb25DaGFuZ2UoKTtcblxuICAgICAgbGV0IGRpc3BsYXlMaW1pdHMgPSBudWxsO1xuXG4gICAgICBjb25zdCB0aXRsZUhlaWdodCA9IHRoaXMuJGlubmVyLmZpbmQoJy5oNXAtZGlhbG9nY2FyZHMtdGl0bGUnKS5vdXRlckhlaWdodCgpIHx8IDA7XG4gICAgICBjb25zdCBkZXNjcmlwdGlvbkhlaWdodCA9IHRoaXMuJGlubmVyLmZpbmQoJy5oNXAtZGlhbG9nY2FyZHMtZGVzY3JpcHRpb24nKS5vdXRlckhlaWdodCh0cnVlKSB8fCAwO1xuICAgICAgY29uc3QgZm9vdGVySGVpZ2h0ID0gdGhpcy4kZm9vdGVyLm91dGVySGVpZ2h0KCkgfHwgMDtcblxuICAgICAgY29uc3Qgbm9uQ2FyZEhlaWdodCA9IHRpdGxlSGVpZ2h0ICsgZGVzY3JpcHRpb25IZWlnaHQgKyBmb290ZXJIZWlnaHQ7XG5cbiAgICAgIGNvbnN0IGlzTW9iaWxlTGFuZHNjYXBlID0gdGhpcy5pc01vYmlsZUxhbmRzY2FwZSgpO1xuXG4gICAgICBpZiAocGFyc2VJbnQodGhpcy4kY2FyZHdyYXBwZXJTZXQuY3NzKCdoZWlnaHQnKSkgPT09IDApIHtcbiAgICAgICAgY29uc29sZS5sb2coJ0RJQUxPR0NBUkRTICh0aXRsZUhlaWdodCwgZGVzY3JpcHRpb25IZWlnaHQsIGZvb3RlckhlaWdodCwgbm9uQ2FyZEhlaWdodCwgaXNNb2JpbGVMYW5kc2NhcGUpJywgdGl0bGVIZWlnaHQsIGRlc2NyaXB0aW9uSGVpZ2h0LCBmb290ZXJIZWlnaHQsIG5vbkNhcmRIZWlnaHQsIGlzTW9iaWxlTGFuZHNjYXBlKTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2hhbmdlIGxhbmRzY2FwZSBsYXlvdXQgb24gbW9iaWxlXG4gICAgICBpZiAoXG4gICAgICAgIHR5cGVvZiB3aW5kb3cub3JpZW50YXRpb24gPT09ICdudW1iZXInICYmXG4gICAgICAgIHRoaXMuJGNhcmR3cmFwcGVyU2V0LmZpbmQoJy5oNXAtZGlhbG9nY2FyZHMtc3VtbWFyeS1zY3JlZW4nKS5oYXNDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLWdvbmUnKSAmJlxuICAgICAgICB0aGlzLnBhcmFtcy5iZWhhdmlvdXIuc2NhbGVUZXh0Tm90Q2FyZFxuICAgICAgKSB7XG4gICAgICAgIHRoaXMuJGlubmVyLnRvZ2dsZUNsYXNzKCdoNXAtbGFuZHNjYXBlJywgaXNNb2JpbGVMYW5kc2NhcGUpO1xuXG4gICAgICAgIGlmIChpc01vYmlsZUxhbmRzY2FwZSkge1xuICAgICAgICAgIGRpc3BsYXlMaW1pdHMgPSAodGhpcy5pc1Jvb3QoKSkgPyB0aGlzLmNvbXB1dGVEaXNwbGF5TGltaXRzS0xMKCkgOiBudWxsO1xuXG4gICAgICAgICAgY29uc3Qgc2NyZWVuSGVpZ2h0ID0gKHRoaXMuaXNJT1MoKSAmJiBpc01vYmlsZUxhbmRzY2FwZSkgP1xuICAgICAgICAgICAgc2NyZWVuLndpZHRoIDpcbiAgICAgICAgICAgIHNjcmVlbi5oZWlnaHQ7XG5cbiAgICAgICAgICBpZiAoZGlzcGxheUxpbWl0cz8uaGVpZ2h0ID09PSAxKSB7XG4gICAgICAgICAgICBkaXNwbGF5TGltaXRzLmhlaWdodCA9IHNjcmVlbkhlaWdodDtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAoZGlzcGxheUxpbWl0cz8uaGVpZ2h0KSB7XG4gICAgICAgICAgICB0aGlzLiRjYXJkd3JhcHBlclNldC5jc3MoJ21heC1oZWlnaHQnLCBgJHtkaXNwbGF5TGltaXRzLmhlaWdodCAtIG5vbkNhcmRIZWlnaHR9cHhgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLiRjYXJkd3JhcHBlclNldC5jc3MoJ21heC1oZWlnaHQnLCAnJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgdGhpcy4kY2FyZHdyYXBwZXJTZXQuY3NzKCdtYXgtaGVpZ2h0JywgJycpO1xuICAgICAgfVxuXG4gICAgICBsZXQgbWF4SGVpZ2h0ID0gMDtcblxuICAgICAgaWYgKCFkaXNwbGF5TGltaXRzIHx8ICFpc01vYmlsZUxhbmRzY2FwZSB8fCAhdGhpcy5wYXJhbXMuYmVoYXZpb3VyLnNjYWxlVGV4dE5vdENhcmQpIHtcbiAgICAgICAgdGhpcy51cGRhdGVJbWFnZVNpemUoKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICB0aGlzLmNhcmRzLmZvckVhY2goY2FyZCA9PiB7XG4gICAgICAgICAgY2FyZC5zZXRJbWFnZUhlaWdodCgnJyk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBpZiAoIXRoaXMucGFyYW1zLmJlaGF2aW91ci5zY2FsZVRleHROb3RDYXJkICYmIHRoaXMuY2FyZHNTaG93biAhPT0gZmFsc2UpIHtcbiAgICAgICAgdGhpcy5kZXRlcm1pbmVDYXJkU2l6ZXMoKTtcbiAgICAgIH1cblxuICAgICAgaWYgKCF0aGlzLnBhcmFtcy5iZWhhdmlvdXIuc2NhbGVUZXh0Tm90Q2FyZCB8fCAhaXNNb2JpbGVMYW5kc2NhcGUgfHwgIWRpc3BsYXlMaW1pdHM/LmhlaWdodCB8fCAhdGhpcy4kY2FyZHdyYXBwZXJTZXQuZmluZCgnLmg1cC1kaWFsb2djYXJkcy1zdW1tYXJ5LXNjcmVlbicpLmhhc0NsYXNzKCdoNXAtZGlhbG9nY2FyZHMtZ29uZScpKSB7XG4gICAgICAgIC8vIFJlc2V0IGNhcmQtd3JhcHBlci1zZXQgaGVpZ2h0XG4gICAgICAgIHRoaXMuJGNhcmR3cmFwcGVyU2V0LmNzcygnaGVpZ2h0JywgJ2F1dG8nKTtcblxuICAgICAgICAvLyBGaW5kIG1heCByZXF1aXJlZCBoZWlnaHQgZm9yIGFsbCBjYXJkc1xuICAgICAgICB0aGlzLiRjYXJkd3JhcHBlclNldC5jaGlsZHJlbignOm5vdCguaDVwLWRpYWxvZ2NhcmRzLWdvbmUpJykuZWFjaCggZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGNvbnN0IHdyYXBwZXJIZWlnaHQgPSAkKHRoaXMpLmNzcygnaGVpZ2h0JywgJycpLm91dGVySGVpZ2h0KCk7XG5cbiAgICAgICAgICBjb25zdCBjb21wdXRlZEhlaWdodCA9IHBhcnNlRmxvYXQoJCh0aGlzKS5maW5kKCcuaDVwLWRpYWxvZ2NhcmRzLWNhcmQtY29udGVudCcpLmNzcygncGFkZGluZy10b3AnKSkgK1xuICAgICAgICAgICAgcGFyc2VGbG9hdCgkKHRoaXMpLmZpbmQoJy5oNXAtZGlhbG9nY2FyZHMtY2FyZC1jb250ZW50JykuY3NzKCdwYWRkaW5nLWJvdHRvbScpKSArXG4gICAgICAgICAgICAkKHRoaXMpLmZpbmQoJy5oNXAtZGlhbG9nY2FyZHMtaW1hZ2Utd3JhcHBlcicpLm91dGVySGVpZ2h0KCkgK1xuICAgICAgICAgICAgJCh0aGlzKS5maW5kKCcuaDVwLWRpYWxvZ2NhcmRzLWNhcmQtdGV4dC13cmFwcGVyJykub3V0ZXJIZWlnaHQoKTtcblxuICAgICAgICAgIGNvbnNvbGUubG9nKHdyYXBwZXJIZWlnaHQsICd2cycsIGNvbXB1dGVkSGVpZ2h0KTtcblxuICAgICAgICAgICQodGhpcykuY3NzKCdoZWlnaHQnLCAnaW5oZXJpdCcpO1xuICAgICAgICAgIG1heEhlaWdodCA9IE1hdGgubWF4KHdyYXBwZXJIZWlnaHQsIG1heEhlaWdodCk7XG5cbiAgICAgICAgICAvLyBDaGVjayBoZWlnaHRcbiAgICAgICAgICBpZiAoISQodGhpcykubmV4dCgnLmg1cC1kaWFsb2djYXJkcy1jYXJkd3JhcCcpLmxlbmd0aCkge1xuICAgICAgICAgICAgY29uc3QgaW5pdGlhbEhlaWdodCA9ICQodGhpcykuZmluZCgnLmg1cC1kaWFsb2djYXJkcy1jYXJkaG9sZGVyJykuY3NzKCdoZWlnaHQnLCAnaW5pdGlhbCcpLm91dGVySGVpZ2h0KCk7XG4gICAgICAgICAgICBtYXhIZWlnaHQgPSBNYXRoLm1heChpbml0aWFsSGVpZ2h0LCBtYXhIZWlnaHQpO1xuICAgICAgICAgICAgJCh0aGlzKS5maW5kKCcuaDVwLWRpYWxvZ2NhcmRzLWNhcmRob2xkZXInKS5jc3MoJ2hlaWdodCcsICdpbmhlcml0Jyk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCByZWxhdGl2ZU1heEhlaWdodCA9IG1heEhlaWdodCAvIHBhcnNlRmxvYXQodGhpcy4kY2FyZHdyYXBwZXJTZXQuY3NzKCdmb250LXNpemUnKSk7XG4gICAgICAgIGNvbnNvbGUubG9nKCdESUFMT0dDQVJEUyAocmVsYXRpdmVNYXhIZWlnaHQpJywgcmVsYXRpdmVNYXhIZWlnaHQgKyAnZW0nKTtcbiAgICAgICAgdGhpcy4kY2FyZHdyYXBwZXJTZXQuY3NzKCdoZWlnaHQnLCByZWxhdGl2ZU1heEhlaWdodCArICdlbScpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIGlmIChkaXNwbGF5TGltaXRzPy5oZWlnaHQgLSBub25DYXJkSGVpZ2h0ID4gMSkge1xuICAgICAgICAgIHRoaXMuJGNhcmR3cmFwcGVyU2V0LmNzcygnaGVpZ2h0JywgYCR7ZGlzcGxheUxpbWl0cz8uaGVpZ2h0IC0gbm9uQ2FyZEhlaWdodH1weGApO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHRoaXMuc2NhbGVUb0ZpdEhlaWdodCgpO1xuICAgICAgdGhpcy50cnVuY2F0ZVJldHJ5QnV0dG9uKCk7XG5cbiAgICAgIHRoaXMuY2FyZHNbdGhpcy5jdXJyZW50Q2FyZElkXS5yZXNpemVPdmVyZmxvd2luZ1RleHQoKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogUmVzaXplcyBlYWNoIGNhcmQgdG8gZml0IGl0cyB0ZXh0XG4gICAgICovXG4gICAgdGhpcy5kZXRlcm1pbmVDYXJkU2l6ZXMgPSAoKSA9PiB7XG4gICAgICBjb25zdCBzZWxmID0gdGhpcztcblxuICAgICAgaWYgKHRoaXMuY2FyZFNpemVEZXRlcm1pbmVkID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgLy8gS2VlcCB0cmFjayBvZiB3aGljaCBjYXJkcyB3ZSd2ZSBhbHJlYWR5IGRldGVybWluZWQgc2l6ZSBmb3JcbiAgICAgICAgdGhpcy5jYXJkU2l6ZURldGVybWluZWQgPSBbXTtcbiAgICAgIH1cblxuICAgICAgLy8gR28gdGhyb3VnaCBlYWNoIGNhcmRcbiAgICAgIHRoaXMuJGNhcmR3cmFwcGVyU2V0LmNoaWxkcmVuKCc6dmlzaWJsZScpLmVhY2goZnVuY3Rpb24gKGkpIHtcbiAgICAgICAgY29uc3QgY2FyZElkID0gc2VsZi5jYXJkc1tpXS5pZDtcblxuICAgICAgICBpZiAoc2VsZi5jYXJkU2l6ZURldGVybWluZWQuaW5kZXhPZihjYXJkSWQpICE9PSAtMSkge1xuICAgICAgICAgIHJldHVybjsgLy8gQWxyZWFkeSBkZXRlcm1pbmVkLCBubyBuZWVkIHRvIGRldGVybWluZSBhZ2Fpbi5cbiAgICAgICAgfVxuICAgICAgICBzZWxmLmNhcmRTaXplRGV0ZXJtaW5lZC5wdXNoKGNhcmRJZCk7XG5cbiAgICAgICAgLy8gSGVyZSBcInRoaXNcIiByZWZlcmVuY2VzIHRoZSBqUXVlcnkgb2JqZWN0XG4gICAgICAgIGNvbnN0ICRjb250ZW50ID0gJCgnLmg1cC1kaWFsb2djYXJkcy1jYXJkLWNvbnRlbnQnLCB0aGlzKTtcbiAgICAgICAgY29uc3QgJHRleHQgPSAkKCcuaDVwLWRpYWxvZ2NhcmRzLWNhcmQtdGV4dC1pbm5lci1jb250ZW50JywgJGNvbnRlbnQpO1xuXG4gICAgICAgIC8vIEdyYWIgc2l6ZSB3aXRoIHRleHRcbiAgICAgICAgY29uc3QgdGV4dEhlaWdodCA9ICR0ZXh0WzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmhlaWdodDtcblxuICAgICAgICAvLyBDaGFuZ2UgdG8gYW5zd2VyXG4gICAgICAgIGNvbnN0IGN1cnJlbnRDYXJkID0gc2VsZi5jYXJkc1tpXTtcbiAgICAgICAgY3VycmVudENhcmQuY2hhbmdlVGV4dChjdXJyZW50Q2FyZC5nZXRBbnN3ZXIoKSk7XG5cbiAgICAgICAgLy8gR3JhYiBzaXplIHdpdGggYW5zd2VyXG4gICAgICAgIGNvbnN0IGFuc3dlckhlaWdodCA9ICR0ZXh0WzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmhlaWdodDtcblxuICAgICAgICAvLyBVc2UgaGlnaGVzdFxuICAgICAgICBsZXQgdXNlSGVpZ2h0ID0gKHRleHRIZWlnaHQgPiBhbnN3ZXJIZWlnaHQgPyB0ZXh0SGVpZ2h0IDogYW5zd2VySGVpZ2h0KTtcblxuICAgICAgICAvLyBNaW4uIGxpbWl0XG4gICAgICAgIGNvbnN0IG1pbkhlaWdodCA9IHBhcnNlRmxvYXQoJHRleHQucGFyZW50KCkucGFyZW50KCkuY3NzKCdtaW5IZWlnaHQnKSk7XG4gICAgICAgIGlmICh1c2VIZWlnaHQgPCBtaW5IZWlnaHQpIHtcbiAgICAgICAgICB1c2VIZWlnaHQgPSAgbWluSGVpZ2h0O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gTm9uZSBvZiB0aGUgY2FyZHMgaGFzIHRleHQsIHNocmluayB0ZXh0IGFyZWEsIGxlYXZlIHNwYWNlIGZvciBhdWRpb1xuICAgICAgICBpZiAoc2VsZi5oYXNOb1RleHRzKSB7XG4gICAgICAgICAgY29uc3QgJGNhcmRUZXh0ID0gJHRleHQuZmluZCgnLmg1cC1kaWFsb2djYXJkcy1jYXJkLXRleHQnKTtcbiAgICAgICAgICB1c2VIZWlnaHQgPSBzZWxmLmhhc05vQXVkaW9zID8gMCA6IHVzZUhlaWdodCAtIHBhcnNlRmxvYXQoJGNhcmRUZXh0LmNzcygnaGVpZ2h0JykpO1xuICAgICAgICAgICRjYXJkVGV4dC5jc3MoJ2hlaWdodCcsIDApO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ29udmVydCB0byBlbVxuICAgICAgICBjb25zdCBmb250U2l6ZSA9IHBhcnNlRmxvYXQoJGNvbnRlbnQuY3NzKCdmb250U2l6ZScpKTtcbiAgICAgICAgdXNlSGVpZ2h0IC89IGZvbnRTaXplO1xuXG4gICAgICAgIC8vIFNldCBoZWlnaHRcbiAgICAgICAgJHRleHQucGFyZW50KCkuY3NzKCdoZWlnaHQnLCB1c2VIZWlnaHQgKyAnZW0nKTtcblxuICAgICAgICAvLyBDaGFuZ2UgYmFjayB0byB0ZXh0XG4gICAgICAgIGN1cnJlbnRDYXJkLmNoYW5nZVRleHQoY3VycmVudENhcmQuZ2V0VGV4dCgpKTtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBTY2FsZXMgdGhlIGNhcmQgY29udGVudHMuXG4gICAgICovXG4gICAgdGhpcy5zY2FsZVRvRml0SGVpZ2h0ID0gKCkgPT4ge1xuICAgICAgaWYgKCF0aGlzLiRjYXJkd3JhcHBlclNldCB8fCAhdGhpcy4kY2FyZHdyYXBwZXJTZXQuaXMoJzp2aXNpYmxlJykgfHwgIXRoaXMucGFyYW1zLmJlaGF2aW91ci5zY2FsZVRleHROb3RDYXJkKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgLy8gUmVzaXplIGZvbnQgc2l6ZSB0byBmaXQgaW5zaWRlIENQXG4gICAgICBpZiAodGhpcy4kaW5uZXIucGFyZW50cygnLmg1cC1jb3Vyc2UtcHJlc2VudGF0aW9uJykubGVuZ3RoKSB7XG4gICAgICAgIGxldCAkcGFyZW50Q29udGFpbmVyID0gdGhpcy4kaW5uZXIucGFyZW50KCk7XG4gICAgICAgIGlmICh0aGlzLiRpbm5lci5wYXJlbnRzKCcuaDVwLXBvcHVwLWNvbnRhaW5lcicpLmxlbmd0aCkge1xuICAgICAgICAgICRwYXJlbnRDb250YWluZXIgPSB0aGlzLiRpbm5lci5wYXJlbnRzKCcuaDVwLXBvcHVwLWNvbnRhaW5lcicpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNvbnRhaW5lckhlaWdodCA9ICRwYXJlbnRDb250YWluZXIuZ2V0KDApLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmhlaWdodDtcbiAgICAgICAgY29uc3QgZ2V0Q29udGVudEhlaWdodCA9ICgpID0+IHtcbiAgICAgICAgICBsZXQgY29udGVudEhlaWdodCA9IDA7XG4gICAgICAgICAgdGhpcy4kaW5uZXIuY2hpbGRyZW4oKS5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vIEhlcmUgXCJ0aGlzXCIgcmVmZXJlbmNlcyB0aGUgalF1ZXJ5IG9iamVjdFxuICAgICAgICAgICAgY29uc3QgJGNoaWxkID0gJCh0aGlzKTtcbiAgICAgICAgICAgIGNvbnRlbnRIZWlnaHQgKz0gdGhpcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5oZWlnaHQgK1xuICAgICAgICAgICAgcGFyc2VGbG9hdCgkY2hpbGQuY3NzKCdtYXJnaW4tdG9wJykpICsgcGFyc2VGbG9hdCgkY2hpbGQuY3NzKCdtYXJnaW4tYm90dG9tJykpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybiBjb250ZW50SGVpZ2h0O1xuICAgICAgICB9O1xuICAgICAgICBsZXQgY29udGVudEhlaWdodCA9IGdldENvbnRlbnRIZWlnaHQoKTtcbiAgICAgICAgY29uc3QgcGFyZW50Rm9udFNpemUgPSBwYXJzZUZsb2F0KHRoaXMuJGlubmVyLnBhcmVudCgpLmNzcygnZm9udC1zaXplJykpO1xuICAgICAgICBsZXQgbmV3Rm9udFNpemUgPSBwYXJzZUZsb2F0KHRoaXMuJGlubmVyLmNzcygnZm9udC1zaXplJykpO1xuXG4gICAgICAgIC8vIERlY3JlYXNlIGZvbnQgc2l6ZVxuICAgICAgICBpZiAoY29udGFpbmVySGVpZ2h0IDwgY29udGVudEhlaWdodCkge1xuICAgICAgICAgIHdoaWxlIChjb250YWluZXJIZWlnaHQgPCBjb250ZW50SGVpZ2h0KSB7XG4gICAgICAgICAgICBuZXdGb250U2l6ZSAtPSBEaWFsb2djYXJkcy5TQ0FMRUlOVEVSVkFMO1xuXG4gICAgICAgICAgICAvLyBDYXAgYXQgbWluIGZvbnQgc2l6ZVxuICAgICAgICAgICAgaWYgKG5ld0ZvbnRTaXplIDwgRGlhbG9nY2FyZHMuTUlOU0NBTEUpIHtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFNldCByZWxhdGl2ZSBmb250IHNpemUgdG8gc2NhbGUgd2l0aCBmdWxsIHNjcmVlbi5cbiAgICAgICAgICAgIHRoaXMuJGlubmVyLmNzcygnZm9udC1zaXplJywgKG5ld0ZvbnRTaXplIC8gcGFyZW50Rm9udFNpemUpICsgJ2VtJyk7XG4gICAgICAgICAgICBjb250ZW50SGVpZ2h0ID0gZ2V0Q29udGVudEhlaWdodCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHsgLy8gSW5jcmVhc2UgZm9udCBzaXplXG4gICAgICAgICAgbGV0IGluY3JlYXNlRm9udFNpemUgPSB0cnVlO1xuICAgICAgICAgIHdoaWxlIChpbmNyZWFzZUZvbnRTaXplKSB7XG4gICAgICAgICAgICBuZXdGb250U2l6ZSArPSBEaWFsb2djYXJkcy5TQ0FMRUlOVEVSVkFMO1xuXG4gICAgICAgICAgICAvLyBDYXAgbWF4IGZvbnQgc2l6ZVxuICAgICAgICAgICAgaWYgKG5ld0ZvbnRTaXplID4gRGlhbG9nY2FyZHMuTUFYU0NBTEUpIHtcbiAgICAgICAgICAgICAgaW5jcmVhc2VGb250U2l6ZSA9IGZhbHNlO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gU2V0IHJlbGF0aXZlIGZvbnQgc2l6ZSB0byBzY2FsZSB3aXRoIGZ1bGwgc2NyZWVuLlxuICAgICAgICAgICAgbGV0IHJlbGF0aXZlRm9udFNpemUgPSBuZXdGb250U2l6ZSAvIHBhcmVudEZvbnRTaXplO1xuICAgICAgICAgICAgdGhpcy4kaW5uZXIuY3NzKCdmb250LXNpemUnLCByZWxhdGl2ZUZvbnRTaXplICsgJ2VtJyk7XG4gICAgICAgICAgICBjb250ZW50SGVpZ2h0ID0gZ2V0Q29udGVudEhlaWdodCgpO1xuICAgICAgICAgICAgaWYgKGNvbnRhaW5lckhlaWdodCA8PSBjb250ZW50SGVpZ2h0KSB7XG4gICAgICAgICAgICAgIGluY3JlYXNlRm9udFNpemUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgcmVsYXRpdmVGb250U2l6ZSA9IChuZXdGb250U2l6ZSAtIERpYWxvZ2NhcmRzLlNDQUxFSU5URVJWQUwpIC8gcGFyZW50Rm9udFNpemU7XG4gICAgICAgICAgICAgIHRoaXMuJGlubmVyLmNzcygnZm9udC1zaXplJywgcmVsYXRpdmVGb250U2l6ZSArICdlbScpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZWxzZSB7IC8vIFJlc2l6ZSBtb2JpbGUgdmlld1xuICAgICAgICB0aGlzLmNhcmRzW3RoaXMuY3VycmVudENhcmRJZF0ucmVzaXplT3ZlcmZsb3dpbmdUZXh0KCk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFRydW5jYXRlIHJldHJ5IGJ1dHRvbiBpZiB3aWR0aCBpcyBzbWFsbC5cbiAgICAgKi9cbiAgICB0aGlzLnRydW5jYXRlUmV0cnlCdXR0b24gPSAoKSA9PiB7XG4gICAgICBpZiAoIXRoaXMuJHJldHJ5KSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgLy8gUmVzZXQgYnV0dG9uIHRvIGZ1bGwgc2l6ZVxuICAgICAgdGhpcy4kcmV0cnkucmVtb3ZlQ2xhc3MoJ3RydW5jYXRlZCcpO1xuICAgICAgdGhpcy4kcmV0cnkuaHRtbCh0aGlzLnBhcmFtcy5yZXRyeSk7XG5cbiAgICAgIC8vIE1lYXN1cmUgYnV0dG9uXG4gICAgICBjb25zdCBtYXhXaWR0aFBlcmNlbnRhZ2VzID0gMC4zO1xuICAgICAgY29uc3QgcmV0cnlXaWR0aCA9IHRoaXMuJHJldHJ5LmdldCgwKS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aCArXG4gICAgICAgICAgcGFyc2VGbG9hdCh0aGlzLiRyZXRyeS5jc3MoJ21hcmdpbi1sZWZ0JykpICsgcGFyc2VGbG9hdCh0aGlzLiRyZXRyeS5jc3MoJ21hcmdpbi1yaWdodCcpKTtcbiAgICAgIGNvbnN0IHJldHJ5V2lkdGhQZXJjZW50YWdlID0gcmV0cnlXaWR0aCAvIHRoaXMuJHJldHJ5LnBhcmVudCgpLmdldCgwKS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aDtcblxuICAgICAgLy8gVHJ1bmNhdGUgYnV0dG9uXG4gICAgICBpZiAocmV0cnlXaWR0aFBlcmNlbnRhZ2UgPiBtYXhXaWR0aFBlcmNlbnRhZ2VzKSB7XG4gICAgICAgIHRoaXMuJHJldHJ5LmFkZENsYXNzKCd0cnVuY2F0ZWQnKTtcbiAgICAgICAgdGhpcy4kcmV0cnkuaHRtbCgnJyk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFJldHJpZXZlIGluZGV4IG9mIGNhcmQgaW4gc2VsZWN0aW9uLCBub3QgbG9hZGVkIGNhcmRzLlxuICAgICAqL1xuICAgIHRoaXMuZ2V0Q3VycmVudFNlbGVjdGlvbkluZGV4ID0gKCkgPT4gdGhpcy5jYXJkSWRzLmluZGV4T2YodGhpcy5jYXJkc1t0aGlzLmN1cnJlbnRDYXJkSWRdLmlkKTtcblxuICAgIC8qKlxuICAgICAqIEdldCB0aGUgY29udGVudCB0eXBlIHRpdGxlLlxuICAgICAqXG4gICAgICogQHJldHVybiB7c3RyaW5nfSB0aXRsZS5cbiAgICAgKi9cbiAgICB0aGlzLmdldFRpdGxlID0gKCkgPT4ge1xuICAgICAgcmV0dXJuIEg1UC5jcmVhdGVUaXRsZSgodGhpcy5jb250ZW50RGF0YSAmJiB0aGlzLmNvbnRlbnREYXRhLm1ldGFkYXRhICYmIHRoaXMuY29udGVudERhdGEubWV0YWRhdGEudGl0bGUpID8gdGhpcy5jb250ZW50RGF0YS5tZXRhZGF0YS50aXRsZSA6ICdEaWFsb2cgQ2FyZHMnKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogU2F2ZSB0aGUgY3VycmVudCBzdGF0ZSB0byBiZSByZXN0b3JlZCBsYXRlci5cbiAgICAgKi9cbiAgICB0aGlzLmdldEN1cnJlbnRTdGF0ZSA9ICgpID0+IHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNhcmRQaWxlczogdGhpcy5jYXJkTWFuYWdlci5nZXRQaWxlcygpLFxuICAgICAgICBjYXJkSWRzOiB0aGlzLmNhcmRJZHMsXG4gICAgICAgIHJvdW5kOiB0aGlzLnJvdW5kLFxuICAgICAgICBjdXJyZW50Q2FyZElkOiB0aGlzLmdldEN1cnJlbnRTZWxlY3Rpb25JbmRleCgpLFxuICAgICAgICByZXN1bHRzOiB0aGlzLnJlc3VsdHNcbiAgICAgIH07XG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb21wdXRlIGRpc3BsYXkgbGltaXRzLlxuICAgKiBAcmV0dXJuIHtvYmplY3R8bnVsbH0gSGVpZ2h0IGFuZCB3aWR0aCBpbiBweCBvciBudWxsIGlmIGNhbm5vdCBiZSBkZXRlcm1pbmVkLlxuICAgKi9cbiAgY29tcHV0ZURpc3BsYXlMaW1pdHMoKSB7XG4gICAgbGV0IHRvcFdpbmRvdyA9IHRoaXMuZ2V0VG9wV2luZG93KCk7XG5cbiAgICAvLyBpT1MgZG9lc24ndCBjaGFuZ2Ugc2NyZWVuIGRpbWVuc2lvbnMgb24gcm90YXRpb25cbiAgICBsZXQgc2NyZWVuU2l6ZSA9ICh0aGlzLmlzSU9TKCkgJiYgdGhpcy5nZXRPcmllbnRhdGlvbigpID09PSAnbGFuZHNjYXBlJykgP1xuICAgICAgeyBoZWlnaHQ6IHNjcmVlbi53aWR0aCwgd2lkdGg6IHNjcmVlbi5oZWlnaHQgfSA6XG4gICAgICB7IGhlaWdodDogc2NyZWVuLmhlaWdodCwgd2lkdGg6IHNjcmVlbi53aWR0aCB9O1xuXG4gICAgdG9wV2luZG93ID0gdG9wV2luZG93IHx8IHtcbiAgICAgIGlubmVySGVpZ2h0OiBzY3JlZW5TaXplLmhlaWdodCxcbiAgICAgIGlubmVyV2lkdGg6IHNjcmVlblNpemUud2lkdGhcbiAgICB9O1xuXG4gICAgLy8gU21hbGxlc3QgdmFsdWUgb2Ygdmlld3BvcnQgYW5kIGNvbnRhaW5lciB3aW5zXG4gICAgcmV0dXJuIHtcbiAgICAgIGhlaWdodDogTWF0aC5taW4odG9wV2luZG93LmlubmVySGVpZ2h0LCBzY3JlZW5TaXplLmhlaWdodCksXG4gICAgICB3aWR0aDogTWF0aC5taW4odG9wV2luZG93LmlubmVyV2lkdGgsIHRoaXMuJGlubmVyLmdldCgwKS5vZmZzZXRXaWR0aClcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIENvbXB1dGUgZGlzcGxheSBsaW1pdHMgZm9yIEtpZHNMb29wIExpdmUuXG4gICAqIEByZXR1cm4ge29iamVjdHxudWxsfSBIZWlnaHQgYW5kIHdpZHRoIGluIHB4IG9yIG51bGwgaWYgY2Fubm90IGJlIGRldGVybWluZWQuXG4gICAqL1xuICBjb21wdXRlRGlzcGxheUxpbWl0c0tMTCgpIHtcbiAgICBjb25zdCBkaXNwbGF5TGltaXRzID0gdGhpcy5jb21wdXRlRGlzcGxheUxpbWl0cygpO1xuXG4gICAgLy8gVGhpcyBvbmx5IHdvcmtzIGJlY2F1c2UgS0xMIGVuZm9yY2VzIGhlaWdodCBvbiBINVAncyBpZnJhbWVcbiAgICBkaXNwbGF5TGltaXRzLmhlaWdodCA9IE1hdGgubWluKGRpc3BsYXlMaW1pdHMuaGVpZ2h0LCBkb2N1bWVudC5ib2R5Lm9mZnNldEhlaWdodCk7XG4gICAgcmV0dXJuIGRpc3BsYXlMaW1pdHM7XG4gIH1cblxuICAvKipcbiAgICogRGV0ZWN0IHdoZXRoZXIgdXNlciBpcyBydW5uaW5nIGlPUy5cbiAgICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSwgaWYgdXNlciBpcyBydW5uaW5nIGlPUy5cbiAgICovXG4gIGlzSU9TKCkge1xuICAgIHJldHVybiAoXG4gICAgICBbJ2lQYWQgU2ltdWxhdG9yJywgJ2lQaG9uZSBTaW11bGF0b3InLCAnaVBvZCBTaW11bGF0b3InLCAnaVBhZCcsICdpUGhvbmUnLCAnaVBvZCddLmluY2x1ZGVzKG5hdmlnYXRvci5wbGF0Zm9ybSkgfHxcbiAgICAgIChuYXZpZ2F0b3IudXNlckFnZW50LmluY2x1ZGVzKCdNYWMnKSAmJiAnb250b3VjaGVuZCcgaW4gZG9jdW1lbnQpXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZXRlcm1pbmUgd2hldGhlciBtb2JpbGUgZGV2aWNlIGluIGxhbmRzY2FwZSBvcmllbnRhdGlvbi5cbiAgICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSwgaWYgbW9iaWxlIGRldmljZSBpbiBsYW5kc2NhcGUgb3JpZW50YXRpb24uXG4gICAqL1xuICBpc01vYmlsZUxhbmRzY2FwZSgpIHtcbiAgICByZXR1cm4gdGhpcy5pc01vYmlsZURldmljZSgpICYmIHRoaXMuZ2V0T3JpZW50YXRpb24oKSA9PT0gJ2xhbmRzY2FwZSc7XG4gIH1cblxuICAvKipcbiAgICogRGV0ZWN0IG1vYmlsZSBkZXZpY2VzIChodHRwOi8vZGV0ZWN0bW9iaWxlYnJvd3NlcnMuY29tLylcbiAgICogQHJldHVybnMge2Jvb2xlYW59IFRydWUgaWYgcnVubmluZyBvbiBhIG1vYmlsZSBkZXZpY2UuXG4gICAqL1xuICBpc01vYmlsZURldmljZSgpIHtcbiAgICBsZXQgY2hlY2sgPSBmYWxzZTtcbiAgICAoZnVuY3Rpb24gKGEpIHtcbiAgICAgIGlmICgvKGFuZHJvaWR8YmJcXGQrfG1lZWdvKS4rbW9iaWxlfGF2YW50Z298YmFkYVxcL3xibGFja2JlcnJ5fGJsYXplcnxjb21wYWx8ZWxhaW5lfGZlbm5lY3xoaXB0b3B8aWVtb2JpbGV8aXAoaG9uZXxvZCl8aXJpc3xraW5kbGV8bGdlIHxtYWVtb3xtaWRwfG1tcHxtb2JpbGUuK2ZpcmVmb3h8bmV0ZnJvbnR8b3BlcmEgbShvYnxpbilpfHBhbG0oIG9zKT98cGhvbmV8cChpeGl8cmUpXFwvfHBsdWNrZXJ8cG9ja2V0fHBzcHxzZXJpZXMoNHw2KTB8c3ltYmlhbnx0cmVvfHVwXFwuKGJyb3dzZXJ8bGluayl8dm9kYWZvbmV8d2FwfHdpbmRvd3MgY2V8eGRhfHhpaW5vL2kudGVzdChhKSB8fCAvMTIwN3w2MzEwfDY1OTB8M2dzb3w0dGhwfDUwWzEtNl1pfDc3MHN8ODAyc3xhIHdhfGFiYWN8YWMoZXJ8b298cy0pfGFpKGtvfHJuKXxhbChhdnxjYXxjbyl8YW1vaXxhbihleHxueXx5dyl8YXB0dXxhcihjaHxnbyl8YXModGV8dXMpfGF0dHd8YXUoZGl8LW18ciB8cyApfGF2YW58YmUoY2t8bGx8bnEpfGJpKGxifHJkKXxibChhY3xheil8YnIoZXx2KXd8YnVtYnxidy0obnx1KXxjNTVcXC98Y2FwaXxjY3dhfGNkbS18Y2VsbHxjaHRtfGNsZGN8Y21kLXxjbyhtcHxuZCl8Y3Jhd3xkYShpdHxsbHxuZyl8ZGJ0ZXxkYy1zfGRldml8ZGljYXxkbW9ifGRvKGN8cClvfGRzKDEyfC1kKXxlbCg0OXxhaSl8ZW0obDJ8dWwpfGVyKGljfGswKXxlc2w4fGV6KFs0LTddMHxvc3x3YXx6ZSl8ZmV0Y3xmbHkoLXxfKXxnMSB1fGc1NjB8Z2VuZXxnZi01fGctbW98Z28oXFwud3xvZCl8Z3IoYWR8dW4pfGhhaWV8aGNpdHxoZC0obXxwfHQpfGhlaS18aGkocHR8dGEpfGhwKCBpfGlwKXxocy1jfGh0KGMoLXwgfF98YXxnfHB8c3x0KXx0cCl8aHUoYXd8dGMpfGktKDIwfGdvfG1hKXxpMjMwfGlhYyggfC18XFwvKXxpYnJvfGlkZWF8aWcwMXxpa29tfGltMWt8aW5ub3xpcGFxfGlyaXN8amEodHx2KWF8amJyb3xqZW11fGppZ3N8a2RkaXxrZWppfGtndCggfFxcLyl8a2xvbnxrcHQgfGt3Yy18a3lvKGN8ayl8bGUobm98eGkpfGxnKCBnfFxcLyhrfGx8dSl8NTB8NTR8LVthLXddKXxsaWJ3fGx5bnh8bTEtd3xtM2dhfG01MFxcL3xtYSh0ZXx1aXx4byl8bWMoMDF8MjF8Y2EpfG0tY3J8bWUocmN8cmkpfG1pKG84fG9hfHRzKXxtbWVmfG1vKDAxfDAyfGJpfGRlfGRvfHQoLXwgfG98dil8enopfG10KDUwfHAxfHYgKXxtd2JwfG15d2F8bjEwWzAtMl18bjIwWzItM118bjMwKDB8Mil8bjUwKDB8Mnw1KXxuNygwKDB8MSl8MTApfG5lKChjfG0pLXxvbnx0Znx3Znx3Z3x3dCl8bm9rKDZ8aSl8bnpwaHxvMmltfG9wKHRpfHd2KXxvcmFufG93ZzF8cDgwMHxwYW4oYXxkfHQpfHBkeGd8cGcoMTN8LShbMS04XXxjKSl8cGhpbHxwaXJlfHBsKGF5fHVjKXxwbi0yfHBvKGNrfHJ0fHNlKXxwcm94fHBzaW98cHQtZ3xxYS1hfHFjKDA3fDEyfDIxfDMyfDYwfC1bMi03XXxpLSl8cXRla3xyMzgwfHI2MDB8cmFrc3xyaW05fHJvKHZlfHpvKXxzNTVcXC98c2EoZ2V8bWF8bW18bXN8bnl8dmEpfHNjKDAxfGgtfG9vfHAtKXxzZGtcXC98c2UoYygtfDB8MSl8NDd8bWN8bmR8cmkpfHNnaC18c2hhcnxzaWUoLXxtKXxzay0wfHNsKDQ1fGlkKXxzbShhbHxhcnxiM3xpdHx0NSl8c28oZnR8bnkpfHNwKDAxfGgtfHYtfHYgKXxzeSgwMXxtYil8dDIoMTh8NTApfHQ2KDAwfDEwfDE4KXx0YShndHxsayl8dGNsLXx0ZGctfHRlbChpfG0pfHRpbS18dC1tb3x0byhwbHxzaCl8dHMoNzB8bS18bTN8bTUpfHR4LTl8dXAoXFwuYnxnMXxzaSl8dXRzdHx2NDAwfHY3NTB8dmVyaXx2aShyZ3x0ZSl8dmsoNDB8NVswLTNdfC12KXx2bTQwfHZvZGF8dnVsY3x2eCg1Mnw1M3w2MHw2MXw3MHw4MHw4MXw4M3w4NXw5OCl8dzNjKC18ICl8d2ViY3x3aGl0fHdpKGcgfG5jfG53KXx3bWxifHdvbnV8eDcwMHx5YXMtfHlvdXJ8emV0b3x6dGUtL2kudGVzdChhLnN1YnN0cigwLCA0KSkpIGNoZWNrID0gdHJ1ZTtcbiAgICB9KShuYXZpZ2F0b3IudXNlckFnZW50IHx8IG5hdmlnYXRvci52ZW5kb3IgfHwgd2luZG93Lm9wZXJhKTtcbiAgICByZXR1cm4gY2hlY2s7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGRldmljZSBvcmllbnRhdGlvbi5cbiAgICogQHJldHVybiB7c3RyaW5nfSAncG9ydHJhaXQnIG9yICdsYW5kc2NhcGUnLlxuICAgKi9cbiAgZ2V0T3JpZW50YXRpb24oKSB7XG4gICAgaWYgKHNjcmVlbi5vcmllbnRhdGlvbiAmJiBzY3JlZW4ub3JpZW50YXRpb24udHlwZSkge1xuICAgICAgaWYgKHNjcmVlbi5vcmllbnRhdGlvbi50eXBlLmluY2x1ZGVzKCdwb3J0cmFpdCcpKSB7XG4gICAgICAgIHJldHVybiAncG9ydHJhaXQnO1xuICAgICAgfVxuICAgICAgZWxzZSBpZiAoc2NyZWVuLm9yaWVudGF0aW9uLnR5cGUuaW5jbHVkZXMoJ2xhbmRzY2FwZScpKSB7XG4gICAgICAgIHJldHVybiAnbGFuZHNjYXBlJztcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBVbnJlbGlhYmxlLCBhcyBub3QgY2xlYXIgd2hhdCBkZXZpY2UncyBuYXR1cmFsIG9yaWVudGF0aW9uIGlzXG4gICAgaWYgKHR5cGVvZiB3aW5kb3cub3JpZW50YXRpb24gPT09ICdudW1iZXInKSB7XG4gICAgICBpZiAod2luZG93Lm9yaWVudGF0aW9uID09PSAwIHx8IHdpbmRvdy5vcmllbnRhdGlvbiA9PT0gMTgwKSB7XG4gICAgICAgIHJldHVybiAncG9ydHJhaXQnO1xuICAgICAgfVxuICAgICAgZWxzZSBpZiAod2luZG93Lm9yaWVudGF0aW9uID09PSA5MCB8fCB3aW5kb3cub3JpZW50YXRpb24gPT09IC05MCB8fCB3aW5kb3cub3JpZW50YXRpb24gPT09IDI3MCkge1xuICAgICAgICByZXR1cm4gJ2xhbmRzY2FwZSc7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuICdsYW5kc2NhcGUnOyAvLyBBc3N1bWUgZGVmYXVsdFxuICB9XG5cbiAgLyoqXG5cdCAqIEdldCB0b3AgRE9NIFdpbmRvdyBvYmplY3QuXG5cdCAqIEBwYXJhbSB7V2luZG93fSBbc3RhcnRXaW5kb3c9d2luZG93XSBXaW5kb3cgdG8gc3RhcnQgbG9va2luZyBmcm9tLlxuXHQgKiBAcmV0dXJuIHtXaW5kb3d8bnVsbH0gVG9wIHdpbmRvdy5cblx0ICovXG4gIGdldFRvcFdpbmRvdyhzdGFydFdpbmRvdykge1xuICAgIHZhciBzYW1lT3JpZ2luO1xuICAgIHN0YXJ0V2luZG93ID0gc3RhcnRXaW5kb3cgfHwgd2luZG93O1xuXG4gICAgLy8gSDVQIGlmcmFtZSBtYXkgYmUgb24gZGlmZmVyZW50IGRvbWFpbiB0aGFuIGlmcmFtZSBjb250ZW50XG4gICAgdHJ5IHtcbiAgICAgIHNhbWVPcmlnaW4gPSBzdGFydFdpbmRvdy5wYXJlbnQubG9jYXRpb24uaG9zdCA9PT0gd2luZG93LmxvY2F0aW9uLmhvc3Q7XG4gICAgfVxuICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgc2FtZU9yaWdpbiA9IG51bGw7XG4gICAgfVxuXG4gICAgaWYgKCFzYW1lT3JpZ2luKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBpZiAoc3RhcnRXaW5kb3cucGFyZW50ID09PSBzdGFydFdpbmRvdyB8fCAhIHN0YXJ0V2luZG93LnBhcmVudCkge1xuICAgICAgcmV0dXJuIHN0YXJ0V2luZG93O1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmdldFRvcFdpbmRvdyhzdGFydFdpbmRvdy5wYXJlbnQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSBvcmllbnRhdGlvbiBjaGFuZ2UuXG4gICAqL1xuICBoYW5kbGVPcmllbnRhdGlvbkNoYW5nZSgpIHtcbiAgICBpZiAoIXRoaXMucGFyYW1zLmJlaGF2aW91ci5zY2FsZVRleHROb3RDYXJkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgaXNNb2JpbGVMYW5kc2NhcGUgPSB0aGlzLmlzTW9iaWxlTGFuZHNjYXBlKCk7XG4gICAgdGhpcy5jYXJkcy5mb3JFYWNoKGNhcmQgPT4ge1xuICAgICAgaWYgKHRoaXMucGFyYW1zLm1vZGUgPT09ICdyZXBldGl0aW9uJykge1xuICAgICAgICBjYXJkLiRidXR0b25UdXJuLnRleHQoaXNNb2JpbGVMYW5kc2NhcGUgPyAnJyA6IHRoaXMucGFyYW1zLmFuc3dlcik7XG4gICAgICAgIGNhcmQuJGJ1dHRvbkNvcnJlY3QudGV4dChpc01vYmlsZUxhbmRzY2FwZSA/ICcnIDogdGhpcy5wYXJhbXMuY29ycmVjdEFuc3dlcik7XG4gICAgICAgIGNhcmQuJGJ1dHRvbkluY29ycmVjdC50ZXh0KGlzTW9iaWxlTGFuZHNjYXBlID8gJycgOiB0aGlzLnBhcmFtcy5pbmNvcnJlY3RBbnN3ZXIpO1xuICAgICAgfVxuXG4gICAgICBpZiAoIWlzTW9iaWxlTGFuZHNjYXBlKSB7XG4gICAgICAgIHRoaXMuJGNhcmR3cmFwcGVyU2V0LmNzcygnbWF4LWhlaWdodCcsICcnKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufVxuXG5EaWFsb2djYXJkcy5pZENvdW50ZXIgPSAwO1xuXG4vLyBDb25zdGFudHNcbkRpYWxvZ2NhcmRzLlNDQUxFSU5URVJWQUwgPSAwLjI7XG5EaWFsb2djYXJkcy5NQVhTQ0FMRSA9IDE2O1xuRGlhbG9nY2FyZHMuTUlOU0NBTEUgPSA0O1xuXG5leHBvcnQgZGVmYXVsdCBEaWFsb2djYXJkcztcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/scripts/h5p-dialogcards.js\n");

/***/ }),

/***/ "./src/styles/h5p-dialogcards.css":
/*!****************************************!*\
  !*** ./src/styles/h5p-dialogcards.css ***!
  \****************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n// extracted by mini-css-extract-plugin\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvc3R5bGVzL2g1cC1kaWFsb2djYXJkcy5jc3MuanMiLCJtYXBwaW5ncyI6IjtBQUFBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vaDVwLWRpYWxvZ2NhcmRzLy4vc3JjL3N0eWxlcy9oNXAtZGlhbG9nY2FyZHMuY3NzP2IzZDYiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gZXh0cmFjdGVkIGJ5IG1pbmktY3NzLWV4dHJhY3QtcGx1Z2luXG5leHBvcnQge307Il0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/styles/h5p-dialogcards.css\n");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	!function() {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = function(exports) {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	}();
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module can't be inlined because the eval-source-map devtool is used.
/******/ 	var __webpack_exports__ = __webpack_require__("./src/entries/h5p-dialogcards.js");
/******/ 	
/******/ })()
;