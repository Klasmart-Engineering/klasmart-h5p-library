/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
/******/ (function() { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "./src/entries/h5p-dialogcards.js":
/*!****************************************!*\
  !*** ./src/entries/h5p-dialogcards.js ***!
  \****************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _styles_h5p_dialogcards_css__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../styles/h5p-dialogcards.css */ \"./src/styles/h5p-dialogcards.css\");\n/* harmony import */ var _scripts_h5p_dialogcards_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../scripts/h5p-dialogcards.js */ \"./src/scripts/h5p-dialogcards.js\");\n\n // Load library\n// H5P = H5P || {};\n\nH5P.Dialogcards = _scripts_h5p_dialogcards_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"];//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZW50cmllcy9oNXAtZGlhbG9nY2FyZHMuanMuanMiLCJtYXBwaW5ncyI6Ijs7O0FBQUE7QUFDQTtBQUdBOztBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vaDVwLWRpYWxvZ2NhcmRzLy4vc3JjL2VudHJpZXMvaDVwLWRpYWxvZ2NhcmRzLmpzPzRmNWIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFwiLi4vc3R5bGVzL2g1cC1kaWFsb2djYXJkcy5jc3NcIjtcbmltcG9ydCBEaWFsb2djYXJkcyBmcm9tIFwiLi4vc2NyaXB0cy9oNXAtZGlhbG9nY2FyZHMuanNcIjtcblxuLy8gTG9hZCBsaWJyYXJ5XG4vLyBINVAgPSBINVAgfHwge307XG5INVAuRGlhbG9nY2FyZHMgPSBEaWFsb2djYXJkcztcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/entries/h5p-dialogcards.js\n");

/***/ }),

/***/ "./src/scripts/h5p-dialogcards-card-manager.js":
/*!*****************************************************!*\
  !*** ./src/scripts/h5p-dialogcards-card-manager.js ***!
  \*****************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _h5p_dialogcards_card_pool__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./h5p-dialogcards-card-pool */ \"./src/scripts/h5p-dialogcards-card-pool.js\");\n/* harmony import */ var _h5p_dialogcards_card_pile__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./h5p-dialogcards-card-pile */ \"./src/scripts/h5p-dialogcards-card-pile.js\");\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _iterableToArray(iter) { if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\n\n\n\nvar CardManager = /*#__PURE__*/function () {\n  /**\n   * @constructor\n   *\n   * @param {object} params Parameters from content type.\n   * @param {number} contentId Id of content.\n   * @param {object} callbacks Callbacks to parent.\n   */\n  function CardManager(params, contentId, callbacks) {\n    this.params = params;\n    this.cardPool = new _h5p_dialogcards_card_pool__WEBPACK_IMPORTED_MODULE_0__[\"default\"](params, contentId, callbacks);\n    this.reset(params.cardPiles);\n    return this;\n  }\n  /**\n   * Create a selection of card ids depending on mode.\n   *\n   * @return {object[]} Selection of card ids.\n   */\n\n\n  var _proto = CardManager.prototype;\n\n  _proto.createSelection = function createSelection() {\n    var selectionIds = [];\n\n    switch (this.params.mode) {\n      case 'repetition':\n        // Repetition mode\n        selectionIds = this.createSelectionRepetition();\n        break;\n\n      default:\n        // Normal mode\n        selectionIds = this.cardPool.getCardIds();\n    }\n\n    return selectionIds;\n  }\n  /**\n   * Create card piles depending on mode.\n   * @param {object} [cardPiles] Piles to set (from previous state).\n   */\n  ;\n\n  _proto.createPiles = function createPiles(cardPiles) {\n    if (cardPiles) {\n      this.cardPiles = cardPiles.map(function (cardPile) {\n        return new _h5p_dialogcards_card_pile__WEBPACK_IMPORTED_MODULE_1__[\"default\"](cardPile.cards);\n      });\n      return;\n    }\n\n    this.cardPiles = [];\n    var pool = this.cardPool.getCardIds();\n\n    switch (this.params.mode) {\n      case 'repetition':\n        // Repetition mode\n        for (var i = 0; i < this.params.behaviour.maxProficiency; i++) {\n          if (i === 0) {\n            this.cardPiles.push(new _h5p_dialogcards_card_pile__WEBPACK_IMPORTED_MODULE_1__[\"default\"](pool));\n          } else {\n            this.cardPiles.push(new _h5p_dialogcards_card_pile__WEBPACK_IMPORTED_MODULE_1__[\"default\"]());\n          }\n        }\n\n        break;\n\n      case 'normal':\n        // Normal mode. One pile only with all cards\n        this.cardPiles.push(new _h5p_dialogcards_card_pile__WEBPACK_IMPORTED_MODULE_1__[\"default\"](pool));\n    }\n  }\n  /**\n   * Update piles.\n   *\n   * Just one \"rule\" for now. Could be amended with more modes.\n   *\n   * @param {object[]} results Results.\n   * @param {number} results.cardId Card that result is reported for.\n   * @param {boolean} results.result Result for that card.\n   * @return {number[]} Card pile sizes.\n   */\n  ;\n\n  _proto.updatePiles = function updatePiles(results) {\n    var _this = this;\n\n    results.forEach(function (result) {\n      // Find card in pile\n      var pileId = _this.find(result.cardId);\n\n      if (pileId === -1) {\n        return;\n      } // Move card to next pile or first pile\n\n\n      var newPileId = result.result === true ? pileId + 1 : 0;\n      newPileId = Math.max(0, Math.min(newPileId, _this.cardPiles.length - 1));\n\n      _this.cardPiles[pileId].remove(result.cardId);\n\n      _this.cardPiles[newPileId].add(result.cardId, 'bottom');\n    });\n    return this.getPileSizes();\n  }\n  /**\n   * Create card selection for repetition mode.\n   *\n   * Draw all cards from first pile with cards, 1/2 of next, 1/3 of next, ...\n   * Don't draw cards from last pile\n   * Get cards from top - will be moved at the bottom of other pile according to results (LIFO)\n   *\n   * @return {object[]} Ids of selected cards from pool.\n   */\n  ;\n\n  _proto.createSelectionRepetition = function createSelectionRepetition() {\n    var selectionIds = [];\n    var firstPileWithCards = null;\n\n    for (var j = 0; j < this.cardPiles.length - 1; j++) {\n      var _selectionIds;\n\n      var pileAmount = this.cardPiles[j].length(); // Skip empty piles\n\n      if (firstPileWithCards === null && pileAmount === 0) {\n        continue;\n      } // Remember first pile with cards\n\n\n      if (firstPileWithCards === null) {\n        firstPileWithCards = j;\n      } // Draw cards favoring those of piles with low id\n\n\n      var drawAmount = Math.ceil(pileAmount * 1 / (1 + j - firstPileWithCards));\n      var cardsDrawn = this.cardPiles[j].peek(0, drawAmount);\n      selectionIds = (_selectionIds = selectionIds).concat.apply(_selectionIds, _toConsumableArray(cardsDrawn));\n    } // Shuffle selection\n\n\n    selectionIds = this.shuffle(selectionIds);\n    return selectionIds;\n  }\n  /**\n   * Shuffle items (not in place).\n   *\n   * @param {object[]} items Items.\n   * @return {object[]} Shuffled items.\n   */\n  ;\n\n  _proto.shuffle = function shuffle(items) {\n    var copies = items.slice();\n\n    for (var i = copies.length - 1; i > 0; i--) {\n      var j = Math.floor(Math.random() * (i + 1));\n      var _ref = [copies[j], copies[i]];\n      copies[i] = _ref[0];\n      copies[j] = _ref[1];\n    }\n\n    return copies;\n  }\n  /**\n   * Find id of pile that contains card with particular id.\n   *\n   * @param {number} id Id of card to be found.\n   * @return {number} Id of pile or -1.\n   */\n  ;\n\n  _proto.find = function find(id) {\n    var found = -1;\n    this.cardPiles.forEach(function (cardPile, index) {\n      if (found !== -1) {\n        return found;\n      }\n\n      if (cardPile.contains(id)) {\n        found = index;\n      }\n    });\n    return found;\n  }\n  /**\n   * Reset Card Manager.\n   * @param {object} [cardPiles] Piles to set (from previous state).\n   */\n  ;\n\n  _proto.reset = function reset(cardPiles) {\n    this.createPiles(cardPiles);\n  }\n  /**\n   * Retrieve card from pool. Will be loaded on call.\n   *\n   * @param {number} id Id of card to be retrieved.\n   */\n  ;\n\n  _proto.getCard = function getCard(id) {\n    return this.cardPool.getCard(id);\n  }\n  /**\n   * Retrieve the total number of cards available.\n   * @return {number} Total number of cards available.\n   */\n  ;\n\n  _proto.getSize = function getSize() {\n    return this.cardPool.getCardIds().length;\n  }\n  /**\n   * Retrieve all piles.\n   * @return {object[]} Piles.\n   */\n  ;\n\n  _proto.getPiles = function getPiles() {\n    return this.cardPiles;\n  }\n  /**\n   * Retrieve the size of each pile.\n   * @return {object[]} Pile sizes.\n   */\n  ;\n\n  _proto.getPileSizes = function getPileSizes() {\n    return this.cardPiles.map(function (pile) {\n      return pile.length();\n    });\n  };\n\n  return CardManager;\n}();\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (CardManager);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvc2NyaXB0cy9oNXAtZGlhbG9nY2FyZHMtY2FyZC1tYW5hZ2VyLmpzLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUNBO0FBQ0E7QUFDQTtBQVBBOztBQVVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTs7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFmQTtBQWlCQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUFBOztBQUNBO0FBQ0E7QUFDQTs7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7O0FBQ0E7O0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFFQTs7QUFDQTtBQUFBOztBQUNBOztBQUdBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBOztBQUNBO0FBQ0E7QUFEQTtBQUVBO0FBQUE7QUFDQTs7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7Ozs7O0FBR0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9oNXAtZGlhbG9nY2FyZHMvLi9zcmMvc2NyaXB0cy9oNXAtZGlhbG9nY2FyZHMtY2FyZC1tYW5hZ2VyLmpzPzAxYTciXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IENhcmRQb29sIGZyb20gJy4vaDVwLWRpYWxvZ2NhcmRzLWNhcmQtcG9vbCc7XG5pbXBvcnQgQ2FyZFBpbGUgZnJvbSAnLi9oNXAtZGlhbG9nY2FyZHMtY2FyZC1waWxlJztcblxuY2xhc3MgQ2FyZE1hbmFnZXIge1xuICAvKipcbiAgICogQGNvbnN0cnVjdG9yXG4gICAqXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBwYXJhbXMgUGFyYW1ldGVycyBmcm9tIGNvbnRlbnQgdHlwZS5cbiAgICogQHBhcmFtIHtudW1iZXJ9IGNvbnRlbnRJZCBJZCBvZiBjb250ZW50LlxuICAgKiBAcGFyYW0ge29iamVjdH0gY2FsbGJhY2tzIENhbGxiYWNrcyB0byBwYXJlbnQuXG4gICAqL1xuICBjb25zdHJ1Y3RvcihwYXJhbXMsIGNvbnRlbnRJZCwgY2FsbGJhY2tzKSB7XG4gICAgdGhpcy5wYXJhbXMgPSBwYXJhbXM7XG4gICAgdGhpcy5jYXJkUG9vbCA9IG5ldyBDYXJkUG9vbChwYXJhbXMsIGNvbnRlbnRJZCwgY2FsbGJhY2tzKTtcblxuICAgIHRoaXMucmVzZXQocGFyYW1zLmNhcmRQaWxlcyk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYSBzZWxlY3Rpb24gb2YgY2FyZCBpZHMgZGVwZW5kaW5nIG9uIG1vZGUuXG4gICAqXG4gICAqIEByZXR1cm4ge29iamVjdFtdfSBTZWxlY3Rpb24gb2YgY2FyZCBpZHMuXG4gICAqL1xuICBjcmVhdGVTZWxlY3Rpb24oKSB7XG4gICAgbGV0IHNlbGVjdGlvbklkcyA9IFtdO1xuXG4gICAgc3dpdGNoICh0aGlzLnBhcmFtcy5tb2RlKSB7XG4gICAgICBjYXNlICdyZXBldGl0aW9uJzpcbiAgICAgICAgLy8gUmVwZXRpdGlvbiBtb2RlXG4gICAgICAgIHNlbGVjdGlvbklkcyA9IHRoaXMuY3JlYXRlU2VsZWN0aW9uUmVwZXRpdGlvbigpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIC8vIE5vcm1hbCBtb2RlXG4gICAgICAgIHNlbGVjdGlvbklkcyA9IHRoaXMuY2FyZFBvb2wuZ2V0Q2FyZElkcygpO1xuICAgIH1cblxuICAgIHJldHVybiBzZWxlY3Rpb25JZHM7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGNhcmQgcGlsZXMgZGVwZW5kaW5nIG9uIG1vZGUuXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBbY2FyZFBpbGVzXSBQaWxlcyB0byBzZXQgKGZyb20gcHJldmlvdXMgc3RhdGUpLlxuICAgKi9cbiAgY3JlYXRlUGlsZXMoY2FyZFBpbGVzKSB7XG4gICAgaWYgKGNhcmRQaWxlcykge1xuICAgICAgdGhpcy5jYXJkUGlsZXMgPSBjYXJkUGlsZXMubWFwKGNhcmRQaWxlID0+IHtcbiAgICAgICAgcmV0dXJuIG5ldyBDYXJkUGlsZShjYXJkUGlsZS5jYXJkcyk7XG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuY2FyZFBpbGVzID0gW107XG4gICAgY29uc3QgcG9vbCA9IHRoaXMuY2FyZFBvb2wuZ2V0Q2FyZElkcygpO1xuXG4gICAgc3dpdGNoICh0aGlzLnBhcmFtcy5tb2RlKSB7XG4gICAgICBjYXNlICdyZXBldGl0aW9uJzpcbiAgICAgICAgLy8gUmVwZXRpdGlvbiBtb2RlXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wYXJhbXMuYmVoYXZpb3VyLm1heFByb2ZpY2llbmN5OyBpKyspIHtcbiAgICAgICAgICBpZiAoaSA9PT0gMCkge1xuICAgICAgICAgICAgdGhpcy5jYXJkUGlsZXMucHVzaChuZXcgQ2FyZFBpbGUocG9vbCkpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuY2FyZFBpbGVzLnB1c2gobmV3IENhcmRQaWxlKCkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSAnbm9ybWFsJzpcbiAgICAgICAgLy8gTm9ybWFsIG1vZGUuIE9uZSBwaWxlIG9ubHkgd2l0aCBhbGwgY2FyZHNcbiAgICAgICAgdGhpcy5jYXJkUGlsZXMucHVzaChuZXcgQ2FyZFBpbGUocG9vbCkpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgcGlsZXMuXG4gICAqXG4gICAqIEp1c3Qgb25lIFwicnVsZVwiIGZvciBub3cuIENvdWxkIGJlIGFtZW5kZWQgd2l0aCBtb3JlIG1vZGVzLlxuICAgKlxuICAgKiBAcGFyYW0ge29iamVjdFtdfSByZXN1bHRzIFJlc3VsdHMuXG4gICAqIEBwYXJhbSB7bnVtYmVyfSByZXN1bHRzLmNhcmRJZCBDYXJkIHRoYXQgcmVzdWx0IGlzIHJlcG9ydGVkIGZvci5cbiAgICogQHBhcmFtIHtib29sZWFufSByZXN1bHRzLnJlc3VsdCBSZXN1bHQgZm9yIHRoYXQgY2FyZC5cbiAgICogQHJldHVybiB7bnVtYmVyW119IENhcmQgcGlsZSBzaXplcy5cbiAgICovXG4gIHVwZGF0ZVBpbGVzKHJlc3VsdHMpIHtcbiAgICByZXN1bHRzLmZvckVhY2gocmVzdWx0ID0+IHtcbiAgICAgIC8vIEZpbmQgY2FyZCBpbiBwaWxlXG4gICAgICBjb25zdCBwaWxlSWQgPSB0aGlzLmZpbmQocmVzdWx0LmNhcmRJZCk7XG4gICAgICBpZiAocGlsZUlkID09PSAtMSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIE1vdmUgY2FyZCB0byBuZXh0IHBpbGUgb3IgZmlyc3QgcGlsZVxuICAgICAgbGV0IG5ld1BpbGVJZCA9IChyZXN1bHQucmVzdWx0ID09PSB0cnVlKSA/IHBpbGVJZCArIDEgOiAwO1xuICAgICAgbmV3UGlsZUlkID0gTWF0aC5tYXgoMCwgTWF0aC5taW4obmV3UGlsZUlkLCB0aGlzLmNhcmRQaWxlcy5sZW5ndGggLSAxKSk7XG4gICAgICB0aGlzLmNhcmRQaWxlc1twaWxlSWRdLnJlbW92ZShyZXN1bHQuY2FyZElkKTtcbiAgICAgIHRoaXMuY2FyZFBpbGVzW25ld1BpbGVJZF0uYWRkKHJlc3VsdC5jYXJkSWQsICdib3R0b20nKTtcbiAgICB9KTtcblxuICAgIHJldHVybiB0aGlzLmdldFBpbGVTaXplcygpO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBjYXJkIHNlbGVjdGlvbiBmb3IgcmVwZXRpdGlvbiBtb2RlLlxuICAgKlxuICAgKiBEcmF3IGFsbCBjYXJkcyBmcm9tIGZpcnN0IHBpbGUgd2l0aCBjYXJkcywgMS8yIG9mIG5leHQsIDEvMyBvZiBuZXh0LCAuLi5cbiAgICogRG9uJ3QgZHJhdyBjYXJkcyBmcm9tIGxhc3QgcGlsZVxuICAgKiBHZXQgY2FyZHMgZnJvbSB0b3AgLSB3aWxsIGJlIG1vdmVkIGF0IHRoZSBib3R0b20gb2Ygb3RoZXIgcGlsZSBhY2NvcmRpbmcgdG8gcmVzdWx0cyAoTElGTylcbiAgICpcbiAgICogQHJldHVybiB7b2JqZWN0W119IElkcyBvZiBzZWxlY3RlZCBjYXJkcyBmcm9tIHBvb2wuXG4gICAqL1xuICBjcmVhdGVTZWxlY3Rpb25SZXBldGl0aW9uKCkge1xuICAgIGxldCBzZWxlY3Rpb25JZHMgPSBbXTtcblxuICAgIGxldCBmaXJzdFBpbGVXaXRoQ2FyZHMgPSBudWxsO1xuICAgIGZvciAobGV0IGogPSAwOyBqIDwgdGhpcy5jYXJkUGlsZXMubGVuZ3RoIC0gMTsgaisrKSB7XG4gICAgICBjb25zdCBwaWxlQW1vdW50ID0gdGhpcy5jYXJkUGlsZXNbal0ubGVuZ3RoKCk7XG5cbiAgICAgIC8vIFNraXAgZW1wdHkgcGlsZXNcbiAgICAgIGlmIChmaXJzdFBpbGVXaXRoQ2FyZHMgPT09IG51bGwgJiYgcGlsZUFtb3VudCA9PT0gMCkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgLy8gUmVtZW1iZXIgZmlyc3QgcGlsZSB3aXRoIGNhcmRzXG4gICAgICBpZiAoZmlyc3RQaWxlV2l0aENhcmRzID09PSBudWxsKSB7XG4gICAgICAgIGZpcnN0UGlsZVdpdGhDYXJkcyA9IGo7XG4gICAgICB9XG5cbiAgICAgIC8vIERyYXcgY2FyZHMgZmF2b3JpbmcgdGhvc2Ugb2YgcGlsZXMgd2l0aCBsb3cgaWRcbiAgICAgIGNvbnN0IGRyYXdBbW91bnQgPSBNYXRoLmNlaWwocGlsZUFtb3VudCAqIDEgLyAoMSArIGogLSBmaXJzdFBpbGVXaXRoQ2FyZHMpKTtcbiAgICAgIGNvbnN0IGNhcmRzRHJhd24gPSB0aGlzLmNhcmRQaWxlc1tqXS5wZWVrKDAsIGRyYXdBbW91bnQpO1xuICAgICAgc2VsZWN0aW9uSWRzID0gc2VsZWN0aW9uSWRzLmNvbmNhdCguLi5jYXJkc0RyYXduKTtcbiAgICB9XG5cbiAgICAvLyBTaHVmZmxlIHNlbGVjdGlvblxuICAgIHNlbGVjdGlvbklkcyA9IHRoaXMuc2h1ZmZsZShzZWxlY3Rpb25JZHMpO1xuXG4gICAgcmV0dXJuIHNlbGVjdGlvbklkcztcbiAgfVxuXG4gIC8qKlxuICAgKiBTaHVmZmxlIGl0ZW1zIChub3QgaW4gcGxhY2UpLlxuICAgKlxuICAgKiBAcGFyYW0ge29iamVjdFtdfSBpdGVtcyBJdGVtcy5cbiAgICogQHJldHVybiB7b2JqZWN0W119IFNodWZmbGVkIGl0ZW1zLlxuICAgKi9cbiAgc2h1ZmZsZShpdGVtcykge1xuICAgIGNvbnN0IGNvcGllcyA9IGl0ZW1zLnNsaWNlKCk7XG4gICAgZm9yIChsZXQgaSA9IGNvcGllcy5sZW5ndGggLSAxOyBpID4gMDsgaS0tKSB7XG4gICAgICBjb25zdCBqID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKGkgKyAxKSk7XG4gICAgICBbY29waWVzW2ldLCBjb3BpZXNbal1dID0gW2NvcGllc1tqXSwgY29waWVzW2ldXTtcbiAgICB9XG4gICAgcmV0dXJuIGNvcGllcztcbiAgfVxuXG4gIC8qKlxuICAgKiBGaW5kIGlkIG9mIHBpbGUgdGhhdCBjb250YWlucyBjYXJkIHdpdGggcGFydGljdWxhciBpZC5cbiAgICpcbiAgICogQHBhcmFtIHtudW1iZXJ9IGlkIElkIG9mIGNhcmQgdG8gYmUgZm91bmQuXG4gICAqIEByZXR1cm4ge251bWJlcn0gSWQgb2YgcGlsZSBvciAtMS5cbiAgICovXG4gIGZpbmQoaWQpIHtcbiAgICBsZXQgZm91bmQgPSAtMTtcbiAgICB0aGlzLmNhcmRQaWxlcy5mb3JFYWNoKChjYXJkUGlsZSwgaW5kZXgpID0+IHtcbiAgICAgIGlmIChmb3VuZCAhPT0gLTEpIHtcbiAgICAgICAgcmV0dXJuIGZvdW5kO1xuICAgICAgfVxuICAgICAgaWYgKGNhcmRQaWxlLmNvbnRhaW5zKGlkKSkgIHtcbiAgICAgICAgZm91bmQgPSBpbmRleDtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gZm91bmQ7XG4gIH1cblxuICAvKipcbiAgICogUmVzZXQgQ2FyZCBNYW5hZ2VyLlxuICAgKiBAcGFyYW0ge29iamVjdH0gW2NhcmRQaWxlc10gUGlsZXMgdG8gc2V0IChmcm9tIHByZXZpb3VzIHN0YXRlKS5cbiAgICovXG4gIHJlc2V0KGNhcmRQaWxlcykge1xuICAgIHRoaXMuY3JlYXRlUGlsZXMoY2FyZFBpbGVzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZSBjYXJkIGZyb20gcG9vbC4gV2lsbCBiZSBsb2FkZWQgb24gY2FsbC5cbiAgICpcbiAgICogQHBhcmFtIHtudW1iZXJ9IGlkIElkIG9mIGNhcmQgdG8gYmUgcmV0cmlldmVkLlxuICAgKi9cbiAgZ2V0Q2FyZChpZCkge1xuICAgIHJldHVybiB0aGlzLmNhcmRQb29sLmdldENhcmQoaWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlIHRoZSB0b3RhbCBudW1iZXIgb2YgY2FyZHMgYXZhaWxhYmxlLlxuICAgKiBAcmV0dXJuIHtudW1iZXJ9IFRvdGFsIG51bWJlciBvZiBjYXJkcyBhdmFpbGFibGUuXG4gICAqL1xuICBnZXRTaXplKCkge1xuICAgIHJldHVybiB0aGlzLmNhcmRQb29sLmdldENhcmRJZHMoKS5sZW5ndGg7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmUgYWxsIHBpbGVzLlxuICAgKiBAcmV0dXJuIHtvYmplY3RbXX0gUGlsZXMuXG4gICAqL1xuICBnZXRQaWxlcygpIHtcbiAgICByZXR1cm4gdGhpcy5jYXJkUGlsZXM7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmUgdGhlIHNpemUgb2YgZWFjaCBwaWxlLlxuICAgKiBAcmV0dXJuIHtvYmplY3RbXX0gUGlsZSBzaXplcy5cbiAgICovXG4gIGdldFBpbGVTaXplcygpIHtcbiAgICByZXR1cm4gdGhpcy5jYXJkUGlsZXMubWFwKHBpbGUgPT4gcGlsZS5sZW5ndGgoKSk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgQ2FyZE1hbmFnZXI7XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/scripts/h5p-dialogcards-card-manager.js\n");

/***/ }),

/***/ "./src/scripts/h5p-dialogcards-card-pile.js":
/*!**************************************************!*\
  !*** ./src/scripts/h5p-dialogcards-card-pile.js ***!
  \**************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _iterableToArray(iter) { if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nvar CardPile = /*#__PURE__*/function () {\n  /**\n   * @constructor\n   *\n   * @params {object[]} cards Card Ids.\n   */\n  function CardPile() {\n    var cards = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    // Only use unique values\n    this.cards = cards.filter(function (item, index) {\n      return cards.indexOf(item) >= index;\n    });\n    return this;\n  }\n  /**\n   * Get complete card pile.\n   */\n\n\n  var _proto = CardPile.prototype;\n\n  _proto.getCards = function getCards() {\n    return this.cards;\n  }\n  /**\n   * Peek at card in pile.\n   *\n   * @param {number|string} position Position to peek at.\n   * @param {number} [amount=1] Number of cards to peek at.\n   */\n  ;\n\n  _proto.peek = function peek(position) {\n    var amount = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;\n    amount = Math.max(0, amount);\n\n    if (position === 'top') {\n      position = 0;\n    }\n\n    if (position === 'bottom') {\n      position = this.cards.length - amount;\n    }\n\n    if (position < 0 || position > this.cards.length - 1) {\n      return [];\n    }\n\n    return this.cards.slice(position, position + amount);\n  }\n  /**\n   * Add cards to the pile.\n   *\n   * @param {number|object[]} ids Id or array of card ids to be added.\n   * @param {number|string} [position='top'] Position to add cards to (top|bottom), can be amended.\n   */\n  ;\n\n  _proto.add = function add(ids) {\n    var _this = this;\n\n    var position = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'top';\n\n    if (typeof ids === 'number') {\n      ids = [ids];\n    }\n\n    ids.forEach(function (id) {\n      var _this$cards;\n\n      if (_this.cards.indexOf(id) !== -1) {\n        return;\n      }\n\n      if (position === 'top') {\n        position = 0;\n      } else if (position === 'bottom') {\n        position = _this.cards.length;\n      } else if (position === 'random') {\n        position = Math.floor(Math.random() * _this.cards.length);\n      }\n\n      (_this$cards = _this.cards).splice.apply(_this$cards, [position, 0].concat(_toConsumableArray(ids)));\n    });\n  }\n  /**\n   * Shorthand for adding cards to top.\n   *\n   * @param {number|object[]} ids Id or array of card ids to be added.\n   */\n  ;\n\n  _proto.push = function push(ids) {\n    this.add(ids, 'top');\n  }\n  /**\n   * Pull consecutive cards from the pile.\n   *\n   * @param {number} [amount=1] Amount of cards to be pulled.\n   * @param {number|string} [position='top'] Position to take cards from. Default top.\n   */\n  ;\n\n  _proto.pull = function pull() {\n    var amount = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;\n    var position = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'top';\n    amount = Math.max(1, Math.min(amount, this.cards.length));\n\n    if (position === 'top') {\n      position = 0;\n    }\n\n    if (position === 'bottom') {\n      position = -amount;\n    }\n\n    position = Math.max(0, Math.min(position, this.cards.length - 1));\n    return this.cards.splice(position, amount);\n  }\n  /**\n   * Remove cards from the pile.\n   *\n   * @param {number|object[]} ids Id or array of card ids to be removed.\n   */\n  ;\n\n  _proto.remove = function remove(ids) {\n    var _this2 = this;\n\n    if (typeof ids === 'number') {\n      ids = [ids];\n    }\n\n    ids.forEach(function (id) {\n      var position = _this2.cards.indexOf(id);\n\n      if (position > -1) {\n        _this2.cards.splice(position, 1);\n      }\n    });\n  }\n  /**\n   * Shuffle pile in place.\n   *\n   * @return {object[]} Shuffled cards.\n   */\n  ;\n\n  _proto.shuffle = function shuffle() {\n    for (var i = this.cards.length - 1; i > 0; i--) {\n      var j = Math.floor(Math.random() * (i + 1));\n      var _ref = [this.cards[j], this.cards[i]];\n      this.cards[i] = _ref[0];\n      this.cards[j] = _ref[1];\n    }\n\n    return this.cards;\n  }\n  /**\n   * Check if id is in pile.\n   *\n   * @return {boolean} True, if card is in pile.\n   */\n  ;\n\n  _proto.contains = function contains(id) {\n    return this.cards.indexOf(id) !== -1;\n  }\n  /**\n   * Get amount of cards on pile.\n   *\n   * @return {number} Amount of cards on pile.\n   */\n  ;\n\n  _proto.length = function length() {\n    return this.cards.length;\n  };\n\n  return CardPile;\n}();\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (CardPile);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvc2NyaXB0cy9oNXAtZGlhbG9nY2FyZHMtY2FyZC1waWxlLmpzLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBOzs7OztBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFBQTtBQUNBOztBQUNBO0FBQ0E7QUFDQTs7QUFDQTtBQUNBO0FBQ0E7O0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQUE7O0FBQUE7O0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQUE7O0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFBQTtBQUFBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUNBO0FBQ0E7QUFDQTs7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUFBOztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUVBO0FBQUE7QUFDQTs7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBOzs7OztBQUdBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vaDVwLWRpYWxvZ2NhcmRzLy4vc3JjL3NjcmlwdHMvaDVwLWRpYWxvZ2NhcmRzLWNhcmQtcGlsZS5qcz8xODlmIl0sInNvdXJjZXNDb250ZW50IjpbImNsYXNzIENhcmRQaWxlIHtcbiAgLyoqXG4gICAqIEBjb25zdHJ1Y3RvclxuICAgKlxuICAgKiBAcGFyYW1zIHtvYmplY3RbXX0gY2FyZHMgQ2FyZCBJZHMuXG4gICAqL1xuICBjb25zdHJ1Y3RvcihjYXJkcyA9IFtdKSB7XG4gICAgLy8gT25seSB1c2UgdW5pcXVlIHZhbHVlc1xuICAgIHRoaXMuY2FyZHMgPSBjYXJkcy5maWx0ZXIoKGl0ZW0sIGluZGV4KSA9PiBjYXJkcy5pbmRleE9mKGl0ZW0pID49IGluZGV4KTtcblxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjb21wbGV0ZSBjYXJkIHBpbGUuXG4gICAqL1xuICBnZXRDYXJkcygpIHtcbiAgICByZXR1cm4gdGhpcy5jYXJkcztcbiAgfVxuXG4gIC8qKlxuICAgKiBQZWVrIGF0IGNhcmQgaW4gcGlsZS5cbiAgICpcbiAgICogQHBhcmFtIHtudW1iZXJ8c3RyaW5nfSBwb3NpdGlvbiBQb3NpdGlvbiB0byBwZWVrIGF0LlxuICAgKiBAcGFyYW0ge251bWJlcn0gW2Ftb3VudD0xXSBOdW1iZXIgb2YgY2FyZHMgdG8gcGVlayBhdC5cbiAgICovXG4gIHBlZWsocG9zaXRpb24sIGFtb3VudCA9IDEpIHtcbiAgICBhbW91bnQgPSBNYXRoLm1heCgwLCBhbW91bnQpO1xuICAgIGlmIChwb3NpdGlvbiA9PT0gJ3RvcCcpIHtcbiAgICAgIHBvc2l0aW9uID0gMDtcbiAgICB9XG4gICAgaWYgKHBvc2l0aW9uID09PSAnYm90dG9tJykge1xuICAgICAgcG9zaXRpb24gPSB0aGlzLmNhcmRzLmxlbmd0aCAtIGFtb3VudDtcbiAgICB9XG4gICAgaWYgKHBvc2l0aW9uIDwgMCB8fCBwb3NpdGlvbiA+IHRoaXMuY2FyZHMubGVuZ3RoIC0gMSkge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmNhcmRzLnNsaWNlKHBvc2l0aW9uLCBwb3NpdGlvbiArIGFtb3VudCk7XG4gIH1cblxuICAvKipcbiAgICogQWRkIGNhcmRzIHRvIHRoZSBwaWxlLlxuICAgKlxuICAgKiBAcGFyYW0ge251bWJlcnxvYmplY3RbXX0gaWRzIElkIG9yIGFycmF5IG9mIGNhcmQgaWRzIHRvIGJlIGFkZGVkLlxuICAgKiBAcGFyYW0ge251bWJlcnxzdHJpbmd9IFtwb3NpdGlvbj0ndG9wJ10gUG9zaXRpb24gdG8gYWRkIGNhcmRzIHRvICh0b3B8Ym90dG9tKSwgY2FuIGJlIGFtZW5kZWQuXG4gICAqL1xuICBhZGQoaWRzLCBwb3NpdGlvbiA9ICd0b3AnKSB7XG4gICAgaWYgKHR5cGVvZiBpZHMgPT09ICdudW1iZXInKSB7XG4gICAgICBpZHMgPSBbaWRzXTtcbiAgICB9XG5cbiAgICBpZHMuZm9yRWFjaChpZCA9PiB7XG4gICAgICBpZiAodGhpcy5jYXJkcy5pbmRleE9mKGlkKSAhPT0gLTEpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAocG9zaXRpb24gPT09ICd0b3AnKSB7XG4gICAgICAgIHBvc2l0aW9uID0gMDtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKHBvc2l0aW9uID09PSAnYm90dG9tJykge1xuICAgICAgICBwb3NpdGlvbiA9IHRoaXMuY2FyZHMubGVuZ3RoO1xuICAgICAgfVxuICAgICAgZWxzZSBpZiAocG9zaXRpb24gPT09ICdyYW5kb20nKSB7XG4gICAgICAgIHBvc2l0aW9uID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKHRoaXMuY2FyZHMubGVuZ3RoKSk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuY2FyZHMuc3BsaWNlKHBvc2l0aW9uLCAwLCAuLi5pZHMpO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFNob3J0aGFuZCBmb3IgYWRkaW5nIGNhcmRzIHRvIHRvcC5cbiAgICpcbiAgICogQHBhcmFtIHtudW1iZXJ8b2JqZWN0W119IGlkcyBJZCBvciBhcnJheSBvZiBjYXJkIGlkcyB0byBiZSBhZGRlZC5cbiAgICovXG4gIHB1c2goaWRzKSB7XG4gICAgdGhpcy5hZGQoaWRzLCAndG9wJyk7XG4gIH1cblxuICAvKipcbiAgICogUHVsbCBjb25zZWN1dGl2ZSBjYXJkcyBmcm9tIHRoZSBwaWxlLlxuICAgKlxuICAgKiBAcGFyYW0ge251bWJlcn0gW2Ftb3VudD0xXSBBbW91bnQgb2YgY2FyZHMgdG8gYmUgcHVsbGVkLlxuICAgKiBAcGFyYW0ge251bWJlcnxzdHJpbmd9IFtwb3NpdGlvbj0ndG9wJ10gUG9zaXRpb24gdG8gdGFrZSBjYXJkcyBmcm9tLiBEZWZhdWx0IHRvcC5cbiAgICovXG4gIHB1bGwoYW1vdW50ID0gMSwgcG9zaXRpb24gPSAndG9wJykge1xuICAgIGFtb3VudCA9IE1hdGgubWF4KDEsIE1hdGgubWluKGFtb3VudCwgdGhpcy5jYXJkcy5sZW5ndGgpKTtcblxuICAgIGlmIChwb3NpdGlvbiA9PT0gJ3RvcCcpIHtcbiAgICAgIHBvc2l0aW9uID0gMDtcbiAgICB9XG4gICAgaWYgKHBvc2l0aW9uID09PSAnYm90dG9tJykge1xuICAgICAgcG9zaXRpb24gPSAtYW1vdW50O1xuICAgIH1cbiAgICBwb3NpdGlvbiA9IE1hdGgubWF4KDAsIE1hdGgubWluKHBvc2l0aW9uLCB0aGlzLmNhcmRzLmxlbmd0aCAtIDEpKTtcblxuICAgIHJldHVybiB0aGlzLmNhcmRzLnNwbGljZShwb3NpdGlvbiwgYW1vdW50KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW1vdmUgY2FyZHMgZnJvbSB0aGUgcGlsZS5cbiAgICpcbiAgICogQHBhcmFtIHtudW1iZXJ8b2JqZWN0W119IGlkcyBJZCBvciBhcnJheSBvZiBjYXJkIGlkcyB0byBiZSByZW1vdmVkLlxuICAgKi9cbiAgcmVtb3ZlKGlkcykge1xuICAgIGlmICh0eXBlb2YgaWRzID09PSAnbnVtYmVyJykge1xuICAgICAgaWRzID0gW2lkc107XG4gICAgfVxuXG4gICAgaWRzLmZvckVhY2goaWQgPT4ge1xuICAgICAgY29uc3QgcG9zaXRpb24gPSB0aGlzLmNhcmRzLmluZGV4T2YoaWQpO1xuICAgICAgaWYgKHBvc2l0aW9uID4gLTEpIHtcbiAgICAgICAgdGhpcy5jYXJkcy5zcGxpY2UocG9zaXRpb24sIDEpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFNodWZmbGUgcGlsZSBpbiBwbGFjZS5cbiAgICpcbiAgICogQHJldHVybiB7b2JqZWN0W119IFNodWZmbGVkIGNhcmRzLlxuICAgKi9cbiAgc2h1ZmZsZSgpIHtcbiAgICBmb3IgKGxldCBpID0gdGhpcy5jYXJkcy5sZW5ndGggLSAxOyBpID4gMDsgaS0tKSB7XG4gICAgICBjb25zdCBqID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKGkgKyAxKSk7XG4gICAgICBbdGhpcy5jYXJkc1tpXSwgdGhpcy5jYXJkc1tqXV0gPSBbdGhpcy5jYXJkc1tqXSwgdGhpcy5jYXJkc1tpXV07XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuY2FyZHM7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgaWQgaXMgaW4gcGlsZS5cbiAgICpcbiAgICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSwgaWYgY2FyZCBpcyBpbiBwaWxlLlxuICAgKi9cbiAgY29udGFpbnMoaWQpIHtcbiAgICByZXR1cm4gdGhpcy5jYXJkcy5pbmRleE9mKGlkKSAhPT0gLTE7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGFtb3VudCBvZiBjYXJkcyBvbiBwaWxlLlxuICAgKlxuICAgKiBAcmV0dXJuIHtudW1iZXJ9IEFtb3VudCBvZiBjYXJkcyBvbiBwaWxlLlxuICAgKi9cbiAgbGVuZ3RoKCkge1xuICAgIHJldHVybiB0aGlzLmNhcmRzLmxlbmd0aDtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBDYXJkUGlsZTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/scripts/h5p-dialogcards-card-pile.js\n");

/***/ }),

/***/ "./src/scripts/h5p-dialogcards-card-pool.js":
/*!**************************************************!*\
  !*** ./src/scripts/h5p-dialogcards-card-pool.js ***!
  \**************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _h5p_dialogcards_card__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./h5p-dialogcards-card */ \"./src/scripts/h5p-dialogcards-card.js\");\n\n\nvar CardPool = /*#__PURE__*/function () {\n  /**\n   * @constructor\n   *\n   * @param {object} params Parameters from content type.\n   * @param {number} contentId Id of content.\n   * @param {object} callbacks Callbacks to main component.\n   */\n  function CardPool(params, contentId, callbacks) {\n    var _this = this;\n\n    this.params = params;\n    this.contentId = contentId;\n    this.callbacks = callbacks;\n    this.cards = [];\n    this.params.dialogs.forEach(function (dialog, index) {\n      dialog.id = index;\n\n      _this.cards.push(index);\n    });\n    return this;\n  }\n  /**\n   * Retrieve a card.\n   *\n   * @param {number} id Id of card to retrieve.\n   */\n\n\n  var _proto = CardPool.prototype;\n\n  _proto.getCard = function getCard(id) {\n    if (id < 0 || id > this.cards.length) {\n      return;\n    } // Replace id with card object if necessary.\n\n\n    if (typeof this.cards[id] === 'number') {\n      this.loadCard(id);\n    }\n\n    return this.cards[id];\n  }\n  /**\n   * Get initial card ids.\n   *\n   * @return {object[]} Card ids.\n   */\n  ;\n\n  _proto.getCardIds = function getCardIds() {\n    return this.cards.map(function (card, index) {\n      return index;\n    });\n  }\n  /**\n   * Load a card if not loaded yet.\n   *\n   * @param {number} id Id of card to load.\n   */\n  ;\n\n  _proto.loadCard = function loadCard(id) {\n    if (id < 0 || id > this.cards.length) {\n      return;\n    }\n\n    if (typeof this.cards[id] === 'number') {\n      this.cards[id] = new _h5p_dialogcards_card__WEBPACK_IMPORTED_MODULE_0__[\"default\"](this.params.dialogs[id], this.params, id, this.contentId, this.callbacks);\n    }\n  };\n\n  return CardPool;\n}();\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (CardPool);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvc2NyaXB0cy9oNXAtZGlhbG9nY2FyZHMtY2FyZC1wb29sLmpzLmpzIiwibWFwcGluZ3MiOiI7O0FBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBOztBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBSUEiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9oNXAtZGlhbG9nY2FyZHMvLi9zcmMvc2NyaXB0cy9oNXAtZGlhbG9nY2FyZHMtY2FyZC1wb29sLmpzP2UwNDEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IENhcmQgZnJvbSAnLi9oNXAtZGlhbG9nY2FyZHMtY2FyZCc7XG5cbmNsYXNzIENhcmRQb29sIHtcbiAgLyoqXG4gICAqIEBjb25zdHJ1Y3RvclxuICAgKlxuICAgKiBAcGFyYW0ge29iamVjdH0gcGFyYW1zIFBhcmFtZXRlcnMgZnJvbSBjb250ZW50IHR5cGUuXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBjb250ZW50SWQgSWQgb2YgY29udGVudC5cbiAgICogQHBhcmFtIHtvYmplY3R9IGNhbGxiYWNrcyBDYWxsYmFja3MgdG8gbWFpbiBjb21wb25lbnQuXG4gICAqL1xuICBjb25zdHJ1Y3RvcihwYXJhbXMsIGNvbnRlbnRJZCwgY2FsbGJhY2tzKSB7XG4gICAgdGhpcy5wYXJhbXMgPSBwYXJhbXM7XG4gICAgdGhpcy5jb250ZW50SWQgPSBjb250ZW50SWQ7XG4gICAgdGhpcy5jYWxsYmFja3MgPSBjYWxsYmFja3M7XG4gICAgdGhpcy5jYXJkcyA9IFtdO1xuXG4gICAgdGhpcy5wYXJhbXMuZGlhbG9ncy5mb3JFYWNoKChkaWFsb2csIGluZGV4KSA9PiB7XG4gICAgICBkaWFsb2cuaWQgPSBpbmRleDtcbiAgICAgIHRoaXMuY2FyZHMucHVzaChpbmRleCk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZSBhIGNhcmQuXG4gICAqXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBpZCBJZCBvZiBjYXJkIHRvIHJldHJpZXZlLlxuICAgKi9cbiAgZ2V0Q2FyZChpZCkge1xuICAgIGlmIChpZCA8IDAgfHwgaWQgPiB0aGlzLmNhcmRzLmxlbmd0aCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIFJlcGxhY2UgaWQgd2l0aCBjYXJkIG9iamVjdCBpZiBuZWNlc3NhcnkuXG4gICAgaWYgKHR5cGVvZiB0aGlzLmNhcmRzW2lkXSA9PT0gJ251bWJlcicpIHtcbiAgICAgIHRoaXMubG9hZENhcmQoaWQpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmNhcmRzW2lkXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgaW5pdGlhbCBjYXJkIGlkcy5cbiAgICpcbiAgICogQHJldHVybiB7b2JqZWN0W119IENhcmQgaWRzLlxuICAgKi9cbiAgZ2V0Q2FyZElkcygpICB7XG4gICAgcmV0dXJuIHRoaXMuY2FyZHMubWFwKChjYXJkLCBpbmRleCkgPT4gaW5kZXgpO1xuICB9XG5cbiAgLyoqXG4gICAqIExvYWQgYSBjYXJkIGlmIG5vdCBsb2FkZWQgeWV0LlxuICAgKlxuICAgKiBAcGFyYW0ge251bWJlcn0gaWQgSWQgb2YgY2FyZCB0byBsb2FkLlxuICAgKi9cbiAgbG9hZENhcmQoaWQpIHtcbiAgICBpZiAoaWQgPCAwIHx8IGlkID4gdGhpcy5jYXJkcy5sZW5ndGgpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAodHlwZW9mIHRoaXMuY2FyZHNbaWRdID09PSAnbnVtYmVyJykge1xuICAgICAgdGhpcy5jYXJkc1tpZF0gPSBuZXcgQ2FyZCh0aGlzLnBhcmFtcy5kaWFsb2dzW2lkXSwgdGhpcy5wYXJhbXMsIGlkLCB0aGlzLmNvbnRlbnRJZCwgdGhpcy5jYWxsYmFja3MpO1xuICAgIH1cbiAgfVxuXG59XG5cbmV4cG9ydCBkZWZhdWx0IENhcmRQb29sO1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/scripts/h5p-dialogcards-card-pool.js\n");

/***/ }),

/***/ "./src/scripts/h5p-dialogcards-card.js":
/*!*********************************************!*\
  !*** ./src/scripts/h5p-dialogcards-card.js ***!
  \*********************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\nvar $ = H5P.jQuery;\n\nvar Card = /*#__PURE__*/function () {\n  /**\n   * @constructor\n   *\n   * @param {object} card Card parameters\n   * @param {object} params Parent's params\n   * @param {number} id Card number in order of appearance\n   * @param {object} [callbacks] Callbacks.\n   * @param {function} [callbacks.onCardSize] Call when card needs resize.\n   * @param {function} [callbacks.onCardTurned] Call when card was turned.\n   */\n  function Card(card, params, id, contentId) {\n    var callbacks = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : {};\n    this.card = card;\n    this.params = params || {};\n    this.id = id;\n    this.contentId = contentId;\n    this.callbacks = callbacks; // Check if to use front settings for back, too\n\n    if (this.card.back.useImageFromFront) {\n      this.card.back.image = this.card.front.image;\n      this.card.back.imageAltText = this.card.front.imageAltText;\n    }\n\n    if (this.card.back.useAudioFromFront) {\n      this.card.back.audio = this.card.front.audio;\n    }\n\n    this.audios = {};\n    this.$audioWrappers = {};\n    this.$cardWrapper = $('<div>', {\n      'class': 'h5p-dialogcards-cardwrap',\n      'role': 'group',\n      'tabindex': '-1'\n    });\n\n    if (this.params.mode !== 'repetition') {\n      this.$cardWrapper.attr('aria-labelledby', 'h5p-dialogcards-progress-' + H5P.Dialogcards.idCounter);\n    }\n\n    this.$cardHolder = $('<div>', {\n      'class': 'h5p-dialogcards-cardholder'\n    }).appendTo(this.$cardWrapper);\n    this.createCardContent(card).appendTo(this.$cardHolder);\n    return this;\n  }\n  /**\n   * Create content for a card\n   *\n   * @param {object} card Card parameters\n   * @returns {*|jQuery|HTMLElement} Card content wrapper\n   */\n\n\n  var _proto = Card.prototype;\n\n  _proto.createCardContent = function createCardContent(card) {\n    var $cardContent = $('<div>', {\n      'class': 'h5p-dialogcards-card-content'\n    }); // Images\n\n    this.$imageWrapper = $('<div>', {\n      'class': 'h5p-dialogcards-image-wrapper'\n    });\n    this.createCardImage(card, 'front').appendTo(this.$imageWrapper);\n    this.createCardImage(card, 'back').appendTo(this.$imageWrapper);\n    this.$imageWrapper.appendTo($cardContent);\n    var $cardTextWrapper = $('<div>', {\n      'class': 'h5p-dialogcards-card-text-wrapper'\n    }).appendTo($cardContent);\n    var $cardTextInner = $('<div>', {\n      'class': 'h5p-dialogcards-card-text-inner'\n    }).appendTo($cardTextWrapper);\n    var $cardTextInnerContent = $('<div>', {\n      'class': 'h5p-dialogcards-card-text-inner-content'\n    }).appendTo($cardTextInner); // Front audio\n\n    this.$audioWrappers.front = this.createCardAudio(card, 'front').appendTo($cardTextInnerContent); // Back audio\n\n    this.$audioWrappers.back = this.createCardAudio(card, 'back').appendTo($cardTextInnerContent);\n    var $cardText = $('<div>', {\n      'class': 'h5p-dialogcards-card-text'\n    }).appendTo($cardTextInnerContent);\n    this.$cardTextArea = $('<div>', {\n      'class': 'h5p-dialogcards-card-text-area',\n      'tabindex': '-1',\n      'html': card.front.text\n    }).appendTo($cardText);\n    this.createCardFooter().appendTo($cardTextWrapper);\n    return $cardContent;\n  }\n  /**\n   * Create card image\n   *\n   * @param {object} card Card parameters\n   * @param {string} side Side, either front or back.\n   * @returns {*|jQuery|HTMLElement} Card image wrapper\n   */\n  ;\n\n  _proto.createCardImage = function createCardImage(card, side) {\n    var $image;\n\n    if (card[side].image !== undefined) {\n      $image = $('<img class=\"h5p-dialogcards-image\" src=\"' + H5P.getPath(card[side].image.path, this.contentId) + '\"/>');\n      $image.addClass(\"h5p-dialogcards-image-\".concat(side)); // KidsLoop customization to prevent dragging the image\n\n      $image.get(0).addEventListener('dragstart', function (event) {\n        event.preventDefault();\n      });\n      /*\n       * KidsLoop customization to prevent saving images on Android. Cannot\n       * use CSS `pointer-events: none`, because it interferes with dragstart\n       */\n\n      $image.get(0).addEventListener('contextmenu', function (event) {\n        event.preventDefault();\n        return false;\n      }); // KidsLoop customization to prevent dragging the image on iOS\n\n      $image.css({\n        'user-select': 'none',\n        '-webkit-user-select': 'none',\n        '-webkit-touch-callout': 'none'\n      });\n\n      if (card[side].imageAltText) {\n        $image.attr('alt', card[side].imageAltText);\n      }\n    } else {\n      $image = $('<div class=\"h5p-dialogcards-image\"></div>');\n    }\n\n    return $image;\n  }\n  /**\n   * Create card audio.\n   *\n   * @param {object} card Card parameters.\n   * @param {string} side Side, either front or back.\n   * @returns {*|jQuery|HTMLElement} Card audio element.\n   */\n  ;\n\n  _proto.createCardAudio = function createCardAudio(card) {\n    var side = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'front';\n    var $audioWrapper = $('<div>').addClass('h5p-dialogcards-audio-wrapper').addClass(\"h5p-dialogcards-audio-wrapper-\".concat(side));\n\n    if (!card[side].text || card[side].text === '') {\n      $audioWrapper.addClass('h5p-no-text');\n    }\n\n    if (card[side].audio !== undefined) {\n      var audioDefaults = {\n        files: card[side].audio,\n        audioNotSupported: this.params.audioNotSupported\n      };\n      var audio = new H5P.Audio(audioDefaults, this.contentId);\n      this.audios[side] = audio;\n      audio.attach($audioWrapper); // Have to stop else audio will take up a socket pending forever in chrome.\n\n      if (audio.audio && audio.audio.preload) {\n        audio.audio.preload = 'none';\n      }\n    } else {\n      $audioWrapper.addClass('hide');\n    }\n\n    return $audioWrapper;\n  }\n  /**\n   * Create card footer\n   *\n   * @returns {*|jQuery|HTMLElement} Card footer element\n   */\n  ;\n\n  _proto.createCardFooter = function createCardFooter() {\n    var $cardFooter = $('<div>', {\n      'class': 'h5p-dialogcards-card-footer'\n    });\n    var classesRepetition = 'h5p-dialogcards-button-hidden';\n    var attributeTabindex = '-1';\n\n    if (this.params.mode === 'repetition') {\n      classesRepetition = '';\n\n      if (this.params.behaviour.quickProgression) {\n        classesRepetition = 'h5p-dialogcards-quick-progression';\n        attributeTabindex = '0';\n      }\n\n      $cardFooter.addClass('h5p-repetition');\n    }\n\n    this.$buttonTurn = H5P.JoubelUI.createButton({\n      'class': 'h5p-dialogcards-turn',\n      'html': this.params.answer\n    }).appendTo($cardFooter);\n    this.$buttonShowSummary = H5P.JoubelUI.createButton({\n      'class': 'h5p-dialogcards-show-summary h5p-dialogcards-button-gone',\n      'html': this.params.showSummary\n    }).appendTo($cardFooter);\n    this.$buttonIncorrect = H5P.JoubelUI.createButton({\n      'class': 'h5p-dialogcards-answer-button',\n      'html': this.params.incorrectAnswer\n    }).addClass('incorrect').addClass(classesRepetition).attr('tabindex', attributeTabindex).appendTo($cardFooter);\n    this.$buttonCorrect = H5P.JoubelUI.createButton({\n      'class': 'h5p-dialogcards-answer-button',\n      'html': this.params.correctAnswer\n    }).addClass('correct').addClass(classesRepetition).attr('tabindex', attributeTabindex).appendTo($cardFooter);\n    return $cardFooter;\n  }\n  /**\n   * Create button listeners.\n   * Will be lost when the element is removed from DOM.\n   */\n  ;\n\n  _proto.createButtonListeners = function createButtonListeners() {\n    var _this = this;\n\n    this.$buttonIncorrect.unbind('click').click(function (event) {\n      if (!event.target.classList.contains('h5p-dialogcards-quick-progression')) {\n        return;\n      }\n\n      _this.callbacks.onNextCard({\n        cardId: _this.id,\n        result: false\n      });\n    });\n    this.$buttonTurn.unbind('click').click(function () {\n      _this.turnCard();\n    });\n    this.$buttonCorrect.unbind('click').click(function (event) {\n      if (!event.target.classList.contains('h5p-dialogcards-quick-progression')) {\n        return;\n      }\n\n      _this.callbacks.onNextCard({\n        cardId: _this.id,\n        result: true\n      });\n    });\n  }\n  /**\n   * Show summary button on last card.\n   *\n   * @param {function} callback Callback called on button click.\n   */\n  ;\n\n  _proto.showSummaryButton = function showSummaryButton(callback) {\n    // Hide answer buttons\n    this.getDOM().find('.h5p-dialogcards-answer-button').addClass('h5p-dialogcards-button-hidden').attr('tabindex', '-1'); // Swap turn button with show summary button\n\n    this.$buttonTurn.addClass('h5p-dialogcards-button-gone');\n    this.$buttonShowSummary.click(function () {\n      return callback();\n    }).removeClass('h5p-dialogcards-button-gone').focus();\n  }\n  /**\n   * Hide summary button and show answer buttons again.\n   */\n  ;\n\n  _proto.hideSummaryButton = function hideSummaryButton() {\n    if (this.params.mode === 'normal') {\n      return;\n    }\n\n    this.getDOM().find('.h5p-dialogcards-answer-button').removeClass('h5p-dialogcards-button-hidden').attr('tabindex', '0'); // Swap turn button with show summary button\n\n    this.$buttonTurn.removeClass('h5p-dialogcards-button-gone');\n    this.$buttonShowSummary.addClass('h5p-dialogcards-button-gone');\n  }\n  /**\n   * Show the opposite side of the card.\n   */\n  ;\n\n  _proto.turnCard = function turnCard() {\n    var _this2 = this;\n\n    var $card = this.getDOM();\n    var $c = $card.find('.h5p-dialogcards-card-content');\n    var $ch = $card.find('.h5p-dialogcards-cardholder').addClass('h5p-dialogcards-collapse'); // Removes tip, since it destroys the animation:\n\n    $c.find('.joubel-tip-container').remove();\n    setTimeout(function () {\n      // Check if card has been turned before\n      var turned = _this2.isTurned(); // Update HTML class for card\n\n\n      $c.toggleClass('h5p-dialogcards-turned', !turned);\n      $ch.removeClass('h5p-dialogcards-collapse');\n\n      _this2.changeText(turned ? _this2.getText() : _this2.getAnswer()); // Image shown/hidden via CSS\n      // Audio buttons shown/hidden via CSS\n\n\n      _this2.stopAudio(); // Toggle state for knowledge confirmation buttons\n\n\n      if (_this2.params.mode === 'repetition' && !_this2.params.behaviour.quickProgression) {\n        var $answerButtons = $card.find('.h5p-dialogcards-answer-button'); // Don't revoke quick progression after card was turned.\n\n        if ($answerButtons.hasClass('h5p-dialogcards-quick-progression') === false) {\n          $answerButtons.addClass('h5p-dialogcards-quick-progression').attr('tabindex', 0);\n        }\n      } // Add backside tip\n      // Had to wait a little, if not Chrome will displace tip icon\n\n\n      setTimeout(function () {\n        _this2.addTipToCard($c, turned ? 'front' : 'back');\n\n        if (typeof _this2.callbacks.onCardTurned === 'function') {\n          _this2.callbacks.onCardTurned(turned);\n        }\n      }, 200);\n\n      _this2.resizeOverflowingText(); // Focus text\n\n\n      _this2.$cardTextArea.focus();\n    }, 200);\n  }\n  /**\n   * Change text of card, used when turning cards.\n   *\n   * @param {string} text Text to set.\n   */\n  ;\n\n  _proto.changeText = function changeText(text) {\n    this.$cardTextArea.html(text);\n    this.$cardTextArea.toggleClass('hide', !text || !text.length);\n  }\n  /**\n   * Set progress for assistive technologies.\n   * @param {number} position Position.\n   * @param {number} max Maximum position.\n   */\n  ;\n\n  _proto.setProgressText = function setProgressText(position, total) {\n    if (this.params.mode !== 'repetition') {\n      return;\n    }\n\n    var progressText = this.params.progressText.replace('@card', position.toString()).replace('@total', total.toString());\n    this.$cardWrapper.attr('aria-label', progressText);\n  }\n  /**\n   * Resize the font-size of text areas that tend to overflow when dialog cards\n   * is squeezed into a tiny container.\n   */\n  ;\n\n  _proto.resizeOverflowingText = function resizeOverflowingText() {\n    if (!this.params.behaviour.scaleTextNotCard) {\n      return; // No text scaling today\n    } // Resize card text if needed\n\n\n    var $textContainer = this.getDOM().find('.h5p-dialogcards-card-text');\n    var $text = $textContainer.children();\n    this.resizeTextToFitContainer($textContainer, $text);\n  }\n  /**\n   * Increase or decrease font size so text wil fit inside container.\n   *\n   * @param {jQuery} $textContainer Outer container, must have a set size.\n   * @param {jQuery} $text Inner text container\n   */\n  ;\n\n  _proto.resizeTextToFitContainer = function resizeTextToFitContainer($textContainer, $text) {\n    // Reset text size\n    $text.css('font-size', '');\n\n    if (window.orientation === 90) {\n      var textInner = this.getDOM().find('.h5p-dialogcards-card-text-inner').get(0);\n\n      if (textInner.clientHeight < textInner.scrollHeight) {\n        var fontSize = parseFloat($text.css('font-size'));\n\n        while (fontSize > Card.MINSCALE && textInner.clientHeight < textInner.scrollHeight) {\n          fontSize -= Card.SCALEINTERVAL;\n          $text.css('font-size', \"\".concat(fontSize, \"px\"));\n        }\n      }\n    } else {\n      // Measure container and text height\n      var currentTextContainerHeight = $textContainer.get(0).getBoundingClientRect().height;\n      var currentTextHeight = $text.get(0).getBoundingClientRect().height;\n      var parentFontSize = parseFloat($textContainer.css('font-size'));\n\n      var _fontSize = parseFloat($text.css('font-size'));\n\n      var $inner = this.getDOM().closest('.h5p-container');\n      var mainFontSize = parseFloat($inner.css('font-size')); // Decrease font size\n\n      if (currentTextHeight > currentTextContainerHeight) {\n        var decreaseFontSize = true;\n\n        while (decreaseFontSize) {\n          _fontSize -= Card.SCALEINTERVAL;\n\n          if (_fontSize < Card.MINSCALE) {\n            decreaseFontSize = false;\n            break;\n          }\n\n          $text.css('font-size', _fontSize / parentFontSize + 'em');\n          currentTextHeight = $text.get(0).getBoundingClientRect().height;\n\n          if (currentTextHeight <= currentTextContainerHeight) {\n            decreaseFontSize = false;\n          }\n        }\n      } else {\n        // Increase font size\n        var increaseFontSize = true;\n\n        while (increaseFontSize) {\n          _fontSize += Card.SCALEINTERVAL; // Cap at  16px\n\n          if (_fontSize > mainFontSize) {\n            increaseFontSize = false;\n            break;\n          } // Set relative font size to scale with full screen.\n\n\n          $text.css('font-size', _fontSize / parentFontSize + 'em');\n          currentTextHeight = $text.get(0).getBoundingClientRect().height;\n\n          if (currentTextHeight >= currentTextContainerHeight) {\n            increaseFontSize = false;\n            _fontSize = _fontSize - Card.SCALEINTERVAL;\n            $text.css('font-size', _fontSize / parentFontSize + 'em');\n          }\n        }\n      }\n    }\n  }\n  /**\n   * Adds tip to a card\n   *\n   * @param {jQuery} $card The card\n   * @param {String} [side=front] Which side of the card\n   * @param {Number} [index] Index of card\n   */\n  ;\n\n  _proto.addTipToCard = function addTipToCard($card, side, index) {\n    // Make sure we have a side\n    if (side !== 'back') {\n      side = 'front';\n    } // Make sure we have an index\n\n\n    if (index === undefined) {\n      index = this.id;\n    } // Remove any old tips\n\n\n    $card.find('.joubel-tip-container').remove(); // Add new tip if set and has length after trim\n\n    var tip = (this.card[side].tip || '').trim();\n\n    if (tip.length) {\n      $card.find('.h5p-dialogcards-card-text-wrapper .h5p-dialogcards-card-text-inner').after(H5P.JoubelUI.createTip(tip, {\n        tipLabel: this.params.tipButtonLabel\n      }));\n    }\n  }\n  /**\n   * Set focus to a given card.\n   * @param {boolean} force If true, don't wait for transition.\n   */\n  ;\n\n  _proto.setCardFocus = function setCardFocus(force) {\n    if (force === true) {\n      this.$cardTextArea.focus();\n    } else {\n      // Wait for transition, then set focus\n      var $card = this.getDOM();\n      $card.one('transitionend', function () {\n        $card.focus();\n      });\n    }\n  }\n  /**\n   * Stop audio of card.\n   */\n  ;\n\n  _proto.stopAudio = function stopAudio() {\n    var _this3 = this;\n\n    var sides = ['front', 'back'];\n    sides.forEach(function (side) {\n      if (!_this3.audios[side] || !_this3.audios[side].audio) {\n        return;\n      }\n      /*\n       * We need to reset the audio button to its initial visual state, but it\n       * doesn't have a function to to that -> force ended event and reload.\n       */\n\n\n      if (_this3.audios[side].audio.duration > 0) {\n        _this3.audios[side].audio.pause();\n\n        _this3.audios[side].audio.currentTime = Math.floor(_this3.audios[side].audio.duration);\n      }\n\n      if (_this3.audios[side].audio.load) {\n        setTimeout(function () {\n          _this3.audios[side].audio.load();\n        }, 100);\n      }\n    });\n  }\n  /**\n   * Get card's DOM\n   *\n   * @return {jQuery} Card's DOM.\n   */\n  ;\n\n  _proto.getDOM = function getDOM() {\n    return this.$cardWrapper;\n  }\n  /**\n   * Set no text mode.\n   */\n  ;\n\n  _proto.setNoText = function setNoText() {\n    this.getDOM().addClass('h5p-no-text');\n  }\n  /**\n   * Get card's text.\n   *\n   * @return {string} Card's text.\n   */\n  ;\n\n  _proto.getText = function getText() {\n    return this.card.front.text;\n  }\n  /**\n   * Get card's answer.\n   *\n   * @return {string} Card's answer.\n   */\n  ;\n\n  _proto.getAnswer = function getAnswer() {\n    return this.card.back.text;\n  }\n  /**\n   * Get card's image wrapper.\n   *\n   * @return {jQuery} Card's image.\n   */\n  ;\n\n  _proto.getImageWrapper = function getImageWrapper() {\n    return this.$imageWrapper;\n  }\n  /**\n   * Set card image height.\n   * @param {string} height CSS height value.\n   */\n  ;\n\n  _proto.setImageHeight = function setImageHeight(height) {\n    this.$imageWrapper.css('height', height);\n  }\n  /**\n   * Get card's Audio.\n   *\n   * @return {Element} Card's audio.\n   */\n  ;\n\n  _proto.getAudio = function getAudio() {\n    return this.isTurned() ? this.$audioWrappers.back : this.$audioWrappers.front;\n  }\n  /**\n   * Detect whether card is turned.\n   * @return {boolean} True, if card is turned.\n   */\n  ;\n\n  _proto.isTurned = function isTurned() {\n    return this.getDOM().find('.h5p-dialogcards-card-content').hasClass('h5p-dialogcards-turned');\n  }\n  /**\n   * Reset card.\n   */\n  ;\n\n  _proto.reset = function reset() {\n    var $card = this.getDOM();\n    $card.removeClass('h5p-dialogcards-previous');\n    $card.removeClass('h5p-dialogcards-current');\n    this.changeText(this.getText());\n    var $cardContent = $card.find('.h5p-dialogcards-card-content');\n    $cardContent.removeClass('h5p-dialogcards-turned');\n    this.addTipToCard($cardContent, 'front', this.id);\n\n    if (!this.params.behaviour.quickProgression) {\n      $card.find('.h5p-dialogcards-answer-button').removeClass('h5p-dialogcards-quick-progression');\n    }\n\n    this.hideSummaryButton();\n  };\n\n  return Card;\n}(); // Constants\n\n\nCard.SCALEINTERVAL = 0.2;\nCard.MAXSCALE = 16;\nCard.MINSCALE = 4;\n/* harmony default export */ __webpack_exports__[\"default\"] = (Card);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvc2NyaXB0cy9oNXAtZGlhbG9nY2FyZHMtY2FyZC5qcy5qcyIsIm1hcHBpbmdzIjoiO0FBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUdBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFIQTs7QUFLQTtBQUNBO0FBQ0E7O0FBRUE7QUFBQTtBQUFBO0FBR0E7QUFHQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQUNBO0FBQ0E7QUFDQTtBQURBOztBQUtBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFEQTtBQUlBO0FBQ0E7QUFEQTtBQUlBO0FBQ0E7QUFEQTs7QUFLQTs7QUFJQTtBQUdBO0FBQ0E7QUFEQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFNQTtBQUdBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFIQTs7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUFBO0FBQ0E7O0FBSUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFLQTtBQUNBO0FBQ0E7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUlBO0FBQ0E7O0FBRUE7QUFDQTs7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUZBO0FBS0E7QUFDQTtBQUNBO0FBRkE7QUFLQTtBQUNBO0FBQ0E7QUFGQTtBQVFBO0FBQ0E7QUFDQTtBQUZBO0FBUUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUFBOztBQUNBO0FBR0E7QUFDQTtBQUNBOztBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFFQTtBQUdBO0FBQ0E7QUFFQTtBQUdBO0FBQ0E7QUFDQTs7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7O0FBTUE7QUFHQTtBQUNBO0FBQUE7QUFHQTtBQUVBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBTUE7QUFHQTtBQUVBO0FBRUE7QUFDQTtBQUNBOzs7QUFDQTtBQUFBOztBQUNBO0FBQ0E7QUFDQTs7QUFHQTtBQUVBO0FBQ0E7QUFDQTs7O0FBR0E7QUFFQTs7QUFDQTtBQUlBOzs7QUFDQTs7O0FBR0E7QUFDQTs7QUFHQTtBQUNBO0FBR0E7QUFDQTtBQUdBOzs7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOzs7QUFHQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBSUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBQ0E7O0FBRUE7QUFDQTs7QUFHQTtBQUNBOztBQUNBO0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFFQTs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTs7QUFDQTtBQUNBOztBQUdBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBOztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFJQTtBQUNBO0FBQ0E7OztBQUdBOztBQUdBOztBQUNBO0FBQ0E7QUFFQTtBQURBO0FBR0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBOzs7QUFDQTtBQUFBOztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTs7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFHQTtBQUVBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBQ0E7QUFDQTs7O0FBR0E7OztBQUNBO0FBQ0E7QUFDQTtBQUVBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vaDVwLWRpYWxvZ2NhcmRzLy4vc3JjL3NjcmlwdHMvaDVwLWRpYWxvZ2NhcmRzLWNhcmQuanM/ZTA4MiJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCAkID0gSDVQLmpRdWVyeTtcblxuY2xhc3MgQ2FyZCB7XG4gIC8qKlxuICAgKiBAY29uc3RydWN0b3JcbiAgICpcbiAgICogQHBhcmFtIHtvYmplY3R9IGNhcmQgQ2FyZCBwYXJhbWV0ZXJzXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBwYXJhbXMgUGFyZW50J3MgcGFyYW1zXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBpZCBDYXJkIG51bWJlciBpbiBvcmRlciBvZiBhcHBlYXJhbmNlXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBbY2FsbGJhY2tzXSBDYWxsYmFja3MuXG4gICAqIEBwYXJhbSB7ZnVuY3Rpb259IFtjYWxsYmFja3Mub25DYXJkU2l6ZV0gQ2FsbCB3aGVuIGNhcmQgbmVlZHMgcmVzaXplLlxuICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBbY2FsbGJhY2tzLm9uQ2FyZFR1cm5lZF0gQ2FsbCB3aGVuIGNhcmQgd2FzIHR1cm5lZC5cbiAgICovXG4gIGNvbnN0cnVjdG9yKGNhcmQsIHBhcmFtcywgaWQsIGNvbnRlbnRJZCwgY2FsbGJhY2tzID0ge30pIHtcbiAgICB0aGlzLmNhcmQgPSBjYXJkO1xuICAgIHRoaXMucGFyYW1zID0gcGFyYW1zIHx8IHt9O1xuICAgIHRoaXMuaWQgPSBpZDtcbiAgICB0aGlzLmNvbnRlbnRJZCA9IGNvbnRlbnRJZDtcbiAgICB0aGlzLmNhbGxiYWNrcyA9IGNhbGxiYWNrcztcblxuICAgIC8vIENoZWNrIGlmIHRvIHVzZSBmcm9udCBzZXR0aW5ncyBmb3IgYmFjaywgdG9vXG4gICAgaWYgKHRoaXMuY2FyZC5iYWNrLnVzZUltYWdlRnJvbUZyb250KSB7XG4gICAgICB0aGlzLmNhcmQuYmFjay5pbWFnZSA9IHRoaXMuY2FyZC5mcm9udC5pbWFnZTtcbiAgICAgIHRoaXMuY2FyZC5iYWNrLmltYWdlQWx0VGV4dCA9IHRoaXMuY2FyZC5mcm9udC5pbWFnZUFsdFRleHQ7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuY2FyZC5iYWNrLnVzZUF1ZGlvRnJvbUZyb250KSB7XG4gICAgICB0aGlzLmNhcmQuYmFjay5hdWRpbyA9IHRoaXMuY2FyZC5mcm9udC5hdWRpbztcbiAgICB9XG5cbiAgICB0aGlzLmF1ZGlvcyA9IHt9O1xuICAgIHRoaXMuJGF1ZGlvV3JhcHBlcnMgPSB7fTtcblxuICAgIHRoaXMuJGNhcmRXcmFwcGVyID0gJCgnPGRpdj4nLCB7XG4gICAgICAnY2xhc3MnOiAnaDVwLWRpYWxvZ2NhcmRzLWNhcmR3cmFwJyxcbiAgICAgICdyb2xlJzogJ2dyb3VwJyxcbiAgICAgICd0YWJpbmRleCc6ICctMSdcbiAgICB9KTtcbiAgICBpZiAodGhpcy5wYXJhbXMubW9kZSAhPT0gJ3JlcGV0aXRpb24nKSB7XG4gICAgICB0aGlzLiRjYXJkV3JhcHBlci5hdHRyKCdhcmlhLWxhYmVsbGVkYnknLCAnaDVwLWRpYWxvZ2NhcmRzLXByb2dyZXNzLScgKyBINVAuRGlhbG9nY2FyZHMuaWRDb3VudGVyKTtcbiAgICB9XG5cbiAgICB0aGlzLiRjYXJkSG9sZGVyID0gJCgnPGRpdj4nLCB7J2NsYXNzJzogJ2g1cC1kaWFsb2djYXJkcy1jYXJkaG9sZGVyJ30pXG4gICAgICAuYXBwZW5kVG8odGhpcy4kY2FyZFdyYXBwZXIpO1xuXG4gICAgdGhpcy5jcmVhdGVDYXJkQ29udGVudChjYXJkKVxuICAgICAgLmFwcGVuZFRvKHRoaXMuJGNhcmRIb2xkZXIpO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGNvbnRlbnQgZm9yIGEgY2FyZFxuICAgKlxuICAgKiBAcGFyYW0ge29iamVjdH0gY2FyZCBDYXJkIHBhcmFtZXRlcnNcbiAgICogQHJldHVybnMgeyp8alF1ZXJ5fEhUTUxFbGVtZW50fSBDYXJkIGNvbnRlbnQgd3JhcHBlclxuICAgKi9cbiAgY3JlYXRlQ2FyZENvbnRlbnQoY2FyZCkge1xuICAgIGNvbnN0ICRjYXJkQ29udGVudCA9ICQoJzxkaXY+Jywge1xuICAgICAgJ2NsYXNzJzogJ2g1cC1kaWFsb2djYXJkcy1jYXJkLWNvbnRlbnQnXG4gICAgfSk7XG5cbiAgICAvLyBJbWFnZXNcbiAgICB0aGlzLiRpbWFnZVdyYXBwZXIgPSAkKCc8ZGl2PicsIHtcbiAgICAgICdjbGFzcyc6ICdoNXAtZGlhbG9nY2FyZHMtaW1hZ2Utd3JhcHBlcidcbiAgICB9KTtcbiAgICB0aGlzLmNyZWF0ZUNhcmRJbWFnZShjYXJkLCAnZnJvbnQnKS5hcHBlbmRUbyh0aGlzLiRpbWFnZVdyYXBwZXIpO1xuICAgIHRoaXMuY3JlYXRlQ2FyZEltYWdlKGNhcmQsICdiYWNrJykuYXBwZW5kVG8odGhpcy4kaW1hZ2VXcmFwcGVyKTtcbiAgICB0aGlzLiRpbWFnZVdyYXBwZXIuYXBwZW5kVG8oJGNhcmRDb250ZW50KTtcblxuICAgIGNvbnN0ICRjYXJkVGV4dFdyYXBwZXIgPSAkKCc8ZGl2PicsIHtcbiAgICAgICdjbGFzcyc6ICdoNXAtZGlhbG9nY2FyZHMtY2FyZC10ZXh0LXdyYXBwZXInXG4gICAgfSkuYXBwZW5kVG8oJGNhcmRDb250ZW50KTtcblxuICAgIGNvbnN0ICRjYXJkVGV4dElubmVyID0gJCgnPGRpdj4nLCB7XG4gICAgICAnY2xhc3MnOiAnaDVwLWRpYWxvZ2NhcmRzLWNhcmQtdGV4dC1pbm5lcidcbiAgICB9KS5hcHBlbmRUbygkY2FyZFRleHRXcmFwcGVyKTtcblxuICAgIGNvbnN0ICRjYXJkVGV4dElubmVyQ29udGVudCA9ICQoJzxkaXY+Jywge1xuICAgICAgJ2NsYXNzJzogJ2g1cC1kaWFsb2djYXJkcy1jYXJkLXRleHQtaW5uZXItY29udGVudCdcbiAgICB9KS5hcHBlbmRUbygkY2FyZFRleHRJbm5lcik7XG5cbiAgICAvLyBGcm9udCBhdWRpb1xuICAgIHRoaXMuJGF1ZGlvV3JhcHBlcnMuZnJvbnQgPSB0aGlzLmNyZWF0ZUNhcmRBdWRpbyhjYXJkLCAnZnJvbnQnKVxuICAgICAgLmFwcGVuZFRvKCRjYXJkVGV4dElubmVyQ29udGVudCk7XG5cbiAgICAvLyBCYWNrIGF1ZGlvXG4gICAgdGhpcy4kYXVkaW9XcmFwcGVycy5iYWNrID0gdGhpcy5jcmVhdGVDYXJkQXVkaW8oY2FyZCwgJ2JhY2snKVxuICAgICAgLmFwcGVuZFRvKCRjYXJkVGV4dElubmVyQ29udGVudCk7XG5cbiAgICBjb25zdCAkY2FyZFRleHQgPSAkKCc8ZGl2PicsIHtcbiAgICAgICdjbGFzcyc6ICdoNXAtZGlhbG9nY2FyZHMtY2FyZC10ZXh0J1xuICAgIH0pLmFwcGVuZFRvKCRjYXJkVGV4dElubmVyQ29udGVudCk7XG5cbiAgICB0aGlzLiRjYXJkVGV4dEFyZWEgPSAkKCc8ZGl2PicsIHtcbiAgICAgICdjbGFzcyc6ICdoNXAtZGlhbG9nY2FyZHMtY2FyZC10ZXh0LWFyZWEnLFxuICAgICAgJ3RhYmluZGV4JzogJy0xJyxcbiAgICAgICdodG1sJzogY2FyZC5mcm9udC50ZXh0XG4gICAgfSkuYXBwZW5kVG8oJGNhcmRUZXh0KTtcblxuICAgIHRoaXMuY3JlYXRlQ2FyZEZvb3RlcigpXG4gICAgICAuYXBwZW5kVG8oJGNhcmRUZXh0V3JhcHBlcik7XG5cbiAgICByZXR1cm4gJGNhcmRDb250ZW50O1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBjYXJkIGltYWdlXG4gICAqXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBjYXJkIENhcmQgcGFyYW1ldGVyc1xuICAgKiBAcGFyYW0ge3N0cmluZ30gc2lkZSBTaWRlLCBlaXRoZXIgZnJvbnQgb3IgYmFjay5cbiAgICogQHJldHVybnMgeyp8alF1ZXJ5fEhUTUxFbGVtZW50fSBDYXJkIGltYWdlIHdyYXBwZXJcbiAgICovXG4gIGNyZWF0ZUNhcmRJbWFnZShjYXJkLCBzaWRlKSB7XG4gICAgbGV0ICRpbWFnZTtcblxuICAgIGlmIChjYXJkW3NpZGVdLmltYWdlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICRpbWFnZSA9ICQoJzxpbWcgY2xhc3M9XCJoNXAtZGlhbG9nY2FyZHMtaW1hZ2VcIiBzcmM9XCInICsgSDVQLmdldFBhdGgoY2FyZFtzaWRlXS5pbWFnZS5wYXRoLCB0aGlzLmNvbnRlbnRJZCkgKyAnXCIvPicpO1xuICAgICAgJGltYWdlLmFkZENsYXNzKGBoNXAtZGlhbG9nY2FyZHMtaW1hZ2UtJHtzaWRlfWApO1xuXG4gICAgICAvLyBLaWRzTG9vcCBjdXN0b21pemF0aW9uIHRvIHByZXZlbnQgZHJhZ2dpbmcgdGhlIGltYWdlXG4gICAgICAkaW1hZ2UuZ2V0KDApLmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdzdGFydCcsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgfSk7XG4gICAgICAvKlxuICAgICAgICogS2lkc0xvb3AgY3VzdG9taXphdGlvbiB0byBwcmV2ZW50IHNhdmluZyBpbWFnZXMgb24gQW5kcm9pZC4gQ2Fubm90XG4gICAgICAgKiB1c2UgQ1NTIGBwb2ludGVyLWV2ZW50czogbm9uZWAsIGJlY2F1c2UgaXQgaW50ZXJmZXJlcyB3aXRoIGRyYWdzdGFydFxuICAgICAgICovXG4gICAgICAkaW1hZ2UuZ2V0KDApLmFkZEV2ZW50TGlzdGVuZXIoJ2NvbnRleHRtZW51JywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH0pO1xuICAgICAgLy8gS2lkc0xvb3AgY3VzdG9taXphdGlvbiB0byBwcmV2ZW50IGRyYWdnaW5nIHRoZSBpbWFnZSBvbiBpT1NcbiAgICAgICRpbWFnZS5jc3Moe1xuICAgICAgICAndXNlci1zZWxlY3QnOiAnbm9uZScsXG4gICAgICAgICctd2Via2l0LXVzZXItc2VsZWN0JzogJ25vbmUnLFxuICAgICAgICAnLXdlYmtpdC10b3VjaC1jYWxsb3V0JzogJ25vbmUnXG4gICAgICB9KTtcblxuICAgICAgaWYgKGNhcmRbc2lkZV0uaW1hZ2VBbHRUZXh0KSB7XG4gICAgICAgICRpbWFnZS5hdHRyKCdhbHQnLCBjYXJkW3NpZGVdLmltYWdlQWx0VGV4dCk7XG4gICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgJGltYWdlID0gJCgnPGRpdiBjbGFzcz1cImg1cC1kaWFsb2djYXJkcy1pbWFnZVwiPjwvZGl2PicpO1xuICAgIH1cblxuICAgIHJldHVybiAkaW1hZ2U7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGNhcmQgYXVkaW8uXG4gICAqXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBjYXJkIENhcmQgcGFyYW1ldGVycy5cbiAgICogQHBhcmFtIHtzdHJpbmd9IHNpZGUgU2lkZSwgZWl0aGVyIGZyb250IG9yIGJhY2suXG4gICAqIEByZXR1cm5zIHsqfGpRdWVyeXxIVE1MRWxlbWVudH0gQ2FyZCBhdWRpbyBlbGVtZW50LlxuICAgKi9cbiAgY3JlYXRlQ2FyZEF1ZGlvKGNhcmQsIHNpZGUgPSAnZnJvbnQnKSB7XG4gICAgY29uc3QgJGF1ZGlvV3JhcHBlciA9ICQoJzxkaXY+JylcbiAgICAgIC5hZGRDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLWF1ZGlvLXdyYXBwZXInKVxuICAgICAgLmFkZENsYXNzKGBoNXAtZGlhbG9nY2FyZHMtYXVkaW8td3JhcHBlci0ke3NpZGV9YCk7XG5cbiAgICBpZiAoIWNhcmRbc2lkZV0udGV4dCB8fCBjYXJkW3NpZGVdLnRleHQgPT09ICcnKSB7XG4gICAgICAkYXVkaW9XcmFwcGVyLmFkZENsYXNzKCdoNXAtbm8tdGV4dCcpO1xuICAgIH1cblxuICAgIGlmIChjYXJkW3NpZGVdLmF1ZGlvICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGNvbnN0IGF1ZGlvRGVmYXVsdHMgPSB7XG4gICAgICAgIGZpbGVzOiBjYXJkW3NpZGVdLmF1ZGlvLFxuICAgICAgICBhdWRpb05vdFN1cHBvcnRlZDogdGhpcy5wYXJhbXMuYXVkaW9Ob3RTdXBwb3J0ZWRcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IGF1ZGlvID0gbmV3IEg1UC5BdWRpbyhhdWRpb0RlZmF1bHRzLCB0aGlzLmNvbnRlbnRJZCk7XG4gICAgICB0aGlzLmF1ZGlvc1tzaWRlXSA9IGF1ZGlvO1xuICAgICAgYXVkaW8uYXR0YWNoKCRhdWRpb1dyYXBwZXIpO1xuXG4gICAgICAvLyBIYXZlIHRvIHN0b3AgZWxzZSBhdWRpbyB3aWxsIHRha2UgdXAgYSBzb2NrZXQgcGVuZGluZyBmb3JldmVyIGluIGNocm9tZS5cbiAgICAgIGlmIChhdWRpby5hdWRpbyAmJiBhdWRpby5hdWRpby5wcmVsb2FkKSB7XG4gICAgICAgIGF1ZGlvLmF1ZGlvLnByZWxvYWQgPSAnbm9uZSc7XG4gICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgJGF1ZGlvV3JhcHBlci5hZGRDbGFzcygnaGlkZScpO1xuICAgIH1cblxuICAgIHJldHVybiAkYXVkaW9XcmFwcGVyO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBjYXJkIGZvb3RlclxuICAgKlxuICAgKiBAcmV0dXJucyB7KnxqUXVlcnl8SFRNTEVsZW1lbnR9IENhcmQgZm9vdGVyIGVsZW1lbnRcbiAgICovXG4gIGNyZWF0ZUNhcmRGb290ZXIoKSB7XG4gICAgY29uc3QgJGNhcmRGb290ZXIgPSAkKCc8ZGl2PicsIHtcbiAgICAgICdjbGFzcyc6ICdoNXAtZGlhbG9nY2FyZHMtY2FyZC1mb290ZXInXG4gICAgfSk7XG5cbiAgICBsZXQgY2xhc3Nlc1JlcGV0aXRpb24gPSAnaDVwLWRpYWxvZ2NhcmRzLWJ1dHRvbi1oaWRkZW4nO1xuICAgIGxldCBhdHRyaWJ1dGVUYWJpbmRleCA9ICctMSc7XG5cbiAgICBpZiAodGhpcy5wYXJhbXMubW9kZSA9PT0gJ3JlcGV0aXRpb24nKSB7XG4gICAgICBjbGFzc2VzUmVwZXRpdGlvbiA9ICcnO1xuICAgICAgaWYgKHRoaXMucGFyYW1zLmJlaGF2aW91ci5xdWlja1Byb2dyZXNzaW9uKSB7XG4gICAgICAgIGNsYXNzZXNSZXBldGl0aW9uID0gJ2g1cC1kaWFsb2djYXJkcy1xdWljay1wcm9ncmVzc2lvbic7XG4gICAgICAgIGF0dHJpYnV0ZVRhYmluZGV4ID0gJzAnO1xuICAgICAgfVxuXG4gICAgICAkY2FyZEZvb3Rlci5hZGRDbGFzcygnaDVwLXJlcGV0aXRpb24nKTtcbiAgICB9XG5cbiAgICB0aGlzLiRidXR0b25UdXJuID0gSDVQLkpvdWJlbFVJLmNyZWF0ZUJ1dHRvbih7XG4gICAgICAnY2xhc3MnOiAnaDVwLWRpYWxvZ2NhcmRzLXR1cm4nLFxuICAgICAgJ2h0bWwnOiB0aGlzLnBhcmFtcy5hbnN3ZXJcbiAgICB9KS5hcHBlbmRUbygkY2FyZEZvb3Rlcik7XG5cbiAgICB0aGlzLiRidXR0b25TaG93U3VtbWFyeSA9IEg1UC5Kb3ViZWxVSS5jcmVhdGVCdXR0b24oe1xuICAgICAgJ2NsYXNzJzogJ2g1cC1kaWFsb2djYXJkcy1zaG93LXN1bW1hcnkgaDVwLWRpYWxvZ2NhcmRzLWJ1dHRvbi1nb25lJyxcbiAgICAgICdodG1sJzogdGhpcy5wYXJhbXMuc2hvd1N1bW1hcnlcbiAgICB9KS5hcHBlbmRUbygkY2FyZEZvb3Rlcik7XG5cbiAgICB0aGlzLiRidXR0b25JbmNvcnJlY3QgPSBINVAuSm91YmVsVUkuY3JlYXRlQnV0dG9uKHtcbiAgICAgICdjbGFzcyc6ICdoNXAtZGlhbG9nY2FyZHMtYW5zd2VyLWJ1dHRvbicsXG4gICAgICAnaHRtbCc6IHRoaXMucGFyYW1zLmluY29ycmVjdEFuc3dlclxuICAgIH0pLmFkZENsYXNzKCdpbmNvcnJlY3QnKVxuICAgICAgLmFkZENsYXNzKGNsYXNzZXNSZXBldGl0aW9uKVxuICAgICAgLmF0dHIoJ3RhYmluZGV4JywgYXR0cmlidXRlVGFiaW5kZXgpXG4gICAgICAuYXBwZW5kVG8oJGNhcmRGb290ZXIpO1xuXG4gICAgdGhpcy4kYnV0dG9uQ29ycmVjdCA9IEg1UC5Kb3ViZWxVSS5jcmVhdGVCdXR0b24oe1xuICAgICAgJ2NsYXNzJzogJ2g1cC1kaWFsb2djYXJkcy1hbnN3ZXItYnV0dG9uJyxcbiAgICAgICdodG1sJzogdGhpcy5wYXJhbXMuY29ycmVjdEFuc3dlclxuICAgIH0pLmFkZENsYXNzKCdjb3JyZWN0JylcbiAgICAgIC5hZGRDbGFzcyhjbGFzc2VzUmVwZXRpdGlvbilcbiAgICAgIC5hdHRyKCd0YWJpbmRleCcsIGF0dHJpYnV0ZVRhYmluZGV4KVxuICAgICAgLmFwcGVuZFRvKCRjYXJkRm9vdGVyKTtcblxuICAgIHJldHVybiAkY2FyZEZvb3RlcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYnV0dG9uIGxpc3RlbmVycy5cbiAgICogV2lsbCBiZSBsb3N0IHdoZW4gdGhlIGVsZW1lbnQgaXMgcmVtb3ZlZCBmcm9tIERPTS5cbiAgICovXG4gIGNyZWF0ZUJ1dHRvbkxpc3RlbmVycygpIHtcbiAgICB0aGlzLiRidXR0b25JbmNvcnJlY3RcbiAgICAgIC51bmJpbmQoJ2NsaWNrJylcbiAgICAgIC5jbGljayhldmVudCA9PiB7XG4gICAgICAgIGlmICghZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnaDVwLWRpYWxvZ2NhcmRzLXF1aWNrLXByb2dyZXNzaW9uJykpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jYWxsYmFja3Mub25OZXh0Q2FyZCh7Y2FyZElkOiB0aGlzLmlkLCByZXN1bHQ6IGZhbHNlfSk7XG4gICAgICB9KTtcblxuICAgIHRoaXMuJGJ1dHRvblR1cm5cbiAgICAgIC51bmJpbmQoJ2NsaWNrJylcbiAgICAgIC5jbGljaygoKSA9PiB7XG4gICAgICAgIHRoaXMudHVybkNhcmQoKTtcbiAgICAgIH0pO1xuXG4gICAgdGhpcy4kYnV0dG9uQ29ycmVjdFxuICAgICAgLnVuYmluZCgnY2xpY2snKVxuICAgICAgLmNsaWNrKGV2ZW50ID0+IHtcbiAgICAgICAgaWYgKCFldmVudC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdoNXAtZGlhbG9nY2FyZHMtcXVpY2stcHJvZ3Jlc3Npb24nKSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNhbGxiYWNrcy5vbk5leHRDYXJkKHtjYXJkSWQ6IHRoaXMuaWQsIHJlc3VsdDogdHJ1ZX0pO1xuICAgICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogU2hvdyBzdW1tYXJ5IGJ1dHRvbiBvbiBsYXN0IGNhcmQuXG4gICAqXG4gICAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGNhbGxlZCBvbiBidXR0b24gY2xpY2suXG4gICAqL1xuICBzaG93U3VtbWFyeUJ1dHRvbihjYWxsYmFjaykge1xuICAgIC8vIEhpZGUgYW5zd2VyIGJ1dHRvbnNcbiAgICB0aGlzLmdldERPTSgpXG4gICAgICAuZmluZCgnLmg1cC1kaWFsb2djYXJkcy1hbnN3ZXItYnV0dG9uJylcbiAgICAgIC5hZGRDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLWJ1dHRvbi1oaWRkZW4nKVxuICAgICAgLmF0dHIoJ3RhYmluZGV4JywgJy0xJyk7XG5cbiAgICAvLyBTd2FwIHR1cm4gYnV0dG9uIHdpdGggc2hvdyBzdW1tYXJ5IGJ1dHRvblxuICAgIHRoaXMuJGJ1dHRvblR1cm5cbiAgICAgIC5hZGRDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLWJ1dHRvbi1nb25lJyk7XG5cbiAgICB0aGlzLiRidXR0b25TaG93U3VtbWFyeVxuICAgICAgLmNsaWNrKCgpID0+IGNhbGxiYWNrKCkpXG4gICAgICAucmVtb3ZlQ2xhc3MoJ2g1cC1kaWFsb2djYXJkcy1idXR0b24tZ29uZScpXG4gICAgICAuZm9jdXMoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIaWRlIHN1bW1hcnkgYnV0dG9uIGFuZCBzaG93IGFuc3dlciBidXR0b25zIGFnYWluLlxuICAgKi9cbiAgaGlkZVN1bW1hcnlCdXR0b24oKSB7XG4gICAgaWYgKHRoaXMucGFyYW1zLm1vZGUgPT09ICdub3JtYWwnKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5nZXRET00oKVxuICAgICAgLmZpbmQoJy5oNXAtZGlhbG9nY2FyZHMtYW5zd2VyLWJ1dHRvbicpXG4gICAgICAucmVtb3ZlQ2xhc3MoJ2g1cC1kaWFsb2djYXJkcy1idXR0b24taGlkZGVuJylcbiAgICAgIC5hdHRyKCd0YWJpbmRleCcsICcwJyk7XG5cbiAgICAvLyBTd2FwIHR1cm4gYnV0dG9uIHdpdGggc2hvdyBzdW1tYXJ5IGJ1dHRvblxuICAgIHRoaXMuJGJ1dHRvblR1cm5cbiAgICAgIC5yZW1vdmVDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLWJ1dHRvbi1nb25lJyk7XG5cbiAgICB0aGlzLiRidXR0b25TaG93U3VtbWFyeVxuICAgICAgLmFkZENsYXNzKCdoNXAtZGlhbG9nY2FyZHMtYnV0dG9uLWdvbmUnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTaG93IHRoZSBvcHBvc2l0ZSBzaWRlIG9mIHRoZSBjYXJkLlxuICAgKi9cbiAgdHVybkNhcmQoKSB7XG4gICAgY29uc3QgJGNhcmQgPSB0aGlzLmdldERPTSgpO1xuICAgIGNvbnN0ICRjID0gJGNhcmQuZmluZCgnLmg1cC1kaWFsb2djYXJkcy1jYXJkLWNvbnRlbnQnKTtcbiAgICBjb25zdCAkY2ggPSAkY2FyZC5maW5kKCcuaDVwLWRpYWxvZ2NhcmRzLWNhcmRob2xkZXInKS5hZGRDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLWNvbGxhcHNlJyk7XG5cbiAgICAvLyBSZW1vdmVzIHRpcCwgc2luY2UgaXQgZGVzdHJveXMgdGhlIGFuaW1hdGlvbjpcbiAgICAkYy5maW5kKCcuam91YmVsLXRpcC1jb250YWluZXInKS5yZW1vdmUoKTtcblxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgLy8gQ2hlY2sgaWYgY2FyZCBoYXMgYmVlbiB0dXJuZWQgYmVmb3JlXG4gICAgICBjb25zdCB0dXJuZWQgPSB0aGlzLmlzVHVybmVkKCk7XG5cbiAgICAgIC8vIFVwZGF0ZSBIVE1MIGNsYXNzIGZvciBjYXJkXG4gICAgICAkYy50b2dnbGVDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLXR1cm5lZCcsICF0dXJuZWQpO1xuXG4gICAgICAkY2gucmVtb3ZlQ2xhc3MoJ2g1cC1kaWFsb2djYXJkcy1jb2xsYXBzZScpO1xuICAgICAgdGhpcy5jaGFuZ2VUZXh0KHR1cm5lZCA/IHRoaXMuZ2V0VGV4dCgpIDogdGhpcy5nZXRBbnN3ZXIoKSk7XG5cbiAgICAgIC8vIEltYWdlIHNob3duL2hpZGRlbiB2aWEgQ1NTXG5cbiAgICAgIC8vIEF1ZGlvIGJ1dHRvbnMgc2hvd24vaGlkZGVuIHZpYSBDU1NcbiAgICAgIHRoaXMuc3RvcEF1ZGlvKCk7XG5cbiAgICAgIC8vIFRvZ2dsZSBzdGF0ZSBmb3Iga25vd2xlZGdlIGNvbmZpcm1hdGlvbiBidXR0b25zXG4gICAgICBpZiAodGhpcy5wYXJhbXMubW9kZSA9PT0gJ3JlcGV0aXRpb24nICYmICF0aGlzLnBhcmFtcy5iZWhhdmlvdXIucXVpY2tQcm9ncmVzc2lvbikge1xuICAgICAgICBjb25zdCAkYW5zd2VyQnV0dG9ucyA9ICRjYXJkLmZpbmQoJy5oNXAtZGlhbG9nY2FyZHMtYW5zd2VyLWJ1dHRvbicpO1xuXG4gICAgICAgIC8vIERvbid0IHJldm9rZSBxdWljayBwcm9ncmVzc2lvbiBhZnRlciBjYXJkIHdhcyB0dXJuZWQuXG4gICAgICAgIGlmICgkYW5zd2VyQnV0dG9ucy5oYXNDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLXF1aWNrLXByb2dyZXNzaW9uJykgPT09IGZhbHNlKSB7XG4gICAgICAgICAgJGFuc3dlckJ1dHRvbnNcbiAgICAgICAgICAgIC5hZGRDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLXF1aWNrLXByb2dyZXNzaW9uJylcbiAgICAgICAgICAgIC5hdHRyKCd0YWJpbmRleCcsIDApO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIEFkZCBiYWNrc2lkZSB0aXBcbiAgICAgIC8vIEhhZCB0byB3YWl0IGEgbGl0dGxlLCBpZiBub3QgQ2hyb21lIHdpbGwgZGlzcGxhY2UgdGlwIGljb25cbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICB0aGlzLmFkZFRpcFRvQ2FyZCgkYywgdHVybmVkID8gJ2Zyb250JyA6ICdiYWNrJyk7XG5cbiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLmNhbGxiYWNrcy5vbkNhcmRUdXJuZWQgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICB0aGlzLmNhbGxiYWNrcy5vbkNhcmRUdXJuZWQodHVybmVkKTtcbiAgICAgICAgfVxuICAgICAgfSwgMjAwKTtcblxuICAgICAgdGhpcy5yZXNpemVPdmVyZmxvd2luZ1RleHQoKTtcblxuICAgICAgLy8gRm9jdXMgdGV4dFxuICAgICAgdGhpcy4kY2FyZFRleHRBcmVhLmZvY3VzKCk7XG4gICAgfSwgMjAwKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGFuZ2UgdGV4dCBvZiBjYXJkLCB1c2VkIHdoZW4gdHVybmluZyBjYXJkcy5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IHRleHQgVGV4dCB0byBzZXQuXG4gICAqL1xuICBjaGFuZ2VUZXh0KHRleHQpIHtcbiAgICB0aGlzLiRjYXJkVGV4dEFyZWEuaHRtbCh0ZXh0KTtcbiAgICB0aGlzLiRjYXJkVGV4dEFyZWEudG9nZ2xlQ2xhc3MoJ2hpZGUnLCAoIXRleHQgfHwgIXRleHQubGVuZ3RoKSk7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHByb2dyZXNzIGZvciBhc3Npc3RpdmUgdGVjaG5vbG9naWVzLlxuICAgKiBAcGFyYW0ge251bWJlcn0gcG9zaXRpb24gUG9zaXRpb24uXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBtYXggTWF4aW11bSBwb3NpdGlvbi5cbiAgICovXG4gIHNldFByb2dyZXNzVGV4dChwb3NpdGlvbiwgdG90YWwpIHtcbiAgICBpZiAodGhpcy5wYXJhbXMubW9kZSAhPT0gJ3JlcGV0aXRpb24nKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgcHJvZ3Jlc3NUZXh0ID0gdGhpcy5wYXJhbXMucHJvZ3Jlc3NUZXh0XG4gICAgICAucmVwbGFjZSgnQGNhcmQnLCAocG9zaXRpb24pLnRvU3RyaW5nKCkpXG4gICAgICAucmVwbGFjZSgnQHRvdGFsJywgKHRvdGFsKS50b1N0cmluZygpKTtcblxuICAgIHRoaXMuJGNhcmRXcmFwcGVyLmF0dHIoJ2FyaWEtbGFiZWwnLCBwcm9ncmVzc1RleHQpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlc2l6ZSB0aGUgZm9udC1zaXplIG9mIHRleHQgYXJlYXMgdGhhdCB0ZW5kIHRvIG92ZXJmbG93IHdoZW4gZGlhbG9nIGNhcmRzXG4gICAqIGlzIHNxdWVlemVkIGludG8gYSB0aW55IGNvbnRhaW5lci5cbiAgICovXG4gIHJlc2l6ZU92ZXJmbG93aW5nVGV4dCgpIHtcbiAgICBpZiAoIXRoaXMucGFyYW1zLmJlaGF2aW91ci5zY2FsZVRleHROb3RDYXJkKSB7XG4gICAgICByZXR1cm47IC8vIE5vIHRleHQgc2NhbGluZyB0b2RheVxuICAgIH1cblxuICAgIC8vIFJlc2l6ZSBjYXJkIHRleHQgaWYgbmVlZGVkXG4gICAgY29uc3QgJHRleHRDb250YWluZXIgPSB0aGlzLmdldERPTSgpLmZpbmQoJy5oNXAtZGlhbG9nY2FyZHMtY2FyZC10ZXh0Jyk7XG4gICAgY29uc3QgJHRleHQgPSAkdGV4dENvbnRhaW5lci5jaGlsZHJlbigpO1xuICAgIHRoaXMucmVzaXplVGV4dFRvRml0Q29udGFpbmVyKCR0ZXh0Q29udGFpbmVyLCAkdGV4dCk7XG4gIH1cblxuICAvKipcbiAgICogSW5jcmVhc2Ugb3IgZGVjcmVhc2UgZm9udCBzaXplIHNvIHRleHQgd2lsIGZpdCBpbnNpZGUgY29udGFpbmVyLlxuICAgKlxuICAgKiBAcGFyYW0ge2pRdWVyeX0gJHRleHRDb250YWluZXIgT3V0ZXIgY29udGFpbmVyLCBtdXN0IGhhdmUgYSBzZXQgc2l6ZS5cbiAgICogQHBhcmFtIHtqUXVlcnl9ICR0ZXh0IElubmVyIHRleHQgY29udGFpbmVyXG4gICAqL1xuICByZXNpemVUZXh0VG9GaXRDb250YWluZXIoJHRleHRDb250YWluZXIsICR0ZXh0KSB7XG4gICAgLy8gUmVzZXQgdGV4dCBzaXplXG4gICAgJHRleHQuY3NzKCdmb250LXNpemUnLCAnJyk7XG5cbiAgICBpZiAod2luZG93Lm9yaWVudGF0aW9uID09PSA5MCkge1xuICAgICAgY29uc3QgdGV4dElubmVyID0gdGhpcy5nZXRET00oKS5maW5kKCcuaDVwLWRpYWxvZ2NhcmRzLWNhcmQtdGV4dC1pbm5lcicpLmdldCgwKTtcblxuICAgICAgaWYgKHRleHRJbm5lci5jbGllbnRIZWlnaHQgPCB0ZXh0SW5uZXIuc2Nyb2xsSGVpZ2h0KSB7XG4gICAgICAgIGxldCBmb250U2l6ZSA9IHBhcnNlRmxvYXQoJHRleHQuY3NzKCdmb250LXNpemUnKSk7XG4gICAgICAgIHdoaWxlIChmb250U2l6ZSA+IENhcmQuTUlOU0NBTEUgJiYgdGV4dElubmVyLmNsaWVudEhlaWdodCA8IHRleHRJbm5lci5zY3JvbGxIZWlnaHQpIHtcbiAgICAgICAgICBmb250U2l6ZSAtPSBDYXJkLlNDQUxFSU5URVJWQUw7XG4gICAgICAgICAgJHRleHQuY3NzKCdmb250LXNpemUnLCBgJHtmb250U2l6ZX1weGApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgLy8gTWVhc3VyZSBjb250YWluZXIgYW5kIHRleHQgaGVpZ2h0XG4gICAgICBjb25zdCBjdXJyZW50VGV4dENvbnRhaW5lckhlaWdodCA9ICR0ZXh0Q29udGFpbmVyLmdldCgwKS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5oZWlnaHQ7XG4gICAgICBsZXQgY3VycmVudFRleHRIZWlnaHQgPSAkdGV4dC5nZXQoMCkuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkuaGVpZ2h0O1xuICAgICAgY29uc3QgcGFyZW50Rm9udFNpemUgPSBwYXJzZUZsb2F0KCR0ZXh0Q29udGFpbmVyLmNzcygnZm9udC1zaXplJykpO1xuICAgICAgbGV0IGZvbnRTaXplID0gcGFyc2VGbG9hdCgkdGV4dC5jc3MoJ2ZvbnQtc2l6ZScpKTtcblxuICAgICAgY29uc3QgJGlubmVyID0gdGhpcy5nZXRET00oKS5jbG9zZXN0KCcuaDVwLWNvbnRhaW5lcicpO1xuICAgICAgY29uc3QgbWFpbkZvbnRTaXplID0gcGFyc2VGbG9hdCgkaW5uZXIuY3NzKCdmb250LXNpemUnKSk7XG5cbiAgICAgIC8vIERlY3JlYXNlIGZvbnQgc2l6ZVxuICAgICAgaWYgKGN1cnJlbnRUZXh0SGVpZ2h0ID4gY3VycmVudFRleHRDb250YWluZXJIZWlnaHQpIHtcbiAgICAgICAgbGV0IGRlY3JlYXNlRm9udFNpemUgPSB0cnVlO1xuICAgICAgICB3aGlsZSAoZGVjcmVhc2VGb250U2l6ZSkge1xuXG4gICAgICAgICAgZm9udFNpemUgLT0gQ2FyZC5TQ0FMRUlOVEVSVkFMO1xuXG4gICAgICAgICAgaWYgKGZvbnRTaXplIDwgQ2FyZC5NSU5TQ0FMRSkge1xuICAgICAgICAgICAgZGVjcmVhc2VGb250U2l6ZSA9IGZhbHNlO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgJHRleHQuY3NzKCdmb250LXNpemUnLCAoZm9udFNpemUgLyBwYXJlbnRGb250U2l6ZSkgKyAnZW0nKTtcblxuICAgICAgICAgIGN1cnJlbnRUZXh0SGVpZ2h0ID0gJHRleHQuZ2V0KDApLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmhlaWdodDtcbiAgICAgICAgICBpZiAoY3VycmVudFRleHRIZWlnaHQgPD0gY3VycmVudFRleHRDb250YWluZXJIZWlnaHQpIHtcbiAgICAgICAgICAgIGRlY3JlYXNlRm9udFNpemUgPSBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgfVxuICAgICAgZWxzZSB7IC8vIEluY3JlYXNlIGZvbnQgc2l6ZVxuICAgICAgICBsZXQgaW5jcmVhc2VGb250U2l6ZSA9IHRydWU7XG4gICAgICAgIHdoaWxlIChpbmNyZWFzZUZvbnRTaXplKSB7XG4gICAgICAgICAgZm9udFNpemUgKz0gQ2FyZC5TQ0FMRUlOVEVSVkFMO1xuXG4gICAgICAgICAgLy8gQ2FwIGF0ICAxNnB4XG4gICAgICAgICAgaWYgKGZvbnRTaXplID4gbWFpbkZvbnRTaXplKSB7XG4gICAgICAgICAgICBpbmNyZWFzZUZvbnRTaXplID0gZmFsc2U7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBTZXQgcmVsYXRpdmUgZm9udCBzaXplIHRvIHNjYWxlIHdpdGggZnVsbCBzY3JlZW4uXG4gICAgICAgICAgJHRleHQuY3NzKCdmb250LXNpemUnLCBmb250U2l6ZSAvIHBhcmVudEZvbnRTaXplICsgJ2VtJyk7XG4gICAgICAgICAgY3VycmVudFRleHRIZWlnaHQgPSAkdGV4dC5nZXQoMCkuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkuaGVpZ2h0O1xuICAgICAgICAgIGlmIChjdXJyZW50VGV4dEhlaWdodCA+PSBjdXJyZW50VGV4dENvbnRhaW5lckhlaWdodCkge1xuICAgICAgICAgICAgaW5jcmVhc2VGb250U2l6ZSA9IGZhbHNlO1xuICAgICAgICAgICAgZm9udFNpemUgPSBmb250U2l6ZSAtIENhcmQuU0NBTEVJTlRFUlZBTDtcbiAgICAgICAgICAgICR0ZXh0LmNzcygnZm9udC1zaXplJywgZm9udFNpemUgLyBwYXJlbnRGb250U2l6ZSArICdlbScpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBBZGRzIHRpcCB0byBhIGNhcmRcbiAgICpcbiAgICogQHBhcmFtIHtqUXVlcnl9ICRjYXJkIFRoZSBjYXJkXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBbc2lkZT1mcm9udF0gV2hpY2ggc2lkZSBvZiB0aGUgY2FyZFxuICAgKiBAcGFyYW0ge051bWJlcn0gW2luZGV4XSBJbmRleCBvZiBjYXJkXG4gICAqL1xuICBhZGRUaXBUb0NhcmQoJGNhcmQsIHNpZGUsIGluZGV4KSB7XG4gICAgLy8gTWFrZSBzdXJlIHdlIGhhdmUgYSBzaWRlXG4gICAgaWYgKHNpZGUgIT09ICdiYWNrJykge1xuICAgICAgc2lkZSA9ICdmcm9udCc7XG4gICAgfVxuXG4gICAgLy8gTWFrZSBzdXJlIHdlIGhhdmUgYW4gaW5kZXhcblxuICAgIGlmIChpbmRleCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBpbmRleCA9IHRoaXMuaWQ7XG4gICAgfVxuXG4gICAgLy8gUmVtb3ZlIGFueSBvbGQgdGlwc1xuICAgICRjYXJkLmZpbmQoJy5qb3ViZWwtdGlwLWNvbnRhaW5lcicpLnJlbW92ZSgpO1xuXG4gICAgLy8gQWRkIG5ldyB0aXAgaWYgc2V0IGFuZCBoYXMgbGVuZ3RoIGFmdGVyIHRyaW1cbiAgICBjb25zdCB0aXAgPSAodGhpcy5jYXJkW3NpZGVdLnRpcCB8fCAnJykudHJpbSgpO1xuICAgIGlmICh0aXAubGVuZ3RoKSB7XG4gICAgICAkY2FyZC5maW5kKCcuaDVwLWRpYWxvZ2NhcmRzLWNhcmQtdGV4dC13cmFwcGVyIC5oNXAtZGlhbG9nY2FyZHMtY2FyZC10ZXh0LWlubmVyJylcbiAgICAgICAgLmFmdGVyKEg1UC5Kb3ViZWxVSS5jcmVhdGVUaXAodGlwLCB7XG4gICAgICAgICAgdGlwTGFiZWw6IHRoaXMucGFyYW1zLnRpcEJ1dHRvbkxhYmVsXG4gICAgICAgIH0pKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2V0IGZvY3VzIHRvIGEgZ2l2ZW4gY2FyZC5cbiAgICogQHBhcmFtIHtib29sZWFufSBmb3JjZSBJZiB0cnVlLCBkb24ndCB3YWl0IGZvciB0cmFuc2l0aW9uLlxuICAgKi9cbiAgc2V0Q2FyZEZvY3VzKGZvcmNlKSB7XG4gICAgaWYgKGZvcmNlID09PSB0cnVlKSB7XG4gICAgICB0aGlzLiRjYXJkVGV4dEFyZWEuZm9jdXMoKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAvLyBXYWl0IGZvciB0cmFuc2l0aW9uLCB0aGVuIHNldCBmb2N1c1xuICAgICAgY29uc3QgJGNhcmQgPSB0aGlzLmdldERPTSgpO1xuICAgICAgJGNhcmQub25lKCd0cmFuc2l0aW9uZW5kJywgKCkgPT4ge1xuICAgICAgICAkY2FyZC5mb2N1cygpO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFN0b3AgYXVkaW8gb2YgY2FyZC5cbiAgICovXG4gIHN0b3BBdWRpbygpIHtcbiAgICBjb25zdCBzaWRlcyA9IFsnZnJvbnQnLCAnYmFjayddO1xuICAgIHNpZGVzLmZvckVhY2goc2lkZSA9PiB7XG4gICAgICBpZiAoIXRoaXMuYXVkaW9zW3NpZGVdIHx8ICF0aGlzLmF1ZGlvc1tzaWRlXS5hdWRpbykge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8qXG4gICAgICAgKiBXZSBuZWVkIHRvIHJlc2V0IHRoZSBhdWRpbyBidXR0b24gdG8gaXRzIGluaXRpYWwgdmlzdWFsIHN0YXRlLCBidXQgaXRcbiAgICAgICAqIGRvZXNuJ3QgaGF2ZSBhIGZ1bmN0aW9uIHRvIHRvIHRoYXQgLT4gZm9yY2UgZW5kZWQgZXZlbnQgYW5kIHJlbG9hZC5cbiAgICAgICAqL1xuICAgICAgaWYgKHRoaXMuYXVkaW9zW3NpZGVdLmF1ZGlvLmR1cmF0aW9uID4gMCkge1xuICAgICAgICB0aGlzLmF1ZGlvc1tzaWRlXS5hdWRpby5wYXVzZSgpO1xuICAgICAgICB0aGlzLmF1ZGlvc1tzaWRlXS5hdWRpby5jdXJyZW50VGltZSA9IE1hdGguZmxvb3IodGhpcy5hdWRpb3Nbc2lkZV0uYXVkaW8uZHVyYXRpb24pO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5hdWRpb3Nbc2lkZV0uYXVkaW8ubG9hZCkge1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICB0aGlzLmF1ZGlvc1tzaWRlXS5hdWRpby5sb2FkKCk7XG4gICAgICAgIH0sIDEwMCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGNhcmQncyBET01cbiAgICpcbiAgICogQHJldHVybiB7alF1ZXJ5fSBDYXJkJ3MgRE9NLlxuICAgKi9cbiAgZ2V0RE9NKCkge1xuICAgIHJldHVybiB0aGlzLiRjYXJkV3JhcHBlcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgbm8gdGV4dCBtb2RlLlxuICAgKi9cbiAgc2V0Tm9UZXh0KCkge1xuICAgIHRoaXMuZ2V0RE9NKCkuYWRkQ2xhc3MoJ2g1cC1uby10ZXh0Jyk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGNhcmQncyB0ZXh0LlxuICAgKlxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IENhcmQncyB0ZXh0LlxuICAgKi9cbiAgZ2V0VGV4dCgpIHtcbiAgICByZXR1cm4gdGhpcy5jYXJkLmZyb250LnRleHQ7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGNhcmQncyBhbnN3ZXIuXG4gICAqXG4gICAqIEByZXR1cm4ge3N0cmluZ30gQ2FyZCdzIGFuc3dlci5cbiAgICovXG4gIGdldEFuc3dlcigpIHtcbiAgICByZXR1cm4gdGhpcy5jYXJkLmJhY2sudGV4dDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgY2FyZCdzIGltYWdlIHdyYXBwZXIuXG4gICAqXG4gICAqIEByZXR1cm4ge2pRdWVyeX0gQ2FyZCdzIGltYWdlLlxuICAgKi9cbiAgZ2V0SW1hZ2VXcmFwcGVyKCkge1xuICAgIHJldHVybiB0aGlzLiRpbWFnZVdyYXBwZXI7XG4gIH1cblxuICAvKipcbiAgICogU2V0IGNhcmQgaW1hZ2UgaGVpZ2h0LlxuICAgKiBAcGFyYW0ge3N0cmluZ30gaGVpZ2h0IENTUyBoZWlnaHQgdmFsdWUuXG4gICAqL1xuICBzZXRJbWFnZUhlaWdodChoZWlnaHQpIHtcbiAgICB0aGlzLiRpbWFnZVdyYXBwZXIuY3NzKCdoZWlnaHQnLCBoZWlnaHQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjYXJkJ3MgQXVkaW8uXG4gICAqXG4gICAqIEByZXR1cm4ge0VsZW1lbnR9IENhcmQncyBhdWRpby5cbiAgICovXG4gIGdldEF1ZGlvKCkge1xuICAgIHJldHVybiB0aGlzLmlzVHVybmVkKCkgPyB0aGlzLiRhdWRpb1dyYXBwZXJzLmJhY2sgOiB0aGlzLiRhdWRpb1dyYXBwZXJzLmZyb250O1xuICB9XG5cbiAgLyoqXG4gICAqIERldGVjdCB3aGV0aGVyIGNhcmQgaXMgdHVybmVkLlxuICAgKiBAcmV0dXJuIHtib29sZWFufSBUcnVlLCBpZiBjYXJkIGlzIHR1cm5lZC5cbiAgICovXG4gIGlzVHVybmVkKCkge1xuICAgIHJldHVybiB0aGlzLmdldERPTSgpXG4gICAgICAuZmluZCgnLmg1cC1kaWFsb2djYXJkcy1jYXJkLWNvbnRlbnQnKVxuICAgICAgLmhhc0NsYXNzKCdoNXAtZGlhbG9nY2FyZHMtdHVybmVkJyk7XG4gIH1cblxuICAvKipcbiAgICogUmVzZXQgY2FyZC5cbiAgICovXG4gIHJlc2V0KCkge1xuICAgIGNvbnN0ICRjYXJkID0gdGhpcy5nZXRET00oKTtcblxuICAgICRjYXJkLnJlbW92ZUNsYXNzKCdoNXAtZGlhbG9nY2FyZHMtcHJldmlvdXMnKTtcbiAgICAkY2FyZC5yZW1vdmVDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLWN1cnJlbnQnKTtcblxuICAgIHRoaXMuY2hhbmdlVGV4dCh0aGlzLmdldFRleHQoKSk7XG5cbiAgICBjb25zdCAkY2FyZENvbnRlbnQgPSAkY2FyZC5maW5kKCcuaDVwLWRpYWxvZ2NhcmRzLWNhcmQtY29udGVudCcpO1xuICAgICRjYXJkQ29udGVudC5yZW1vdmVDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLXR1cm5lZCcpO1xuICAgIHRoaXMuYWRkVGlwVG9DYXJkKCRjYXJkQ29udGVudCwgJ2Zyb250JywgdGhpcy5pZCk7XG5cbiAgICBpZiAoIXRoaXMucGFyYW1zLmJlaGF2aW91ci5xdWlja1Byb2dyZXNzaW9uKSB7XG4gICAgICAkY2FyZC5maW5kKCcuaDVwLWRpYWxvZ2NhcmRzLWFuc3dlci1idXR0b24nKS5yZW1vdmVDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLXF1aWNrLXByb2dyZXNzaW9uJyk7XG4gICAgfVxuICAgIHRoaXMuaGlkZVN1bW1hcnlCdXR0b24oKTtcbiAgfVxufVxuXG4vLyBDb25zdGFudHNcbkNhcmQuU0NBTEVJTlRFUlZBTCA9IDAuMjtcbkNhcmQuTUFYU0NBTEUgPSAxNjtcbkNhcmQuTUlOU0NBTEUgPSA0O1xuXG5leHBvcnQgZGVmYXVsdCBDYXJkO1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/scripts/h5p-dialogcards-card.js\n");

/***/ }),

/***/ "./src/scripts/h5p-dialogcards-summary-screen.js":
/*!*******************************************************!*\
  !*** ./src/scripts/h5p-dialogcards-summary-screen.js ***!
  \*******************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\nvar SummaryScreen = /*#__PURE__*/function () {\n  /**\n   * @constructor\n   */\n  function SummaryScreen(params, callbacks) {\n    var _this = this;\n\n    this.params = params;\n    this.callbacks = callbacks;\n    this.currentCallback = callbacks.nextRound;\n    this.fields = [];\n    this.container = document.createElement('div');\n    this.container.classList.add('h5p-dialogcards-summary-screen');\n    var containerRound = this.createContainerDOM(params.summary);\n    this.fields['round'] = containerRound.getElementsByClassName('h5p-dialogcards-summary-subheader')[0];\n    this.fields['h5p-dialogcards-round-cards-right'] = this.addTableRow(containerRound, {\n      category: this.params.summaryCardsRight,\n      symbol: 'h5p-dialogcards-check'\n    });\n    this.fields['h5p-dialogcards-round-cards-wrong'] = this.addTableRow(containerRound, {\n      category: this.params.summaryCardsWrong,\n      symbol: 'h5p-dialogcards-times'\n    });\n    this.fields['h5p-dialogcards-round-cards-not-shown'] = this.addTableRow(containerRound, {\n      category: this.params.summaryCardsNotShown\n    });\n    var containerOverall = this.createContainerDOM(params.summaryOverallScore);\n    this.fields['h5p-dialogcards-overall-cards-completed'] = this.addTableRow(containerOverall, {\n      category: this.params.summaryCardsCompleted,\n      symbol: 'h5p-dialogcards-check'\n    });\n    this.fields['h5p-dialogcards-overall-completed-rounds'] = this.addTableRow(containerOverall, {\n      category: this.params.summaryCompletedRounds,\n      symbol: ''\n    });\n    var message = document.createElement('div');\n    message.classList.add('h5p-dialogcards-summary-message');\n    this.fields['message'] = message;\n    var buttonNextRound = H5P.JoubelUI.createButton({\n      'class': 'h5p-dialogcards-buttonNextRound',\n      'title': this.params.nextRound.replace('@round', 2),\n      'html': this.params.nextRound.replace('@round', 2)\n    }).click(this.currentCallback).get(0);\n    this.fields['button'] = buttonNextRound; // Button to start over including confirmation dialog\n\n    var buttonStartOver = H5P.JoubelUI.createButton({\n      'class': 'h5p-dialogcards-button-restart',\n      'title': this.params.startOver,\n      'html': this.params.startOver\n    }).get(0);\n    var confirmationDialog = this.createConfirmationDialog({\n      l10n: this.params.confirmStartingOver,\n      instance: this\n    }, function () {\n      // Stop interference with confirm dialog animation and goto animation\n      setTimeout(function () {\n        _this.callbacks.retry();\n      }, 100);\n    });\n    /*\n     * For some reason, using $.click to add the listener in the line above\n     * leads to losing the listener when button reappears on next summary screen\n     */\n\n    buttonStartOver.addEventListener('click', function (event) {\n      confirmationDialog.show(event.target.offsetTop);\n    });\n    this.fields['buttonStartOver'] = buttonStartOver; // Footer\n\n    var footer = document.createElement('div');\n    footer.classList.add('h5p-dialogcards-summary-footer');\n    footer.appendChild(buttonStartOver);\n    footer.appendChild(buttonNextRound);\n    this.container.appendChild(containerRound);\n    this.container.appendChild(containerOverall);\n    this.container.appendChild(message);\n    this.container.appendChild(footer);\n    this.hide();\n    return this;\n  }\n  /**\n   * Get DOM of summary screen.\n   * @return {object} Summary screen DOM.\n   */\n\n\n  var _proto = SummaryScreen.prototype;\n\n  _proto.getDOM = function getDOM() {\n    return this.container;\n  }\n  /**\n   * Create container DOM.\n   * @param {string} headerText Header text.\n   * @param {string} [subheaderText=''] Sub-Header text.\n   * @return {object} Container DOM.\n   */\n  ;\n\n  _proto.createContainerDOM = function createContainerDOM(headerText) {\n    var subheaderText = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n    var container = document.createElement('div');\n    container.classList.add('h5p-dialogcards-summary-container');\n    var header = document.createElement('div');\n    header.classList.add('h5p-dialogcards-summary-header');\n    header.innerHTML = headerText;\n    container.appendChild(header);\n    var subheader = document.createElement('div');\n    subheader.classList.add('h5p-dialogcards-summary-subheader');\n    subheader.innerHTML = subheaderText;\n    container.appendChild(subheader);\n    var table = document.createElement('table');\n    table.classList.add('h5p-dialogcards-summary-table');\n    container.appendChild(table);\n    return container;\n  }\n  /**\n   * Add row to a table.\n   * @param {object} container Container to add table to.\n   * @param {object} cols Columns.\n   * @param {string} cols.category Category text.\n   * @param {string} [cols.symbol=''] Symbol.\n   * @param {object} [cols.score] Score value and maximum value.\n   * @param {number|string} [cols.score.value=''] Value.\n   * @param {number|string} [cols.score.max] Maximum value.\n   * @return {object} Score field for updating later.\n   */\n  ;\n\n  _proto.addTableRow = function addTableRow(container, cols) {\n    var table = container.getElementsByClassName('h5p-dialogcards-summary-table')[0];\n    var row = document.createElement('tr');\n    var category = document.createElement('td');\n    category.classList.add('h5p-dialogcards-summary-table-row-category');\n    category.innerHTML = cols.category;\n    row.appendChild(category);\n    var symbol = document.createElement('td');\n    symbol.classList.add('h5p-dialogcards-summary-table-row-symbol');\n\n    if (cols.symbol !== undefined && cols.symbol !== '') {\n      symbol.classList.add(cols.symbol);\n    }\n\n    row.appendChild(symbol);\n    var score = document.createElement('td');\n    score.classList.add('h5p-dialogcards-summary-table-row-score');\n    row.appendChild(score);\n    table.appendChild(row);\n    return score;\n  }\n  /**\n   * Update fields.\n   * @param {object} [args] Arguments.\n   * @param {boolean} [args.done] If true, learner is done.\n   * @param {number} [args.round] Round number.\n   * @param {string} [args.message] Message text.\n   * @param {object[]} [args.results] Results.\n   * @param {string} [args.results.field] Field identifier.\n   * @param {object} [args.results.score] Score for field.\n   * @param {number} [args.results.score.value] Score value for field.\n   * @param {number} [args.results.score.max] Score max value for field.\n   */\n  ;\n\n  _proto.update = function update() {\n    var _this2 = this;\n\n    var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n        _ref$done = _ref.done,\n        done = _ref$done === void 0 ? false : _ref$done,\n        _ref$round = _ref.round,\n        round = _ref$round === void 0 ? undefined : _ref$round,\n        _ref$message = _ref.message,\n        message = _ref$message === void 0 ? undefined : _ref$message,\n        _ref$results = _ref.results,\n        results = _ref$results === void 0 ? [] : _ref$results;\n\n    if (done === true) {\n      this.fields['buttonStartOver'].classList.add('h5p-dialogcards-button-gone');\n\n      if (this.params.behaviour.enableRetry) {\n        this.fields['button'].classList.remove('h5p-dialogcards-button-next-round');\n        this.fields['button'].classList.add('h5p-dialogcards-button-restart');\n        this.fields['button'].innerHTML = this.params.retry;\n        this.fields['button'].title = this.params.retry;\n        this.currentCallback = this.callbacks.retry;\n      } else {\n        this.fields['button'].classList.add('h5p-dialogcards-button-gone');\n      }\n    } else {\n      this.fields['buttonStartOver'].classList.remove('h5p-dialogcards-button-gone');\n      this.fields['button'].classList.add('h5p-dialogcards-button-next-round');\n      this.fields['button'].classList.remove('h5p-dialogcards-button-restart');\n      this.fields['button'].innerHTML = this.params.nextRound;\n      this.fields['button'].title = this.params.nextRound;\n      this.currentCallback = this.callbacks.nextRound;\n    }\n\n    H5P.jQuery(this.fields['button']).unbind('click').click(this.currentCallback);\n    this.fields['round'].innerHTML = this.params.round.replace('@round', round);\n\n    if (!done && round !== undefined) {\n      this.fields['button'].innerHTML = this.params.nextRound.replace('@round', round + 1);\n      this.fields['button'].title = this.params.nextRound.replace('@round', round + 1);\n    }\n\n    if (done && message !== undefined && message !== '') {\n      this.fields['message'].classList.remove('h5p-dialogcards-gone');\n      this.fields['message'].innerHTML = message;\n    } else {\n      this.fields['message'].classList.add('h5p-dialogcards-gone');\n    }\n\n    results.forEach(function (result) {\n      var scoreHTML = result.score.value !== undefined ? result.score.value : '';\n\n      if (result.score.max !== undefined) {\n        scoreHTML = \"\".concat(scoreHTML, \"&nbsp;<span class=\\\"h5p-dialogcards-summary-table-row-score-divider\\\">/</span>&nbsp;\").concat(result.score.max);\n      }\n\n      _this2.fields[result.field].innerHTML = scoreHTML;\n    });\n  }\n  /**\n   * Show DOM.\n   */\n  ;\n\n  _proto.show = function show() {\n    this.container.classList.remove('h5p-dialogcards-gone');\n    this.fields['button'].focus();\n  }\n  /**\n   * Hide DOM.\n   */\n  ;\n\n  _proto.hide = function hide() {\n    this.container.classList.add('h5p-dialogcards-gone');\n  }\n  /**\n   * Add confirmation dialog to button.\n   * @param {object} options Dialog options.\n   * @param {function} clicked Callback for confirmation button.\n   * @return {H5P.ConfirmationDialog|undefined} Confirmation dialog.\n   */\n  ;\n\n  _proto.createConfirmationDialog = function createConfirmationDialog(options, clicked) {\n    options = options || {};\n    var confirmationDialog = new H5P.ConfirmationDialog({\n      instance: options.instance,\n      headerText: options.l10n.header,\n      dialogText: options.l10n.body,\n      cancelText: options.l10n.cancelLabel,\n      confirmText: options.l10n.confirmLabel\n    });\n    confirmationDialog.on('confirmed', function () {\n      clicked();\n    });\n    confirmationDialog.appendTo(this.getContainer());\n    return confirmationDialog;\n  }\n  /**\n   * Find container to attach dialogs to.\n   * @return {HTMLElement} Container to attach dialogs to.\n   */\n  ;\n\n  _proto.getContainer = function getContainer() {\n    var $content = H5P.jQuery('[data-content-id=\"' + self.contentId + '\"].h5p-content');\n    var $containerParents = $content.parents('.h5p-container');\n    var $container;\n\n    if ($containerParents.length !== 0) {\n      // use parent highest up if any\n      $container = $containerParents.last();\n    } else if ($content.length !== 0) {\n      $container = $content;\n    } else {\n      $container = H5P.jQuery(document.body);\n    }\n\n    return $container.get(0);\n  };\n\n  return SummaryScreen;\n}();\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (SummaryScreen);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvc2NyaXB0cy9oNXAtZGlhbG9nY2FyZHMtc3VtbWFyeS1zY3JlZW4uanMuanMiLCJtYXBwaW5ncyI6IjtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTs7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFNQTs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBTUE7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBQ0E7QUFDQTtBQUNBO0FBRUE7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTs7QUFDQTtBQUNBO0FBQ0E7O0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQUE7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBOztBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFDQTtBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUNBO0FBQ0E7QUFDQTs7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFMQTtBQVFBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFFQTs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBOztBQUVBO0FBQ0E7Ozs7O0FBR0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9oNXAtZGlhbG9nY2FyZHMvLi9zcmMvc2NyaXB0cy9oNXAtZGlhbG9nY2FyZHMtc3VtbWFyeS1zY3JlZW4uanM/YjFmZSJdLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBTdW1tYXJ5U2NyZWVuIHtcbiAgLyoqXG4gICAqIEBjb25zdHJ1Y3RvclxuICAgKi9cbiAgY29uc3RydWN0b3IocGFyYW1zLCBjYWxsYmFja3MpIHtcbiAgICB0aGlzLnBhcmFtcyA9IHBhcmFtcztcbiAgICB0aGlzLmNhbGxiYWNrcyA9IGNhbGxiYWNrcztcblxuICAgIHRoaXMuY3VycmVudENhbGxiYWNrID0gY2FsbGJhY2tzLm5leHRSb3VuZDtcblxuICAgIHRoaXMuZmllbGRzID0gW107XG5cbiAgICB0aGlzLmNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2g1cC1kaWFsb2djYXJkcy1zdW1tYXJ5LXNjcmVlbicpO1xuXG4gICAgY29uc3QgY29udGFpbmVyUm91bmQgPSB0aGlzLmNyZWF0ZUNvbnRhaW5lckRPTShwYXJhbXMuc3VtbWFyeSk7XG4gICAgdGhpcy5maWVsZHNbJ3JvdW5kJ10gPSBjb250YWluZXJSb3VuZC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdoNXAtZGlhbG9nY2FyZHMtc3VtbWFyeS1zdWJoZWFkZXInKVswXTtcblxuICAgIHRoaXMuZmllbGRzWydoNXAtZGlhbG9nY2FyZHMtcm91bmQtY2FyZHMtcmlnaHQnXSA9IHRoaXMuYWRkVGFibGVSb3coXG4gICAgICBjb250YWluZXJSb3VuZCwge2NhdGVnb3J5OiB0aGlzLnBhcmFtcy5zdW1tYXJ5Q2FyZHNSaWdodCwgc3ltYm9sOiAnaDVwLWRpYWxvZ2NhcmRzLWNoZWNrJ30pO1xuICAgIHRoaXMuZmllbGRzWydoNXAtZGlhbG9nY2FyZHMtcm91bmQtY2FyZHMtd3JvbmcnXSA9IHRoaXMuYWRkVGFibGVSb3coXG4gICAgICBjb250YWluZXJSb3VuZCwge2NhdGVnb3J5OiB0aGlzLnBhcmFtcy5zdW1tYXJ5Q2FyZHNXcm9uZywgc3ltYm9sOiAnaDVwLWRpYWxvZ2NhcmRzLXRpbWVzJ30pO1xuICAgIHRoaXMuZmllbGRzWydoNXAtZGlhbG9nY2FyZHMtcm91bmQtY2FyZHMtbm90LXNob3duJ10gPSB0aGlzLmFkZFRhYmxlUm93KFxuICAgICAgY29udGFpbmVyUm91bmQsIHtjYXRlZ29yeTogdGhpcy5wYXJhbXMuc3VtbWFyeUNhcmRzTm90U2hvd259KTtcblxuICAgIGNvbnN0IGNvbnRhaW5lck92ZXJhbGwgPSB0aGlzLmNyZWF0ZUNvbnRhaW5lckRPTShwYXJhbXMuc3VtbWFyeU92ZXJhbGxTY29yZSk7XG4gICAgdGhpcy5maWVsZHNbJ2g1cC1kaWFsb2djYXJkcy1vdmVyYWxsLWNhcmRzLWNvbXBsZXRlZCddID0gdGhpcy5hZGRUYWJsZVJvdyhcbiAgICAgIGNvbnRhaW5lck92ZXJhbGwsIHtjYXRlZ29yeTogdGhpcy5wYXJhbXMuc3VtbWFyeUNhcmRzQ29tcGxldGVkLCBzeW1ib2w6ICdoNXAtZGlhbG9nY2FyZHMtY2hlY2snfSk7XG4gICAgdGhpcy5maWVsZHNbJ2g1cC1kaWFsb2djYXJkcy1vdmVyYWxsLWNvbXBsZXRlZC1yb3VuZHMnXSA9IHRoaXMuYWRkVGFibGVSb3coXG4gICAgICBjb250YWluZXJPdmVyYWxsLCB7Y2F0ZWdvcnk6IHRoaXMucGFyYW1zLnN1bW1hcnlDb21wbGV0ZWRSb3VuZHMsIHN5bWJvbDogJyd9KTtcblxuICAgIGNvbnN0IG1lc3NhZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBtZXNzYWdlLmNsYXNzTGlzdC5hZGQoJ2g1cC1kaWFsb2djYXJkcy1zdW1tYXJ5LW1lc3NhZ2UnKTtcblxuICAgIHRoaXMuZmllbGRzWydtZXNzYWdlJ10gPSBtZXNzYWdlO1xuXG4gICAgY29uc3QgYnV0dG9uTmV4dFJvdW5kID0gSDVQLkpvdWJlbFVJLmNyZWF0ZUJ1dHRvbih7XG4gICAgICAnY2xhc3MnOiAnaDVwLWRpYWxvZ2NhcmRzLWJ1dHRvbk5leHRSb3VuZCcsXG4gICAgICAndGl0bGUnOiB0aGlzLnBhcmFtcy5uZXh0Um91bmQucmVwbGFjZSgnQHJvdW5kJywgMiksXG4gICAgICAnaHRtbCc6IHRoaXMucGFyYW1zLm5leHRSb3VuZC5yZXBsYWNlKCdAcm91bmQnLCAyKVxuICAgIH0pLmNsaWNrKHRoaXMuY3VycmVudENhbGxiYWNrKS5nZXQoMCk7XG5cbiAgICB0aGlzLmZpZWxkc1snYnV0dG9uJ10gPSBidXR0b25OZXh0Um91bmQ7XG5cbiAgICAvLyBCdXR0b24gdG8gc3RhcnQgb3ZlciBpbmNsdWRpbmcgY29uZmlybWF0aW9uIGRpYWxvZ1xuICAgIGNvbnN0IGJ1dHRvblN0YXJ0T3ZlciA9IEg1UC5Kb3ViZWxVSS5jcmVhdGVCdXR0b24oe1xuICAgICAgJ2NsYXNzJzogJ2g1cC1kaWFsb2djYXJkcy1idXR0b24tcmVzdGFydCcsXG4gICAgICAndGl0bGUnOiB0aGlzLnBhcmFtcy5zdGFydE92ZXIsXG4gICAgICAnaHRtbCc6IHRoaXMucGFyYW1zLnN0YXJ0T3ZlclxuICAgIH0pLmdldCgwKTtcblxuICAgIGNvbnN0IGNvbmZpcm1hdGlvbkRpYWxvZyA9IHRoaXMuY3JlYXRlQ29uZmlybWF0aW9uRGlhbG9nKHtcbiAgICAgIGwxMG46IHRoaXMucGFyYW1zLmNvbmZpcm1TdGFydGluZ092ZXIsXG4gICAgICBpbnN0YW5jZTogdGhpc1xuICAgIH0sICgpID0+IHtcbiAgICAgIC8vIFN0b3AgaW50ZXJmZXJlbmNlIHdpdGggY29uZmlybSBkaWFsb2cgYW5pbWF0aW9uIGFuZCBnb3RvIGFuaW1hdGlvblxuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHRoaXMuY2FsbGJhY2tzLnJldHJ5KCk7XG4gICAgICB9LCAxMDApO1xuICAgIH0pO1xuXG4gICAgLypcbiAgICAgKiBGb3Igc29tZSByZWFzb24sIHVzaW5nICQuY2xpY2sgdG8gYWRkIHRoZSBsaXN0ZW5lciBpbiB0aGUgbGluZSBhYm92ZVxuICAgICAqIGxlYWRzIHRvIGxvc2luZyB0aGUgbGlzdGVuZXIgd2hlbiBidXR0b24gcmVhcHBlYXJzIG9uIG5leHQgc3VtbWFyeSBzY3JlZW5cbiAgICAgKi9cbiAgICBidXR0b25TdGFydE92ZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXZlbnQpID0+IHtcbiAgICAgIGNvbmZpcm1hdGlvbkRpYWxvZy5zaG93KGV2ZW50LnRhcmdldC5vZmZzZXRUb3ApO1xuICAgIH0pO1xuXG4gICAgdGhpcy5maWVsZHNbJ2J1dHRvblN0YXJ0T3ZlciddID0gYnV0dG9uU3RhcnRPdmVyO1xuXG4gICAgLy8gRm9vdGVyXG4gICAgY29uc3QgZm9vdGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgZm9vdGVyLmNsYXNzTGlzdC5hZGQoJ2g1cC1kaWFsb2djYXJkcy1zdW1tYXJ5LWZvb3RlcicpO1xuICAgIGZvb3Rlci5hcHBlbmRDaGlsZChidXR0b25TdGFydE92ZXIpO1xuICAgIGZvb3Rlci5hcHBlbmRDaGlsZChidXR0b25OZXh0Um91bmQpO1xuXG4gICAgdGhpcy5jb250YWluZXIuYXBwZW5kQ2hpbGQoY29udGFpbmVyUm91bmQpO1xuICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKGNvbnRhaW5lck92ZXJhbGwpO1xuICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKG1lc3NhZ2UpO1xuICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKGZvb3Rlcik7XG5cbiAgICB0aGlzLmhpZGUoKTtcblxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBET00gb2Ygc3VtbWFyeSBzY3JlZW4uXG4gICAqIEByZXR1cm4ge29iamVjdH0gU3VtbWFyeSBzY3JlZW4gRE9NLlxuICAgKi9cbiAgZ2V0RE9NKCkge1xuICAgIHJldHVybiB0aGlzLmNvbnRhaW5lcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgY29udGFpbmVyIERPTS5cbiAgICogQHBhcmFtIHtzdHJpbmd9IGhlYWRlclRleHQgSGVhZGVyIHRleHQuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBbc3ViaGVhZGVyVGV4dD0nJ10gU3ViLUhlYWRlciB0ZXh0LlxuICAgKiBAcmV0dXJuIHtvYmplY3R9IENvbnRhaW5lciBET00uXG4gICAqL1xuICBjcmVhdGVDb250YWluZXJET00oaGVhZGVyVGV4dCwgc3ViaGVhZGVyVGV4dCA9ICcnKSB7XG4gICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2g1cC1kaWFsb2djYXJkcy1zdW1tYXJ5LWNvbnRhaW5lcicpO1xuXG4gICAgY29uc3QgaGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgaGVhZGVyLmNsYXNzTGlzdC5hZGQoJ2g1cC1kaWFsb2djYXJkcy1zdW1tYXJ5LWhlYWRlcicpO1xuICAgIGhlYWRlci5pbm5lckhUTUwgPSBoZWFkZXJUZXh0O1xuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChoZWFkZXIpO1xuXG4gICAgY29uc3Qgc3ViaGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgc3ViaGVhZGVyLmNsYXNzTGlzdC5hZGQoJ2g1cC1kaWFsb2djYXJkcy1zdW1tYXJ5LXN1YmhlYWRlcicpO1xuICAgIHN1YmhlYWRlci5pbm5lckhUTUwgPSBzdWJoZWFkZXJUZXh0O1xuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChzdWJoZWFkZXIpO1xuXG4gICAgY29uc3QgdGFibGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0YWJsZScpO1xuICAgIHRhYmxlLmNsYXNzTGlzdC5hZGQoJ2g1cC1kaWFsb2djYXJkcy1zdW1tYXJ5LXRhYmxlJyk7XG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHRhYmxlKTtcblxuICAgIHJldHVybiBjb250YWluZXI7XG4gIH1cblxuICAvKipcbiAgICogQWRkIHJvdyB0byBhIHRhYmxlLlxuICAgKiBAcGFyYW0ge29iamVjdH0gY29udGFpbmVyIENvbnRhaW5lciB0byBhZGQgdGFibGUgdG8uXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBjb2xzIENvbHVtbnMuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBjb2xzLmNhdGVnb3J5IENhdGVnb3J5IHRleHQuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBbY29scy5zeW1ib2w9JyddIFN5bWJvbC5cbiAgICogQHBhcmFtIHtvYmplY3R9IFtjb2xzLnNjb3JlXSBTY29yZSB2YWx1ZSBhbmQgbWF4aW11bSB2YWx1ZS5cbiAgICogQHBhcmFtIHtudW1iZXJ8c3RyaW5nfSBbY29scy5zY29yZS52YWx1ZT0nJ10gVmFsdWUuXG4gICAqIEBwYXJhbSB7bnVtYmVyfHN0cmluZ30gW2NvbHMuc2NvcmUubWF4XSBNYXhpbXVtIHZhbHVlLlxuICAgKiBAcmV0dXJuIHtvYmplY3R9IFNjb3JlIGZpZWxkIGZvciB1cGRhdGluZyBsYXRlci5cbiAgICovXG4gIGFkZFRhYmxlUm93KGNvbnRhaW5lciwgY29scykge1xuICAgIGNvbnN0IHRhYmxlID0gY29udGFpbmVyLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2g1cC1kaWFsb2djYXJkcy1zdW1tYXJ5LXRhYmxlJylbMF07XG5cbiAgICBjb25zdCByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpO1xuXG4gICAgY29uc3QgY2F0ZWdvcnkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuICAgIGNhdGVnb3J5LmNsYXNzTGlzdC5hZGQoJ2g1cC1kaWFsb2djYXJkcy1zdW1tYXJ5LXRhYmxlLXJvdy1jYXRlZ29yeScpO1xuICAgIGNhdGVnb3J5LmlubmVySFRNTCA9IGNvbHMuY2F0ZWdvcnk7XG4gICAgcm93LmFwcGVuZENoaWxkKGNhdGVnb3J5KTtcblxuICAgIGNvbnN0IHN5bWJvbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG4gICAgc3ltYm9sLmNsYXNzTGlzdC5hZGQoJ2g1cC1kaWFsb2djYXJkcy1zdW1tYXJ5LXRhYmxlLXJvdy1zeW1ib2wnKTtcbiAgICBpZiAoY29scy5zeW1ib2wgIT09IHVuZGVmaW5lZCAmJiBjb2xzLnN5bWJvbCAhPT0gJycpIHtcbiAgICAgIHN5bWJvbC5jbGFzc0xpc3QuYWRkKGNvbHMuc3ltYm9sKTtcbiAgICB9XG4gICAgcm93LmFwcGVuZENoaWxkKHN5bWJvbCk7XG5cbiAgICBjb25zdCBzY29yZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG4gICAgc2NvcmUuY2xhc3NMaXN0LmFkZCgnaDVwLWRpYWxvZ2NhcmRzLXN1bW1hcnktdGFibGUtcm93LXNjb3JlJyk7XG4gICAgcm93LmFwcGVuZENoaWxkKHNjb3JlKTtcblxuICAgIHRhYmxlLmFwcGVuZENoaWxkKHJvdyk7XG5cbiAgICByZXR1cm4gc2NvcmU7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIGZpZWxkcy5cbiAgICogQHBhcmFtIHtvYmplY3R9IFthcmdzXSBBcmd1bWVudHMuXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2FyZ3MuZG9uZV0gSWYgdHJ1ZSwgbGVhcm5lciBpcyBkb25lLlxuICAgKiBAcGFyYW0ge251bWJlcn0gW2FyZ3Mucm91bmRdIFJvdW5kIG51bWJlci5cbiAgICogQHBhcmFtIHtzdHJpbmd9IFthcmdzLm1lc3NhZ2VdIE1lc3NhZ2UgdGV4dC5cbiAgICogQHBhcmFtIHtvYmplY3RbXX0gW2FyZ3MucmVzdWx0c10gUmVzdWx0cy5cbiAgICogQHBhcmFtIHtzdHJpbmd9IFthcmdzLnJlc3VsdHMuZmllbGRdIEZpZWxkIGlkZW50aWZpZXIuXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBbYXJncy5yZXN1bHRzLnNjb3JlXSBTY29yZSBmb3IgZmllbGQuXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBbYXJncy5yZXN1bHRzLnNjb3JlLnZhbHVlXSBTY29yZSB2YWx1ZSBmb3IgZmllbGQuXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBbYXJncy5yZXN1bHRzLnNjb3JlLm1heF0gU2NvcmUgbWF4IHZhbHVlIGZvciBmaWVsZC5cbiAgICovXG4gIHVwZGF0ZSh7ZG9uZSA9IGZhbHNlLCByb3VuZCA9IHVuZGVmaW5lZCwgbWVzc2FnZSA9IHVuZGVmaW5lZCwgcmVzdWx0cyA9IFtdfSA9IHt9KSB7XG4gICAgaWYgKGRvbmUgPT09IHRydWUpIHtcbiAgICAgIHRoaXMuZmllbGRzWydidXR0b25TdGFydE92ZXInXS5jbGFzc0xpc3QuYWRkKCdoNXAtZGlhbG9nY2FyZHMtYnV0dG9uLWdvbmUnKTtcblxuICAgICAgaWYgKHRoaXMucGFyYW1zLmJlaGF2aW91ci5lbmFibGVSZXRyeSkge1xuICAgICAgICB0aGlzLmZpZWxkc1snYnV0dG9uJ10uY2xhc3NMaXN0LnJlbW92ZSgnaDVwLWRpYWxvZ2NhcmRzLWJ1dHRvbi1uZXh0LXJvdW5kJyk7XG4gICAgICAgIHRoaXMuZmllbGRzWydidXR0b24nXS5jbGFzc0xpc3QuYWRkKCdoNXAtZGlhbG9nY2FyZHMtYnV0dG9uLXJlc3RhcnQnKTtcbiAgICAgICAgdGhpcy5maWVsZHNbJ2J1dHRvbiddLmlubmVySFRNTCA9IHRoaXMucGFyYW1zLnJldHJ5O1xuICAgICAgICB0aGlzLmZpZWxkc1snYnV0dG9uJ10udGl0bGUgPSB0aGlzLnBhcmFtcy5yZXRyeTtcbiAgICAgICAgdGhpcy5jdXJyZW50Q2FsbGJhY2sgPSB0aGlzLmNhbGxiYWNrcy5yZXRyeTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICB0aGlzLmZpZWxkc1snYnV0dG9uJ10uY2xhc3NMaXN0LmFkZCgnaDVwLWRpYWxvZ2NhcmRzLWJ1dHRvbi1nb25lJyk7XG4gICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgdGhpcy5maWVsZHNbJ2J1dHRvblN0YXJ0T3ZlciddLmNsYXNzTGlzdC5yZW1vdmUoJ2g1cC1kaWFsb2djYXJkcy1idXR0b24tZ29uZScpO1xuXG4gICAgICB0aGlzLmZpZWxkc1snYnV0dG9uJ10uY2xhc3NMaXN0LmFkZCgnaDVwLWRpYWxvZ2NhcmRzLWJ1dHRvbi1uZXh0LXJvdW5kJyk7XG4gICAgICB0aGlzLmZpZWxkc1snYnV0dG9uJ10uY2xhc3NMaXN0LnJlbW92ZSgnaDVwLWRpYWxvZ2NhcmRzLWJ1dHRvbi1yZXN0YXJ0Jyk7XG4gICAgICB0aGlzLmZpZWxkc1snYnV0dG9uJ10uaW5uZXJIVE1MID0gdGhpcy5wYXJhbXMubmV4dFJvdW5kO1xuICAgICAgdGhpcy5maWVsZHNbJ2J1dHRvbiddLnRpdGxlID0gdGhpcy5wYXJhbXMubmV4dFJvdW5kO1xuICAgICAgdGhpcy5jdXJyZW50Q2FsbGJhY2sgPSB0aGlzLmNhbGxiYWNrcy5uZXh0Um91bmQ7XG4gICAgfVxuICAgIEg1UC5qUXVlcnkodGhpcy5maWVsZHNbJ2J1dHRvbiddKS51bmJpbmQoJ2NsaWNrJykuY2xpY2sodGhpcy5jdXJyZW50Q2FsbGJhY2spO1xuXG4gICAgdGhpcy5maWVsZHNbJ3JvdW5kJ10uaW5uZXJIVE1MID0gdGhpcy5wYXJhbXMucm91bmQucmVwbGFjZSgnQHJvdW5kJywgcm91bmQpO1xuXG4gICAgaWYgKCFkb25lICYmIHJvdW5kICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHRoaXMuZmllbGRzWydidXR0b24nXS5pbm5lckhUTUwgPSB0aGlzLnBhcmFtcy5uZXh0Um91bmQucmVwbGFjZSgnQHJvdW5kJywgcm91bmQgKyAxKTtcbiAgICAgIHRoaXMuZmllbGRzWydidXR0b24nXS50aXRsZSA9IHRoaXMucGFyYW1zLm5leHRSb3VuZC5yZXBsYWNlKCdAcm91bmQnLCByb3VuZCArIDEpO1xuICAgIH1cblxuICAgIGlmIChkb25lICYmIG1lc3NhZ2UgIT09IHVuZGVmaW5lZCAmJiBtZXNzYWdlICE9PSAnJykge1xuICAgICAgdGhpcy5maWVsZHNbJ21lc3NhZ2UnXS5jbGFzc0xpc3QucmVtb3ZlKCdoNXAtZGlhbG9nY2FyZHMtZ29uZScpO1xuICAgICAgdGhpcy5maWVsZHNbJ21lc3NhZ2UnXS5pbm5lckhUTUwgPSBtZXNzYWdlO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHRoaXMuZmllbGRzWydtZXNzYWdlJ10uY2xhc3NMaXN0LmFkZCgnaDVwLWRpYWxvZ2NhcmRzLWdvbmUnKTtcbiAgICB9XG5cbiAgICByZXN1bHRzLmZvckVhY2gocmVzdWx0ID0+IHtcbiAgICAgIGxldCBzY29yZUhUTUwgPSAocmVzdWx0LnNjb3JlLnZhbHVlICE9PSB1bmRlZmluZWQpID8gcmVzdWx0LnNjb3JlLnZhbHVlIDogJyc7XG4gICAgICBpZiAocmVzdWx0LnNjb3JlLm1heCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHNjb3JlSFRNTCA9IGAke3Njb3JlSFRNTH0mbmJzcDs8c3BhbiBjbGFzcz1cImg1cC1kaWFsb2djYXJkcy1zdW1tYXJ5LXRhYmxlLXJvdy1zY29yZS1kaXZpZGVyXCI+Lzwvc3Bhbj4mbmJzcDske3Jlc3VsdC5zY29yZS5tYXh9YDtcbiAgICAgIH1cbiAgICAgIHRoaXMuZmllbGRzW3Jlc3VsdC5maWVsZF0uaW5uZXJIVE1MID0gc2NvcmVIVE1MO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFNob3cgRE9NLlxuICAgKi9cbiAgc2hvdygpIHtcbiAgICB0aGlzLmNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCdoNXAtZGlhbG9nY2FyZHMtZ29uZScpO1xuICAgIHRoaXMuZmllbGRzWydidXR0b24nXS5mb2N1cygpO1xuICB9XG5cbiAgLyoqXG4gICAqIEhpZGUgRE9NLlxuICAgKi9cbiAgaGlkZSgpIHtcbiAgICB0aGlzLmNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdoNXAtZGlhbG9nY2FyZHMtZ29uZScpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBjb25maXJtYXRpb24gZGlhbG9nIHRvIGJ1dHRvbi5cbiAgICogQHBhcmFtIHtvYmplY3R9IG9wdGlvbnMgRGlhbG9nIG9wdGlvbnMuXG4gICAqIEBwYXJhbSB7ZnVuY3Rpb259IGNsaWNrZWQgQ2FsbGJhY2sgZm9yIGNvbmZpcm1hdGlvbiBidXR0b24uXG4gICAqIEByZXR1cm4ge0g1UC5Db25maXJtYXRpb25EaWFsb2d8dW5kZWZpbmVkfSBDb25maXJtYXRpb24gZGlhbG9nLlxuICAgKi9cbiAgY3JlYXRlQ29uZmlybWF0aW9uRGlhbG9nKG9wdGlvbnMsIGNsaWNrZWQpIHtcbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcblxuICAgIHZhciBjb25maXJtYXRpb25EaWFsb2cgPSBuZXcgSDVQLkNvbmZpcm1hdGlvbkRpYWxvZyh7XG4gICAgICBpbnN0YW5jZTogb3B0aW9ucy5pbnN0YW5jZSxcbiAgICAgIGhlYWRlclRleHQ6IG9wdGlvbnMubDEwbi5oZWFkZXIsXG4gICAgICBkaWFsb2dUZXh0OiBvcHRpb25zLmwxMG4uYm9keSxcbiAgICAgIGNhbmNlbFRleHQ6IG9wdGlvbnMubDEwbi5jYW5jZWxMYWJlbCxcbiAgICAgIGNvbmZpcm1UZXh0OiBvcHRpb25zLmwxMG4uY29uZmlybUxhYmVsXG4gICAgfSk7XG5cbiAgICBjb25maXJtYXRpb25EaWFsb2cub24oJ2NvbmZpcm1lZCcsICgpID0+IHtcbiAgICAgIGNsaWNrZWQoKTtcbiAgICB9KTtcblxuICAgIGNvbmZpcm1hdGlvbkRpYWxvZy5hcHBlbmRUbyh0aGlzLmdldENvbnRhaW5lcigpKTtcblxuICAgIHJldHVybiBjb25maXJtYXRpb25EaWFsb2c7XG4gIH1cblxuICAvKipcbiAgICogRmluZCBjb250YWluZXIgdG8gYXR0YWNoIGRpYWxvZ3MgdG8uXG4gICAqIEByZXR1cm4ge0hUTUxFbGVtZW50fSBDb250YWluZXIgdG8gYXR0YWNoIGRpYWxvZ3MgdG8uXG4gICAqL1xuICBnZXRDb250YWluZXIoKSB7XG4gICAgY29uc3QgJGNvbnRlbnQgPSBINVAualF1ZXJ5KCdbZGF0YS1jb250ZW50LWlkPVwiJyArIHNlbGYuY29udGVudElkICsgJ1wiXS5oNXAtY29udGVudCcpO1xuICAgIGNvbnN0ICRjb250YWluZXJQYXJlbnRzID0gJGNvbnRlbnQucGFyZW50cygnLmg1cC1jb250YWluZXInKTtcblxuICAgIGxldCAkY29udGFpbmVyO1xuICAgIGlmICgkY29udGFpbmVyUGFyZW50cy5sZW5ndGggIT09IDApIHtcbiAgICAgIC8vIHVzZSBwYXJlbnQgaGlnaGVzdCB1cCBpZiBhbnlcbiAgICAgICRjb250YWluZXIgPSAkY29udGFpbmVyUGFyZW50cy5sYXN0KCk7XG4gICAgfVxuICAgIGVsc2UgaWYgKCRjb250ZW50Lmxlbmd0aCAhPT0gMCkge1xuICAgICAgJGNvbnRhaW5lciA9ICRjb250ZW50O1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICRjb250YWluZXIgPSBINVAualF1ZXJ5KGRvY3VtZW50LmJvZHkpO1xuICAgIH1cblxuICAgIHJldHVybiAkY29udGFpbmVyLmdldCgwKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBTdW1tYXJ5U2NyZWVuO1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/scripts/h5p-dialogcards-summary-screen.js\n");

/***/ }),

/***/ "./src/scripts/h5p-dialogcards.js":
/*!****************************************!*\
  !*** ./src/scripts/h5p-dialogcards.js ***!
  \****************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _h5p_dialogcards_card_manager__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./h5p-dialogcards-card-manager */ \"./src/scripts/h5p-dialogcards-card-manager.js\");\n/* harmony import */ var _h5p_dialogcards_summary_screen__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./h5p-dialogcards-summary-screen */ \"./src/scripts/h5p-dialogcards-summary-screen.js\");\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\n\n\nvar $ = H5P.jQuery;\nvar JoubelUI = H5P.JoubelUI;\n\nvar Dialogcards = /*#__PURE__*/function (_H5P$EventDispatcher) {\n  _inheritsLoose(Dialogcards, _H5P$EventDispatcher);\n\n  /**\n   * Initialize module.\n   *\n   * @constructor\n   *\n   * @param {Object} params Parameters.\n   * @param {Number} id Content id.\n   * @param {Object} contentData Content data, e.g. for saveContentState\n   * @returns {DialogCards} self\n   */\n  function Dialogcards(params, id, contentData) {\n    var _this;\n\n    Dialogcards.idCounter++;\n    _this = _H5P$EventDispatcher.call(this) || this;\n    _this.contentId = _this.id = id;\n    _this.previousState = contentData.previousState || {}; // Var cardOrder stores order of cards to allow resuming of card set.\n    // Var progress stores current card index.\n\n    _this.contentData = contentData || {}; // Strip cards with empty sides\n\n    params.dialogs = params.dialogs || [];\n    params.dialogs = params.dialogs.filter(function (dialog) {\n      if (!dialog.front || !dialog.back) {\n        return false;\n      } // Empty front?\n\n\n      if (!dialog.front.text && !dialog.front.image && !dialog.front.audio) {\n        return false;\n      } // Empty back?\n\n\n      var noBackText = !dialog.back.text;\n      var noBackImage = dialog.back.useImageFromFront && !dialog.front.image || !dialog.back.useImageFromFront && !dialog.back.image;\n      var noBackAudio = dialog.back.useAudioFromFront && !dialog.front.audio || !dialog.back.useAudioFromFront && !dialog.back.audio;\n\n      if (noBackText && noBackImage && noBackAudio) {\n        return false;\n      }\n\n      return true;\n    }); // Set default behavior.\n\n    _this.params = $.extend(true, {\n      title: '',\n      mode: 'normal',\n      description: \"Sit in pairs and make up sentences where you include the expressions below.<br/>Example: I should have said yes, HOWEVER I kept my mouth shut.\",\n      next: \"Next\",\n      prev: \"Previous\",\n      retry: \"Retry\",\n      answer: \"Turn\",\n      correctAnswer: 'I got it right!',\n      incorrectAnswer: 'I got it wrong',\n      round: 'Round @round',\n      cardsLeft: 'Cards left: @number',\n      nextRound: 'Proceed to round @round',\n      startOver: 'Start over',\n      showSummary: 'Next',\n      summary: 'Summary',\n      summaryCardsRight: 'Cards you got right:',\n      summaryCardsWrong: 'Cards you got wrong:',\n      summaryCardsNotShown: 'Cards in pool not shown:',\n      summaryOverallScore: 'Overall Score',\n      summaryCardsCompleted: 'Cards you have completed learning:',\n      summaryCompletedRounds: 'Completed rounds:',\n      summaryAllDone: 'Well done! You got all @cards cards correct @max times in a row each!',\n      progressText: \"Card @card of @total\",\n      cardFrontLabel: \"Card front\",\n      cardBackLabel: \"Card back\",\n      tipButtonLabel: 'Show tip',\n      audioNotSupported: 'Your browser does not support this audio',\n      confirmStartingOver: {\n        header: 'Start over?',\n        body: 'All progress will be lost. Are you sure you want to start over?',\n        cancelLabel: 'Cancel',\n        confirmLabel: 'Start over'\n      },\n      dialogs: [{\n        front: {\n          text: 'Horse'\n        },\n        back: {\n          text: 'Hest',\n          useImageFromFront: true,\n          useAudioFromFront: false\n        }\n      } // {\n      //   front: {\n      //     text: 'Cow'\n      //   },\n      //   back: {\n      //     text: 'Ku',\n      //     useImageFromFront: true,\n      //     useAudioFromFront: false\n      //   }\n      // }\n      ],\n      behaviour: {\n        enableRetry: true,\n        disableBackwardsNavigation: false,\n        scaleTextNotCard: false,\n        randomCards: false,\n        maxProficiency: 5,\n        quickProgression: false\n      }\n    }, params); // Check for no texts at all\n\n    _this.hasNoTexts = _this.params.dialogs.every(function (dialog) {\n      return dialog.front.text === '' && dialog.back.text === '';\n    }); // Check for no audios at all\n\n    _this.hasNoAudios = !_this.params.dialogs.some(function (dialog) {\n      return dialog.front.audio || dialog.back.audio && !dialog.back.useAudioFromFront;\n    }); // TODO: Translations\n\n    _this.cards = [];\n    _this.currentCardId = 0;\n    _this.round = 0; // 0 indicates that DOM needs to be set up\n\n    _this.results = _this.previousState.results || []; // Workaround for iOS\n\n    if (screen.orientation) {\n      screen.orientation.addEventListener('change', function () {\n        _this.handleOrientationChange();\n      });\n    } else {\n      window.addEventListener('orientationchange', function () {\n        _this.handleOrientationChange();\n      });\n    }\n    /*\n     * Workaround (hopefully temporary) for KidsLoopLive that for whatever\n     * reason does not use h5p-resizer.js.\n     */\n\n\n    window.addEventListener('resize', function () {\n      _this.resize();\n    });\n    /**\n     * Attach h5p inside the given container.\n     *\n     * @param {jQuery} $container Container.\n     */\n\n    _this.attach = function ($container) {\n      _this.$inner = $container.addClass('h5p-dialogcards');\n\n      if (_this.params.behaviour.scaleTextNotCard) {\n        $container.addClass('h5p-text-scaling');\n      } // KidsLoop customization to prevent dragging the image\n\n\n      _this.$inner.get(0).addEventListener('dragstart', function (event) {\n        event.preventDefault();\n      }); // Only pass what's necessary\n\n\n      var managerParams = {\n        mode: _this.params.mode,\n        dialogs: _this.params.dialogs,\n        audioNotSupported: _this.params.audioNotSupported,\n        answer: _this.params.answer,\n        showSummary: _this.params.showSummary,\n        incorrectAnswer: _this.params.incorrectAnswer,\n        correctAnswer: _this.params.correctAnswer,\n        progressText: _this.params.progressText,\n        tipButtonLabel: _this.params.tipButtonLabel,\n        behaviour: {\n          scaleTextNotCard: _this.params.behaviour.scaleTextNotCard,\n          maxProficiency: _this.params.behaviour.maxProficiency,\n          quickProgression: _this.params.behaviour.quickProgression\n        },\n        cardPiles: _this.previousState.cardPiles\n      };\n      _this.cardManager = new _h5p_dialogcards_card_manager__WEBPACK_IMPORTED_MODULE_0__[\"default\"](managerParams, _this.id, {\n        onCardTurned: _this.handleCardTurned,\n        onNextCard: _this.nextCard\n      });\n\n      _this.createDOM(_this.round === 0);\n      /*\n       * Goto previously viewed card. It was possible to also recover the turned\n       * state, but it feels sensible to let the previously viewed card be\n       * reviewed starting with the front.\n       */\n\n\n      if (_this.previousState.currentCardId !== undefined) {\n        _this.gotoCard(_this.previousState.currentCardId); // Show summary if previous round was completed but next round not started.\n\n\n        if (_this.params.mode === 'repetition' && _this.results.length === _this.cardIds.length) {\n          _this.showSummary(true);\n        }\n      }\n\n      _this.updateNavigation();\n\n      _this.trigger('resize');\n    };\n    /**\n     * Create DOM.\n     * @param {boolean} firstCall Is first call?\n     */\n\n\n    _this.createDOM = function (firstCall) {\n      _this.cardIds = firstCall && _this.previousState.cardIds ? _this.previousState.cardIds : _this.cardManager.createSelection();\n      _this.cardPoolSize = _this.cardPoolSize || _this.cardManager.getSize();\n\n      if (firstCall === true) {\n        var title = $('<div>' + _this.params.title + '</div>').text().trim();\n        _this.$header = $((title ? '<div class=\"h5p-dialogcards-title\"><div class=\"h5p-dialogcards-title-inner\">' + _this.params.title + '</div></div>' : '') + '<div class=\"h5p-dialogcards-description\">' + _this.params.description + '</div>');\n        _this.summaryScreen = new _h5p_dialogcards_summary_screen__WEBPACK_IMPORTED_MODULE_1__[\"default\"](_this.params, {\n          nextRound: _this.nextRound,\n          retry: _this.restartRepetition\n        });\n      }\n\n      if (firstCall === true) {\n        _this.$cardwrapperSet = _this.initCards(_this.cardIds);\n      } else {\n        _this.$cardwrapperSet.detach();\n\n        _this.$cardwrapperSet = _this.initCards(_this.cardIds);\n\n        _this.$cardSideAnnouncer.before(_this.$cardwrapperSet);\n      }\n\n      _this.$cardwrapperSet.prepend(_this.summaryScreen.getDOM());\n\n      if (firstCall === true) {\n        _this.$cardSideAnnouncer = $('<div>', {\n          html: _this.params.cardFrontLabel,\n          'class': 'h5p-dialogcards-card-side-announcer',\n          'aria-live': 'polite',\n          'aria-hidden': 'true'\n        });\n        _this.$footer = _this.createFooter();\n        _this.$mainContent = $('<div>').append(_this.$header).append(_this.$cardwrapperSet).append(_this.$cardSideAnnouncer).append(_this.$footer).appendTo(_this.$inner); // No card has texts\n\n        if (_this.hasNoTexts) {\n          _this.cards.forEach(function (card) {\n            card.setNoText();\n          });\n        }\n\n        _this.on('reset', function () {\n          this.reset();\n        });\n\n        _this.on('resize', _this.resize); // Set round to previous state if available\n\n\n        _this.round = _this.previousState.round !== undefined ? _this.previousState.round : 1;\n      }\n    };\n    /**\n     * Create footer/navigation line\n     *\n     * @returns {*|jQuery|HTMLElement} Footer element\n     */\n\n\n    _this.createFooter = function () {\n      var $footer = $('<nav>', {\n        'class': 'h5p-dialogcards-footer',\n        'role': 'navigation'\n      });\n\n      if (_this.params.mode === 'normal') {\n        _this.$prev = JoubelUI.createButton({\n          'class': 'h5p-dialogcards-footer-button h5p-dialogcards-prev truncated',\n          'aria-label': _this.params.prev,\n          'title': _this.params.prev\n        }).click(function () {\n          _this.prevCard();\n        }).appendTo($footer);\n        _this.$next = JoubelUI.createButton({\n          'class': 'h5p-dialogcards-footer-button h5p-dialogcards-next truncated',\n          'aria-label': _this.params.next,\n          'title': _this.params.next\n        }).click(function () {\n          _this.nextCard();\n        }).appendTo($footer);\n        _this.$retry = JoubelUI.createButton({\n          'class': 'h5p-dialogcards-footer-button h5p-dialogcards-retry h5p-dialogcards-disabled',\n          'title': _this.params.retry,\n          'html': _this.params.retry\n        }).click(function () {\n          _this.trigger('reset');\n        }).appendTo($footer);\n        _this.$progress = $('<div>', {\n          'id': 'h5p-dialogcards-progress-' + Dialogcards.idCounter,\n          'class': 'h5p-dialogcards-progress',\n          'aria-live': 'assertive'\n        }).appendTo($footer);\n      } else {\n        _this.$round = $('<div>', {\n          'class': 'h5p-dialogcards-round'\n        }).appendTo($footer);\n        _this.$progress = $('<div>', {\n          'class': 'h5p-dialogcards-cards-left',\n          'aria-live': 'assertive'\n        }).appendTo($footer);\n      }\n\n      return $footer;\n    };\n    /**\n     * Called when all cards has been loaded.\n     */\n\n\n    _this.updateImageSize = function () {\n      // Find highest card content\n      var relativeHeightCap = 15;\n      var height = 0;\n\n      var $currentCardContent = _this.cards[_this.currentCardId].getDOM().find('.h5p-dialogcards-card-content');\n\n      _this.params.dialogs.forEach(function (dialog) {\n        var imageHeight;\n\n        if (dialog.front.image) {\n          imageHeight = dialog.front.image.height / dialog.front.image.width * $currentCardContent.get(0).getBoundingClientRect().width;\n\n          if (imageHeight > height) {\n            height = imageHeight;\n          }\n        }\n\n        if (dialog.back.image) {\n          imageHeight = dialog.back.image.height / dialog.back.image.width * $currentCardContent.get(0).getBoundingClientRect().width;\n\n          if (imageHeight > height) {\n            height = imageHeight;\n          }\n        }\n      });\n\n      if (height > 0) {\n        var relativeImageHeight = height / parseFloat(_this.$inner.css('font-size'));\n\n        if (relativeImageHeight > relativeHeightCap) {\n          relativeImageHeight = relativeHeightCap;\n        }\n\n        _this.cards.forEach(function (card) {\n          card.setImageHeight(\"\".concat(relativeImageHeight, \"em\"));\n        });\n      }\n    };\n    /**\n     * Creates all cards and appends them to card wrapper.\n     *\n     * @param {object[]} cardIds Card ids.\n     * @returns {*|jQuery|HTMLElement} Card wrapper set\n     */\n\n\n    _this.initCards = function (cardIds) {\n      var initLoad = 2;\n      _this.cards = [];\n      _this.currentCardId = 0; // Randomize cards order\n\n      if (_this.params.behaviour.randomCards) {\n        cardIds = H5P.shuffleArray(cardIds);\n      }\n\n      var $cardwrapperSet = $('<div>', {\n        'class': 'h5p-dialogcards-cardwrap-set'\n      });\n\n      for (var i = 0; i < cardIds.length; i++) {\n        // Load cards progressively\n        if (i >= initLoad) {\n          break;\n        }\n\n        var card = _this.getCard(cardIds[i]);\n\n        card.setProgressText(i + 1, cardIds.length);\n\n        _this.cards.push(card);\n\n        var $cardWrapper = card.getDOM(); // Set current card\n\n        if (i === _this.currentCardId) {\n          $cardWrapper.addClass('h5p-dialogcards-current');\n          _this.$current = $cardWrapper;\n        }\n\n        card.addTipToCard($cardWrapper.find('.h5p-dialogcards-card-content'), 'front', i);\n        $cardwrapperSet.append($cardWrapper);\n      }\n\n      return $cardwrapperSet;\n    };\n    /**\n     * Handle card turned.\n     *\n     * @param {boolean} turned - True, if card is turned.\n     */\n\n\n    _this.handleCardTurned = function (turned) {\n      // a11y notification\n      _this.$cardSideAnnouncer.html(turned ? _this.params.cardFrontLabel : _this.params.cardBackLabel); // retry button\n\n\n      if (_this.params.behaviour.enableRetry && _this.currentCardId + 1 === _this.cardIds.length) {\n        if (_this.$retry) {\n          _this.$retry.removeClass('h5p-dialogcards-disabled');\n\n          _this.truncateRetryButton();\n        }\n      }\n    };\n    /**\n     * Update navigation text and show or hide buttons.\n     */\n\n\n    _this.updateNavigation = function () {\n      if (_this.params.mode === 'normal') {\n        // Final card\n        if (_this.getCurrentSelectionIndex() < _this.cardIds.length - 1) {\n          _this.$next.removeClass('h5p-dialogcards-disabled');\n\n          _this.$retry.addClass('h5p-dialogcards-disabled');\n        } else {\n          _this.$next.addClass('h5p-dialogcards-disabled');\n        } // First card\n\n\n        if (_this.currentCardId > 0 && !_this.params.behaviour.disableBackwardsNavigation) {\n          _this.$prev.removeClass('h5p-dialogcards-disabled');\n        } else {\n          _this.$prev.addClass('h5p-dialogcards-disabled');\n        }\n\n        _this.$progress.text(_this.params.progressText.replace('@card', _this.getCurrentSelectionIndex() + 1).replace('@total', _this.cardIds.length)); // Looks strange, but the Ids get mixed up elsewhere\n\n\n        _this.cards[_this.findCardPosition(_this.cards[_this.currentCardId].id)].resizeOverflowingText();\n      } else {\n        _this.$round.text(_this.params.round.replace('@round', _this.round));\n\n        var selectionIndex = _this.getCurrentSelectionIndex();\n\n        _this.$progress.text(_this.params.cardsLeft.replace('@number', _this.cardIds.length - selectionIndex));\n      }\n\n      _this.trigger('resize');\n    };\n    /**\n     * Show summary screen.\n     * @param {boolean} [previousState = false] If true, piles will not be updated.\n     */\n\n\n    _this.showSummary = function () {\n      var previousState = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n      // Update piles and retrieve the new pile sizes\n      var newPileSizes = previousState ? _this.cardManager.getPileSizes() : _this.cardManager.updatePiles(_this.results);\n\n      var right = _this.results.filter(function (result) {\n        return result.result === true;\n      }).length;\n\n      var wrong = _this.results.length - right;\n      var notShown = _this.cardPoolSize - right - wrong;\n      var completed = newPileSizes.slice(-1)[0];\n      var done = completed === _this.cardPoolSize;\n      var summary = {\n        round: _this.round,\n        results: [{\n          field: 'h5p-dialogcards-round-cards-right',\n          score: {\n            value: right,\n            max: wrong + right\n          }\n        }, {\n          field: 'h5p-dialogcards-round-cards-wrong',\n          score: {\n            value: wrong,\n            max: wrong + right\n          }\n        }, {\n          field: 'h5p-dialogcards-round-cards-not-shown',\n          score: {\n            value: notShown\n          }\n        }, {\n          field: 'h5p-dialogcards-overall-cards-completed',\n          score: {\n            value: completed,\n            max: _this.cardPoolSize\n          }\n        }, {\n          field: 'h5p-dialogcards-overall-completed-rounds',\n          score: {\n            value: _this.round\n          }\n        }]\n      };\n\n      if (done) {\n        summary.done = true;\n        summary.message = _this.params.summaryAllDone.replace('@cards', _this.cardPoolSize).replace('@max', _this.params.behaviour.maxProficiency - 1);\n      }\n\n      _this.summaryScreen.update(summary);\n\n      _this.summaryScreen.show();\n\n      _this.hideCards();\n\n      _this.trigger('resize');\n    };\n    /**\n     * Show main content.\n     */\n\n\n    _this.showCards = function () {\n      _this.$cardwrapperSet.find('.h5p-dialogcards-cardwrap').removeClass('h5p-dialogcards-gone');\n\n      _this.$footer.removeClass('h5p-dialogcards-gone');\n\n      _this.cardsShown = true;\n    };\n    /**\n     * Hide main content.\n     */\n\n\n    _this.hideCards = function () {\n      _this.$cardwrapperSet.find('.h5p-dialogcards-cardwrap').addClass('h5p-dialogcards-gone');\n\n      _this.$footer.addClass('h5p-dialogcards-gone');\n\n      _this.cardsShown = false;\n    };\n    /**\n     * Show next card.\n     *\n     * @param {object} [result] Optional result of repetition mode.\n     */\n\n\n    _this.nextCard = function (result) {\n      if (typeof result !== 'undefined') {\n        _this.results.push(result);\n      }\n\n      _this.cards[_this.currentCardId].stopAudio(); // On final card\n\n\n      if (_this.cardIds.length - _this.getCurrentSelectionIndex() === 1) {\n        if (_this.params.mode === 'repetition') {\n          _this.$progress.text(_this.params.cardsLeft.replace('@number', 0));\n\n          _this.cards[_this.currentCardId].showSummaryButton(_this.showSummary);\n        }\n\n        return;\n      }\n\n      _this.gotoCard(_this.getCurrentSelectionIndex() + 1);\n    };\n    /**\n     * Get card from card manager.\n     * @param {number} id Card's Id.\n     * @return {object} Card.\n     */\n\n\n    _this.getCard = function (id) {\n      var card = _this.cardManager.getCard(id);\n\n      card.createButtonListeners();\n      return card;\n    };\n    /**\n     * Find the position of a loaded card.\n     * @param {number} cardId CardId to look for.\n     * @return {number} Position or undefined.\n     */\n\n\n    _this.findCardPosition = function (cardId) {\n      var position;\n\n      _this.cards.forEach(function (card, index) {\n        if (!position && card.id === cardId) {\n          position = index;\n        }\n      });\n\n      return position;\n    };\n    /**\n     * Insert a card into the DOM.\n     * @param {Card} card Card to insert.\n     * @param {number} [index] Position to insert card at.\n     */\n\n\n    _this.insertCardToDOM = function (card, index) {\n      var $node = card.getDOM(); // Put at appropriate position.\n\n      if (index === undefined) {\n        $node.appendTo(_this.$cardwrapperSet);\n      } else if (index === 0) {\n        _this.$cardwrapperSet.prepend($node);\n      } else {\n        _this.$cardwrapperSet.children().eq(index).after($node);\n      } // Add hints\n\n\n      card.addTipToCard($node.find('.h5p-dialogcards-card-content'), 'front', index);\n    };\n    /**\n     * Go to a specific card in the selection. Cards may need to be loaded.\n     * @param {number} targetPosition Target card position.\n     */\n\n\n    _this.gotoCard = function (targetPosition) {\n      if (targetPosition < 0 || targetPosition >= _this.cardIds.length) {\n        return;\n      } // Stop action on current card\n\n\n      var currentCard = _this.cards[_this.currentCardId];\n      currentCard.stopAudio();\n      currentCard.getDOM().removeClass('h5p-dialogcards-current'); // Get card positions to check for being loaded\n\n      var checkLoaded = [];\n\n      if (targetPosition > 0) {\n        checkLoaded.push(targetPosition - 1);\n      }\n\n      checkLoaded.push(targetPosition);\n\n      if (targetPosition + 1 < _this.cardIds.length) {\n        checkLoaded.push(targetPosition + 1);\n      } // Load and insert target card, predecessor and successor if required.\n\n\n      checkLoaded.forEach(function (position) {\n        var loadedPosition = _this.findCardPosition(_this.cardIds[position]);\n\n        if (loadedPosition === undefined) {\n          // Card has not been loaded. Load now.\n          var card = _this.getCard(_this.cardIds[position]);\n\n          card.setProgressText(position + 1, _this.cardIds.length);\n          /*\n           * Try to find successor card in loaded pile and insert before\n           * or put to the end of the loaded pile.\n           */\n\n          var successorId = Math.min(position + 1, _this.cardIds.length - 1);\n\n          var successor = _this.findCardPosition(_this.cardIds[successorId]);\n\n          var insertPosition = successor || _this.cards.length;\n\n          _this.cards.splice(insertPosition, 0, card);\n\n          _this.insertCardToDOM(card, insertPosition);\n        }\n      });\n\n      _this.resize(); // Retrieve position of id now in *loaded cards*\n\n\n      targetPosition = _this.findCardPosition(_this.cardIds[targetPosition]); // Set classes for card order/display\n\n      _this.cards.forEach(function (card, index) {\n        if (index < targetPosition) {\n          card.getDOM().addClass('h5p-dialogcards-previous');\n        } else {\n          card.getDOM().removeClass('h5p-dialogcards-previous');\n\n          if (index === targetPosition) {\n            card.getDOM().addClass('h5p-dialogcards-current');\n          }\n        }\n      });\n\n      _this.currentCardId = targetPosition;\n\n      _this.updateNavigation();\n\n      _this.cards[_this.currentCardId].setCardFocus();\n    };\n    /**\n     * Show previous card.\n     */\n\n\n    _this.prevCard = function () {\n      _this.gotoCard(_this.getCurrentSelectionIndex() - 1);\n    };\n    /**\n     * Show all audio buttons\n     */\n\n\n    _this.showAllAudio = function () {\n      _this.$cardwrapperSet.find('.h5p-audio-inner').removeClass('hide');\n    };\n\n    _this.restartRepetition = function () {\n      _this.cardManager.reset();\n\n      _this.round = 0;\n\n      _this.nextRound();\n    };\n\n    _this.nextRound = function () {\n      _this.round++;\n\n      _this.summaryScreen.hide();\n\n      _this.showCards();\n\n      _this.reset();\n\n      _this.createDOM();\n\n      _this.updateNavigation();\n\n      _this.cards[_this.currentCardId].setCardFocus(true);\n\n      _this.trigger('resize');\n    };\n    /**\n     * Reset the task so that the user can do it again.\n     */\n\n\n    _this.reset = function () {\n      _this.results = [];\n\n      _this.cards[_this.currentCardId].stopAudio(_this.$current.index()); // Turn all cards to front\n\n\n      _this.cards.forEach(function (card) {\n        card.reset();\n      }); // Show first card\n\n\n      _this.currentCardId = 0;\n\n      if (_this.params.mode === 'normal') {\n        _this.cards[_this.currentCardId].getDOM().addClass('h5p-dialogcards-current');\n      }\n\n      _this.updateNavigation();\n\n      if (_this.$retry) {\n        _this.$retry.addClass('h5p-dialogcards-disabled');\n      }\n\n      _this.showAllAudio();\n\n      _this.cards[_this.currentCardId].resizeOverflowingText();\n\n      _this.cards[_this.currentCardId].setCardFocus();\n    };\n    /**\n     * Update the dimensions of the task when resizing the task.\n     */\n\n\n    _this.resize = function () {\n      var _displayLimits3;\n\n      _this.handleOrientationChange();\n\n      var displayLimits = null;\n      var titleHeight = _this.$inner.find('.h5p-dialogcards-title').outerHeight() || 0;\n      var descriptionHeight = _this.$inner.find('.h5p-dialogcards-description').outerHeight(true) || 0;\n      var footerHeight = _this.$footer.outerHeight() || 0;\n      var nonCardHeight = titleHeight + descriptionHeight + footerHeight;\n\n      var isMobileLandscape = _this.isMobileLandscape(); // Change landscape layout on mobile\n\n\n      if (typeof window.orientation === 'number' && _this.$cardwrapperSet.find('.h5p-dialogcards-summary-screen').hasClass('h5p-dialogcards-gone') && _this.params.behaviour.scaleTextNotCard) {\n        _this.$inner.toggleClass('h5p-landscape', isMobileLandscape);\n\n        if (isMobileLandscape) {\n          var _displayLimits, _displayLimits2;\n\n          displayLimits = _this.isRoot() ? _this.computeDisplayLimitsKLL() : null;\n          var screenHeight = _this.isIOS() && isMobileLandscape ? screen.width : screen.height;\n\n          if (((_displayLimits = displayLimits) === null || _displayLimits === void 0 ? void 0 : _displayLimits.height) === 1) {\n            displayLimits.height = screenHeight;\n          }\n\n          if ((_displayLimits2 = displayLimits) !== null && _displayLimits2 !== void 0 && _displayLimits2.height) {\n            _this.$cardwrapperSet.css('max-height', \"\".concat(displayLimits.height - nonCardHeight, \"px\"));\n          } else {\n            _this.$cardwrapperSet.css('max-height', '');\n          }\n        }\n      } else {\n        _this.$cardwrapperSet.css('max-height', '');\n      }\n\n      var maxHeight = 0;\n\n      if (!displayLimits || !isMobileLandscape || !_this.params.behaviour.scaleTextNotCard) {\n        _this.updateImageSize();\n      } else {\n        _this.cards.forEach(function (card) {\n          card.setImageHeight('');\n        });\n      }\n\n      if (!_this.params.behaviour.scaleTextNotCard && _this.cardsShown !== false) {\n        _this.determineCardSizes();\n      }\n\n      if (!_this.params.behaviour.scaleTextNotCard || !isMobileLandscape || !((_displayLimits3 = displayLimits) !== null && _displayLimits3 !== void 0 && _displayLimits3.height) || !_this.$cardwrapperSet.find('.h5p-dialogcards-summary-screen').hasClass('h5p-dialogcards-gone')) {\n        // Reset card-wrapper-set height\n        _this.$cardwrapperSet.css('height', 'auto'); // Find max required height for all cards\n\n\n        _this.$cardwrapperSet.children(':not(.h5p-dialogcards-gone)').each(function () {\n          var wrapperHeight = $(this).css('height', 'initial').outerHeight();\n          $(this).css('height', 'inherit');\n          maxHeight = Math.max(wrapperHeight, maxHeight); // Check height\n\n          if (!$(this).next('.h5p-dialogcards-cardwrap').length) {\n            var initialHeight = $(this).find('.h5p-dialogcards-cardholder').css('height', 'initial').outerHeight();\n            maxHeight = Math.max(initialHeight, maxHeight);\n            $(this).find('.h5p-dialogcards-cardholder').css('height', 'inherit');\n          }\n        });\n\n        var relativeMaxHeight = maxHeight / parseFloat(_this.$cardwrapperSet.css('font-size'));\n\n        _this.$cardwrapperSet.css('height', relativeMaxHeight + 'em');\n      } else {\n        var _displayLimits4;\n\n        if (((_displayLimits4 = displayLimits) === null || _displayLimits4 === void 0 ? void 0 : _displayLimits4.height) - nonCardHeight > 1) {\n          var _displayLimits5;\n\n          _this.$cardwrapperSet.css('height', \"\".concat(((_displayLimits5 = displayLimits) === null || _displayLimits5 === void 0 ? void 0 : _displayLimits5.height) - nonCardHeight, \"px\"));\n        }\n      }\n\n      _this.scaleToFitHeight();\n\n      _this.truncateRetryButton();\n\n      _this.cards[_this.currentCardId].resizeOverflowingText();\n    };\n    /**\n     * Resizes each card to fit its text\n     */\n\n\n    _this.determineCardSizes = function () {\n      var self = _assertThisInitialized(_this);\n\n      if (_this.cardSizeDetermined === undefined) {\n        // Keep track of which cards we've already determined size for\n        _this.cardSizeDetermined = [];\n      } // Go through each card\n\n\n      _this.$cardwrapperSet.children(':visible').each(function (i) {\n        var cardId = self.cards[i].id;\n\n        if (self.cardSizeDetermined.indexOf(cardId) !== -1) {\n          return; // Already determined, no need to determine again.\n        }\n\n        self.cardSizeDetermined.push(cardId); // Here \"this\" references the jQuery object\n\n        var $content = $('.h5p-dialogcards-card-content', this);\n        var $text = $('.h5p-dialogcards-card-text-inner-content', $content); // Grab size with text\n\n        var textHeight = $text[0].getBoundingClientRect().height; // Change to answer\n\n        var currentCard = self.cards[i];\n        currentCard.changeText(currentCard.getAnswer()); // Grab size with answer\n\n        var answerHeight = $text[0].getBoundingClientRect().height; // Use highest\n\n        var useHeight = textHeight > answerHeight ? textHeight : answerHeight; // Min. limit\n\n        var minHeight = parseFloat($text.parent().parent().css('minHeight'));\n\n        if (useHeight < minHeight) {\n          useHeight = minHeight;\n        } // None of the cards has text, shrink text area, leave space for audio\n\n\n        if (self.hasNoTexts) {\n          var $cardText = $text.find('.h5p-dialogcards-card-text');\n          useHeight = self.hasNoAudios ? 0 : useHeight - parseFloat($cardText.css('height'));\n          $cardText.css('height', 0);\n        } // Convert to em\n\n\n        var fontSize = parseFloat($content.css('fontSize'));\n        useHeight /= fontSize; // Set height\n\n        $text.parent().css('height', useHeight + 'em'); // Change back to text\n\n        currentCard.changeText(currentCard.getText());\n      });\n    };\n    /**\n     * Scales the card contents.\n     */\n\n\n    _this.scaleToFitHeight = function () {\n      if (!_this.$cardwrapperSet || !_this.$cardwrapperSet.is(':visible') || !_this.params.behaviour.scaleTextNotCard) {\n        return;\n      } // Resize font size to fit inside CP\n\n\n      if (_this.$inner.parents('.h5p-course-presentation').length) {\n        var $parentContainer = _this.$inner.parent();\n\n        if (_this.$inner.parents('.h5p-popup-container').length) {\n          $parentContainer = _this.$inner.parents('.h5p-popup-container');\n        }\n\n        var containerHeight = $parentContainer.get(0).getBoundingClientRect().height;\n\n        var getContentHeight = function getContentHeight() {\n          var contentHeight = 0;\n\n          _this.$inner.children().each(function () {\n            // Here \"this\" references the jQuery object\n            var $child = $(this);\n            contentHeight += this.getBoundingClientRect().height + parseFloat($child.css('margin-top')) + parseFloat($child.css('margin-bottom'));\n          });\n\n          return contentHeight;\n        };\n\n        var contentHeight = getContentHeight();\n        var parentFontSize = parseFloat(_this.$inner.parent().css('font-size'));\n        var newFontSize = parseFloat(_this.$inner.css('font-size')); // Decrease font size\n\n        if (containerHeight < contentHeight) {\n          while (containerHeight < contentHeight) {\n            newFontSize -= Dialogcards.SCALEINTERVAL; // Cap at min font size\n\n            if (newFontSize < Dialogcards.MINSCALE) {\n              break;\n            } // Set relative font size to scale with full screen.\n\n\n            _this.$inner.css('font-size', newFontSize / parentFontSize + 'em');\n\n            contentHeight = getContentHeight();\n          }\n        } else {\n          // Increase font size\n          var increaseFontSize = true;\n\n          while (increaseFontSize) {\n            newFontSize += Dialogcards.SCALEINTERVAL; // Cap max font size\n\n            if (newFontSize > Dialogcards.MAXSCALE) {\n              increaseFontSize = false;\n              break;\n            } // Set relative font size to scale with full screen.\n\n\n            var relativeFontSize = newFontSize / parentFontSize;\n\n            _this.$inner.css('font-size', relativeFontSize + 'em');\n\n            contentHeight = getContentHeight();\n\n            if (containerHeight <= contentHeight) {\n              increaseFontSize = false;\n              relativeFontSize = (newFontSize - Dialogcards.SCALEINTERVAL) / parentFontSize;\n\n              _this.$inner.css('font-size', relativeFontSize + 'em');\n            }\n          }\n        }\n      } else {\n        // Resize mobile view\n        _this.cards[_this.currentCardId].resizeOverflowingText();\n      }\n    };\n    /**\n     * Truncate retry button if width is small.\n     */\n\n\n    _this.truncateRetryButton = function () {\n      if (!_this.$retry) {\n        return;\n      } // Reset button to full size\n\n\n      _this.$retry.removeClass('truncated');\n\n      _this.$retry.html(_this.params.retry); // Measure button\n\n\n      var maxWidthPercentages = 0.3;\n      var retryWidth = _this.$retry.get(0).getBoundingClientRect().width + parseFloat(_this.$retry.css('margin-left')) + parseFloat(_this.$retry.css('margin-right'));\n\n      var retryWidthPercentage = retryWidth / _this.$retry.parent().get(0).getBoundingClientRect().width; // Truncate button\n\n\n      if (retryWidthPercentage > maxWidthPercentages) {\n        _this.$retry.addClass('truncated');\n\n        _this.$retry.html('');\n      }\n    };\n    /**\n     * Retrieve index of card in selection, not loaded cards.\n     */\n\n\n    _this.getCurrentSelectionIndex = function () {\n      return _this.cardIds.indexOf(_this.cards[_this.currentCardId].id);\n    };\n    /**\n     * Get the content type title.\n     *\n     * @return {string} title.\n     */\n\n\n    _this.getTitle = function () {\n      return H5P.createTitle(_this.contentData && _this.contentData.metadata && _this.contentData.metadata.title ? _this.contentData.metadata.title : 'Dialog Cards');\n    };\n    /**\n     * Save the current state to be restored later.\n     */\n\n\n    _this.getCurrentState = function () {\n      return {\n        cardPiles: _this.cardManager.getPiles(),\n        cardIds: _this.cardIds,\n        round: _this.round,\n        currentCardId: _this.getCurrentSelectionIndex(),\n        results: _this.results\n      };\n    };\n\n    return _this;\n  }\n  /**\n   * Compute display limits.\n   * @return {object|null} Height and width in px or null if cannot be determined.\n   */\n\n\n  var _proto = Dialogcards.prototype;\n\n  _proto.computeDisplayLimits = function computeDisplayLimits() {\n    var topWindow = this.getTopWindow(); // iOS doesn't change screen dimensions on rotation\n\n    var screenSize = this.isIOS() && this.getOrientation() === 'landscape' ? {\n      height: screen.width,\n      width: screen.height\n    } : {\n      height: screen.height,\n      width: screen.width\n    };\n    topWindow = topWindow || {\n      innerHeight: screenSize.height,\n      innerWidth: screenSize.width\n    }; // Smallest value of viewport and container wins\n\n    return {\n      height: Math.min(topWindow.innerHeight, screenSize.height),\n      width: Math.min(topWindow.innerWidth, this.$inner.get(0).offsetWidth)\n    };\n  }\n  /**\n   * Compute display limits for KidsLoop Live.\n   * @return {object|null} Height and width in px or null if cannot be determined.\n   */\n  ;\n\n  _proto.computeDisplayLimitsKLL = function computeDisplayLimitsKLL() {\n    var displayLimits = this.computeDisplayLimits(); // This only works because KLL enforces height on H5P's iframe\n\n    displayLimits.height = Math.min(displayLimits.height, document.body.offsetHeight);\n    return displayLimits;\n  }\n  /**\n   * Detect whether user is running iOS.\n   * @return {boolean} True, if user is running iOS.\n   */\n  ;\n\n  _proto.isIOS = function isIOS() {\n    return ['iPad Simulator', 'iPhone Simulator', 'iPod Simulator', 'iPad', 'iPhone', 'iPod'].includes(navigator.platform) || navigator.userAgent.includes('Mac') && 'ontouchend' in document;\n  }\n  /**\n   * Determine whether mobile device in landscape orientation.\n   * @return {boolean} True, if mobile device in landscape orientation.\n   */\n  ;\n\n  _proto.isMobileLandscape = function isMobileLandscape() {\n    return this.isMobileDevice() && this.getOrientation() === 'landscape';\n  }\n  /**\n   * Detect mobile devices (http://detectmobilebrowsers.com/)\n   * @returns {boolean} True if running on a mobile device.\n   */\n  ;\n\n  _proto.isMobileDevice = function isMobileDevice() {\n    var check = false;\n\n    (function (a) {\n      if (/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(a.substr(0, 4))) check = true;\n    })(navigator.userAgent || navigator.vendor || window.opera);\n\n    return check;\n  }\n  /**\n   * Get device orientation.\n   * @return {string} 'portrait' or 'landscape'.\n   */\n  ;\n\n  _proto.getOrientation = function getOrientation() {\n    if (screen.orientation && screen.orientation.type) {\n      if (screen.orientation.type.includes('portrait')) {\n        return 'portrait';\n      } else if (screen.orientation.type.includes('landscape')) {\n        return 'landscape';\n      }\n    } // Unreliable, as not clear what device's natural orientation is\n\n\n    if (typeof window.orientation === 'number') {\n      if (window.orientation === 0 || window.orientation === 180) {\n        return 'portrait';\n      } else if (window.orientation === 90 || window.orientation === -90 || window.orientation === 270) {\n        return 'landscape';\n      }\n    }\n\n    return 'landscape'; // Assume default\n  }\n  /**\n  * Get top DOM Window object.\n  * @param {Window} [startWindow=window] Window to start looking from.\n  * @return {Window|null} Top window.\n  */\n  ;\n\n  _proto.getTopWindow = function getTopWindow(startWindow) {\n    var sameOrigin;\n    startWindow = startWindow || window; // H5P iframe may be on different domain than iframe content\n\n    try {\n      sameOrigin = startWindow.parent.location.host === window.location.host;\n    } catch (error) {\n      sameOrigin = null;\n    }\n\n    if (!sameOrigin) {\n      return null;\n    }\n\n    if (startWindow.parent === startWindow || !startWindow.parent) {\n      return startWindow;\n    }\n\n    return this.getTopWindow(startWindow.parent);\n  }\n  /**\n   * Handle orientation change.\n   */\n  ;\n\n  _proto.handleOrientationChange = function handleOrientationChange() {\n    var _this2 = this;\n\n    if (!this.params.behaviour.scaleTextNotCard) {\n      return;\n    }\n\n    var isMobileLandscape = this.isMobileLandscape();\n    this.cards.forEach(function (card) {\n      if (_this2.params.mode === 'repetition') {\n        card.$buttonTurn.text(isMobileLandscape ? '' : _this2.params.answer);\n        card.$buttonCorrect.text(isMobileLandscape ? '' : _this2.params.correctAnswer);\n        card.$buttonIncorrect.text(isMobileLandscape ? '' : _this2.params.incorrectAnswer);\n      }\n\n      if (!isMobileLandscape) {\n        _this2.$cardwrapperSet.css('max-height', '');\n      }\n    });\n  };\n\n  return Dialogcards;\n}(H5P.EventDispatcher);\n\nDialogcards.idCounter = 0; // Constants\n\nDialogcards.SCALEINTERVAL = 0.2;\nDialogcards.MAXSCALE = 16;\nDialogcards.MINSCALE = 4;\n/* harmony default export */ __webpack_exports__[\"default\"] = (Dialogcards);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvc2NyaXB0cy9oNXAtZGlhbG9nY2FyZHMuanMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUVBO0FBQ0E7O0FBRUE7OztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTs7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUdBOztBQUNBOztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBOztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFFQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBSkE7QUFXQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFwQkE7QUFzQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFOQTtBQXhEQTs7QUFtRUE7QUFBQTtBQUFBOztBQUdBO0FBQUE7QUFBQTs7QUFJQTtBQUVBO0FBQ0E7O0FBQ0E7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBQ0E7QUFDQTs7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFmQTtBQWtCQTtBQUNBO0FBQ0E7QUFGQTs7QUFLQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUlBOztBQUVBO0FBQ0E7QUFDQTtBQUdBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBRUE7O0FBQ0E7O0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU9BO0FBRUE7O0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7OztBQUdBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFFQTtBQUNBO0FBREE7QUFJQTtBQUNBO0FBQ0E7QUFGQTtBQUlBOztBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFDQTtBQUNBO0FBQ0E7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBR0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFEQTs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUNBOztBQUVBOztBQUNBOztBQUdBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBQ0E7QUFDQTtBQUVBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7O0FBRUE7OztBQU1BO0FBQ0E7QUFFQTs7QUFDQTs7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFBQTtBQUNBO0FBQ0E7O0FBSUE7QUFBQTtBQUFBOztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUZBO0FBS0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUZBO0FBS0E7QUFDQTtBQUFBO0FBQUE7QUFGQTtBQUtBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFGQTtBQUtBO0FBQ0E7QUFBQTtBQUFBO0FBRkE7QUFuQkE7O0FBMEJBO0FBQ0E7QUFDQTtBQUdBOztBQUVBOztBQUNBOztBQUNBOztBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7O0FBQ0E7O0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTs7QUFDQTs7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7OztBQUdBO0FBQ0E7QUFDQTs7QUFDQTtBQUNBOztBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7O0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBOztBQUdBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBOzs7QUFHQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7O0FBR0E7O0FBQ0E7QUFDQTtBQUNBOztBQUNBOztBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTs7QUFDQTtBQUVBO0FBQ0E7O0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7OztBQUdBOztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFDQTs7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFFQTs7QUFFQTtBQUNBOztBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBOzs7QUFDQTtBQUNBOztBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7OztBQUdBOztBQUNBO0FBQ0E7QUFDQTs7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBQ0E7O0FBRUE7O0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFBQTs7QUFDQTs7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUVBOztBQUVBOzs7QUFHQTtBQUtBOztBQUVBO0FBQUE7O0FBQ0E7QUFFQTs7QUFJQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBOztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFDQTs7QUFDQTtBQUNBO0FBQ0E7O0FBQ0E7QUFBQTs7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBQ0E7O0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBQ0E7O0FBR0E7QUFDQTs7QUFHQTs7QUFHQTtBQUNBOztBQUdBOztBQUdBOztBQUdBOztBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTs7QUFHQTs7QUFHQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBOztBQUNBO0FBQ0E7QUFDQTs7QUFDQTs7QUFDQTtBQUNBOztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7O0FBQ0E7QUFDQTs7QUFDQTtBQUNBO0FBQ0E7O0FBR0E7QUFDQTtBQUNBOztBQUdBO0FBQ0E7QUFDQTs7O0FBR0E7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFDQTtBQUNBOztBQUdBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTs7QUFDQTs7QUFDQTs7QUFDQTtBQUNBO0FBQ0E7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7O0FBQ0E7OztBQUdBO0FBQ0E7O0FBRUE7OztBQUdBO0FBQ0E7O0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBOzs7QUFDQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTEE7QUFPQTs7QUE1L0JBO0FBNi9CQTtBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQUNBO0FBQ0E7O0FBR0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFGQTs7QUFNQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7O0FBR0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFJQTtBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTs7QUFDQTtBQUNBO0FBQ0E7O0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBOztBQUdBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBOzs7QUFDQTtBQUFBOztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUF4cENBOztBQTJwQ0E7O0FBR0E7QUFDQTtBQUNBO0FBRUEiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9oNXAtZGlhbG9nY2FyZHMvLi9zcmMvc2NyaXB0cy9oNXAtZGlhbG9nY2FyZHMuanM/OTc5NCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQ2FyZE1hbmFnZXIgZnJvbSAnLi9oNXAtZGlhbG9nY2FyZHMtY2FyZC1tYW5hZ2VyJztcbmltcG9ydCBTdW1tYXJ5U2NyZWVuIGZyb20gJy4vaDVwLWRpYWxvZ2NhcmRzLXN1bW1hcnktc2NyZWVuJztcblxuY29uc3QgJCA9IEg1UC5qUXVlcnk7XG5jb25zdCBKb3ViZWxVSSA9IEg1UC5Kb3ViZWxVSTtcblxuY2xhc3MgRGlhbG9nY2FyZHMgZXh0ZW5kcyBINVAuRXZlbnREaXNwYXRjaGVyIHtcbiAgLyoqXG4gICAqIEluaXRpYWxpemUgbW9kdWxlLlxuICAgKlxuICAgKiBAY29uc3RydWN0b3JcbiAgICpcbiAgICogQHBhcmFtIHtPYmplY3R9IHBhcmFtcyBQYXJhbWV0ZXJzLlxuICAgKiBAcGFyYW0ge051bWJlcn0gaWQgQ29udGVudCBpZC5cbiAgICogQHBhcmFtIHtPYmplY3R9IGNvbnRlbnREYXRhIENvbnRlbnQgZGF0YSwgZS5nLiBmb3Igc2F2ZUNvbnRlbnRTdGF0ZVxuICAgKiBAcmV0dXJucyB7RGlhbG9nQ2FyZHN9IHNlbGZcbiAgICovXG4gIGNvbnN0cnVjdG9yKHBhcmFtcywgaWQsIGNvbnRlbnREYXRhKSB7XG4gICAgRGlhbG9nY2FyZHMuaWRDb3VudGVyKys7XG4gICAgc3VwZXIoKTtcblxuICAgIHRoaXMuY29udGVudElkID0gdGhpcy5pZCA9IGlkO1xuICAgIHRoaXMucHJldmlvdXNTdGF0ZSA9IGNvbnRlbnREYXRhLnByZXZpb3VzU3RhdGUgfHwge307XG5cbiAgICAvLyBWYXIgY2FyZE9yZGVyIHN0b3JlcyBvcmRlciBvZiBjYXJkcyB0byBhbGxvdyByZXN1bWluZyBvZiBjYXJkIHNldC5cbiAgICAvLyBWYXIgcHJvZ3Jlc3Mgc3RvcmVzIGN1cnJlbnQgY2FyZCBpbmRleC5cbiAgICB0aGlzLmNvbnRlbnREYXRhID0gY29udGVudERhdGEgfHwge307XG5cbiAgICAvLyBTdHJpcCBjYXJkcyB3aXRoIGVtcHR5IHNpZGVzXG4gICAgcGFyYW1zLmRpYWxvZ3MgPSBwYXJhbXMuZGlhbG9ncyB8fCBbXTtcbiAgICBwYXJhbXMuZGlhbG9ncyA9IHBhcmFtcy5kaWFsb2dzLmZpbHRlcihkaWFsb2cgPT4ge1xuICAgICAgaWYgKCFkaWFsb2cuZnJvbnQgfHwgIWRpYWxvZy5iYWNrKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgLy8gRW1wdHkgZnJvbnQ/XG4gICAgICBpZiAoIWRpYWxvZy5mcm9udC50ZXh0ICYmICFkaWFsb2cuZnJvbnQuaW1hZ2UgJiYgIWRpYWxvZy5mcm9udC5hdWRpbykge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIC8vIEVtcHR5IGJhY2s/XG4gICAgICBjb25zdCBub0JhY2tUZXh0ID0gIWRpYWxvZy5iYWNrLnRleHQ7XG4gICAgICBjb25zdCBub0JhY2tJbWFnZSA9ICgoZGlhbG9nLmJhY2sudXNlSW1hZ2VGcm9tRnJvbnQgJiYgIWRpYWxvZy5mcm9udC5pbWFnZSkgfHwgKCFkaWFsb2cuYmFjay51c2VJbWFnZUZyb21Gcm9udCAmJiAhZGlhbG9nLmJhY2suaW1hZ2UpKTtcbiAgICAgIGNvbnN0IG5vQmFja0F1ZGlvID0gKChkaWFsb2cuYmFjay51c2VBdWRpb0Zyb21Gcm9udCAmJiAhZGlhbG9nLmZyb250LmF1ZGlvKSB8fCAoIWRpYWxvZy5iYWNrLnVzZUF1ZGlvRnJvbUZyb250ICYmICFkaWFsb2cuYmFjay5hdWRpbykpO1xuICAgICAgaWYgKG5vQmFja1RleHQgJiYgbm9CYWNrSW1hZ2UgJiYgbm9CYWNrQXVkaW8pIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9KTtcblxuICAgIC8vIFNldCBkZWZhdWx0IGJlaGF2aW9yLlxuICAgIHRoaXMucGFyYW1zID0gJC5leHRlbmQodHJ1ZSwge1xuICAgICAgdGl0bGU6ICcnLFxuICAgICAgbW9kZTogJ25vcm1hbCcsXG4gICAgICBkZXNjcmlwdGlvbjogXCJTaXQgaW4gcGFpcnMgYW5kIG1ha2UgdXAgc2VudGVuY2VzIHdoZXJlIHlvdSBpbmNsdWRlIHRoZSBleHByZXNzaW9ucyBiZWxvdy48YnIvPkV4YW1wbGU6IEkgc2hvdWxkIGhhdmUgc2FpZCB5ZXMsIEhPV0VWRVIgSSBrZXB0IG15IG1vdXRoIHNodXQuXCIsXG4gICAgICBuZXh0OiBcIk5leHRcIixcbiAgICAgIHByZXY6IFwiUHJldmlvdXNcIixcbiAgICAgIHJldHJ5OiBcIlJldHJ5XCIsXG4gICAgICBhbnN3ZXI6IFwiVHVyblwiLFxuICAgICAgY29ycmVjdEFuc3dlcjogJ0kgZ290IGl0IHJpZ2h0IScsXG4gICAgICBpbmNvcnJlY3RBbnN3ZXI6ICdJIGdvdCBpdCB3cm9uZycsXG4gICAgICByb3VuZDogJ1JvdW5kIEByb3VuZCcsXG4gICAgICBjYXJkc0xlZnQ6ICdDYXJkcyBsZWZ0OiBAbnVtYmVyJyxcbiAgICAgIG5leHRSb3VuZDogJ1Byb2NlZWQgdG8gcm91bmQgQHJvdW5kJyxcbiAgICAgIHN0YXJ0T3ZlcjogJ1N0YXJ0IG92ZXInLFxuICAgICAgc2hvd1N1bW1hcnk6ICdOZXh0JyxcbiAgICAgIHN1bW1hcnk6ICdTdW1tYXJ5JyxcbiAgICAgIHN1bW1hcnlDYXJkc1JpZ2h0OiAnQ2FyZHMgeW91IGdvdCByaWdodDonLFxuICAgICAgc3VtbWFyeUNhcmRzV3Jvbmc6ICdDYXJkcyB5b3UgZ290IHdyb25nOicsXG4gICAgICBzdW1tYXJ5Q2FyZHNOb3RTaG93bjogJ0NhcmRzIGluIHBvb2wgbm90IHNob3duOicsXG4gICAgICBzdW1tYXJ5T3ZlcmFsbFNjb3JlOiAnT3ZlcmFsbCBTY29yZScsXG4gICAgICBzdW1tYXJ5Q2FyZHNDb21wbGV0ZWQ6ICdDYXJkcyB5b3UgaGF2ZSBjb21wbGV0ZWQgbGVhcm5pbmc6JyxcbiAgICAgIHN1bW1hcnlDb21wbGV0ZWRSb3VuZHM6ICdDb21wbGV0ZWQgcm91bmRzOicsXG4gICAgICBzdW1tYXJ5QWxsRG9uZTogJ1dlbGwgZG9uZSEgWW91IGdvdCBhbGwgQGNhcmRzIGNhcmRzIGNvcnJlY3QgQG1heCB0aW1lcyBpbiBhIHJvdyBlYWNoIScsXG4gICAgICBwcm9ncmVzc1RleHQ6IFwiQ2FyZCBAY2FyZCBvZiBAdG90YWxcIixcbiAgICAgIGNhcmRGcm9udExhYmVsOiBcIkNhcmQgZnJvbnRcIixcbiAgICAgIGNhcmRCYWNrTGFiZWw6IFwiQ2FyZCBiYWNrXCIsXG4gICAgICB0aXBCdXR0b25MYWJlbDogJ1Nob3cgdGlwJyxcbiAgICAgIGF1ZGlvTm90U3VwcG9ydGVkOiAnWW91ciBicm93c2VyIGRvZXMgbm90IHN1cHBvcnQgdGhpcyBhdWRpbycsXG4gICAgICBjb25maXJtU3RhcnRpbmdPdmVyOiB7XG4gICAgICAgIGhlYWRlcjogJ1N0YXJ0IG92ZXI/JyxcbiAgICAgICAgYm9keTogJ0FsbCBwcm9ncmVzcyB3aWxsIGJlIGxvc3QuIEFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBzdGFydCBvdmVyPycsXG4gICAgICAgIGNhbmNlbExhYmVsOiAnQ2FuY2VsJyxcbiAgICAgICAgY29uZmlybUxhYmVsOiAnU3RhcnQgb3ZlcidcbiAgICAgIH0sXG4gICAgICBkaWFsb2dzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBmcm9udDoge1xuICAgICAgICAgICAgdGV4dDogJ0hvcnNlJ1xuICAgICAgICAgIH0sXG4gICAgICAgICAgYmFjazoge1xuICAgICAgICAgICAgdGV4dDogJ0hlc3QnLFxuICAgICAgICAgICAgdXNlSW1hZ2VGcm9tRnJvbnQ6IHRydWUsXG4gICAgICAgICAgICB1c2VBdWRpb0Zyb21Gcm9udDogZmFsc2VcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8ge1xuICAgICAgICAvLyAgIGZyb250OiB7XG4gICAgICAgIC8vICAgICB0ZXh0OiAnQ293J1xuICAgICAgICAvLyAgIH0sXG4gICAgICAgIC8vICAgYmFjazoge1xuICAgICAgICAvLyAgICAgdGV4dDogJ0t1JyxcbiAgICAgICAgLy8gICAgIHVzZUltYWdlRnJvbUZyb250OiB0cnVlLFxuICAgICAgICAvLyAgICAgdXNlQXVkaW9Gcm9tRnJvbnQ6IGZhbHNlXG4gICAgICAgIC8vICAgfVxuICAgICAgICAvLyB9XG4gICAgICBdLFxuICAgICAgYmVoYXZpb3VyOiB7XG4gICAgICAgIGVuYWJsZVJldHJ5OiB0cnVlLFxuICAgICAgICBkaXNhYmxlQmFja3dhcmRzTmF2aWdhdGlvbjogZmFsc2UsXG4gICAgICAgIHNjYWxlVGV4dE5vdENhcmQ6IGZhbHNlLFxuICAgICAgICByYW5kb21DYXJkczogZmFsc2UsXG4gICAgICAgIG1heFByb2ZpY2llbmN5OiA1LFxuICAgICAgICBxdWlja1Byb2dyZXNzaW9uOiBmYWxzZVxuICAgICAgfVxuICAgIH0sIHBhcmFtcyk7XG5cbiAgICAvLyBDaGVjayBmb3Igbm8gdGV4dHMgYXQgYWxsXG4gICAgdGhpcy5oYXNOb1RleHRzID0gdGhpcy5wYXJhbXMuZGlhbG9ncy5ldmVyeShkaWFsb2cgPT4gZGlhbG9nLmZyb250LnRleHQgPT09ICcnICYmIGRpYWxvZy5iYWNrLnRleHQgPT09ICcnKTtcblxuICAgIC8vIENoZWNrIGZvciBubyBhdWRpb3MgYXQgYWxsXG4gICAgdGhpcy5oYXNOb0F1ZGlvcyA9ICF0aGlzLnBhcmFtcy5kaWFsb2dzLnNvbWUoZGlhbG9nID0+IGRpYWxvZy5mcm9udC5hdWRpbyB8fCAoZGlhbG9nLmJhY2suYXVkaW8gJiYgIWRpYWxvZy5iYWNrLnVzZUF1ZGlvRnJvbUZyb250KSk7XG5cbiAgICAvLyBUT0RPOiBUcmFuc2xhdGlvbnNcblxuICAgIHRoaXMuY2FyZHMgPSBbXTtcblxuICAgIHRoaXMuY3VycmVudENhcmRJZCA9IDA7XG4gICAgdGhpcy5yb3VuZCA9IDA7IC8vIDAgaW5kaWNhdGVzIHRoYXQgRE9NIG5lZWRzIHRvIGJlIHNldCB1cFxuICAgIHRoaXMucmVzdWx0cyA9IHRoaXMucHJldmlvdXNTdGF0ZS5yZXN1bHRzIHx8IFtdO1xuXG4gICAgLy8gV29ya2Fyb3VuZCBmb3IgaU9TXG4gICAgaWYgKHNjcmVlbi5vcmllbnRhdGlvbikge1xuICAgICAgc2NyZWVuLm9yaWVudGF0aW9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsICgpID0+IHtcbiAgICAgICAgdGhpcy5oYW5kbGVPcmllbnRhdGlvbkNoYW5nZSgpO1xuICAgICAgfSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ29yaWVudGF0aW9uY2hhbmdlJywgKCkgPT4ge1xuICAgICAgICB0aGlzLmhhbmRsZU9yaWVudGF0aW9uQ2hhbmdlKCk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvKlxuICAgICAqIFdvcmthcm91bmQgKGhvcGVmdWxseSB0ZW1wb3JhcnkpIGZvciBLaWRzTG9vcExpdmUgdGhhdCBmb3Igd2hhdGV2ZXJcbiAgICAgKiByZWFzb24gZG9lcyBub3QgdXNlIGg1cC1yZXNpemVyLmpzLlxuICAgICAqL1xuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCAoKSA9PiB7XG4gICAgICB0aGlzLnJlc2l6ZSgpO1xuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogQXR0YWNoIGg1cCBpbnNpZGUgdGhlIGdpdmVuIGNvbnRhaW5lci5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7alF1ZXJ5fSAkY29udGFpbmVyIENvbnRhaW5lci5cbiAgICAgKi9cbiAgICB0aGlzLmF0dGFjaCA9ICgkY29udGFpbmVyKSA9PiB7XG4gICAgICB0aGlzLiRpbm5lciA9ICRjb250YWluZXIuYWRkQ2xhc3MoJ2g1cC1kaWFsb2djYXJkcycpO1xuICAgICAgaWYgKHRoaXMucGFyYW1zLmJlaGF2aW91ci5zY2FsZVRleHROb3RDYXJkKSB7XG4gICAgICAgICRjb250YWluZXIuYWRkQ2xhc3MoJ2g1cC10ZXh0LXNjYWxpbmcnKTtcbiAgICAgIH1cblxuICAgICAgLy8gS2lkc0xvb3AgY3VzdG9taXphdGlvbiB0byBwcmV2ZW50IGRyYWdnaW5nIHRoZSBpbWFnZVxuICAgICAgdGhpcy4kaW5uZXIuZ2V0KDApLmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdzdGFydCcsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIE9ubHkgcGFzcyB3aGF0J3MgbmVjZXNzYXJ5XG4gICAgICBjb25zdCBtYW5hZ2VyUGFyYW1zID0ge1xuICAgICAgICBtb2RlOiB0aGlzLnBhcmFtcy5tb2RlLFxuICAgICAgICBkaWFsb2dzOiB0aGlzLnBhcmFtcy5kaWFsb2dzLFxuICAgICAgICBhdWRpb05vdFN1cHBvcnRlZDogdGhpcy5wYXJhbXMuYXVkaW9Ob3RTdXBwb3J0ZWQsXG4gICAgICAgIGFuc3dlcjogdGhpcy5wYXJhbXMuYW5zd2VyLFxuICAgICAgICBzaG93U3VtbWFyeTogdGhpcy5wYXJhbXMuc2hvd1N1bW1hcnksXG4gICAgICAgIGluY29ycmVjdEFuc3dlcjogdGhpcy5wYXJhbXMuaW5jb3JyZWN0QW5zd2VyLFxuICAgICAgICBjb3JyZWN0QW5zd2VyOiB0aGlzLnBhcmFtcy5jb3JyZWN0QW5zd2VyLFxuICAgICAgICBwcm9ncmVzc1RleHQ6IHRoaXMucGFyYW1zLnByb2dyZXNzVGV4dCxcbiAgICAgICAgdGlwQnV0dG9uTGFiZWw6IHRoaXMucGFyYW1zLnRpcEJ1dHRvbkxhYmVsLFxuICAgICAgICBiZWhhdmlvdXI6IHtcbiAgICAgICAgICBzY2FsZVRleHROb3RDYXJkOiB0aGlzLnBhcmFtcy5iZWhhdmlvdXIuc2NhbGVUZXh0Tm90Q2FyZCxcbiAgICAgICAgICBtYXhQcm9maWNpZW5jeTogdGhpcy5wYXJhbXMuYmVoYXZpb3VyLm1heFByb2ZpY2llbmN5LFxuICAgICAgICAgIHF1aWNrUHJvZ3Jlc3Npb246IHRoaXMucGFyYW1zLmJlaGF2aW91ci5xdWlja1Byb2dyZXNzaW9uXG4gICAgICAgIH0sXG4gICAgICAgIGNhcmRQaWxlczogdGhpcy5wcmV2aW91c1N0YXRlLmNhcmRQaWxlc1xuICAgICAgfTtcblxuICAgICAgdGhpcy5jYXJkTWFuYWdlciA9IG5ldyBDYXJkTWFuYWdlcihtYW5hZ2VyUGFyYW1zLCB0aGlzLmlkLCB7XG4gICAgICAgIG9uQ2FyZFR1cm5lZDogdGhpcy5oYW5kbGVDYXJkVHVybmVkLFxuICAgICAgICBvbk5leHRDYXJkOiB0aGlzLm5leHRDYXJkXG4gICAgICB9KTtcblxuICAgICAgdGhpcy5jcmVhdGVET00odGhpcy5yb3VuZCA9PT0gMCk7XG5cbiAgICAgIC8qXG4gICAgICAgKiBHb3RvIHByZXZpb3VzbHkgdmlld2VkIGNhcmQuIEl0IHdhcyBwb3NzaWJsZSB0byBhbHNvIHJlY292ZXIgdGhlIHR1cm5lZFxuICAgICAgICogc3RhdGUsIGJ1dCBpdCBmZWVscyBzZW5zaWJsZSB0byBsZXQgdGhlIHByZXZpb3VzbHkgdmlld2VkIGNhcmQgYmVcbiAgICAgICAqIHJldmlld2VkIHN0YXJ0aW5nIHdpdGggdGhlIGZyb250LlxuICAgICAgICovXG4gICAgICBpZiAodGhpcy5wcmV2aW91c1N0YXRlLmN1cnJlbnRDYXJkSWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aGlzLmdvdG9DYXJkKHRoaXMucHJldmlvdXNTdGF0ZS5jdXJyZW50Q2FyZElkKTtcblxuICAgICAgICAvLyBTaG93IHN1bW1hcnkgaWYgcHJldmlvdXMgcm91bmQgd2FzIGNvbXBsZXRlZCBidXQgbmV4dCByb3VuZCBub3Qgc3RhcnRlZC5cbiAgICAgICAgaWYgKHRoaXMucGFyYW1zLm1vZGUgPT09ICdyZXBldGl0aW9uJyAmJiB0aGlzLnJlc3VsdHMubGVuZ3RoID09PSB0aGlzLmNhcmRJZHMubGVuZ3RoKSB7XG4gICAgICAgICAgdGhpcy5zaG93U3VtbWFyeSh0cnVlKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB0aGlzLnVwZGF0ZU5hdmlnYXRpb24oKTtcbiAgICAgIHRoaXMudHJpZ2dlcigncmVzaXplJyk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBET00uXG4gICAgICogQHBhcmFtIHtib29sZWFufSBmaXJzdENhbGwgSXMgZmlyc3QgY2FsbD9cbiAgICAgKi9cbiAgICB0aGlzLmNyZWF0ZURPTSA9IChmaXJzdENhbGwpID0+IHtcbiAgICAgIHRoaXMuY2FyZElkcyA9IChmaXJzdENhbGwgJiYgdGhpcy5wcmV2aW91c1N0YXRlLmNhcmRJZHMpID9cbiAgICAgICAgdGhpcy5wcmV2aW91c1N0YXRlLmNhcmRJZHMgOlxuICAgICAgICB0aGlzLmNhcmRNYW5hZ2VyLmNyZWF0ZVNlbGVjdGlvbigpO1xuXG4gICAgICB0aGlzLmNhcmRQb29sU2l6ZSA9IHRoaXMuY2FyZFBvb2xTaXplIHx8IHRoaXMuY2FyZE1hbmFnZXIuZ2V0U2l6ZSgpO1xuXG4gICAgICBpZiAoZmlyc3RDYWxsID09PSB0cnVlKSB7XG4gICAgICAgIGNvbnN0IHRpdGxlID0gJCgnPGRpdj4nICsgdGhpcy5wYXJhbXMudGl0bGUgKyAnPC9kaXY+JykudGV4dCgpLnRyaW0oKTtcbiAgICAgICAgdGhpcy4kaGVhZGVyID0gJCgodGl0bGUgPyAnPGRpdiBjbGFzcz1cImg1cC1kaWFsb2djYXJkcy10aXRsZVwiPjxkaXYgY2xhc3M9XCJoNXAtZGlhbG9nY2FyZHMtdGl0bGUtaW5uZXJcIj4nICsgdGhpcy5wYXJhbXMudGl0bGUgKyAnPC9kaXY+PC9kaXY+JyA6ICcnKSArXG4gICAgICAgICAgJzxkaXYgY2xhc3M9XCJoNXAtZGlhbG9nY2FyZHMtZGVzY3JpcHRpb25cIj4nICsgdGhpcy5wYXJhbXMuZGVzY3JpcHRpb24gKyAnPC9kaXY+Jyk7XG5cbiAgICAgICAgdGhpcy5zdW1tYXJ5U2NyZWVuID0gbmV3IFN1bW1hcnlTY3JlZW4odGhpcy5wYXJhbXMsIHtuZXh0Um91bmQ6IHRoaXMubmV4dFJvdW5kLCByZXRyeTogdGhpcy5yZXN0YXJ0UmVwZXRpdGlvbn0pO1xuICAgICAgfVxuXG4gICAgICBpZiAoZmlyc3RDYWxsID09PSB0cnVlKSB7XG4gICAgICAgIHRoaXMuJGNhcmR3cmFwcGVyU2V0ID0gdGhpcy5pbml0Q2FyZHModGhpcy5jYXJkSWRzKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICB0aGlzLiRjYXJkd3JhcHBlclNldC5kZXRhY2goKTtcbiAgICAgICAgdGhpcy4kY2FyZHdyYXBwZXJTZXQgPSB0aGlzLmluaXRDYXJkcyh0aGlzLmNhcmRJZHMpO1xuICAgICAgICB0aGlzLiRjYXJkU2lkZUFubm91bmNlci5iZWZvcmUodGhpcy4kY2FyZHdyYXBwZXJTZXQpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLiRjYXJkd3JhcHBlclNldC5wcmVwZW5kKHRoaXMuc3VtbWFyeVNjcmVlbi5nZXRET00oKSk7XG5cbiAgICAgIGlmIChmaXJzdENhbGwgPT09IHRydWUpIHtcbiAgICAgICAgdGhpcy4kY2FyZFNpZGVBbm5vdW5jZXIgPSAkKCc8ZGl2PicsIHtcbiAgICAgICAgICBodG1sOiB0aGlzLnBhcmFtcy5jYXJkRnJvbnRMYWJlbCxcbiAgICAgICAgICAnY2xhc3MnOiAnaDVwLWRpYWxvZ2NhcmRzLWNhcmQtc2lkZS1hbm5vdW5jZXInLFxuICAgICAgICAgICdhcmlhLWxpdmUnOiAncG9saXRlJyxcbiAgICAgICAgICAnYXJpYS1oaWRkZW4nOiAndHJ1ZSdcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy4kZm9vdGVyID0gdGhpcy5jcmVhdGVGb290ZXIoKTtcblxuICAgICAgICB0aGlzLiRtYWluQ29udGVudCA9ICQoJzxkaXY+JylcbiAgICAgICAgICAuYXBwZW5kKHRoaXMuJGhlYWRlcilcbiAgICAgICAgICAuYXBwZW5kKHRoaXMuJGNhcmR3cmFwcGVyU2V0KVxuICAgICAgICAgIC5hcHBlbmQodGhpcy4kY2FyZFNpZGVBbm5vdW5jZXIpXG4gICAgICAgICAgLmFwcGVuZCh0aGlzLiRmb290ZXIpXG4gICAgICAgICAgLmFwcGVuZFRvKHRoaXMuJGlubmVyKTtcblxuICAgICAgICAvLyBObyBjYXJkIGhhcyB0ZXh0c1xuICAgICAgICBpZiAodGhpcy5oYXNOb1RleHRzKSB7XG4gICAgICAgICAgdGhpcy5jYXJkcy5mb3JFYWNoKGNhcmQgPT4ge1xuICAgICAgICAgICAgY2FyZC5zZXROb1RleHQoKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMub24oJ3Jlc2V0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHRoaXMucmVzZXQoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5vbigncmVzaXplJywgdGhpcy5yZXNpemUpO1xuXG4gICAgICAgIC8vIFNldCByb3VuZCB0byBwcmV2aW91cyBzdGF0ZSBpZiBhdmFpbGFibGVcbiAgICAgICAgdGhpcy5yb3VuZCA9ICh0aGlzLnByZXZpb3VzU3RhdGUucm91bmQgIT09IHVuZGVmaW5lZCkgPyB0aGlzLnByZXZpb3VzU3RhdGUucm91bmQgOiAxO1xuICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgZm9vdGVyL25hdmlnYXRpb24gbGluZVxuICAgICAqXG4gICAgICogQHJldHVybnMgeyp8alF1ZXJ5fEhUTUxFbGVtZW50fSBGb290ZXIgZWxlbWVudFxuICAgICAqL1xuICAgIHRoaXMuY3JlYXRlRm9vdGVyID0gKCkgPT4ge1xuICAgICAgY29uc3QgJGZvb3RlciA9ICQoJzxuYXY+Jywge1xuICAgICAgICAnY2xhc3MnOiAnaDVwLWRpYWxvZ2NhcmRzLWZvb3RlcicsXG4gICAgICAgICdyb2xlJzogJ25hdmlnYXRpb24nXG4gICAgICB9KTtcblxuICAgICAgaWYgKHRoaXMucGFyYW1zLm1vZGUgPT09ICdub3JtYWwnKSB7XG4gICAgICAgIHRoaXMuJHByZXYgPSBKb3ViZWxVSS5jcmVhdGVCdXR0b24oe1xuICAgICAgICAgICdjbGFzcyc6ICdoNXAtZGlhbG9nY2FyZHMtZm9vdGVyLWJ1dHRvbiBoNXAtZGlhbG9nY2FyZHMtcHJldiB0cnVuY2F0ZWQnLFxuICAgICAgICAgICdhcmlhLWxhYmVsJzogdGhpcy5wYXJhbXMucHJldixcbiAgICAgICAgICAndGl0bGUnOiB0aGlzLnBhcmFtcy5wcmV2XG4gICAgICAgIH0pLmNsaWNrKCgpID0+IHtcbiAgICAgICAgICB0aGlzLnByZXZDYXJkKCk7XG4gICAgICAgIH0pLmFwcGVuZFRvKCRmb290ZXIpO1xuXG4gICAgICAgIHRoaXMuJG5leHQgPSBKb3ViZWxVSS5jcmVhdGVCdXR0b24oe1xuICAgICAgICAgICdjbGFzcyc6ICdoNXAtZGlhbG9nY2FyZHMtZm9vdGVyLWJ1dHRvbiBoNXAtZGlhbG9nY2FyZHMtbmV4dCB0cnVuY2F0ZWQnLFxuICAgICAgICAgICdhcmlhLWxhYmVsJzogdGhpcy5wYXJhbXMubmV4dCxcbiAgICAgICAgICAndGl0bGUnOiB0aGlzLnBhcmFtcy5uZXh0XG4gICAgICAgIH0pLmNsaWNrKCgpID0+IHtcbiAgICAgICAgICB0aGlzLm5leHRDYXJkKCk7XG4gICAgICAgIH0pLmFwcGVuZFRvKCRmb290ZXIpO1xuXG4gICAgICAgIHRoaXMuJHJldHJ5ID0gSm91YmVsVUkuY3JlYXRlQnV0dG9uKHtcbiAgICAgICAgICAnY2xhc3MnOiAnaDVwLWRpYWxvZ2NhcmRzLWZvb3Rlci1idXR0b24gaDVwLWRpYWxvZ2NhcmRzLXJldHJ5IGg1cC1kaWFsb2djYXJkcy1kaXNhYmxlZCcsXG4gICAgICAgICAgJ3RpdGxlJzogdGhpcy5wYXJhbXMucmV0cnksXG4gICAgICAgICAgJ2h0bWwnOiB0aGlzLnBhcmFtcy5yZXRyeVxuICAgICAgICB9KS5jbGljaygoKSA9PiB7XG4gICAgICAgICAgdGhpcy50cmlnZ2VyKCdyZXNldCcpO1xuICAgICAgICB9KS5hcHBlbmRUbygkZm9vdGVyKTtcblxuICAgICAgICB0aGlzLiRwcm9ncmVzcyA9ICQoJzxkaXY+Jywge1xuICAgICAgICAgICdpZCc6ICdoNXAtZGlhbG9nY2FyZHMtcHJvZ3Jlc3MtJyArIERpYWxvZ2NhcmRzLmlkQ291bnRlcixcbiAgICAgICAgICAnY2xhc3MnOiAnaDVwLWRpYWxvZ2NhcmRzLXByb2dyZXNzJyxcbiAgICAgICAgICAnYXJpYS1saXZlJzogJ2Fzc2VydGl2ZSdcbiAgICAgICAgfSkuYXBwZW5kVG8oJGZvb3Rlcik7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgdGhpcy4kcm91bmQgPSAkKCc8ZGl2PicsIHtcbiAgICAgICAgICAnY2xhc3MnOiAnaDVwLWRpYWxvZ2NhcmRzLXJvdW5kJ1xuICAgICAgICB9KS5hcHBlbmRUbygkZm9vdGVyKTtcblxuICAgICAgICB0aGlzLiRwcm9ncmVzcyA9ICQoJzxkaXY+Jywge1xuICAgICAgICAgICdjbGFzcyc6ICdoNXAtZGlhbG9nY2FyZHMtY2FyZHMtbGVmdCcsXG4gICAgICAgICAgJ2FyaWEtbGl2ZSc6ICdhc3NlcnRpdmUnXG4gICAgICAgIH0pLmFwcGVuZFRvKCRmb290ZXIpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gJGZvb3RlcjtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQ2FsbGVkIHdoZW4gYWxsIGNhcmRzIGhhcyBiZWVuIGxvYWRlZC5cbiAgICAgKi9cbiAgICB0aGlzLnVwZGF0ZUltYWdlU2l6ZSA9ICgpID0+IHtcbiAgICAgIC8vIEZpbmQgaGlnaGVzdCBjYXJkIGNvbnRlbnRcbiAgICAgIGxldCByZWxhdGl2ZUhlaWdodENhcCA9IDE1O1xuICAgICAgbGV0IGhlaWdodCA9IDA7XG5cbiAgICAgIGNvbnN0ICRjdXJyZW50Q2FyZENvbnRlbnQgPSB0aGlzLmNhcmRzW3RoaXMuY3VycmVudENhcmRJZF0uZ2V0RE9NKCkuZmluZCgnLmg1cC1kaWFsb2djYXJkcy1jYXJkLWNvbnRlbnQnKTtcblxuICAgICAgdGhpcy5wYXJhbXMuZGlhbG9ncy5mb3JFYWNoKGRpYWxvZyA9PiB7XG4gICAgICAgIGxldCBpbWFnZUhlaWdodDtcblxuICAgICAgICBpZiAoZGlhbG9nLmZyb250LmltYWdlKSB7XG4gICAgICAgICAgaW1hZ2VIZWlnaHQgPSBkaWFsb2cuZnJvbnQuaW1hZ2UuaGVpZ2h0IC8gZGlhbG9nLmZyb250LmltYWdlLndpZHRoICogJGN1cnJlbnRDYXJkQ29udGVudC5nZXQoMCkuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkud2lkdGg7XG4gICAgICAgICAgaWYgKGltYWdlSGVpZ2h0ID4gaGVpZ2h0KSB7XG4gICAgICAgICAgICBoZWlnaHQgPSBpbWFnZUhlaWdodDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGlhbG9nLmJhY2suaW1hZ2UpIHtcbiAgICAgICAgICBpbWFnZUhlaWdodCA9IGRpYWxvZy5iYWNrLmltYWdlLmhlaWdodCAvIGRpYWxvZy5iYWNrLmltYWdlLndpZHRoICogJGN1cnJlbnRDYXJkQ29udGVudC5nZXQoMCkuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkud2lkdGg7XG4gICAgICAgICAgaWYgKGltYWdlSGVpZ2h0ID4gaGVpZ2h0KSB7XG4gICAgICAgICAgICBoZWlnaHQgPSBpbWFnZUhlaWdodDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBpZiAoaGVpZ2h0ID4gMCkge1xuICAgICAgICBsZXQgcmVsYXRpdmVJbWFnZUhlaWdodCA9IGhlaWdodCAvIHBhcnNlRmxvYXQodGhpcy4kaW5uZXIuY3NzKCdmb250LXNpemUnKSk7XG4gICAgICAgIGlmIChyZWxhdGl2ZUltYWdlSGVpZ2h0ID4gcmVsYXRpdmVIZWlnaHRDYXApIHtcbiAgICAgICAgICByZWxhdGl2ZUltYWdlSGVpZ2h0ID0gcmVsYXRpdmVIZWlnaHRDYXA7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jYXJkcy5mb3JFYWNoKGNhcmQgPT4ge1xuICAgICAgICAgIGNhcmQuc2V0SW1hZ2VIZWlnaHQoYCR7cmVsYXRpdmVJbWFnZUhlaWdodH1lbWApO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhbGwgY2FyZHMgYW5kIGFwcGVuZHMgdGhlbSB0byBjYXJkIHdyYXBwZXIuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge29iamVjdFtdfSBjYXJkSWRzIENhcmQgaWRzLlxuICAgICAqIEByZXR1cm5zIHsqfGpRdWVyeXxIVE1MRWxlbWVudH0gQ2FyZCB3cmFwcGVyIHNldFxuICAgICAqL1xuICAgIHRoaXMuaW5pdENhcmRzID0gKGNhcmRJZHMpID0+IHtcbiAgICAgIGNvbnN0IGluaXRMb2FkID0gMjtcbiAgICAgIHRoaXMuY2FyZHMgPSBbXTtcbiAgICAgIHRoaXMuY3VycmVudENhcmRJZCA9IDA7XG5cbiAgICAgIC8vIFJhbmRvbWl6ZSBjYXJkcyBvcmRlclxuICAgICAgaWYgKHRoaXMucGFyYW1zLmJlaGF2aW91ci5yYW5kb21DYXJkcykge1xuICAgICAgICBjYXJkSWRzID0gSDVQLnNodWZmbGVBcnJheShjYXJkSWRzKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgJGNhcmR3cmFwcGVyU2V0ID0gJCgnPGRpdj4nLCB7XG4gICAgICAgICdjbGFzcyc6ICdoNXAtZGlhbG9nY2FyZHMtY2FyZHdyYXAtc2V0J1xuICAgICAgfSk7XG5cbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2FyZElkcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAvLyBMb2FkIGNhcmRzIHByb2dyZXNzaXZlbHlcbiAgICAgICAgaWYgKGkgPj0gaW5pdExvYWQpIHtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGNhcmQgPSB0aGlzLmdldENhcmQoY2FyZElkc1tpXSk7XG4gICAgICAgIGNhcmQuc2V0UHJvZ3Jlc3NUZXh0KGkgKyAxLCBjYXJkSWRzLmxlbmd0aCk7XG5cbiAgICAgICAgdGhpcy5jYXJkcy5wdXNoKGNhcmQpO1xuICAgICAgICBjb25zdCAkY2FyZFdyYXBwZXIgPSBjYXJkLmdldERPTSgpO1xuXG4gICAgICAgIC8vIFNldCBjdXJyZW50IGNhcmRcbiAgICAgICAgaWYgKGkgPT09IHRoaXMuY3VycmVudENhcmRJZCkge1xuICAgICAgICAgICRjYXJkV3JhcHBlci5hZGRDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLWN1cnJlbnQnKTtcbiAgICAgICAgICB0aGlzLiRjdXJyZW50ID0gJGNhcmRXcmFwcGVyO1xuICAgICAgICB9XG5cbiAgICAgICAgY2FyZC5hZGRUaXBUb0NhcmQoJGNhcmRXcmFwcGVyLmZpbmQoJy5oNXAtZGlhbG9nY2FyZHMtY2FyZC1jb250ZW50JyksICdmcm9udCcsIGkpO1xuXG4gICAgICAgICRjYXJkd3JhcHBlclNldC5hcHBlbmQoJGNhcmRXcmFwcGVyKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuICRjYXJkd3JhcHBlclNldDtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogSGFuZGxlIGNhcmQgdHVybmVkLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtib29sZWFufSB0dXJuZWQgLSBUcnVlLCBpZiBjYXJkIGlzIHR1cm5lZC5cbiAgICAgKi9cbiAgICB0aGlzLmhhbmRsZUNhcmRUdXJuZWQgPSAodHVybmVkKSA9PiB7XG4gICAgICAvLyBhMTF5IG5vdGlmaWNhdGlvblxuICAgICAgdGhpcy4kY2FyZFNpZGVBbm5vdW5jZXIuaHRtbCh0dXJuZWQgPyB0aGlzLnBhcmFtcy5jYXJkRnJvbnRMYWJlbCA6IHRoaXMucGFyYW1zLmNhcmRCYWNrTGFiZWwpO1xuXG4gICAgICAvLyByZXRyeSBidXR0b25cbiAgICAgIGlmICh0aGlzLnBhcmFtcy5iZWhhdmlvdXIuZW5hYmxlUmV0cnkgJiYgdGhpcy5jdXJyZW50Q2FyZElkICsgMSA9PT0gdGhpcy5jYXJkSWRzLmxlbmd0aCkge1xuICAgICAgICBpZiAodGhpcy4kcmV0cnkpIHtcbiAgICAgICAgICB0aGlzLiRyZXRyeS5yZW1vdmVDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLWRpc2FibGVkJyk7XG4gICAgICAgICAgdGhpcy50cnVuY2F0ZVJldHJ5QnV0dG9uKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVXBkYXRlIG5hdmlnYXRpb24gdGV4dCBhbmQgc2hvdyBvciBoaWRlIGJ1dHRvbnMuXG4gICAgICovXG4gICAgdGhpcy51cGRhdGVOYXZpZ2F0aW9uID0gKCkgPT4ge1xuICAgICAgaWYgKHRoaXMucGFyYW1zLm1vZGUgPT09ICdub3JtYWwnKSB7XG4gICAgICAgIC8vIEZpbmFsIGNhcmRcbiAgICAgICAgaWYgKHRoaXMuZ2V0Q3VycmVudFNlbGVjdGlvbkluZGV4KCkgPCB0aGlzLmNhcmRJZHMubGVuZ3RoIC0gMSkge1xuICAgICAgICAgIHRoaXMuJG5leHQucmVtb3ZlQ2xhc3MoJ2g1cC1kaWFsb2djYXJkcy1kaXNhYmxlZCcpO1xuICAgICAgICAgIHRoaXMuJHJldHJ5LmFkZENsYXNzKCdoNXAtZGlhbG9nY2FyZHMtZGlzYWJsZWQnKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICB0aGlzLiRuZXh0LmFkZENsYXNzKCdoNXAtZGlhbG9nY2FyZHMtZGlzYWJsZWQnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEZpcnN0IGNhcmRcbiAgICAgICAgaWYgKHRoaXMuY3VycmVudENhcmRJZCA+IDAgJiYgIXRoaXMucGFyYW1zLmJlaGF2aW91ci5kaXNhYmxlQmFja3dhcmRzTmF2aWdhdGlvbikge1xuICAgICAgICAgIHRoaXMuJHByZXYucmVtb3ZlQ2xhc3MoJ2g1cC1kaWFsb2djYXJkcy1kaXNhYmxlZCcpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIHRoaXMuJHByZXYuYWRkQ2xhc3MoJ2g1cC1kaWFsb2djYXJkcy1kaXNhYmxlZCcpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy4kcHJvZ3Jlc3MudGV4dCh0aGlzLnBhcmFtcy5wcm9ncmVzc1RleHRcbiAgICAgICAgICAucmVwbGFjZSgnQGNhcmQnLCB0aGlzLmdldEN1cnJlbnRTZWxlY3Rpb25JbmRleCgpICsgMSlcbiAgICAgICAgICAucmVwbGFjZSgnQHRvdGFsJywgdGhpcy5jYXJkSWRzLmxlbmd0aClcbiAgICAgICAgKTtcblxuICAgICAgICAvLyBMb29rcyBzdHJhbmdlLCBidXQgdGhlIElkcyBnZXQgbWl4ZWQgdXAgZWxzZXdoZXJlXG4gICAgICAgIHRoaXMuY2FyZHNbdGhpcy5maW5kQ2FyZFBvc2l0aW9uKHRoaXMuY2FyZHNbdGhpcy5jdXJyZW50Q2FyZElkXS5pZCldLnJlc2l6ZU92ZXJmbG93aW5nVGV4dCgpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHRoaXMuJHJvdW5kLnRleHQodGhpcy5wYXJhbXMucm91bmQucmVwbGFjZSgnQHJvdW5kJywgdGhpcy5yb3VuZCkpO1xuICAgICAgICBjb25zdCBzZWxlY3Rpb25JbmRleCA9IHRoaXMuZ2V0Q3VycmVudFNlbGVjdGlvbkluZGV4KCk7XG4gICAgICAgIHRoaXMuJHByb2dyZXNzLnRleHQodGhpcy5wYXJhbXMuY2FyZHNMZWZ0LnJlcGxhY2UoJ0BudW1iZXInLCB0aGlzLmNhcmRJZHMubGVuZ3RoIC0gc2VsZWN0aW9uSW5kZXgpKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy50cmlnZ2VyKCdyZXNpemUnKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogU2hvdyBzdW1tYXJ5IHNjcmVlbi5cbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtwcmV2aW91c1N0YXRlID0gZmFsc2VdIElmIHRydWUsIHBpbGVzIHdpbGwgbm90IGJlIHVwZGF0ZWQuXG4gICAgICovXG4gICAgdGhpcy5zaG93U3VtbWFyeSA9IChwcmV2aW91c1N0YXRlID0gZmFsc2UpID0+IHtcbiAgICAgIC8vIFVwZGF0ZSBwaWxlcyBhbmQgcmV0cmlldmUgdGhlIG5ldyBwaWxlIHNpemVzXG4gICAgICBjb25zdCBuZXdQaWxlU2l6ZXMgPSAocHJldmlvdXNTdGF0ZSkgP1xuICAgICAgICB0aGlzLmNhcmRNYW5hZ2VyLmdldFBpbGVTaXplcygpIDpcbiAgICAgICAgdGhpcy5jYXJkTWFuYWdlci51cGRhdGVQaWxlcyh0aGlzLnJlc3VsdHMpO1xuXG4gICAgICBjb25zdCByaWdodCA9IHRoaXMucmVzdWx0cy5maWx0ZXIocmVzdWx0ID0+IHJlc3VsdC5yZXN1bHQgPT09IHRydWUpLmxlbmd0aDtcbiAgICAgIGNvbnN0IHdyb25nID0gdGhpcy5yZXN1bHRzLmxlbmd0aCAtIHJpZ2h0O1xuICAgICAgY29uc3Qgbm90U2hvd24gPSB0aGlzLmNhcmRQb29sU2l6ZSAtIHJpZ2h0IC0gd3Jvbmc7XG4gICAgICBjb25zdCBjb21wbGV0ZWQgPSBuZXdQaWxlU2l6ZXMuc2xpY2UoLTEpWzBdO1xuICAgICAgY29uc3QgZG9uZSA9IGNvbXBsZXRlZCA9PT0gdGhpcy5jYXJkUG9vbFNpemU7XG5cbiAgICAgIGNvbnN0IHN1bW1hcnkgPSB7XG4gICAgICAgIHJvdW5kOiB0aGlzLnJvdW5kLFxuICAgICAgICByZXN1bHRzOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgZmllbGQ6ICdoNXAtZGlhbG9nY2FyZHMtcm91bmQtY2FyZHMtcmlnaHQnLFxuICAgICAgICAgICAgc2NvcmU6IHt2YWx1ZTogcmlnaHQsIG1heDogd3JvbmcgKyByaWdodH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGZpZWxkOiAnaDVwLWRpYWxvZ2NhcmRzLXJvdW5kLWNhcmRzLXdyb25nJyxcbiAgICAgICAgICAgIHNjb3JlOiB7dmFsdWU6IHdyb25nLCBtYXg6IHdyb25nICsgcmlnaHR9XG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBmaWVsZDogJ2g1cC1kaWFsb2djYXJkcy1yb3VuZC1jYXJkcy1ub3Qtc2hvd24nLFxuICAgICAgICAgICAgc2NvcmU6IHt2YWx1ZTogbm90U2hvd259XG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBmaWVsZDogJ2g1cC1kaWFsb2djYXJkcy1vdmVyYWxsLWNhcmRzLWNvbXBsZXRlZCcsXG4gICAgICAgICAgICBzY29yZToge3ZhbHVlOiBjb21wbGV0ZWQsIG1heDogdGhpcy5jYXJkUG9vbFNpemV9XG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBmaWVsZDogJ2g1cC1kaWFsb2djYXJkcy1vdmVyYWxsLWNvbXBsZXRlZC1yb3VuZHMnLFxuICAgICAgICAgICAgc2NvcmU6IHt2YWx1ZTogdGhpcy5yb3VuZH1cbiAgICAgICAgICB9XG4gICAgICAgIF1cbiAgICAgIH07XG5cbiAgICAgIGlmIChkb25lKSB7XG4gICAgICAgIHN1bW1hcnkuZG9uZSA9IHRydWU7XG4gICAgICAgIHN1bW1hcnkubWVzc2FnZSA9IHRoaXMucGFyYW1zLnN1bW1hcnlBbGxEb25lXG4gICAgICAgICAgLnJlcGxhY2UoJ0BjYXJkcycsIHRoaXMuY2FyZFBvb2xTaXplKVxuICAgICAgICAgIC5yZXBsYWNlKCdAbWF4JywgdGhpcy5wYXJhbXMuYmVoYXZpb3VyLm1heFByb2ZpY2llbmN5IC0gMSk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuc3VtbWFyeVNjcmVlbi51cGRhdGUoc3VtbWFyeSk7XG4gICAgICB0aGlzLnN1bW1hcnlTY3JlZW4uc2hvdygpO1xuICAgICAgdGhpcy5oaWRlQ2FyZHMoKTtcblxuICAgICAgdGhpcy50cmlnZ2VyKCdyZXNpemUnKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogU2hvdyBtYWluIGNvbnRlbnQuXG4gICAgICovXG4gICAgdGhpcy5zaG93Q2FyZHMgPSAoKSA9PiB7XG4gICAgICB0aGlzLiRjYXJkd3JhcHBlclNldC5maW5kKCcuaDVwLWRpYWxvZ2NhcmRzLWNhcmR3cmFwJykucmVtb3ZlQ2xhc3MoJ2g1cC1kaWFsb2djYXJkcy1nb25lJyk7XG4gICAgICB0aGlzLiRmb290ZXIucmVtb3ZlQ2xhc3MoJ2g1cC1kaWFsb2djYXJkcy1nb25lJyk7XG4gICAgICB0aGlzLmNhcmRzU2hvd24gPSB0cnVlO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBIaWRlIG1haW4gY29udGVudC5cbiAgICAgKi9cbiAgICB0aGlzLmhpZGVDYXJkcyA9ICgpID0+IHtcbiAgICAgIHRoaXMuJGNhcmR3cmFwcGVyU2V0LmZpbmQoJy5oNXAtZGlhbG9nY2FyZHMtY2FyZHdyYXAnKS5hZGRDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLWdvbmUnKTtcbiAgICAgIHRoaXMuJGZvb3Rlci5hZGRDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLWdvbmUnKTtcbiAgICAgIHRoaXMuY2FyZHNTaG93biA9IGZhbHNlO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBTaG93IG5leHQgY2FyZC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBbcmVzdWx0XSBPcHRpb25hbCByZXN1bHQgb2YgcmVwZXRpdGlvbiBtb2RlLlxuICAgICAqL1xuICAgIHRoaXMubmV4dENhcmQgPSAocmVzdWx0KSA9PiB7XG4gICAgICBpZiAodHlwZW9mKHJlc3VsdCkgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIHRoaXMucmVzdWx0cy5wdXNoKHJlc3VsdCk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuY2FyZHNbdGhpcy5jdXJyZW50Q2FyZElkXS5zdG9wQXVkaW8oKTtcblxuICAgICAgLy8gT24gZmluYWwgY2FyZFxuICAgICAgaWYgKHRoaXMuY2FyZElkcy5sZW5ndGggLSB0aGlzLmdldEN1cnJlbnRTZWxlY3Rpb25JbmRleCgpID09PSAxKSB7XG4gICAgICAgIGlmICh0aGlzLnBhcmFtcy5tb2RlID09PSAncmVwZXRpdGlvbicpIHtcbiAgICAgICAgICB0aGlzLiRwcm9ncmVzcy50ZXh0KHRoaXMucGFyYW1zLmNhcmRzTGVmdC5yZXBsYWNlKCdAbnVtYmVyJywgMCkpO1xuICAgICAgICAgIHRoaXMuY2FyZHNbdGhpcy5jdXJyZW50Q2FyZElkXS5zaG93U3VtbWFyeUJ1dHRvbih0aGlzLnNob3dTdW1tYXJ5KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHRoaXMuZ290b0NhcmQodGhpcy5nZXRDdXJyZW50U2VsZWN0aW9uSW5kZXgoKSArIDEpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBHZXQgY2FyZCBmcm9tIGNhcmQgbWFuYWdlci5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gaWQgQ2FyZCdzIElkLlxuICAgICAqIEByZXR1cm4ge29iamVjdH0gQ2FyZC5cbiAgICAgKi9cbiAgICB0aGlzLmdldENhcmQgPSAoaWQpID0+IHtcbiAgICAgIGNvbnN0IGNhcmQgPSB0aGlzLmNhcmRNYW5hZ2VyLmdldENhcmQoaWQpO1xuICAgICAgY2FyZC5jcmVhdGVCdXR0b25MaXN0ZW5lcnMoKTtcblxuICAgICAgcmV0dXJuIGNhcmQ7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEZpbmQgdGhlIHBvc2l0aW9uIG9mIGEgbG9hZGVkIGNhcmQuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IGNhcmRJZCBDYXJkSWQgdG8gbG9vayBmb3IuXG4gICAgICogQHJldHVybiB7bnVtYmVyfSBQb3NpdGlvbiBvciB1bmRlZmluZWQuXG4gICAgICovXG4gICAgdGhpcy5maW5kQ2FyZFBvc2l0aW9uID0gKGNhcmRJZCkgPT4ge1xuICAgICAgbGV0IHBvc2l0aW9uO1xuXG4gICAgICB0aGlzLmNhcmRzLmZvckVhY2goKGNhcmQsIGluZGV4KSA9PiB7XG4gICAgICAgIGlmICghcG9zaXRpb24gJiYgY2FyZC5pZCA9PT0gY2FyZElkKSB7XG4gICAgICAgICAgcG9zaXRpb24gPSBpbmRleDtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiBwb3NpdGlvbjtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogSW5zZXJ0IGEgY2FyZCBpbnRvIHRoZSBET00uXG4gICAgICogQHBhcmFtIHtDYXJkfSBjYXJkIENhcmQgdG8gaW5zZXJ0LlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbaW5kZXhdIFBvc2l0aW9uIHRvIGluc2VydCBjYXJkIGF0LlxuICAgICAqL1xuICAgIHRoaXMuaW5zZXJ0Q2FyZFRvRE9NID0gKGNhcmQsIGluZGV4KSA9PiB7XG4gICAgICBjb25zdCAkbm9kZSA9IGNhcmQuZ2V0RE9NKCk7XG5cbiAgICAgIC8vIFB1dCBhdCBhcHByb3ByaWF0ZSBwb3NpdGlvbi5cbiAgICAgIGlmIChpbmRleCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICRub2RlLmFwcGVuZFRvKHRoaXMuJGNhcmR3cmFwcGVyU2V0KTtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKGluZGV4ID09PSAwKSB7XG4gICAgICAgIHRoaXMuJGNhcmR3cmFwcGVyU2V0LnByZXBlbmQoJG5vZGUpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHRoaXMuJGNhcmR3cmFwcGVyU2V0LmNoaWxkcmVuKCkuZXEoaW5kZXgpLmFmdGVyKCRub2RlKTtcbiAgICAgIH1cblxuICAgICAgLy8gQWRkIGhpbnRzXG4gICAgICBjYXJkLmFkZFRpcFRvQ2FyZCgkbm9kZS5maW5kKCcuaDVwLWRpYWxvZ2NhcmRzLWNhcmQtY29udGVudCcpLCAnZnJvbnQnLCBpbmRleCk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEdvIHRvIGEgc3BlY2lmaWMgY2FyZCBpbiB0aGUgc2VsZWN0aW9uLiBDYXJkcyBtYXkgbmVlZCB0byBiZSBsb2FkZWQuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IHRhcmdldFBvc2l0aW9uIFRhcmdldCBjYXJkIHBvc2l0aW9uLlxuICAgICAqL1xuICAgIHRoaXMuZ290b0NhcmQgPSAodGFyZ2V0UG9zaXRpb24pID0+IHtcbiAgICAgIGlmICh0YXJnZXRQb3NpdGlvbiA8IDAgfHwgdGFyZ2V0UG9zaXRpb24gPj0gdGhpcy5jYXJkSWRzLmxlbmd0aCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIFN0b3AgYWN0aW9uIG9uIGN1cnJlbnQgY2FyZFxuICAgICAgY29uc3QgY3VycmVudENhcmQgPSB0aGlzLmNhcmRzW3RoaXMuY3VycmVudENhcmRJZF07XG4gICAgICBjdXJyZW50Q2FyZC5zdG9wQXVkaW8oKTtcbiAgICAgIGN1cnJlbnRDYXJkLmdldERPTSgpLnJlbW92ZUNsYXNzKCdoNXAtZGlhbG9nY2FyZHMtY3VycmVudCcpO1xuXG4gICAgICAvLyBHZXQgY2FyZCBwb3NpdGlvbnMgdG8gY2hlY2sgZm9yIGJlaW5nIGxvYWRlZFxuICAgICAgY29uc3QgY2hlY2tMb2FkZWQgPSBbXTtcbiAgICAgIGlmICh0YXJnZXRQb3NpdGlvbiA+IDApIHtcbiAgICAgICAgY2hlY2tMb2FkZWQucHVzaCh0YXJnZXRQb3NpdGlvbiAtIDEpO1xuICAgICAgfVxuICAgICAgY2hlY2tMb2FkZWQucHVzaCh0YXJnZXRQb3NpdGlvbik7XG4gICAgICBpZiAodGFyZ2V0UG9zaXRpb24gKyAxIDwgdGhpcy5jYXJkSWRzLmxlbmd0aCkge1xuICAgICAgICBjaGVja0xvYWRlZC5wdXNoKHRhcmdldFBvc2l0aW9uICsgMSk7XG4gICAgICB9XG5cbiAgICAgIC8vIExvYWQgYW5kIGluc2VydCB0YXJnZXQgY2FyZCwgcHJlZGVjZXNzb3IgYW5kIHN1Y2Nlc3NvciBpZiByZXF1aXJlZC5cbiAgICAgIGNoZWNrTG9hZGVkLmZvckVhY2gocG9zaXRpb24gPT4ge1xuICAgICAgICBjb25zdCBsb2FkZWRQb3NpdGlvbiA9IHRoaXMuZmluZENhcmRQb3NpdGlvbih0aGlzLmNhcmRJZHNbcG9zaXRpb25dKTtcbiAgICAgICAgaWYgKGxvYWRlZFBvc2l0aW9uID09PSB1bmRlZmluZWQpIHtcblxuICAgICAgICAgIC8vIENhcmQgaGFzIG5vdCBiZWVuIGxvYWRlZC4gTG9hZCBub3cuXG4gICAgICAgICAgY29uc3QgY2FyZCA9IHRoaXMuZ2V0Q2FyZCh0aGlzLmNhcmRJZHNbcG9zaXRpb25dKTtcbiAgICAgICAgICBjYXJkLnNldFByb2dyZXNzVGV4dChwb3NpdGlvbiArIDEsIHRoaXMuY2FyZElkcy5sZW5ndGgpO1xuXG4gICAgICAgICAgLypcbiAgICAgICAgICAgKiBUcnkgdG8gZmluZCBzdWNjZXNzb3IgY2FyZCBpbiBsb2FkZWQgcGlsZSBhbmQgaW5zZXJ0IGJlZm9yZVxuICAgICAgICAgICAqIG9yIHB1dCB0byB0aGUgZW5kIG9mIHRoZSBsb2FkZWQgcGlsZS5cbiAgICAgICAgICAgKi9cbiAgICAgICAgICBjb25zdCBzdWNjZXNzb3JJZCA9IE1hdGgubWluKHBvc2l0aW9uICsgMSwgdGhpcy5jYXJkSWRzLmxlbmd0aCAtIDEpO1xuICAgICAgICAgIGNvbnN0IHN1Y2Nlc3NvciA9IHRoaXMuZmluZENhcmRQb3NpdGlvbih0aGlzLmNhcmRJZHNbc3VjY2Vzc29ySWRdKTtcbiAgICAgICAgICBjb25zdCBpbnNlcnRQb3NpdGlvbiA9IHN1Y2Nlc3NvciB8fCB0aGlzLmNhcmRzLmxlbmd0aDtcblxuICAgICAgICAgIHRoaXMuY2FyZHMuc3BsaWNlKGluc2VydFBvc2l0aW9uLCAwLCBjYXJkKTtcbiAgICAgICAgICB0aGlzLmluc2VydENhcmRUb0RPTShjYXJkLCBpbnNlcnRQb3NpdGlvbik7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLnJlc2l6ZSgpO1xuXG4gICAgICAvLyBSZXRyaWV2ZSBwb3NpdGlvbiBvZiBpZCBub3cgaW4gKmxvYWRlZCBjYXJkcypcbiAgICAgIHRhcmdldFBvc2l0aW9uID0gdGhpcy5maW5kQ2FyZFBvc2l0aW9uKHRoaXMuY2FyZElkc1t0YXJnZXRQb3NpdGlvbl0pO1xuXG4gICAgICAvLyBTZXQgY2xhc3NlcyBmb3IgY2FyZCBvcmRlci9kaXNwbGF5XG4gICAgICB0aGlzLmNhcmRzLmZvckVhY2goKGNhcmQsIGluZGV4KSA9PiB7XG4gICAgICAgIGlmIChpbmRleCA8IHRhcmdldFBvc2l0aW9uKSB7XG4gICAgICAgICAgY2FyZC5nZXRET00oKS5hZGRDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLXByZXZpb3VzJyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgY2FyZC5nZXRET00oKS5yZW1vdmVDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLXByZXZpb3VzJyk7XG5cbiAgICAgICAgICBpZiAoaW5kZXggPT09IHRhcmdldFBvc2l0aW9uKSB7XG4gICAgICAgICAgICBjYXJkLmdldERPTSgpLmFkZENsYXNzKCdoNXAtZGlhbG9nY2FyZHMtY3VycmVudCcpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuY3VycmVudENhcmRJZCA9IHRhcmdldFBvc2l0aW9uO1xuICAgICAgdGhpcy51cGRhdGVOYXZpZ2F0aW9uKCk7XG4gICAgICB0aGlzLmNhcmRzW3RoaXMuY3VycmVudENhcmRJZF0uc2V0Q2FyZEZvY3VzKCk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFNob3cgcHJldmlvdXMgY2FyZC5cbiAgICAgKi9cbiAgICB0aGlzLnByZXZDYXJkID0gKCkgPT4ge1xuICAgICAgdGhpcy5nb3RvQ2FyZCh0aGlzLmdldEN1cnJlbnRTZWxlY3Rpb25JbmRleCgpIC0gMSk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFNob3cgYWxsIGF1ZGlvIGJ1dHRvbnNcbiAgICAgKi9cbiAgICB0aGlzLnNob3dBbGxBdWRpbyA9ICgpID0+IHtcbiAgICAgIHRoaXMuJGNhcmR3cmFwcGVyU2V0LmZpbmQoJy5oNXAtYXVkaW8taW5uZXInKVxuICAgICAgICAucmVtb3ZlQ2xhc3MoJ2hpZGUnKTtcbiAgICB9O1xuXG4gICAgdGhpcy5yZXN0YXJ0UmVwZXRpdGlvbiA9ICgpID0+IHtcbiAgICAgIHRoaXMuY2FyZE1hbmFnZXIucmVzZXQoKTtcbiAgICAgIHRoaXMucm91bmQgPSAwO1xuXG4gICAgICB0aGlzLm5leHRSb3VuZCgpO1xuICAgIH07XG5cbiAgICB0aGlzLm5leHRSb3VuZCA9ICgpID0+IHtcbiAgICAgIHRoaXMucm91bmQrKztcbiAgICAgIHRoaXMuc3VtbWFyeVNjcmVlbi5oaWRlKCk7XG4gICAgICB0aGlzLnNob3dDYXJkcygpO1xuXG4gICAgICB0aGlzLnJlc2V0KCk7XG4gICAgICB0aGlzLmNyZWF0ZURPTSgpO1xuXG4gICAgICB0aGlzLnVwZGF0ZU5hdmlnYXRpb24oKTtcbiAgICAgIHRoaXMuY2FyZHNbdGhpcy5jdXJyZW50Q2FyZElkXS5zZXRDYXJkRm9jdXModHJ1ZSk7XG5cbiAgICAgIHRoaXMudHJpZ2dlcigncmVzaXplJyk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFJlc2V0IHRoZSB0YXNrIHNvIHRoYXQgdGhlIHVzZXIgY2FuIGRvIGl0IGFnYWluLlxuICAgICAqL1xuICAgIHRoaXMucmVzZXQgPSAoKSA9PiB7XG4gICAgICB0aGlzLnJlc3VsdHMgPSBbXTtcbiAgICAgIHRoaXMuY2FyZHNbdGhpcy5jdXJyZW50Q2FyZElkXS5zdG9wQXVkaW8odGhpcy4kY3VycmVudC5pbmRleCgpKTtcblxuICAgICAgLy8gVHVybiBhbGwgY2FyZHMgdG8gZnJvbnRcbiAgICAgIHRoaXMuY2FyZHMuZm9yRWFjaChjYXJkID0+IHtcbiAgICAgICAgY2FyZC5yZXNldCgpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIFNob3cgZmlyc3QgY2FyZFxuICAgICAgdGhpcy5jdXJyZW50Q2FyZElkID0gMDtcbiAgICAgIGlmICh0aGlzLnBhcmFtcy5tb2RlID09PSAnbm9ybWFsJykge1xuICAgICAgICB0aGlzLmNhcmRzW3RoaXMuY3VycmVudENhcmRJZF0uZ2V0RE9NKCkuYWRkQ2xhc3MoJ2g1cC1kaWFsb2djYXJkcy1jdXJyZW50Jyk7XG4gICAgICB9XG4gICAgICB0aGlzLnVwZGF0ZU5hdmlnYXRpb24oKTtcblxuICAgICAgaWYgKHRoaXMuJHJldHJ5KSB7XG4gICAgICAgIHRoaXMuJHJldHJ5LmFkZENsYXNzKCdoNXAtZGlhbG9nY2FyZHMtZGlzYWJsZWQnKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuc2hvd0FsbEF1ZGlvKCk7XG5cbiAgICAgIHRoaXMuY2FyZHNbdGhpcy5jdXJyZW50Q2FyZElkXS5yZXNpemVPdmVyZmxvd2luZ1RleHQoKTtcbiAgICAgIHRoaXMuY2FyZHNbdGhpcy5jdXJyZW50Q2FyZElkXS5zZXRDYXJkRm9jdXMoKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVXBkYXRlIHRoZSBkaW1lbnNpb25zIG9mIHRoZSB0YXNrIHdoZW4gcmVzaXppbmcgdGhlIHRhc2suXG4gICAgICovXG4gICAgdGhpcy5yZXNpemUgPSAoKSA9PiB7XG4gICAgICB0aGlzLmhhbmRsZU9yaWVudGF0aW9uQ2hhbmdlKCk7XG5cbiAgICAgIGxldCBkaXNwbGF5TGltaXRzID0gbnVsbDtcblxuICAgICAgY29uc3QgdGl0bGVIZWlnaHQgPSB0aGlzLiRpbm5lci5maW5kKCcuaDVwLWRpYWxvZ2NhcmRzLXRpdGxlJykub3V0ZXJIZWlnaHQoKSB8fCAwO1xuICAgICAgY29uc3QgZGVzY3JpcHRpb25IZWlnaHQgPSB0aGlzLiRpbm5lci5maW5kKCcuaDVwLWRpYWxvZ2NhcmRzLWRlc2NyaXB0aW9uJykub3V0ZXJIZWlnaHQodHJ1ZSkgfHwgMDtcbiAgICAgIGNvbnN0IGZvb3RlckhlaWdodCA9IHRoaXMuJGZvb3Rlci5vdXRlckhlaWdodCgpIHx8IDA7XG5cbiAgICAgIGNvbnN0IG5vbkNhcmRIZWlnaHQgPSB0aXRsZUhlaWdodCArIGRlc2NyaXB0aW9uSGVpZ2h0ICsgZm9vdGVySGVpZ2h0O1xuXG4gICAgICBjb25zdCBpc01vYmlsZUxhbmRzY2FwZSA9IHRoaXMuaXNNb2JpbGVMYW5kc2NhcGUoKTtcblxuICAgICAgLy8gQ2hhbmdlIGxhbmRzY2FwZSBsYXlvdXQgb24gbW9iaWxlXG4gICAgICBpZiAoXG4gICAgICAgIHR5cGVvZiB3aW5kb3cub3JpZW50YXRpb24gPT09ICdudW1iZXInICYmXG4gICAgICAgIHRoaXMuJGNhcmR3cmFwcGVyU2V0LmZpbmQoJy5oNXAtZGlhbG9nY2FyZHMtc3VtbWFyeS1zY3JlZW4nKS5oYXNDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLWdvbmUnKSAmJlxuICAgICAgICB0aGlzLnBhcmFtcy5iZWhhdmlvdXIuc2NhbGVUZXh0Tm90Q2FyZFxuICAgICAgKSB7XG4gICAgICAgIHRoaXMuJGlubmVyLnRvZ2dsZUNsYXNzKCdoNXAtbGFuZHNjYXBlJywgaXNNb2JpbGVMYW5kc2NhcGUpO1xuXG4gICAgICAgIGlmIChpc01vYmlsZUxhbmRzY2FwZSkge1xuICAgICAgICAgIGRpc3BsYXlMaW1pdHMgPSAodGhpcy5pc1Jvb3QoKSkgPyB0aGlzLmNvbXB1dGVEaXNwbGF5TGltaXRzS0xMKCkgOiBudWxsO1xuXG4gICAgICAgICAgY29uc3Qgc2NyZWVuSGVpZ2h0ID0gKHRoaXMuaXNJT1MoKSAmJiBpc01vYmlsZUxhbmRzY2FwZSkgP1xuICAgICAgICAgICAgc2NyZWVuLndpZHRoIDpcbiAgICAgICAgICAgIHNjcmVlbi5oZWlnaHQ7XG5cbiAgICAgICAgICBpZiAoZGlzcGxheUxpbWl0cz8uaGVpZ2h0ID09PSAxKSB7XG4gICAgICAgICAgICBkaXNwbGF5TGltaXRzLmhlaWdodCA9IHNjcmVlbkhlaWdodDtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAoZGlzcGxheUxpbWl0cz8uaGVpZ2h0KSB7XG4gICAgICAgICAgICB0aGlzLiRjYXJkd3JhcHBlclNldC5jc3MoJ21heC1oZWlnaHQnLCBgJHtkaXNwbGF5TGltaXRzLmhlaWdodCAtIG5vbkNhcmRIZWlnaHR9cHhgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLiRjYXJkd3JhcHBlclNldC5jc3MoJ21heC1oZWlnaHQnLCAnJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgdGhpcy4kY2FyZHdyYXBwZXJTZXQuY3NzKCdtYXgtaGVpZ2h0JywgJycpO1xuICAgICAgfVxuXG4gICAgICBsZXQgbWF4SGVpZ2h0ID0gMDtcblxuICAgICAgaWYgKCFkaXNwbGF5TGltaXRzIHx8ICFpc01vYmlsZUxhbmRzY2FwZSB8fCAhdGhpcy5wYXJhbXMuYmVoYXZpb3VyLnNjYWxlVGV4dE5vdENhcmQpIHtcbiAgICAgICAgdGhpcy51cGRhdGVJbWFnZVNpemUoKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICB0aGlzLmNhcmRzLmZvckVhY2goY2FyZCA9PiB7XG4gICAgICAgICAgY2FyZC5zZXRJbWFnZUhlaWdodCgnJyk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBpZiAoIXRoaXMucGFyYW1zLmJlaGF2aW91ci5zY2FsZVRleHROb3RDYXJkICYmIHRoaXMuY2FyZHNTaG93biAhPT0gZmFsc2UpIHtcbiAgICAgICAgdGhpcy5kZXRlcm1pbmVDYXJkU2l6ZXMoKTtcbiAgICAgIH1cblxuICAgICAgaWYgKCF0aGlzLnBhcmFtcy5iZWhhdmlvdXIuc2NhbGVUZXh0Tm90Q2FyZCB8fCAhaXNNb2JpbGVMYW5kc2NhcGUgfHwgIWRpc3BsYXlMaW1pdHM/LmhlaWdodCB8fCAhdGhpcy4kY2FyZHdyYXBwZXJTZXQuZmluZCgnLmg1cC1kaWFsb2djYXJkcy1zdW1tYXJ5LXNjcmVlbicpLmhhc0NsYXNzKCdoNXAtZGlhbG9nY2FyZHMtZ29uZScpKSB7XG4gICAgICAgIC8vIFJlc2V0IGNhcmQtd3JhcHBlci1zZXQgaGVpZ2h0XG4gICAgICAgIHRoaXMuJGNhcmR3cmFwcGVyU2V0LmNzcygnaGVpZ2h0JywgJ2F1dG8nKTtcblxuICAgICAgICAvLyBGaW5kIG1heCByZXF1aXJlZCBoZWlnaHQgZm9yIGFsbCBjYXJkc1xuICAgICAgICB0aGlzLiRjYXJkd3JhcHBlclNldC5jaGlsZHJlbignOm5vdCguaDVwLWRpYWxvZ2NhcmRzLWdvbmUpJykuZWFjaCggZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGNvbnN0IHdyYXBwZXJIZWlnaHQgPSAkKHRoaXMpLmNzcygnaGVpZ2h0JywgJ2luaXRpYWwnKS5vdXRlckhlaWdodCgpO1xuICAgICAgICAgICQodGhpcykuY3NzKCdoZWlnaHQnLCAnaW5oZXJpdCcpO1xuICAgICAgICAgIG1heEhlaWdodCA9IE1hdGgubWF4KHdyYXBwZXJIZWlnaHQsIG1heEhlaWdodCk7XG5cbiAgICAgICAgICAvLyBDaGVjayBoZWlnaHRcbiAgICAgICAgICBpZiAoISQodGhpcykubmV4dCgnLmg1cC1kaWFsb2djYXJkcy1jYXJkd3JhcCcpLmxlbmd0aCkge1xuICAgICAgICAgICAgY29uc3QgaW5pdGlhbEhlaWdodCA9ICQodGhpcykuZmluZCgnLmg1cC1kaWFsb2djYXJkcy1jYXJkaG9sZGVyJykuY3NzKCdoZWlnaHQnLCAnaW5pdGlhbCcpLm91dGVySGVpZ2h0KCk7XG4gICAgICAgICAgICBtYXhIZWlnaHQgPSBNYXRoLm1heChpbml0aWFsSGVpZ2h0LCBtYXhIZWlnaHQpO1xuICAgICAgICAgICAgJCh0aGlzKS5maW5kKCcuaDVwLWRpYWxvZ2NhcmRzLWNhcmRob2xkZXInKS5jc3MoJ2hlaWdodCcsICdpbmhlcml0Jyk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgcmVsYXRpdmVNYXhIZWlnaHQgPSBtYXhIZWlnaHQgLyBwYXJzZUZsb2F0KHRoaXMuJGNhcmR3cmFwcGVyU2V0LmNzcygnZm9udC1zaXplJykpO1xuICAgICAgICB0aGlzLiRjYXJkd3JhcHBlclNldC5jc3MoJ2hlaWdodCcsIHJlbGF0aXZlTWF4SGVpZ2h0ICsgJ2VtJyk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgaWYgKGRpc3BsYXlMaW1pdHM/LmhlaWdodCAtIG5vbkNhcmRIZWlnaHQgPiAxKSB7XG4gICAgICAgICAgdGhpcy4kY2FyZHdyYXBwZXJTZXQuY3NzKCdoZWlnaHQnLCBgJHtkaXNwbGF5TGltaXRzPy5oZWlnaHQgLSBub25DYXJkSGVpZ2h0fXB4YCk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdGhpcy5zY2FsZVRvRml0SGVpZ2h0KCk7XG4gICAgICB0aGlzLnRydW5jYXRlUmV0cnlCdXR0b24oKTtcblxuICAgICAgdGhpcy5jYXJkc1t0aGlzLmN1cnJlbnRDYXJkSWRdLnJlc2l6ZU92ZXJmbG93aW5nVGV4dCgpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBSZXNpemVzIGVhY2ggY2FyZCB0byBmaXQgaXRzIHRleHRcbiAgICAgKi9cbiAgICB0aGlzLmRldGVybWluZUNhcmRTaXplcyA9ICgpID0+IHtcbiAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuXG4gICAgICBpZiAodGhpcy5jYXJkU2l6ZURldGVybWluZWQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAvLyBLZWVwIHRyYWNrIG9mIHdoaWNoIGNhcmRzIHdlJ3ZlIGFscmVhZHkgZGV0ZXJtaW5lZCBzaXplIGZvclxuICAgICAgICB0aGlzLmNhcmRTaXplRGV0ZXJtaW5lZCA9IFtdO1xuICAgICAgfVxuXG4gICAgICAvLyBHbyB0aHJvdWdoIGVhY2ggY2FyZFxuICAgICAgdGhpcy4kY2FyZHdyYXBwZXJTZXQuY2hpbGRyZW4oJzp2aXNpYmxlJykuZWFjaChmdW5jdGlvbiAoaSkge1xuICAgICAgICBjb25zdCBjYXJkSWQgPSBzZWxmLmNhcmRzW2ldLmlkO1xuXG4gICAgICAgIGlmIChzZWxmLmNhcmRTaXplRGV0ZXJtaW5lZC5pbmRleE9mKGNhcmRJZCkgIT09IC0xKSB7XG4gICAgICAgICAgcmV0dXJuOyAvLyBBbHJlYWR5IGRldGVybWluZWQsIG5vIG5lZWQgdG8gZGV0ZXJtaW5lIGFnYWluLlxuICAgICAgICB9XG4gICAgICAgIHNlbGYuY2FyZFNpemVEZXRlcm1pbmVkLnB1c2goY2FyZElkKTtcblxuICAgICAgICAvLyBIZXJlIFwidGhpc1wiIHJlZmVyZW5jZXMgdGhlIGpRdWVyeSBvYmplY3RcbiAgICAgICAgY29uc3QgJGNvbnRlbnQgPSAkKCcuaDVwLWRpYWxvZ2NhcmRzLWNhcmQtY29udGVudCcsIHRoaXMpO1xuICAgICAgICBjb25zdCAkdGV4dCA9ICQoJy5oNXAtZGlhbG9nY2FyZHMtY2FyZC10ZXh0LWlubmVyLWNvbnRlbnQnLCAkY29udGVudCk7XG5cbiAgICAgICAgLy8gR3JhYiBzaXplIHdpdGggdGV4dFxuICAgICAgICBjb25zdCB0ZXh0SGVpZ2h0ID0gJHRleHRbMF0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkuaGVpZ2h0O1xuXG4gICAgICAgIC8vIENoYW5nZSB0byBhbnN3ZXJcbiAgICAgICAgY29uc3QgY3VycmVudENhcmQgPSBzZWxmLmNhcmRzW2ldO1xuICAgICAgICBjdXJyZW50Q2FyZC5jaGFuZ2VUZXh0KGN1cnJlbnRDYXJkLmdldEFuc3dlcigpKTtcblxuICAgICAgICAvLyBHcmFiIHNpemUgd2l0aCBhbnN3ZXJcbiAgICAgICAgY29uc3QgYW5zd2VySGVpZ2h0ID0gJHRleHRbMF0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkuaGVpZ2h0O1xuXG4gICAgICAgIC8vIFVzZSBoaWdoZXN0XG4gICAgICAgIGxldCB1c2VIZWlnaHQgPSAodGV4dEhlaWdodCA+IGFuc3dlckhlaWdodCA/IHRleHRIZWlnaHQgOiBhbnN3ZXJIZWlnaHQpO1xuXG4gICAgICAgIC8vIE1pbi4gbGltaXRcbiAgICAgICAgY29uc3QgbWluSGVpZ2h0ID0gcGFyc2VGbG9hdCgkdGV4dC5wYXJlbnQoKS5wYXJlbnQoKS5jc3MoJ21pbkhlaWdodCcpKTtcbiAgICAgICAgaWYgKHVzZUhlaWdodCA8IG1pbkhlaWdodCkge1xuICAgICAgICAgIHVzZUhlaWdodCA9ICBtaW5IZWlnaHQ7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBOb25lIG9mIHRoZSBjYXJkcyBoYXMgdGV4dCwgc2hyaW5rIHRleHQgYXJlYSwgbGVhdmUgc3BhY2UgZm9yIGF1ZGlvXG4gICAgICAgIGlmIChzZWxmLmhhc05vVGV4dHMpIHtcbiAgICAgICAgICBjb25zdCAkY2FyZFRleHQgPSAkdGV4dC5maW5kKCcuaDVwLWRpYWxvZ2NhcmRzLWNhcmQtdGV4dCcpO1xuICAgICAgICAgIHVzZUhlaWdodCA9IHNlbGYuaGFzTm9BdWRpb3MgPyAwIDogdXNlSGVpZ2h0IC0gcGFyc2VGbG9hdCgkY2FyZFRleHQuY3NzKCdoZWlnaHQnKSk7XG4gICAgICAgICAgJGNhcmRUZXh0LmNzcygnaGVpZ2h0JywgMCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDb252ZXJ0IHRvIGVtXG4gICAgICAgIGNvbnN0IGZvbnRTaXplID0gcGFyc2VGbG9hdCgkY29udGVudC5jc3MoJ2ZvbnRTaXplJykpO1xuICAgICAgICB1c2VIZWlnaHQgLz0gZm9udFNpemU7XG5cbiAgICAgICAgLy8gU2V0IGhlaWdodFxuICAgICAgICAkdGV4dC5wYXJlbnQoKS5jc3MoJ2hlaWdodCcsIHVzZUhlaWdodCArICdlbScpO1xuXG4gICAgICAgIC8vIENoYW5nZSBiYWNrIHRvIHRleHRcbiAgICAgICAgY3VycmVudENhcmQuY2hhbmdlVGV4dChjdXJyZW50Q2FyZC5nZXRUZXh0KCkpO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFNjYWxlcyB0aGUgY2FyZCBjb250ZW50cy5cbiAgICAgKi9cbiAgICB0aGlzLnNjYWxlVG9GaXRIZWlnaHQgPSAoKSA9PiB7XG4gICAgICBpZiAoIXRoaXMuJGNhcmR3cmFwcGVyU2V0IHx8ICF0aGlzLiRjYXJkd3JhcHBlclNldC5pcygnOnZpc2libGUnKSB8fCAhdGhpcy5wYXJhbXMuYmVoYXZpb3VyLnNjYWxlVGV4dE5vdENhcmQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICAvLyBSZXNpemUgZm9udCBzaXplIHRvIGZpdCBpbnNpZGUgQ1BcbiAgICAgIGlmICh0aGlzLiRpbm5lci5wYXJlbnRzKCcuaDVwLWNvdXJzZS1wcmVzZW50YXRpb24nKS5sZW5ndGgpIHtcbiAgICAgICAgbGV0ICRwYXJlbnRDb250YWluZXIgPSB0aGlzLiRpbm5lci5wYXJlbnQoKTtcbiAgICAgICAgaWYgKHRoaXMuJGlubmVyLnBhcmVudHMoJy5oNXAtcG9wdXAtY29udGFpbmVyJykubGVuZ3RoKSB7XG4gICAgICAgICAgJHBhcmVudENvbnRhaW5lciA9IHRoaXMuJGlubmVyLnBhcmVudHMoJy5oNXAtcG9wdXAtY29udGFpbmVyJyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29udGFpbmVySGVpZ2h0ID0gJHBhcmVudENvbnRhaW5lci5nZXQoMCkuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkuaGVpZ2h0O1xuICAgICAgICBjb25zdCBnZXRDb250ZW50SGVpZ2h0ID0gKCkgPT4ge1xuICAgICAgICAgIGxldCBjb250ZW50SGVpZ2h0ID0gMDtcbiAgICAgICAgICB0aGlzLiRpbm5lci5jaGlsZHJlbigpLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy8gSGVyZSBcInRoaXNcIiByZWZlcmVuY2VzIHRoZSBqUXVlcnkgb2JqZWN0XG4gICAgICAgICAgICBjb25zdCAkY2hpbGQgPSAkKHRoaXMpO1xuICAgICAgICAgICAgY29udGVudEhlaWdodCArPSB0aGlzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmhlaWdodCArXG4gICAgICAgICAgICBwYXJzZUZsb2F0KCRjaGlsZC5jc3MoJ21hcmdpbi10b3AnKSkgKyBwYXJzZUZsb2F0KCRjaGlsZC5jc3MoJ21hcmdpbi1ib3R0b20nKSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuIGNvbnRlbnRIZWlnaHQ7XG4gICAgICAgIH07XG4gICAgICAgIGxldCBjb250ZW50SGVpZ2h0ID0gZ2V0Q29udGVudEhlaWdodCgpO1xuICAgICAgICBjb25zdCBwYXJlbnRGb250U2l6ZSA9IHBhcnNlRmxvYXQodGhpcy4kaW5uZXIucGFyZW50KCkuY3NzKCdmb250LXNpemUnKSk7XG4gICAgICAgIGxldCBuZXdGb250U2l6ZSA9IHBhcnNlRmxvYXQodGhpcy4kaW5uZXIuY3NzKCdmb250LXNpemUnKSk7XG5cbiAgICAgICAgLy8gRGVjcmVhc2UgZm9udCBzaXplXG4gICAgICAgIGlmIChjb250YWluZXJIZWlnaHQgPCBjb250ZW50SGVpZ2h0KSB7XG4gICAgICAgICAgd2hpbGUgKGNvbnRhaW5lckhlaWdodCA8IGNvbnRlbnRIZWlnaHQpIHtcbiAgICAgICAgICAgIG5ld0ZvbnRTaXplIC09IERpYWxvZ2NhcmRzLlNDQUxFSU5URVJWQUw7XG5cbiAgICAgICAgICAgIC8vIENhcCBhdCBtaW4gZm9udCBzaXplXG4gICAgICAgICAgICBpZiAobmV3Rm9udFNpemUgPCBEaWFsb2djYXJkcy5NSU5TQ0FMRSkge1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gU2V0IHJlbGF0aXZlIGZvbnQgc2l6ZSB0byBzY2FsZSB3aXRoIGZ1bGwgc2NyZWVuLlxuICAgICAgICAgICAgdGhpcy4kaW5uZXIuY3NzKCdmb250LXNpemUnLCAobmV3Rm9udFNpemUgLyBwYXJlbnRGb250U2l6ZSkgKyAnZW0nKTtcbiAgICAgICAgICAgIGNvbnRlbnRIZWlnaHQgPSBnZXRDb250ZW50SGVpZ2h0KCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgeyAvLyBJbmNyZWFzZSBmb250IHNpemVcbiAgICAgICAgICBsZXQgaW5jcmVhc2VGb250U2l6ZSA9IHRydWU7XG4gICAgICAgICAgd2hpbGUgKGluY3JlYXNlRm9udFNpemUpIHtcbiAgICAgICAgICAgIG5ld0ZvbnRTaXplICs9IERpYWxvZ2NhcmRzLlNDQUxFSU5URVJWQUw7XG5cbiAgICAgICAgICAgIC8vIENhcCBtYXggZm9udCBzaXplXG4gICAgICAgICAgICBpZiAobmV3Rm9udFNpemUgPiBEaWFsb2djYXJkcy5NQVhTQ0FMRSkge1xuICAgICAgICAgICAgICBpbmNyZWFzZUZvbnRTaXplID0gZmFsc2U7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBTZXQgcmVsYXRpdmUgZm9udCBzaXplIHRvIHNjYWxlIHdpdGggZnVsbCBzY3JlZW4uXG4gICAgICAgICAgICBsZXQgcmVsYXRpdmVGb250U2l6ZSA9IG5ld0ZvbnRTaXplIC8gcGFyZW50Rm9udFNpemU7XG4gICAgICAgICAgICB0aGlzLiRpbm5lci5jc3MoJ2ZvbnQtc2l6ZScsIHJlbGF0aXZlRm9udFNpemUgKyAnZW0nKTtcbiAgICAgICAgICAgIGNvbnRlbnRIZWlnaHQgPSBnZXRDb250ZW50SGVpZ2h0KCk7XG4gICAgICAgICAgICBpZiAoY29udGFpbmVySGVpZ2h0IDw9IGNvbnRlbnRIZWlnaHQpIHtcbiAgICAgICAgICAgICAgaW5jcmVhc2VGb250U2l6ZSA9IGZhbHNlO1xuICAgICAgICAgICAgICByZWxhdGl2ZUZvbnRTaXplID0gKG5ld0ZvbnRTaXplIC0gRGlhbG9nY2FyZHMuU0NBTEVJTlRFUlZBTCkgLyBwYXJlbnRGb250U2l6ZTtcbiAgICAgICAgICAgICAgdGhpcy4kaW5uZXIuY3NzKCdmb250LXNpemUnLCByZWxhdGl2ZUZvbnRTaXplICsgJ2VtJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBlbHNlIHsgLy8gUmVzaXplIG1vYmlsZSB2aWV3XG4gICAgICAgIHRoaXMuY2FyZHNbdGhpcy5jdXJyZW50Q2FyZElkXS5yZXNpemVPdmVyZmxvd2luZ1RleHQoKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVHJ1bmNhdGUgcmV0cnkgYnV0dG9uIGlmIHdpZHRoIGlzIHNtYWxsLlxuICAgICAqL1xuICAgIHRoaXMudHJ1bmNhdGVSZXRyeUJ1dHRvbiA9ICgpID0+IHtcbiAgICAgIGlmICghdGhpcy4kcmV0cnkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICAvLyBSZXNldCBidXR0b24gdG8gZnVsbCBzaXplXG4gICAgICB0aGlzLiRyZXRyeS5yZW1vdmVDbGFzcygndHJ1bmNhdGVkJyk7XG4gICAgICB0aGlzLiRyZXRyeS5odG1sKHRoaXMucGFyYW1zLnJldHJ5KTtcblxuICAgICAgLy8gTWVhc3VyZSBidXR0b25cbiAgICAgIGNvbnN0IG1heFdpZHRoUGVyY2VudGFnZXMgPSAwLjM7XG4gICAgICBjb25zdCByZXRyeVdpZHRoID0gdGhpcy4kcmV0cnkuZ2V0KDApLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoICtcbiAgICAgICAgICBwYXJzZUZsb2F0KHRoaXMuJHJldHJ5LmNzcygnbWFyZ2luLWxlZnQnKSkgKyBwYXJzZUZsb2F0KHRoaXMuJHJldHJ5LmNzcygnbWFyZ2luLXJpZ2h0JykpO1xuICAgICAgY29uc3QgcmV0cnlXaWR0aFBlcmNlbnRhZ2UgPSByZXRyeVdpZHRoIC8gdGhpcy4kcmV0cnkucGFyZW50KCkuZ2V0KDApLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoO1xuXG4gICAgICAvLyBUcnVuY2F0ZSBidXR0b25cbiAgICAgIGlmIChyZXRyeVdpZHRoUGVyY2VudGFnZSA+IG1heFdpZHRoUGVyY2VudGFnZXMpIHtcbiAgICAgICAgdGhpcy4kcmV0cnkuYWRkQ2xhc3MoJ3RydW5jYXRlZCcpO1xuICAgICAgICB0aGlzLiRyZXRyeS5odG1sKCcnKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogUmV0cmlldmUgaW5kZXggb2YgY2FyZCBpbiBzZWxlY3Rpb24sIG5vdCBsb2FkZWQgY2FyZHMuXG4gICAgICovXG4gICAgdGhpcy5nZXRDdXJyZW50U2VsZWN0aW9uSW5kZXggPSAoKSA9PiB0aGlzLmNhcmRJZHMuaW5kZXhPZih0aGlzLmNhcmRzW3RoaXMuY3VycmVudENhcmRJZF0uaWQpO1xuXG4gICAgLyoqXG4gICAgICogR2V0IHRoZSBjb250ZW50IHR5cGUgdGl0bGUuXG4gICAgICpcbiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9IHRpdGxlLlxuICAgICAqL1xuICAgIHRoaXMuZ2V0VGl0bGUgPSAoKSA9PiB7XG4gICAgICByZXR1cm4gSDVQLmNyZWF0ZVRpdGxlKCh0aGlzLmNvbnRlbnREYXRhICYmIHRoaXMuY29udGVudERhdGEubWV0YWRhdGEgJiYgdGhpcy5jb250ZW50RGF0YS5tZXRhZGF0YS50aXRsZSkgPyB0aGlzLmNvbnRlbnREYXRhLm1ldGFkYXRhLnRpdGxlIDogJ0RpYWxvZyBDYXJkcycpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBTYXZlIHRoZSBjdXJyZW50IHN0YXRlIHRvIGJlIHJlc3RvcmVkIGxhdGVyLlxuICAgICAqL1xuICAgIHRoaXMuZ2V0Q3VycmVudFN0YXRlID0gKCkgPT4ge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgY2FyZFBpbGVzOiB0aGlzLmNhcmRNYW5hZ2VyLmdldFBpbGVzKCksXG4gICAgICAgIGNhcmRJZHM6IHRoaXMuY2FyZElkcyxcbiAgICAgICAgcm91bmQ6IHRoaXMucm91bmQsXG4gICAgICAgIGN1cnJlbnRDYXJkSWQ6IHRoaXMuZ2V0Q3VycmVudFNlbGVjdGlvbkluZGV4KCksXG4gICAgICAgIHJlc3VsdHM6IHRoaXMucmVzdWx0c1xuICAgICAgfTtcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIENvbXB1dGUgZGlzcGxheSBsaW1pdHMuXG4gICAqIEByZXR1cm4ge29iamVjdHxudWxsfSBIZWlnaHQgYW5kIHdpZHRoIGluIHB4IG9yIG51bGwgaWYgY2Fubm90IGJlIGRldGVybWluZWQuXG4gICAqL1xuICBjb21wdXRlRGlzcGxheUxpbWl0cygpIHtcbiAgICBsZXQgdG9wV2luZG93ID0gdGhpcy5nZXRUb3BXaW5kb3coKTtcblxuICAgIC8vIGlPUyBkb2Vzbid0IGNoYW5nZSBzY3JlZW4gZGltZW5zaW9ucyBvbiByb3RhdGlvblxuICAgIGxldCBzY3JlZW5TaXplID0gKHRoaXMuaXNJT1MoKSAmJiB0aGlzLmdldE9yaWVudGF0aW9uKCkgPT09ICdsYW5kc2NhcGUnKSA/XG4gICAgICB7IGhlaWdodDogc2NyZWVuLndpZHRoLCB3aWR0aDogc2NyZWVuLmhlaWdodCB9IDpcbiAgICAgIHsgaGVpZ2h0OiBzY3JlZW4uaGVpZ2h0LCB3aWR0aDogc2NyZWVuLndpZHRoIH07XG5cbiAgICB0b3BXaW5kb3cgPSB0b3BXaW5kb3cgfHwge1xuICAgICAgaW5uZXJIZWlnaHQ6IHNjcmVlblNpemUuaGVpZ2h0LFxuICAgICAgaW5uZXJXaWR0aDogc2NyZWVuU2l6ZS53aWR0aFxuICAgIH07XG5cbiAgICAvLyBTbWFsbGVzdCB2YWx1ZSBvZiB2aWV3cG9ydCBhbmQgY29udGFpbmVyIHdpbnNcbiAgICByZXR1cm4ge1xuICAgICAgaGVpZ2h0OiBNYXRoLm1pbih0b3BXaW5kb3cuaW5uZXJIZWlnaHQsIHNjcmVlblNpemUuaGVpZ2h0KSxcbiAgICAgIHdpZHRoOiBNYXRoLm1pbih0b3BXaW5kb3cuaW5uZXJXaWR0aCwgdGhpcy4kaW5uZXIuZ2V0KDApLm9mZnNldFdpZHRoKVxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogQ29tcHV0ZSBkaXNwbGF5IGxpbWl0cyBmb3IgS2lkc0xvb3AgTGl2ZS5cbiAgICogQHJldHVybiB7b2JqZWN0fG51bGx9IEhlaWdodCBhbmQgd2lkdGggaW4gcHggb3IgbnVsbCBpZiBjYW5ub3QgYmUgZGV0ZXJtaW5lZC5cbiAgICovXG4gIGNvbXB1dGVEaXNwbGF5TGltaXRzS0xMKCkge1xuICAgIGNvbnN0IGRpc3BsYXlMaW1pdHMgPSB0aGlzLmNvbXB1dGVEaXNwbGF5TGltaXRzKCk7XG5cbiAgICAvLyBUaGlzIG9ubHkgd29ya3MgYmVjYXVzZSBLTEwgZW5mb3JjZXMgaGVpZ2h0IG9uIEg1UCdzIGlmcmFtZVxuICAgIGRpc3BsYXlMaW1pdHMuaGVpZ2h0ID0gTWF0aC5taW4oZGlzcGxheUxpbWl0cy5oZWlnaHQsIGRvY3VtZW50LmJvZHkub2Zmc2V0SGVpZ2h0KTtcbiAgICByZXR1cm4gZGlzcGxheUxpbWl0cztcbiAgfVxuXG4gIC8qKlxuICAgKiBEZXRlY3Qgd2hldGhlciB1c2VyIGlzIHJ1bm5pbmcgaU9TLlxuICAgKiBAcmV0dXJuIHtib29sZWFufSBUcnVlLCBpZiB1c2VyIGlzIHJ1bm5pbmcgaU9TLlxuICAgKi9cbiAgaXNJT1MoKSB7XG4gICAgcmV0dXJuIChcbiAgICAgIFsnaVBhZCBTaW11bGF0b3InLCAnaVBob25lIFNpbXVsYXRvcicsICdpUG9kIFNpbXVsYXRvcicsICdpUGFkJywgJ2lQaG9uZScsICdpUG9kJ10uaW5jbHVkZXMobmF2aWdhdG9yLnBsYXRmb3JtKSB8fFxuICAgICAgKG5hdmlnYXRvci51c2VyQWdlbnQuaW5jbHVkZXMoJ01hYycpICYmICdvbnRvdWNoZW5kJyBpbiBkb2N1bWVudClcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIERldGVybWluZSB3aGV0aGVyIG1vYmlsZSBkZXZpY2UgaW4gbGFuZHNjYXBlIG9yaWVudGF0aW9uLlxuICAgKiBAcmV0dXJuIHtib29sZWFufSBUcnVlLCBpZiBtb2JpbGUgZGV2aWNlIGluIGxhbmRzY2FwZSBvcmllbnRhdGlvbi5cbiAgICovXG4gIGlzTW9iaWxlTGFuZHNjYXBlKCkge1xuICAgIHJldHVybiB0aGlzLmlzTW9iaWxlRGV2aWNlKCkgJiYgdGhpcy5nZXRPcmllbnRhdGlvbigpID09PSAnbGFuZHNjYXBlJztcbiAgfVxuXG4gIC8qKlxuICAgKiBEZXRlY3QgbW9iaWxlIGRldmljZXMgKGh0dHA6Ly9kZXRlY3Rtb2JpbGVicm93c2Vycy5jb20vKVxuICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gVHJ1ZSBpZiBydW5uaW5nIG9uIGEgbW9iaWxlIGRldmljZS5cbiAgICovXG4gIGlzTW9iaWxlRGV2aWNlKCkge1xuICAgIGxldCBjaGVjayA9IGZhbHNlO1xuICAgIChmdW5jdGlvbiAoYSkge1xuICAgICAgaWYgKC8oYW5kcm9pZHxiYlxcZCt8bWVlZ28pLittb2JpbGV8YXZhbnRnb3xiYWRhXFwvfGJsYWNrYmVycnl8YmxhemVyfGNvbXBhbHxlbGFpbmV8ZmVubmVjfGhpcHRvcHxpZW1vYmlsZXxpcChob25lfG9kKXxpcmlzfGtpbmRsZXxsZ2UgfG1hZW1vfG1pZHB8bW1wfG1vYmlsZS4rZmlyZWZveHxuZXRmcm9udHxvcGVyYSBtKG9ifGluKWl8cGFsbSggb3MpP3xwaG9uZXxwKGl4aXxyZSlcXC98cGx1Y2tlcnxwb2NrZXR8cHNwfHNlcmllcyg0fDYpMHxzeW1iaWFufHRyZW98dXBcXC4oYnJvd3NlcnxsaW5rKXx2b2RhZm9uZXx3YXB8d2luZG93cyBjZXx4ZGF8eGlpbm8vaS50ZXN0KGEpIHx8IC8xMjA3fDYzMTB8NjU5MHwzZ3NvfDR0aHB8NTBbMS02XWl8Nzcwc3w4MDJzfGEgd2F8YWJhY3xhYyhlcnxvb3xzLSl8YWkoa298cm4pfGFsKGF2fGNhfGNvKXxhbW9pfGFuKGV4fG55fHl3KXxhcHR1fGFyKGNofGdvKXxhcyh0ZXx1cyl8YXR0d3xhdShkaXwtbXxyIHxzICl8YXZhbnxiZShja3xsbHxucSl8YmkobGJ8cmQpfGJsKGFjfGF6KXxicihlfHYpd3xidW1ifGJ3LShufHUpfGM1NVxcL3xjYXBpfGNjd2F8Y2RtLXxjZWxsfGNodG18Y2xkY3xjbWQtfGNvKG1wfG5kKXxjcmF3fGRhKGl0fGxsfG5nKXxkYnRlfGRjLXN8ZGV2aXxkaWNhfGRtb2J8ZG8oY3xwKW98ZHMoMTJ8LWQpfGVsKDQ5fGFpKXxlbShsMnx1bCl8ZXIoaWN8azApfGVzbDh8ZXooWzQtN10wfG9zfHdhfHplKXxmZXRjfGZseSgtfF8pfGcxIHV8ZzU2MHxnZW5lfGdmLTV8Zy1tb3xnbyhcXC53fG9kKXxncihhZHx1bil8aGFpZXxoY2l0fGhkLShtfHB8dCl8aGVpLXxoaShwdHx0YSl8aHAoIGl8aXApfGhzLWN8aHQoYygtfCB8X3xhfGd8cHxzfHQpfHRwKXxodShhd3x0Yyl8aS0oMjB8Z298bWEpfGkyMzB8aWFjKCB8LXxcXC8pfGlicm98aWRlYXxpZzAxfGlrb218aW0xa3xpbm5vfGlwYXF8aXJpc3xqYSh0fHYpYXxqYnJvfGplbXV8amlnc3xrZGRpfGtlaml8a2d0KCB8XFwvKXxrbG9ufGtwdCB8a3djLXxreW8oY3xrKXxsZShub3x4aSl8bGcoIGd8XFwvKGt8bHx1KXw1MHw1NHwtW2Etd10pfGxpYnd8bHlueHxtMS13fG0zZ2F8bTUwXFwvfG1hKHRlfHVpfHhvKXxtYygwMXwyMXxjYSl8bS1jcnxtZShyY3xyaSl8bWkobzh8b2F8dHMpfG1tZWZ8bW8oMDF8MDJ8Yml8ZGV8ZG98dCgtfCB8b3x2KXx6eil8bXQoNTB8cDF8diApfG13YnB8bXl3YXxuMTBbMC0yXXxuMjBbMi0zXXxuMzAoMHwyKXxuNTAoMHwyfDUpfG43KDAoMHwxKXwxMCl8bmUoKGN8bSktfG9ufHRmfHdmfHdnfHd0KXxub2soNnxpKXxuenBofG8yaW18b3AodGl8d3YpfG9yYW58b3dnMXxwODAwfHBhbihhfGR8dCl8cGR4Z3xwZygxM3wtKFsxLThdfGMpKXxwaGlsfHBpcmV8cGwoYXl8dWMpfHBuLTJ8cG8oY2t8cnR8c2UpfHByb3h8cHNpb3xwdC1nfHFhLWF8cWMoMDd8MTJ8MjF8MzJ8NjB8LVsyLTddfGktKXxxdGVrfHIzODB8cjYwMHxyYWtzfHJpbTl8cm8odmV8em8pfHM1NVxcL3xzYShnZXxtYXxtbXxtc3xueXx2YSl8c2MoMDF8aC18b298cC0pfHNka1xcL3xzZShjKC18MHwxKXw0N3xtY3xuZHxyaSl8c2doLXxzaGFyfHNpZSgtfG0pfHNrLTB8c2woNDV8aWQpfHNtKGFsfGFyfGIzfGl0fHQ1KXxzbyhmdHxueSl8c3AoMDF8aC18di18diApfHN5KDAxfG1iKXx0MigxOHw1MCl8dDYoMDB8MTB8MTgpfHRhKGd0fGxrKXx0Y2wtfHRkZy18dGVsKGl8bSl8dGltLXx0LW1vfHRvKHBsfHNoKXx0cyg3MHxtLXxtM3xtNSl8dHgtOXx1cChcXC5ifGcxfHNpKXx1dHN0fHY0MDB8djc1MHx2ZXJpfHZpKHJnfHRlKXx2ayg0MHw1WzAtM118LXYpfHZtNDB8dm9kYXx2dWxjfHZ4KDUyfDUzfDYwfDYxfDcwfDgwfDgxfDgzfDg1fDk4KXx3M2MoLXwgKXx3ZWJjfHdoaXR8d2koZyB8bmN8bncpfHdtbGJ8d29udXx4NzAwfHlhcy18eW91cnx6ZXRvfHp0ZS0vaS50ZXN0KGEuc3Vic3RyKDAsIDQpKSkgY2hlY2sgPSB0cnVlO1xuICAgIH0pKG5hdmlnYXRvci51c2VyQWdlbnQgfHwgbmF2aWdhdG9yLnZlbmRvciB8fCB3aW5kb3cub3BlcmEpO1xuICAgIHJldHVybiBjaGVjaztcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgZGV2aWNlIG9yaWVudGF0aW9uLlxuICAgKiBAcmV0dXJuIHtzdHJpbmd9ICdwb3J0cmFpdCcgb3IgJ2xhbmRzY2FwZScuXG4gICAqL1xuICBnZXRPcmllbnRhdGlvbigpIHtcbiAgICBpZiAoc2NyZWVuLm9yaWVudGF0aW9uICYmIHNjcmVlbi5vcmllbnRhdGlvbi50eXBlKSB7XG4gICAgICBpZiAoc2NyZWVuLm9yaWVudGF0aW9uLnR5cGUuaW5jbHVkZXMoJ3BvcnRyYWl0JykpIHtcbiAgICAgICAgcmV0dXJuICdwb3J0cmFpdCc7XG4gICAgICB9XG4gICAgICBlbHNlIGlmIChzY3JlZW4ub3JpZW50YXRpb24udHlwZS5pbmNsdWRlcygnbGFuZHNjYXBlJykpIHtcbiAgICAgICAgcmV0dXJuICdsYW5kc2NhcGUnO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFVucmVsaWFibGUsIGFzIG5vdCBjbGVhciB3aGF0IGRldmljZSdzIG5hdHVyYWwgb3JpZW50YXRpb24gaXNcbiAgICBpZiAodHlwZW9mIHdpbmRvdy5vcmllbnRhdGlvbiA9PT0gJ251bWJlcicpIHtcbiAgICAgIGlmICh3aW5kb3cub3JpZW50YXRpb24gPT09IDAgfHwgd2luZG93Lm9yaWVudGF0aW9uID09PSAxODApIHtcbiAgICAgICAgcmV0dXJuICdwb3J0cmFpdCc7XG4gICAgICB9XG4gICAgICBlbHNlIGlmICh3aW5kb3cub3JpZW50YXRpb24gPT09IDkwIHx8IHdpbmRvdy5vcmllbnRhdGlvbiA9PT0gLTkwIHx8IHdpbmRvdy5vcmllbnRhdGlvbiA9PT0gMjcwKSB7XG4gICAgICAgIHJldHVybiAnbGFuZHNjYXBlJztcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gJ2xhbmRzY2FwZSc7IC8vIEFzc3VtZSBkZWZhdWx0XG4gIH1cblxuICAvKipcblx0ICogR2V0IHRvcCBET00gV2luZG93IG9iamVjdC5cblx0ICogQHBhcmFtIHtXaW5kb3d9IFtzdGFydFdpbmRvdz13aW5kb3ddIFdpbmRvdyB0byBzdGFydCBsb29raW5nIGZyb20uXG5cdCAqIEByZXR1cm4ge1dpbmRvd3xudWxsfSBUb3Agd2luZG93LlxuXHQgKi9cbiAgZ2V0VG9wV2luZG93KHN0YXJ0V2luZG93KSB7XG4gICAgdmFyIHNhbWVPcmlnaW47XG4gICAgc3RhcnRXaW5kb3cgPSBzdGFydFdpbmRvdyB8fCB3aW5kb3c7XG5cbiAgICAvLyBINVAgaWZyYW1lIG1heSBiZSBvbiBkaWZmZXJlbnQgZG9tYWluIHRoYW4gaWZyYW1lIGNvbnRlbnRcbiAgICB0cnkge1xuICAgICAgc2FtZU9yaWdpbiA9IHN0YXJ0V2luZG93LnBhcmVudC5sb2NhdGlvbi5ob3N0ID09PSB3aW5kb3cubG9jYXRpb24uaG9zdDtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICBzYW1lT3JpZ2luID0gbnVsbDtcbiAgICB9XG5cbiAgICBpZiAoIXNhbWVPcmlnaW4pIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGlmIChzdGFydFdpbmRvdy5wYXJlbnQgPT09IHN0YXJ0V2luZG93IHx8ICEgc3RhcnRXaW5kb3cucGFyZW50KSB7XG4gICAgICByZXR1cm4gc3RhcnRXaW5kb3c7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuZ2V0VG9wV2luZG93KHN0YXJ0V2luZG93LnBhcmVudCk7XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlIG9yaWVudGF0aW9uIGNoYW5nZS5cbiAgICovXG4gIGhhbmRsZU9yaWVudGF0aW9uQ2hhbmdlKCkge1xuICAgIGlmICghdGhpcy5wYXJhbXMuYmVoYXZpb3VyLnNjYWxlVGV4dE5vdENhcmQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBpc01vYmlsZUxhbmRzY2FwZSA9IHRoaXMuaXNNb2JpbGVMYW5kc2NhcGUoKTtcbiAgICB0aGlzLmNhcmRzLmZvckVhY2goY2FyZCA9PiB7XG4gICAgICBpZiAodGhpcy5wYXJhbXMubW9kZSA9PT0gJ3JlcGV0aXRpb24nKSB7XG4gICAgICAgIGNhcmQuJGJ1dHRvblR1cm4udGV4dChpc01vYmlsZUxhbmRzY2FwZSA/ICcnIDogdGhpcy5wYXJhbXMuYW5zd2VyKTtcbiAgICAgICAgY2FyZC4kYnV0dG9uQ29ycmVjdC50ZXh0KGlzTW9iaWxlTGFuZHNjYXBlID8gJycgOiB0aGlzLnBhcmFtcy5jb3JyZWN0QW5zd2VyKTtcbiAgICAgICAgY2FyZC4kYnV0dG9uSW5jb3JyZWN0LnRleHQoaXNNb2JpbGVMYW5kc2NhcGUgPyAnJyA6IHRoaXMucGFyYW1zLmluY29ycmVjdEFuc3dlcik7XG4gICAgICB9XG5cbiAgICAgIGlmICghaXNNb2JpbGVMYW5kc2NhcGUpIHtcbiAgICAgICAgdGhpcy4kY2FyZHdyYXBwZXJTZXQuY3NzKCdtYXgtaGVpZ2h0JywgJycpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG59XG5cbkRpYWxvZ2NhcmRzLmlkQ291bnRlciA9IDA7XG5cbi8vIENvbnN0YW50c1xuRGlhbG9nY2FyZHMuU0NBTEVJTlRFUlZBTCA9IDAuMjtcbkRpYWxvZ2NhcmRzLk1BWFNDQUxFID0gMTY7XG5EaWFsb2djYXJkcy5NSU5TQ0FMRSA9IDQ7XG5cbmV4cG9ydCBkZWZhdWx0IERpYWxvZ2NhcmRzO1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/scripts/h5p-dialogcards.js\n");

/***/ }),

/***/ "./src/styles/h5p-dialogcards.css":
/*!****************************************!*\
  !*** ./src/styles/h5p-dialogcards.css ***!
  \****************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n// extracted by mini-css-extract-plugin\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvc3R5bGVzL2g1cC1kaWFsb2djYXJkcy5jc3MuanMiLCJtYXBwaW5ncyI6IjtBQUFBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vaDVwLWRpYWxvZ2NhcmRzLy4vc3JjL3N0eWxlcy9oNXAtZGlhbG9nY2FyZHMuY3NzP2IzZDYiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gZXh0cmFjdGVkIGJ5IG1pbmktY3NzLWV4dHJhY3QtcGx1Z2luXG5leHBvcnQge307Il0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/styles/h5p-dialogcards.css\n");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	!function() {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = function(exports) {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	}();
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module can't be inlined because the eval-source-map devtool is used.
/******/ 	var __webpack_exports__ = __webpack_require__("./src/entries/h5p-dialogcards.js");
/******/ 	
/******/ })()
;
