/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
/******/ (function() { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "./src/entries/h5p-dialogcards.js":
/*!****************************************!*\
  !*** ./src/entries/h5p-dialogcards.js ***!
  \****************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _styles_h5p_dialogcards_css__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../styles/h5p-dialogcards.css */ \"./src/styles/h5p-dialogcards.css\");\n/* harmony import */ var _scripts_h5p_dialogcards_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../scripts/h5p-dialogcards.js */ \"./src/scripts/h5p-dialogcards.js\");\n\n // Load library\n// H5P = H5P || {};\n\nH5P.Dialogcards = _scripts_h5p_dialogcards_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"];//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZW50cmllcy9oNXAtZGlhbG9nY2FyZHMuanMuanMiLCJtYXBwaW5ncyI6Ijs7O0FBQUE7QUFDQTtBQUdBOztBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vaDVwLWRpYWxvZ2NhcmRzLy4vc3JjL2VudHJpZXMvaDVwLWRpYWxvZ2NhcmRzLmpzPzRmNWIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFwiLi4vc3R5bGVzL2g1cC1kaWFsb2djYXJkcy5jc3NcIjtcbmltcG9ydCBEaWFsb2djYXJkcyBmcm9tIFwiLi4vc2NyaXB0cy9oNXAtZGlhbG9nY2FyZHMuanNcIjtcblxuLy8gTG9hZCBsaWJyYXJ5XG4vLyBINVAgPSBINVAgfHwge307XG5INVAuRGlhbG9nY2FyZHMgPSBEaWFsb2djYXJkcztcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/entries/h5p-dialogcards.js\n");

/***/ }),

/***/ "./src/scripts/h5p-dialogcards-card-manager.js":
/*!*****************************************************!*\
  !*** ./src/scripts/h5p-dialogcards-card-manager.js ***!
  \*****************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _h5p_dialogcards_card_pool__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./h5p-dialogcards-card-pool */ \"./src/scripts/h5p-dialogcards-card-pool.js\");\n/* harmony import */ var _h5p_dialogcards_card_pile__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./h5p-dialogcards-card-pile */ \"./src/scripts/h5p-dialogcards-card-pile.js\");\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _iterableToArray(iter) { if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\n\n\n\nvar CardManager = /*#__PURE__*/function () {\n  /**\n   * @constructor\n   *\n   * @param {object} params Parameters from content type.\n   * @param {number} contentId Id of content.\n   * @param {object} callbacks Callbacks to parent.\n   */\n  function CardManager(params, contentId, callbacks) {\n    this.params = params;\n    this.cardPool = new _h5p_dialogcards_card_pool__WEBPACK_IMPORTED_MODULE_0__[\"default\"](params, contentId, callbacks);\n    this.reset(params.cardPiles);\n    return this;\n  }\n  /**\n   * Create a selection of card ids depending on mode.\n   *\n   * @return {object[]} Selection of card ids.\n   */\n\n\n  var _proto = CardManager.prototype;\n\n  _proto.createSelection = function createSelection() {\n    var selectionIds = [];\n\n    switch (this.params.mode) {\n      case 'repetition':\n        // Repetition mode\n        selectionIds = this.createSelectionRepetition();\n        break;\n\n      default:\n        // Normal mode\n        selectionIds = this.cardPool.getCardIds();\n    }\n\n    return selectionIds;\n  }\n  /**\n   * Create card piles depending on mode.\n   * @param {object} [cardPiles] Piles to set (from previous state).\n   */\n  ;\n\n  _proto.createPiles = function createPiles(cardPiles) {\n    if (cardPiles) {\n      this.cardPiles = cardPiles.map(function (cardPile) {\n        return new _h5p_dialogcards_card_pile__WEBPACK_IMPORTED_MODULE_1__[\"default\"](cardPile.cards);\n      });\n      return;\n    }\n\n    this.cardPiles = [];\n    var pool = this.cardPool.getCardIds();\n\n    switch (this.params.mode) {\n      case 'repetition':\n        // Repetition mode\n        for (var i = 0; i < this.params.behaviour.maxProficiency; i++) {\n          if (i === 0) {\n            this.cardPiles.push(new _h5p_dialogcards_card_pile__WEBPACK_IMPORTED_MODULE_1__[\"default\"](pool));\n          } else {\n            this.cardPiles.push(new _h5p_dialogcards_card_pile__WEBPACK_IMPORTED_MODULE_1__[\"default\"]());\n          }\n        }\n\n        break;\n\n      case 'normal':\n        // Normal mode. One pile only with all cards\n        this.cardPiles.push(new _h5p_dialogcards_card_pile__WEBPACK_IMPORTED_MODULE_1__[\"default\"](pool));\n    }\n  }\n  /**\n   * Update piles.\n   *\n   * Just one \"rule\" for now. Could be amended with more modes.\n   *\n   * @param {object[]} results Results.\n   * @param {number} results.cardId Card that result is reported for.\n   * @param {boolean} results.result Result for that card.\n   * @return {number[]} Card pile sizes.\n   */\n  ;\n\n  _proto.updatePiles = function updatePiles(results) {\n    var _this = this;\n\n    results.forEach(function (result) {\n      // Find card in pile\n      var pileId = _this.find(result.cardId);\n\n      if (pileId === -1) {\n        return;\n      } // Move card to next pile or first pile\n\n\n      var newPileId = result.result === true ? pileId + 1 : 0;\n      newPileId = Math.max(0, Math.min(newPileId, _this.cardPiles.length - 1));\n\n      _this.cardPiles[pileId].remove(result.cardId);\n\n      _this.cardPiles[newPileId].add(result.cardId, 'bottom');\n    });\n    return this.getPileSizes();\n  }\n  /**\n   * Create card selection for repetition mode.\n   *\n   * Draw all cards from first pile with cards, 1/2 of next, 1/3 of next, ...\n   * Don't draw cards from last pile\n   * Get cards from top - will be moved at the bottom of other pile according to results (LIFO)\n   *\n   * @return {object[]} Ids of selected cards from pool.\n   */\n  ;\n\n  _proto.createSelectionRepetition = function createSelectionRepetition() {\n    var selectionIds = [];\n    var firstPileWithCards = null;\n\n    for (var j = 0; j < this.cardPiles.length - 1; j++) {\n      var _selectionIds;\n\n      var pileAmount = this.cardPiles[j].length(); // Skip empty piles\n\n      if (firstPileWithCards === null && pileAmount === 0) {\n        continue;\n      } // Remember first pile with cards\n\n\n      if (firstPileWithCards === null) {\n        firstPileWithCards = j;\n      } // Draw cards favoring those of piles with low id\n\n\n      var drawAmount = Math.ceil(pileAmount * 1 / (1 + j - firstPileWithCards));\n      var cardsDrawn = this.cardPiles[j].peek(0, drawAmount);\n      selectionIds = (_selectionIds = selectionIds).concat.apply(_selectionIds, _toConsumableArray(cardsDrawn));\n    } // Shuffle selection\n\n\n    selectionIds = this.shuffle(selectionIds);\n    return selectionIds;\n  }\n  /**\n   * Shuffle items (not in place).\n   *\n   * @param {object[]} items Items.\n   * @return {object[]} Shuffled items.\n   */\n  ;\n\n  _proto.shuffle = function shuffle(items) {\n    var copies = items.slice();\n\n    for (var i = copies.length - 1; i > 0; i--) {\n      var j = Math.floor(Math.random() * (i + 1));\n      var _ref = [copies[j], copies[i]];\n      copies[i] = _ref[0];\n      copies[j] = _ref[1];\n    }\n\n    return copies;\n  }\n  /**\n   * Find id of pile that contains card with particular id.\n   *\n   * @param {number} id Id of card to be found.\n   * @return {number} Id of pile or -1.\n   */\n  ;\n\n  _proto.find = function find(id) {\n    var found = -1;\n    this.cardPiles.forEach(function (cardPile, index) {\n      if (found !== -1) {\n        return found;\n      }\n\n      if (cardPile.contains(id)) {\n        found = index;\n      }\n    });\n    return found;\n  }\n  /**\n   * Reset Card Manager.\n   * @param {object} [cardPiles] Piles to set (from previous state).\n   */\n  ;\n\n  _proto.reset = function reset(cardPiles) {\n    this.createPiles(cardPiles);\n  }\n  /**\n   * Retrieve card from pool. Will be loaded on call.\n   *\n   * @param {number} id Id of card to be retrieved.\n   */\n  ;\n\n  _proto.getCard = function getCard(id) {\n    return this.cardPool.getCard(id);\n  }\n  /**\n   * Retrieve the total number of cards available.\n   * @return {number} Total number of cards available.\n   */\n  ;\n\n  _proto.getSize = function getSize() {\n    return this.cardPool.getCardIds().length;\n  }\n  /**\n   * Retrieve all piles.\n   * @return {object[]} Piles.\n   */\n  ;\n\n  _proto.getPiles = function getPiles() {\n    return this.cardPiles;\n  }\n  /**\n   * Retrieve the size of each pile.\n   * @return {object[]} Pile sizes.\n   */\n  ;\n\n  _proto.getPileSizes = function getPileSizes() {\n    return this.cardPiles.map(function (pile) {\n      return pile.length();\n    });\n  };\n\n  return CardManager;\n}();\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (CardManager);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvc2NyaXB0cy9oNXAtZGlhbG9nY2FyZHMtY2FyZC1tYW5hZ2VyLmpzLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUNBO0FBQ0E7QUFDQTtBQVBBOztBQVVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTs7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFmQTtBQWlCQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUFBOztBQUNBO0FBQ0E7QUFDQTs7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7O0FBQ0E7O0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFFQTs7QUFDQTtBQUFBOztBQUNBOztBQUdBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBOztBQUNBO0FBQ0E7QUFEQTtBQUVBO0FBQUE7QUFDQTs7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7Ozs7O0FBR0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9oNXAtZGlhbG9nY2FyZHMvLi9zcmMvc2NyaXB0cy9oNXAtZGlhbG9nY2FyZHMtY2FyZC1tYW5hZ2VyLmpzPzAxYTciXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IENhcmRQb29sIGZyb20gJy4vaDVwLWRpYWxvZ2NhcmRzLWNhcmQtcG9vbCc7XG5pbXBvcnQgQ2FyZFBpbGUgZnJvbSAnLi9oNXAtZGlhbG9nY2FyZHMtY2FyZC1waWxlJztcblxuY2xhc3MgQ2FyZE1hbmFnZXIge1xuICAvKipcbiAgICogQGNvbnN0cnVjdG9yXG4gICAqXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBwYXJhbXMgUGFyYW1ldGVycyBmcm9tIGNvbnRlbnQgdHlwZS5cbiAgICogQHBhcmFtIHtudW1iZXJ9IGNvbnRlbnRJZCBJZCBvZiBjb250ZW50LlxuICAgKiBAcGFyYW0ge29iamVjdH0gY2FsbGJhY2tzIENhbGxiYWNrcyB0byBwYXJlbnQuXG4gICAqL1xuICBjb25zdHJ1Y3RvcihwYXJhbXMsIGNvbnRlbnRJZCwgY2FsbGJhY2tzKSB7XG4gICAgdGhpcy5wYXJhbXMgPSBwYXJhbXM7XG4gICAgdGhpcy5jYXJkUG9vbCA9IG5ldyBDYXJkUG9vbChwYXJhbXMsIGNvbnRlbnRJZCwgY2FsbGJhY2tzKTtcblxuICAgIHRoaXMucmVzZXQocGFyYW1zLmNhcmRQaWxlcyk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYSBzZWxlY3Rpb24gb2YgY2FyZCBpZHMgZGVwZW5kaW5nIG9uIG1vZGUuXG4gICAqXG4gICAqIEByZXR1cm4ge29iamVjdFtdfSBTZWxlY3Rpb24gb2YgY2FyZCBpZHMuXG4gICAqL1xuICBjcmVhdGVTZWxlY3Rpb24oKSB7XG4gICAgbGV0IHNlbGVjdGlvbklkcyA9IFtdO1xuXG4gICAgc3dpdGNoICh0aGlzLnBhcmFtcy5tb2RlKSB7XG4gICAgICBjYXNlICdyZXBldGl0aW9uJzpcbiAgICAgICAgLy8gUmVwZXRpdGlvbiBtb2RlXG4gICAgICAgIHNlbGVjdGlvbklkcyA9IHRoaXMuY3JlYXRlU2VsZWN0aW9uUmVwZXRpdGlvbigpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIC8vIE5vcm1hbCBtb2RlXG4gICAgICAgIHNlbGVjdGlvbklkcyA9IHRoaXMuY2FyZFBvb2wuZ2V0Q2FyZElkcygpO1xuICAgIH1cblxuICAgIHJldHVybiBzZWxlY3Rpb25JZHM7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGNhcmQgcGlsZXMgZGVwZW5kaW5nIG9uIG1vZGUuXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBbY2FyZFBpbGVzXSBQaWxlcyB0byBzZXQgKGZyb20gcHJldmlvdXMgc3RhdGUpLlxuICAgKi9cbiAgY3JlYXRlUGlsZXMoY2FyZFBpbGVzKSB7XG4gICAgaWYgKGNhcmRQaWxlcykge1xuICAgICAgdGhpcy5jYXJkUGlsZXMgPSBjYXJkUGlsZXMubWFwKGNhcmRQaWxlID0+IHtcbiAgICAgICAgcmV0dXJuIG5ldyBDYXJkUGlsZShjYXJkUGlsZS5jYXJkcyk7XG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuY2FyZFBpbGVzID0gW107XG4gICAgY29uc3QgcG9vbCA9IHRoaXMuY2FyZFBvb2wuZ2V0Q2FyZElkcygpO1xuXG4gICAgc3dpdGNoICh0aGlzLnBhcmFtcy5tb2RlKSB7XG4gICAgICBjYXNlICdyZXBldGl0aW9uJzpcbiAgICAgICAgLy8gUmVwZXRpdGlvbiBtb2RlXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wYXJhbXMuYmVoYXZpb3VyLm1heFByb2ZpY2llbmN5OyBpKyspIHtcbiAgICAgICAgICBpZiAoaSA9PT0gMCkge1xuICAgICAgICAgICAgdGhpcy5jYXJkUGlsZXMucHVzaChuZXcgQ2FyZFBpbGUocG9vbCkpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuY2FyZFBpbGVzLnB1c2gobmV3IENhcmRQaWxlKCkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSAnbm9ybWFsJzpcbiAgICAgICAgLy8gTm9ybWFsIG1vZGUuIE9uZSBwaWxlIG9ubHkgd2l0aCBhbGwgY2FyZHNcbiAgICAgICAgdGhpcy5jYXJkUGlsZXMucHVzaChuZXcgQ2FyZFBpbGUocG9vbCkpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgcGlsZXMuXG4gICAqXG4gICAqIEp1c3Qgb25lIFwicnVsZVwiIGZvciBub3cuIENvdWxkIGJlIGFtZW5kZWQgd2l0aCBtb3JlIG1vZGVzLlxuICAgKlxuICAgKiBAcGFyYW0ge29iamVjdFtdfSByZXN1bHRzIFJlc3VsdHMuXG4gICAqIEBwYXJhbSB7bnVtYmVyfSByZXN1bHRzLmNhcmRJZCBDYXJkIHRoYXQgcmVzdWx0IGlzIHJlcG9ydGVkIGZvci5cbiAgICogQHBhcmFtIHtib29sZWFufSByZXN1bHRzLnJlc3VsdCBSZXN1bHQgZm9yIHRoYXQgY2FyZC5cbiAgICogQHJldHVybiB7bnVtYmVyW119IENhcmQgcGlsZSBzaXplcy5cbiAgICovXG4gIHVwZGF0ZVBpbGVzKHJlc3VsdHMpIHtcbiAgICByZXN1bHRzLmZvckVhY2gocmVzdWx0ID0+IHtcbiAgICAgIC8vIEZpbmQgY2FyZCBpbiBwaWxlXG4gICAgICBjb25zdCBwaWxlSWQgPSB0aGlzLmZpbmQocmVzdWx0LmNhcmRJZCk7XG4gICAgICBpZiAocGlsZUlkID09PSAtMSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIE1vdmUgY2FyZCB0byBuZXh0IHBpbGUgb3IgZmlyc3QgcGlsZVxuICAgICAgbGV0IG5ld1BpbGVJZCA9IChyZXN1bHQucmVzdWx0ID09PSB0cnVlKSA/IHBpbGVJZCArIDEgOiAwO1xuICAgICAgbmV3UGlsZUlkID0gTWF0aC5tYXgoMCwgTWF0aC5taW4obmV3UGlsZUlkLCB0aGlzLmNhcmRQaWxlcy5sZW5ndGggLSAxKSk7XG4gICAgICB0aGlzLmNhcmRQaWxlc1twaWxlSWRdLnJlbW92ZShyZXN1bHQuY2FyZElkKTtcbiAgICAgIHRoaXMuY2FyZFBpbGVzW25ld1BpbGVJZF0uYWRkKHJlc3VsdC5jYXJkSWQsICdib3R0b20nKTtcbiAgICB9KTtcblxuICAgIHJldHVybiB0aGlzLmdldFBpbGVTaXplcygpO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBjYXJkIHNlbGVjdGlvbiBmb3IgcmVwZXRpdGlvbiBtb2RlLlxuICAgKlxuICAgKiBEcmF3IGFsbCBjYXJkcyBmcm9tIGZpcnN0IHBpbGUgd2l0aCBjYXJkcywgMS8yIG9mIG5leHQsIDEvMyBvZiBuZXh0LCAuLi5cbiAgICogRG9uJ3QgZHJhdyBjYXJkcyBmcm9tIGxhc3QgcGlsZVxuICAgKiBHZXQgY2FyZHMgZnJvbSB0b3AgLSB3aWxsIGJlIG1vdmVkIGF0IHRoZSBib3R0b20gb2Ygb3RoZXIgcGlsZSBhY2NvcmRpbmcgdG8gcmVzdWx0cyAoTElGTylcbiAgICpcbiAgICogQHJldHVybiB7b2JqZWN0W119IElkcyBvZiBzZWxlY3RlZCBjYXJkcyBmcm9tIHBvb2wuXG4gICAqL1xuICBjcmVhdGVTZWxlY3Rpb25SZXBldGl0aW9uKCkge1xuICAgIGxldCBzZWxlY3Rpb25JZHMgPSBbXTtcblxuICAgIGxldCBmaXJzdFBpbGVXaXRoQ2FyZHMgPSBudWxsO1xuICAgIGZvciAobGV0IGogPSAwOyBqIDwgdGhpcy5jYXJkUGlsZXMubGVuZ3RoIC0gMTsgaisrKSB7XG4gICAgICBjb25zdCBwaWxlQW1vdW50ID0gdGhpcy5jYXJkUGlsZXNbal0ubGVuZ3RoKCk7XG5cbiAgICAgIC8vIFNraXAgZW1wdHkgcGlsZXNcbiAgICAgIGlmIChmaXJzdFBpbGVXaXRoQ2FyZHMgPT09IG51bGwgJiYgcGlsZUFtb3VudCA9PT0gMCkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgLy8gUmVtZW1iZXIgZmlyc3QgcGlsZSB3aXRoIGNhcmRzXG4gICAgICBpZiAoZmlyc3RQaWxlV2l0aENhcmRzID09PSBudWxsKSB7XG4gICAgICAgIGZpcnN0UGlsZVdpdGhDYXJkcyA9IGo7XG4gICAgICB9XG5cbiAgICAgIC8vIERyYXcgY2FyZHMgZmF2b3JpbmcgdGhvc2Ugb2YgcGlsZXMgd2l0aCBsb3cgaWRcbiAgICAgIGNvbnN0IGRyYXdBbW91bnQgPSBNYXRoLmNlaWwocGlsZUFtb3VudCAqIDEgLyAoMSArIGogLSBmaXJzdFBpbGVXaXRoQ2FyZHMpKTtcbiAgICAgIGNvbnN0IGNhcmRzRHJhd24gPSB0aGlzLmNhcmRQaWxlc1tqXS5wZWVrKDAsIGRyYXdBbW91bnQpO1xuICAgICAgc2VsZWN0aW9uSWRzID0gc2VsZWN0aW9uSWRzLmNvbmNhdCguLi5jYXJkc0RyYXduKTtcbiAgICB9XG5cbiAgICAvLyBTaHVmZmxlIHNlbGVjdGlvblxuICAgIHNlbGVjdGlvbklkcyA9IHRoaXMuc2h1ZmZsZShzZWxlY3Rpb25JZHMpO1xuXG4gICAgcmV0dXJuIHNlbGVjdGlvbklkcztcbiAgfVxuXG4gIC8qKlxuICAgKiBTaHVmZmxlIGl0ZW1zIChub3QgaW4gcGxhY2UpLlxuICAgKlxuICAgKiBAcGFyYW0ge29iamVjdFtdfSBpdGVtcyBJdGVtcy5cbiAgICogQHJldHVybiB7b2JqZWN0W119IFNodWZmbGVkIGl0ZW1zLlxuICAgKi9cbiAgc2h1ZmZsZShpdGVtcykge1xuICAgIGNvbnN0IGNvcGllcyA9IGl0ZW1zLnNsaWNlKCk7XG4gICAgZm9yIChsZXQgaSA9IGNvcGllcy5sZW5ndGggLSAxOyBpID4gMDsgaS0tKSB7XG4gICAgICBjb25zdCBqID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKGkgKyAxKSk7XG4gICAgICBbY29waWVzW2ldLCBjb3BpZXNbal1dID0gW2NvcGllc1tqXSwgY29waWVzW2ldXTtcbiAgICB9XG4gICAgcmV0dXJuIGNvcGllcztcbiAgfVxuXG4gIC8qKlxuICAgKiBGaW5kIGlkIG9mIHBpbGUgdGhhdCBjb250YWlucyBjYXJkIHdpdGggcGFydGljdWxhciBpZC5cbiAgICpcbiAgICogQHBhcmFtIHtudW1iZXJ9IGlkIElkIG9mIGNhcmQgdG8gYmUgZm91bmQuXG4gICAqIEByZXR1cm4ge251bWJlcn0gSWQgb2YgcGlsZSBvciAtMS5cbiAgICovXG4gIGZpbmQoaWQpIHtcbiAgICBsZXQgZm91bmQgPSAtMTtcbiAgICB0aGlzLmNhcmRQaWxlcy5mb3JFYWNoKChjYXJkUGlsZSwgaW5kZXgpID0+IHtcbiAgICAgIGlmIChmb3VuZCAhPT0gLTEpIHtcbiAgICAgICAgcmV0dXJuIGZvdW5kO1xuICAgICAgfVxuICAgICAgaWYgKGNhcmRQaWxlLmNvbnRhaW5zKGlkKSkgIHtcbiAgICAgICAgZm91bmQgPSBpbmRleDtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gZm91bmQ7XG4gIH1cblxuICAvKipcbiAgICogUmVzZXQgQ2FyZCBNYW5hZ2VyLlxuICAgKiBAcGFyYW0ge29iamVjdH0gW2NhcmRQaWxlc10gUGlsZXMgdG8gc2V0IChmcm9tIHByZXZpb3VzIHN0YXRlKS5cbiAgICovXG4gIHJlc2V0KGNhcmRQaWxlcykge1xuICAgIHRoaXMuY3JlYXRlUGlsZXMoY2FyZFBpbGVzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZSBjYXJkIGZyb20gcG9vbC4gV2lsbCBiZSBsb2FkZWQgb24gY2FsbC5cbiAgICpcbiAgICogQHBhcmFtIHtudW1iZXJ9IGlkIElkIG9mIGNhcmQgdG8gYmUgcmV0cmlldmVkLlxuICAgKi9cbiAgZ2V0Q2FyZChpZCkge1xuICAgIHJldHVybiB0aGlzLmNhcmRQb29sLmdldENhcmQoaWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlIHRoZSB0b3RhbCBudW1iZXIgb2YgY2FyZHMgYXZhaWxhYmxlLlxuICAgKiBAcmV0dXJuIHtudW1iZXJ9IFRvdGFsIG51bWJlciBvZiBjYXJkcyBhdmFpbGFibGUuXG4gICAqL1xuICBnZXRTaXplKCkge1xuICAgIHJldHVybiB0aGlzLmNhcmRQb29sLmdldENhcmRJZHMoKS5sZW5ndGg7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmUgYWxsIHBpbGVzLlxuICAgKiBAcmV0dXJuIHtvYmplY3RbXX0gUGlsZXMuXG4gICAqL1xuICBnZXRQaWxlcygpIHtcbiAgICByZXR1cm4gdGhpcy5jYXJkUGlsZXM7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmUgdGhlIHNpemUgb2YgZWFjaCBwaWxlLlxuICAgKiBAcmV0dXJuIHtvYmplY3RbXX0gUGlsZSBzaXplcy5cbiAgICovXG4gIGdldFBpbGVTaXplcygpIHtcbiAgICByZXR1cm4gdGhpcy5jYXJkUGlsZXMubWFwKHBpbGUgPT4gcGlsZS5sZW5ndGgoKSk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgQ2FyZE1hbmFnZXI7XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/scripts/h5p-dialogcards-card-manager.js\n");

/***/ }),

/***/ "./src/scripts/h5p-dialogcards-card-pile.js":
/*!**************************************************!*\
  !*** ./src/scripts/h5p-dialogcards-card-pile.js ***!
  \**************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _iterableToArray(iter) { if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nvar CardPile = /*#__PURE__*/function () {\n  /**\n   * @constructor\n   *\n   * @params {object[]} cards Card Ids.\n   */\n  function CardPile() {\n    var cards = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    // Only use unique values\n    this.cards = cards.filter(function (item, index) {\n      return cards.indexOf(item) >= index;\n    });\n    return this;\n  }\n  /**\n   * Get complete card pile.\n   */\n\n\n  var _proto = CardPile.prototype;\n\n  _proto.getCards = function getCards() {\n    return this.cards;\n  }\n  /**\n   * Peek at card in pile.\n   *\n   * @param {number|string} position Position to peek at.\n   * @param {number} [amount=1] Number of cards to peek at.\n   */\n  ;\n\n  _proto.peek = function peek(position) {\n    var amount = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;\n    amount = Math.max(0, amount);\n\n    if (position === 'top') {\n      position = 0;\n    }\n\n    if (position === 'bottom') {\n      position = this.cards.length - amount;\n    }\n\n    if (position < 0 || position > this.cards.length - 1) {\n      return [];\n    }\n\n    return this.cards.slice(position, position + amount);\n  }\n  /**\n   * Add cards to the pile.\n   *\n   * @param {number|object[]} ids Id or array of card ids to be added.\n   * @param {number|string} [position='top'] Position to add cards to (top|bottom), can be amended.\n   */\n  ;\n\n  _proto.add = function add(ids) {\n    var _this = this;\n\n    var position = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'top';\n\n    if (typeof ids === 'number') {\n      ids = [ids];\n    }\n\n    ids.forEach(function (id) {\n      var _this$cards;\n\n      if (_this.cards.indexOf(id) !== -1) {\n        return;\n      }\n\n      if (position === 'top') {\n        position = 0;\n      } else if (position === 'bottom') {\n        position = _this.cards.length;\n      } else if (position === 'random') {\n        position = Math.floor(Math.random() * _this.cards.length);\n      }\n\n      (_this$cards = _this.cards).splice.apply(_this$cards, [position, 0].concat(_toConsumableArray(ids)));\n    });\n  }\n  /**\n   * Shorthand for adding cards to top.\n   *\n   * @param {number|object[]} ids Id or array of card ids to be added.\n   */\n  ;\n\n  _proto.push = function push(ids) {\n    this.add(ids, 'top');\n  }\n  /**\n   * Pull consecutive cards from the pile.\n   *\n   * @param {number} [amount=1] Amount of cards to be pulled.\n   * @param {number|string} [position='top'] Position to take cards from. Default top.\n   */\n  ;\n\n  _proto.pull = function pull() {\n    var amount = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;\n    var position = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'top';\n    amount = Math.max(1, Math.min(amount, this.cards.length));\n\n    if (position === 'top') {\n      position = 0;\n    }\n\n    if (position === 'bottom') {\n      position = -amount;\n    }\n\n    position = Math.max(0, Math.min(position, this.cards.length - 1));\n    return this.cards.splice(position, amount);\n  }\n  /**\n   * Remove cards from the pile.\n   *\n   * @param {number|object[]} ids Id or array of card ids to be removed.\n   */\n  ;\n\n  _proto.remove = function remove(ids) {\n    var _this2 = this;\n\n    if (typeof ids === 'number') {\n      ids = [ids];\n    }\n\n    ids.forEach(function (id) {\n      var position = _this2.cards.indexOf(id);\n\n      if (position > -1) {\n        _this2.cards.splice(position, 1);\n      }\n    });\n  }\n  /**\n   * Shuffle pile in place.\n   *\n   * @return {object[]} Shuffled cards.\n   */\n  ;\n\n  _proto.shuffle = function shuffle() {\n    for (var i = this.cards.length - 1; i > 0; i--) {\n      var j = Math.floor(Math.random() * (i + 1));\n      var _ref = [this.cards[j], this.cards[i]];\n      this.cards[i] = _ref[0];\n      this.cards[j] = _ref[1];\n    }\n\n    return this.cards;\n  }\n  /**\n   * Check if id is in pile.\n   *\n   * @return {boolean} True, if card is in pile.\n   */\n  ;\n\n  _proto.contains = function contains(id) {\n    return this.cards.indexOf(id) !== -1;\n  }\n  /**\n   * Get amount of cards on pile.\n   *\n   * @return {number} Amount of cards on pile.\n   */\n  ;\n\n  _proto.length = function length() {\n    return this.cards.length;\n  };\n\n  return CardPile;\n}();\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (CardPile);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvc2NyaXB0cy9oNXAtZGlhbG9nY2FyZHMtY2FyZC1waWxlLmpzLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBOzs7OztBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFBQTtBQUNBOztBQUNBO0FBQ0E7QUFDQTs7QUFDQTtBQUNBO0FBQ0E7O0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQUE7O0FBQUE7O0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQUE7O0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFBQTtBQUFBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUNBO0FBQ0E7QUFDQTs7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUFBOztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUVBO0FBQUE7QUFDQTs7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBOzs7OztBQUdBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vaDVwLWRpYWxvZ2NhcmRzLy4vc3JjL3NjcmlwdHMvaDVwLWRpYWxvZ2NhcmRzLWNhcmQtcGlsZS5qcz8xODlmIl0sInNvdXJjZXNDb250ZW50IjpbImNsYXNzIENhcmRQaWxlIHtcbiAgLyoqXG4gICAqIEBjb25zdHJ1Y3RvclxuICAgKlxuICAgKiBAcGFyYW1zIHtvYmplY3RbXX0gY2FyZHMgQ2FyZCBJZHMuXG4gICAqL1xuICBjb25zdHJ1Y3RvcihjYXJkcyA9IFtdKSB7XG4gICAgLy8gT25seSB1c2UgdW5pcXVlIHZhbHVlc1xuICAgIHRoaXMuY2FyZHMgPSBjYXJkcy5maWx0ZXIoKGl0ZW0sIGluZGV4KSA9PiBjYXJkcy5pbmRleE9mKGl0ZW0pID49IGluZGV4KTtcblxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjb21wbGV0ZSBjYXJkIHBpbGUuXG4gICAqL1xuICBnZXRDYXJkcygpIHtcbiAgICByZXR1cm4gdGhpcy5jYXJkcztcbiAgfVxuXG4gIC8qKlxuICAgKiBQZWVrIGF0IGNhcmQgaW4gcGlsZS5cbiAgICpcbiAgICogQHBhcmFtIHtudW1iZXJ8c3RyaW5nfSBwb3NpdGlvbiBQb3NpdGlvbiB0byBwZWVrIGF0LlxuICAgKiBAcGFyYW0ge251bWJlcn0gW2Ftb3VudD0xXSBOdW1iZXIgb2YgY2FyZHMgdG8gcGVlayBhdC5cbiAgICovXG4gIHBlZWsocG9zaXRpb24sIGFtb3VudCA9IDEpIHtcbiAgICBhbW91bnQgPSBNYXRoLm1heCgwLCBhbW91bnQpO1xuICAgIGlmIChwb3NpdGlvbiA9PT0gJ3RvcCcpIHtcbiAgICAgIHBvc2l0aW9uID0gMDtcbiAgICB9XG4gICAgaWYgKHBvc2l0aW9uID09PSAnYm90dG9tJykge1xuICAgICAgcG9zaXRpb24gPSB0aGlzLmNhcmRzLmxlbmd0aCAtIGFtb3VudDtcbiAgICB9XG4gICAgaWYgKHBvc2l0aW9uIDwgMCB8fCBwb3NpdGlvbiA+IHRoaXMuY2FyZHMubGVuZ3RoIC0gMSkge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmNhcmRzLnNsaWNlKHBvc2l0aW9uLCBwb3NpdGlvbiArIGFtb3VudCk7XG4gIH1cblxuICAvKipcbiAgICogQWRkIGNhcmRzIHRvIHRoZSBwaWxlLlxuICAgKlxuICAgKiBAcGFyYW0ge251bWJlcnxvYmplY3RbXX0gaWRzIElkIG9yIGFycmF5IG9mIGNhcmQgaWRzIHRvIGJlIGFkZGVkLlxuICAgKiBAcGFyYW0ge251bWJlcnxzdHJpbmd9IFtwb3NpdGlvbj0ndG9wJ10gUG9zaXRpb24gdG8gYWRkIGNhcmRzIHRvICh0b3B8Ym90dG9tKSwgY2FuIGJlIGFtZW5kZWQuXG4gICAqL1xuICBhZGQoaWRzLCBwb3NpdGlvbiA9ICd0b3AnKSB7XG4gICAgaWYgKHR5cGVvZiBpZHMgPT09ICdudW1iZXInKSB7XG4gICAgICBpZHMgPSBbaWRzXTtcbiAgICB9XG5cbiAgICBpZHMuZm9yRWFjaChpZCA9PiB7XG4gICAgICBpZiAodGhpcy5jYXJkcy5pbmRleE9mKGlkKSAhPT0gLTEpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAocG9zaXRpb24gPT09ICd0b3AnKSB7XG4gICAgICAgIHBvc2l0aW9uID0gMDtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKHBvc2l0aW9uID09PSAnYm90dG9tJykge1xuICAgICAgICBwb3NpdGlvbiA9IHRoaXMuY2FyZHMubGVuZ3RoO1xuICAgICAgfVxuICAgICAgZWxzZSBpZiAocG9zaXRpb24gPT09ICdyYW5kb20nKSB7XG4gICAgICAgIHBvc2l0aW9uID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKHRoaXMuY2FyZHMubGVuZ3RoKSk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuY2FyZHMuc3BsaWNlKHBvc2l0aW9uLCAwLCAuLi5pZHMpO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFNob3J0aGFuZCBmb3IgYWRkaW5nIGNhcmRzIHRvIHRvcC5cbiAgICpcbiAgICogQHBhcmFtIHtudW1iZXJ8b2JqZWN0W119IGlkcyBJZCBvciBhcnJheSBvZiBjYXJkIGlkcyB0byBiZSBhZGRlZC5cbiAgICovXG4gIHB1c2goaWRzKSB7XG4gICAgdGhpcy5hZGQoaWRzLCAndG9wJyk7XG4gIH1cblxuICAvKipcbiAgICogUHVsbCBjb25zZWN1dGl2ZSBjYXJkcyBmcm9tIHRoZSBwaWxlLlxuICAgKlxuICAgKiBAcGFyYW0ge251bWJlcn0gW2Ftb3VudD0xXSBBbW91bnQgb2YgY2FyZHMgdG8gYmUgcHVsbGVkLlxuICAgKiBAcGFyYW0ge251bWJlcnxzdHJpbmd9IFtwb3NpdGlvbj0ndG9wJ10gUG9zaXRpb24gdG8gdGFrZSBjYXJkcyBmcm9tLiBEZWZhdWx0IHRvcC5cbiAgICovXG4gIHB1bGwoYW1vdW50ID0gMSwgcG9zaXRpb24gPSAndG9wJykge1xuICAgIGFtb3VudCA9IE1hdGgubWF4KDEsIE1hdGgubWluKGFtb3VudCwgdGhpcy5jYXJkcy5sZW5ndGgpKTtcblxuICAgIGlmIChwb3NpdGlvbiA9PT0gJ3RvcCcpIHtcbiAgICAgIHBvc2l0aW9uID0gMDtcbiAgICB9XG4gICAgaWYgKHBvc2l0aW9uID09PSAnYm90dG9tJykge1xuICAgICAgcG9zaXRpb24gPSAtYW1vdW50O1xuICAgIH1cbiAgICBwb3NpdGlvbiA9IE1hdGgubWF4KDAsIE1hdGgubWluKHBvc2l0aW9uLCB0aGlzLmNhcmRzLmxlbmd0aCAtIDEpKTtcblxuICAgIHJldHVybiB0aGlzLmNhcmRzLnNwbGljZShwb3NpdGlvbiwgYW1vdW50KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW1vdmUgY2FyZHMgZnJvbSB0aGUgcGlsZS5cbiAgICpcbiAgICogQHBhcmFtIHtudW1iZXJ8b2JqZWN0W119IGlkcyBJZCBvciBhcnJheSBvZiBjYXJkIGlkcyB0byBiZSByZW1vdmVkLlxuICAgKi9cbiAgcmVtb3ZlKGlkcykge1xuICAgIGlmICh0eXBlb2YgaWRzID09PSAnbnVtYmVyJykge1xuICAgICAgaWRzID0gW2lkc107XG4gICAgfVxuXG4gICAgaWRzLmZvckVhY2goaWQgPT4ge1xuICAgICAgY29uc3QgcG9zaXRpb24gPSB0aGlzLmNhcmRzLmluZGV4T2YoaWQpO1xuICAgICAgaWYgKHBvc2l0aW9uID4gLTEpIHtcbiAgICAgICAgdGhpcy5jYXJkcy5zcGxpY2UocG9zaXRpb24sIDEpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFNodWZmbGUgcGlsZSBpbiBwbGFjZS5cbiAgICpcbiAgICogQHJldHVybiB7b2JqZWN0W119IFNodWZmbGVkIGNhcmRzLlxuICAgKi9cbiAgc2h1ZmZsZSgpIHtcbiAgICBmb3IgKGxldCBpID0gdGhpcy5jYXJkcy5sZW5ndGggLSAxOyBpID4gMDsgaS0tKSB7XG4gICAgICBjb25zdCBqID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKGkgKyAxKSk7XG4gICAgICBbdGhpcy5jYXJkc1tpXSwgdGhpcy5jYXJkc1tqXV0gPSBbdGhpcy5jYXJkc1tqXSwgdGhpcy5jYXJkc1tpXV07XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuY2FyZHM7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgaWQgaXMgaW4gcGlsZS5cbiAgICpcbiAgICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSwgaWYgY2FyZCBpcyBpbiBwaWxlLlxuICAgKi9cbiAgY29udGFpbnMoaWQpIHtcbiAgICByZXR1cm4gdGhpcy5jYXJkcy5pbmRleE9mKGlkKSAhPT0gLTE7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGFtb3VudCBvZiBjYXJkcyBvbiBwaWxlLlxuICAgKlxuICAgKiBAcmV0dXJuIHtudW1iZXJ9IEFtb3VudCBvZiBjYXJkcyBvbiBwaWxlLlxuICAgKi9cbiAgbGVuZ3RoKCkge1xuICAgIHJldHVybiB0aGlzLmNhcmRzLmxlbmd0aDtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBDYXJkUGlsZTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/scripts/h5p-dialogcards-card-pile.js\n");

/***/ }),

/***/ "./src/scripts/h5p-dialogcards-card-pool.js":
/*!**************************************************!*\
  !*** ./src/scripts/h5p-dialogcards-card-pool.js ***!
  \**************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _h5p_dialogcards_card__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./h5p-dialogcards-card */ \"./src/scripts/h5p-dialogcards-card.js\");\n\n\nvar CardPool = /*#__PURE__*/function () {\n  /**\n   * @constructor\n   *\n   * @param {object} params Parameters from content type.\n   * @param {number} contentId Id of content.\n   * @param {object} callbacks Callbacks to main component.\n   */\n  function CardPool(params, contentId, callbacks) {\n    var _this = this;\n\n    this.params = params;\n    this.contentId = contentId;\n    this.callbacks = callbacks;\n    this.cards = [];\n    this.params.dialogs.forEach(function (dialog, index) {\n      dialog.id = index;\n\n      _this.cards.push(index);\n    });\n    return this;\n  }\n  /**\n   * Retrieve a card.\n   *\n   * @param {number} id Id of card to retrieve.\n   */\n\n\n  var _proto = CardPool.prototype;\n\n  _proto.getCard = function getCard(id) {\n    if (id < 0 || id > this.cards.length) {\n      return;\n    } // Replace id with card object if necessary.\n\n\n    if (typeof this.cards[id] === 'number') {\n      this.loadCard(id);\n    }\n\n    return this.cards[id];\n  }\n  /**\n   * Get initial card ids.\n   *\n   * @return {object[]} Card ids.\n   */\n  ;\n\n  _proto.getCardIds = function getCardIds() {\n    return this.cards.map(function (card, index) {\n      return index;\n    });\n  }\n  /**\n   * Load a card if not loaded yet.\n   *\n   * @param {number} id Id of card to load.\n   */\n  ;\n\n  _proto.loadCard = function loadCard(id) {\n    if (id < 0 || id > this.cards.length) {\n      return;\n    }\n\n    if (typeof this.cards[id] === 'number') {\n      this.cards[id] = new _h5p_dialogcards_card__WEBPACK_IMPORTED_MODULE_0__[\"default\"](this.params.dialogs[id], this.params, id, this.contentId, this.callbacks);\n    }\n  };\n\n  return CardPool;\n}();\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (CardPool);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvc2NyaXB0cy9oNXAtZGlhbG9nY2FyZHMtY2FyZC1wb29sLmpzLmpzIiwibWFwcGluZ3MiOiI7O0FBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBOztBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBSUEiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9oNXAtZGlhbG9nY2FyZHMvLi9zcmMvc2NyaXB0cy9oNXAtZGlhbG9nY2FyZHMtY2FyZC1wb29sLmpzP2UwNDEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IENhcmQgZnJvbSAnLi9oNXAtZGlhbG9nY2FyZHMtY2FyZCc7XG5cbmNsYXNzIENhcmRQb29sIHtcbiAgLyoqXG4gICAqIEBjb25zdHJ1Y3RvclxuICAgKlxuICAgKiBAcGFyYW0ge29iamVjdH0gcGFyYW1zIFBhcmFtZXRlcnMgZnJvbSBjb250ZW50IHR5cGUuXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBjb250ZW50SWQgSWQgb2YgY29udGVudC5cbiAgICogQHBhcmFtIHtvYmplY3R9IGNhbGxiYWNrcyBDYWxsYmFja3MgdG8gbWFpbiBjb21wb25lbnQuXG4gICAqL1xuICBjb25zdHJ1Y3RvcihwYXJhbXMsIGNvbnRlbnRJZCwgY2FsbGJhY2tzKSB7XG4gICAgdGhpcy5wYXJhbXMgPSBwYXJhbXM7XG4gICAgdGhpcy5jb250ZW50SWQgPSBjb250ZW50SWQ7XG4gICAgdGhpcy5jYWxsYmFja3MgPSBjYWxsYmFja3M7XG4gICAgdGhpcy5jYXJkcyA9IFtdO1xuXG4gICAgdGhpcy5wYXJhbXMuZGlhbG9ncy5mb3JFYWNoKChkaWFsb2csIGluZGV4KSA9PiB7XG4gICAgICBkaWFsb2cuaWQgPSBpbmRleDtcbiAgICAgIHRoaXMuY2FyZHMucHVzaChpbmRleCk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZSBhIGNhcmQuXG4gICAqXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBpZCBJZCBvZiBjYXJkIHRvIHJldHJpZXZlLlxuICAgKi9cbiAgZ2V0Q2FyZChpZCkge1xuICAgIGlmIChpZCA8IDAgfHwgaWQgPiB0aGlzLmNhcmRzLmxlbmd0aCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIFJlcGxhY2UgaWQgd2l0aCBjYXJkIG9iamVjdCBpZiBuZWNlc3NhcnkuXG4gICAgaWYgKHR5cGVvZiB0aGlzLmNhcmRzW2lkXSA9PT0gJ251bWJlcicpIHtcbiAgICAgIHRoaXMubG9hZENhcmQoaWQpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmNhcmRzW2lkXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgaW5pdGlhbCBjYXJkIGlkcy5cbiAgICpcbiAgICogQHJldHVybiB7b2JqZWN0W119IENhcmQgaWRzLlxuICAgKi9cbiAgZ2V0Q2FyZElkcygpICB7XG4gICAgcmV0dXJuIHRoaXMuY2FyZHMubWFwKChjYXJkLCBpbmRleCkgPT4gaW5kZXgpO1xuICB9XG5cbiAgLyoqXG4gICAqIExvYWQgYSBjYXJkIGlmIG5vdCBsb2FkZWQgeWV0LlxuICAgKlxuICAgKiBAcGFyYW0ge251bWJlcn0gaWQgSWQgb2YgY2FyZCB0byBsb2FkLlxuICAgKi9cbiAgbG9hZENhcmQoaWQpIHtcbiAgICBpZiAoaWQgPCAwIHx8IGlkID4gdGhpcy5jYXJkcy5sZW5ndGgpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAodHlwZW9mIHRoaXMuY2FyZHNbaWRdID09PSAnbnVtYmVyJykge1xuICAgICAgdGhpcy5jYXJkc1tpZF0gPSBuZXcgQ2FyZCh0aGlzLnBhcmFtcy5kaWFsb2dzW2lkXSwgdGhpcy5wYXJhbXMsIGlkLCB0aGlzLmNvbnRlbnRJZCwgdGhpcy5jYWxsYmFja3MpO1xuICAgIH1cbiAgfVxuXG59XG5cbmV4cG9ydCBkZWZhdWx0IENhcmRQb29sO1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/scripts/h5p-dialogcards-card-pool.js\n");

/***/ }),

/***/ "./src/scripts/h5p-dialogcards-card.js":
/*!*********************************************!*\
  !*** ./src/scripts/h5p-dialogcards-card.js ***!
  \*********************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\nvar $ = H5P.jQuery;\n\nvar Card = /*#__PURE__*/function () {\n  /**\n   * @constructor\n   *\n   * @param {object} card Card parameters\n   * @param {object} params Parent's params\n   * @param {number} id Card number in order of appearance\n   * @param {object} [callbacks] Callbacks.\n   * @param {function} [callbacks.onCardSize] Call when card needs resize.\n   * @param {function} [callbacks.onCardTurned] Call when card was turned.\n   */\n  function Card(card, params, id, contentId) {\n    var callbacks = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : {};\n    this.card = card;\n    this.params = params || {};\n    this.id = id;\n    this.contentId = contentId;\n    this.callbacks = callbacks; // Check if to use front settings for back, too\n\n    if (this.card.back.useImageFromFront) {\n      this.card.back.image = this.card.front.image;\n      this.card.back.imageAltText = this.card.front.imageAltText;\n    }\n\n    if (this.card.back.useAudioFromFront) {\n      this.card.back.audio = this.card.front.audio;\n    }\n\n    this.audios = {};\n    this.$audioWrappers = {};\n    this.$cardWrapper = $('<div>', {\n      'class': 'h5p-dialogcards-cardwrap',\n      'role': 'group',\n      'tabindex': '-1'\n    });\n\n    if (this.params.mode !== 'repetition') {\n      this.$cardWrapper.attr('aria-labelledby', 'h5p-dialogcards-progress-' + H5P.Dialogcards.idCounter);\n    }\n\n    this.$cardHolder = $('<div>', {\n      'class': 'h5p-dialogcards-cardholder'\n    }).appendTo(this.$cardWrapper);\n    this.createCardContent(card).appendTo(this.$cardHolder);\n    return this;\n  }\n  /**\n   * Create content for a card\n   *\n   * @param {object} card Card parameters\n   * @returns {*|jQuery|HTMLElement} Card content wrapper\n   */\n\n\n  var _proto = Card.prototype;\n\n  _proto.createCardContent = function createCardContent(card) {\n    var $cardContent = $('<div>', {\n      'class': 'h5p-dialogcards-card-content'\n    }); // Images\n\n    this.$imageWrapper = $('<div>', {\n      'class': 'h5p-dialogcards-image-wrapper'\n    });\n    this.createCardImage(card, 'front').appendTo(this.$imageWrapper);\n    this.createCardImage(card, 'back').appendTo(this.$imageWrapper);\n    this.$imageWrapper.appendTo($cardContent);\n    var $cardTextWrapper = $('<div>', {\n      'class': 'h5p-dialogcards-card-text-wrapper'\n    }).appendTo($cardContent);\n    var $cardTextInner = $('<div>', {\n      'class': 'h5p-dialogcards-card-text-inner'\n    }).appendTo($cardTextWrapper);\n    var $cardTextInnerContent = $('<div>', {\n      'class': 'h5p-dialogcards-card-text-inner-content'\n    }).appendTo($cardTextInner); // Front audio\n\n    this.$audioWrappers.front = this.createCardAudio(card, 'front').appendTo($cardTextInnerContent); // Back audio\n\n    this.$audioWrappers.back = this.createCardAudio(card, 'back').appendTo($cardTextInnerContent);\n    var $cardText = $('<div>', {\n      'class': 'h5p-dialogcards-card-text'\n    }).appendTo($cardTextInnerContent);\n    this.$cardTextArea = $('<div>', {\n      'class': 'h5p-dialogcards-card-text-area',\n      'tabindex': '-1',\n      'html': card.front.text\n    }).appendTo($cardText);\n    this.createCardFooter().appendTo($cardTextWrapper);\n    return $cardContent;\n  }\n  /**\n   * Create card image\n   *\n   * @param {object} card Card parameters\n   * @param {string} side Side, either front or back.\n   * @returns {*|jQuery|HTMLElement} Card image wrapper\n   */\n  ;\n\n  _proto.createCardImage = function createCardImage(card, side) {\n    var $image;\n\n    if (card[side].image !== undefined) {\n      $image = $('<img class=\"h5p-dialogcards-image\" src=\"' + H5P.getPath(card[side].image.path, this.contentId) + '\"/>');\n      $image.addClass(\"h5p-dialogcards-image-\".concat(side)); // KidsLoop customization to prevent dragging the image\n\n      $image.get(0).addEventListener('dragstart', function (event) {\n        event.preventDefault();\n      });\n      /*\n       * KidsLoop customization to prevent saving images on Android. Cannot\n       * use CSS `pointer-events: none`, because it interferes with dragstart\n       */\n\n      $image.get(0).addEventListener('contextmenu', function (event) {\n        event.preventDefault();\n        return false;\n      }); // KidsLoop customization to prevent dragging the image on iOS\n\n      $image.css({\n        'user-select': 'none',\n        '-webkit-user-select': 'none',\n        '-webkit-touch-callout': 'none'\n      });\n\n      if (card[side].imageAltText) {\n        $image.attr('alt', card[side].imageAltText);\n      }\n    } else {\n      $image = $('<div class=\"h5p-dialogcards-image\"></div>');\n    }\n\n    return $image;\n  }\n  /**\n   * Create card audio.\n   *\n   * @param {object} card Card parameters.\n   * @param {string} side Side, either front or back.\n   * @returns {*|jQuery|HTMLElement} Card audio element.\n   */\n  ;\n\n  _proto.createCardAudio = function createCardAudio(card) {\n    var side = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'front';\n    var $audioWrapper = $('<div>').addClass('h5p-dialogcards-audio-wrapper').addClass(\"h5p-dialogcards-audio-wrapper-\".concat(side));\n\n    if (!card[side].text || card[side].text === '') {\n      $audioWrapper.addClass('h5p-no-text');\n    }\n\n    if (card[side].audio !== undefined) {\n      var audioDefaults = {\n        files: card[side].audio,\n        audioNotSupported: this.params.audioNotSupported\n      };\n      var audio = new H5P.Audio(audioDefaults, this.contentId);\n      this.audios[side] = audio;\n      audio.attach($audioWrapper); // Have to stop else audio will take up a socket pending forever in chrome.\n\n      if (audio.audio && audio.audio.preload) {\n        audio.audio.preload = 'none';\n      }\n    } else {\n      $audioWrapper.addClass('hide');\n    }\n\n    return $audioWrapper;\n  }\n  /**\n   * Create card footer\n   *\n   * @returns {*|jQuery|HTMLElement} Card footer element\n   */\n  ;\n\n  _proto.createCardFooter = function createCardFooter() {\n    var $cardFooter = $('<div>', {\n      'class': 'h5p-dialogcards-card-footer'\n    });\n    var classesRepetition = 'h5p-dialogcards-button-hidden';\n    var attributeTabindex = '-1';\n\n    if (this.params.mode === 'repetition') {\n      classesRepetition = '';\n\n      if (this.params.behaviour.quickProgression) {\n        classesRepetition = 'h5p-dialogcards-quick-progression';\n        attributeTabindex = '0';\n      }\n\n      $cardFooter.addClass('h5p-repetition');\n    }\n\n    this.$buttonTurn = H5P.JoubelUI.createButton({\n      'class': 'h5p-dialogcards-turn',\n      'html': this.params.answer\n    }).appendTo($cardFooter);\n    this.$buttonShowSummary = H5P.JoubelUI.createButton({\n      'class': 'h5p-dialogcards-show-summary h5p-dialogcards-button-gone',\n      'html': this.params.showSummary\n    }).appendTo($cardFooter);\n    this.$buttonIncorrect = H5P.JoubelUI.createButton({\n      'class': 'h5p-dialogcards-answer-button',\n      'html': this.params.incorrectAnswer\n    }).addClass('incorrect').addClass(classesRepetition).attr('tabindex', attributeTabindex).appendTo($cardFooter);\n    this.$buttonCorrect = H5P.JoubelUI.createButton({\n      'class': 'h5p-dialogcards-answer-button',\n      'html': this.params.correctAnswer\n    }).addClass('correct').addClass(classesRepetition).attr('tabindex', attributeTabindex).appendTo($cardFooter);\n    return $cardFooter;\n  }\n  /**\n   * Create button listeners.\n   * Will be lost when the element is removed from DOM.\n   */\n  ;\n\n  _proto.createButtonListeners = function createButtonListeners() {\n    var _this = this;\n\n    this.$buttonIncorrect.unbind('click').click(function (event) {\n      if (!event.target.classList.contains('h5p-dialogcards-quick-progression')) {\n        return;\n      }\n\n      _this.callbacks.onNextCard({\n        cardId: _this.id,\n        result: false\n      });\n    });\n    this.$buttonTurn.unbind('click').click(function () {\n      _this.turnCard();\n    });\n    this.$buttonCorrect.unbind('click').click(function (event) {\n      if (!event.target.classList.contains('h5p-dialogcards-quick-progression')) {\n        return;\n      }\n\n      _this.callbacks.onNextCard({\n        cardId: _this.id,\n        result: true\n      });\n    });\n  }\n  /**\n   * Show summary button on last card.\n   *\n   * @param {function} callback Callback called on button click.\n   */\n  ;\n\n  _proto.showSummaryButton = function showSummaryButton(callback) {\n    // Hide answer buttons\n    this.getDOM().find('.h5p-dialogcards-answer-button').addClass('h5p-dialogcards-button-hidden').attr('tabindex', '-1'); // Swap turn button with show summary button\n\n    this.$buttonTurn.addClass('h5p-dialogcards-button-gone');\n    this.$buttonShowSummary.click(function () {\n      return callback();\n    }).removeClass('h5p-dialogcards-button-gone').focus();\n  }\n  /**\n   * Hide summary button and show answer buttons again.\n   */\n  ;\n\n  _proto.hideSummaryButton = function hideSummaryButton() {\n    if (this.params.mode === 'normal') {\n      return;\n    }\n\n    this.getDOM().find('.h5p-dialogcards-answer-button').removeClass('h5p-dialogcards-button-hidden').attr('tabindex', '0'); // Swap turn button with show summary button\n\n    this.$buttonTurn.removeClass('h5p-dialogcards-button-gone');\n    this.$buttonShowSummary.addClass('h5p-dialogcards-button-gone');\n  }\n  /**\n   * Show the opposite side of the card.\n   */\n  ;\n\n  _proto.turnCard = function turnCard() {\n    var _this2 = this;\n\n    var $card = this.getDOM();\n    var $c = $card.find('.h5p-dialogcards-card-content');\n    var $ch = $card.find('.h5p-dialogcards-cardholder').addClass('h5p-dialogcards-collapse'); // Removes tip, since it destroys the animation:\n\n    $c.find('.joubel-tip-container').remove();\n    setTimeout(function () {\n      // Check if card has been turned before\n      var turned = _this2.isTurned(); // Update HTML class for card\n\n\n      $c.toggleClass('h5p-dialogcards-turned', !turned);\n      $ch.removeClass('h5p-dialogcards-collapse');\n\n      _this2.changeText(turned ? _this2.getText() : _this2.getAnswer()); // Image shown/hidden via CSS\n      // Audio buttons shown/hidden via CSS\n\n\n      _this2.stopAudio(); // Toggle state for knowledge confirmation buttons\n\n\n      if (_this2.params.mode === 'repetition' && !_this2.params.behaviour.quickProgression) {\n        var $answerButtons = $card.find('.h5p-dialogcards-answer-button'); // Don't revoke quick progression after card was turned.\n\n        if ($answerButtons.hasClass('h5p-dialogcards-quick-progression') === false) {\n          $answerButtons.addClass('h5p-dialogcards-quick-progression').attr('tabindex', 0);\n        }\n      } // Add backside tip\n      // Had to wait a little, if not Chrome will displace tip icon\n\n\n      setTimeout(function () {\n        _this2.addTipToCard($c, turned ? 'front' : 'back');\n\n        if (typeof _this2.callbacks.onCardTurned === 'function') {\n          _this2.callbacks.onCardTurned(turned);\n        }\n      }, 200);\n\n      _this2.resizeOverflowingText(); // Focus text\n\n\n      _this2.$cardTextArea.focus();\n    }, 200);\n  }\n  /**\n   * Change text of card, used when turning cards.\n   *\n   * @param {string} text Text to set.\n   */\n  ;\n\n  _proto.changeText = function changeText(text) {\n    this.$cardTextArea.html(text);\n    this.$cardTextArea.toggleClass('hide', !text || !text.length);\n  }\n  /**\n   * Set progress for assistive technologies.\n   * @param {number} position Position.\n   * @param {number} max Maximum position.\n   */\n  ;\n\n  _proto.setProgressText = function setProgressText(position, total) {\n    if (this.params.mode !== 'repetition') {\n      return;\n    }\n\n    var progressText = this.params.progressText.replace('@card', position.toString()).replace('@total', total.toString());\n    this.$cardWrapper.attr('aria-label', progressText);\n  }\n  /**\n   * Resize the font-size of text areas that tend to overflow when dialog cards\n   * is squeezed into a tiny container.\n   */\n  ;\n\n  _proto.resizeOverflowingText = function resizeOverflowingText() {\n    if (!this.params.behaviour.scaleTextNotCard) {\n      return; // No text scaling today\n    } // Resize card text if needed\n\n\n    var $textContainer = this.getDOM().find('.h5p-dialogcards-card-text');\n    var $text = $textContainer.children();\n    this.resizeTextToFitContainer($textContainer, $text);\n  }\n  /**\n   * Increase or decrease font size so text wil fit inside container.\n   *\n   * @param {jQuery} $textContainer Outer container, must have a set size.\n   * @param {jQuery} $text Inner text container\n   */\n  ;\n\n  _proto.resizeTextToFitContainer = function resizeTextToFitContainer($textContainer, $text) {\n    // Reset text size\n    $text.css('font-size', '');\n\n    if (window.orientation === 90) {\n      var textInner = this.getDOM().find('.h5p-dialogcards-card-text-inner').get(0);\n\n      if (textInner.clientHeight < textInner.scrollHeight) {\n        var fontSize = parseFloat($text.css('font-size'));\n\n        while (fontSize > Card.MINSCALE && textInner.clientHeight < textInner.scrollHeight) {\n          fontSize -= Card.SCALEINTERVAL;\n          $text.css('font-size', \"\".concat(fontSize, \"px\"));\n        }\n      }\n    } else {\n      // Measure container and text height\n      var currentTextContainerHeight = $textContainer.get(0).getBoundingClientRect().height;\n      var currentTextHeight = $text.get(0).getBoundingClientRect().height;\n      var parentFontSize = parseFloat($textContainer.css('font-size'));\n\n      var _fontSize = parseFloat($text.css('font-size'));\n\n      var $inner = this.getDOM().closest('.h5p-container');\n      var mainFontSize = parseFloat($inner.css('font-size')); // Decrease font size\n\n      if (currentTextHeight > currentTextContainerHeight) {\n        var decreaseFontSize = true;\n\n        while (decreaseFontSize) {\n          _fontSize -= Card.SCALEINTERVAL;\n\n          if (_fontSize < Card.MINSCALE) {\n            decreaseFontSize = false;\n            break;\n          }\n\n          $text.css('font-size', _fontSize / parentFontSize + 'em');\n          currentTextHeight = $text.get(0).getBoundingClientRect().height;\n\n          if (currentTextHeight <= currentTextContainerHeight) {\n            decreaseFontSize = false;\n          }\n        }\n      } else {\n        // Increase font size\n        var increaseFontSize = true;\n\n        while (increaseFontSize) {\n          _fontSize += Card.SCALEINTERVAL; // Cap at  16px\n\n          if (_fontSize > mainFontSize) {\n            increaseFontSize = false;\n            break;\n          } // Set relative font size to scale with full screen.\n\n\n          $text.css('font-size', _fontSize / parentFontSize + 'em');\n          currentTextHeight = $text.get(0).getBoundingClientRect().height;\n\n          if (currentTextHeight >= currentTextContainerHeight) {\n            increaseFontSize = false;\n            _fontSize = _fontSize - Card.SCALEINTERVAL;\n            $text.css('font-size', _fontSize / parentFontSize + 'em');\n          }\n        }\n      }\n    }\n  }\n  /**\n   * Adds tip to a card\n   *\n   * @param {jQuery} $card The card\n   * @param {String} [side=front] Which side of the card\n   * @param {Number} [index] Index of card\n   */\n  ;\n\n  _proto.addTipToCard = function addTipToCard($card, side, index) {\n    // Make sure we have a side\n    if (side !== 'back') {\n      side = 'front';\n    } // Make sure we have an index\n\n\n    if (index === undefined) {\n      index = this.id;\n    } // Remove any old tips\n\n\n    $card.find('.joubel-tip-container').remove(); // Add new tip if set and has length after trim\n\n    var tip = (this.card[side].tip || '').trim();\n\n    if (tip.length) {\n      $card.find('.h5p-dialogcards-card-text-wrapper .h5p-dialogcards-card-text-inner').after(H5P.JoubelUI.createTip(tip, {\n        tipLabel: this.params.tipButtonLabel\n      }));\n    }\n  }\n  /**\n   * Set focus to a given card.\n   * @param {boolean} force If true, don't wait for transition.\n   */\n  ;\n\n  _proto.setCardFocus = function setCardFocus(force) {\n    if (force === true) {\n      this.$cardTextArea.focus();\n    } else {\n      // Wait for transition, then set focus\n      var $card = this.getDOM();\n      $card.one('transitionend', function () {\n        $card.focus();\n      });\n    }\n  }\n  /**\n   * Stop audio of card.\n   */\n  ;\n\n  _proto.stopAudio = function stopAudio() {\n    var _this3 = this;\n\n    var sides = ['front', 'back'];\n    sides.forEach(function (side) {\n      if (!_this3.audios[side] || !_this3.audios[side].audio) {\n        return;\n      }\n      /*\n       * We need to reset the audio button to its initial visual state, but it\n       * doesn't have a function to to that -> force ended event and reload.\n       */\n\n\n      if (_this3.audios[side].audio.duration > 0) {\n        _this3.audios[side].audio.pause();\n\n        _this3.audios[side].audio.currentTime = Math.floor(_this3.audios[side].audio.duration);\n      }\n\n      if (_this3.audios[side].audio.load) {\n        setTimeout(function () {\n          _this3.audios[side].audio.load();\n        }, 100);\n      }\n    });\n  }\n  /**\n   * Get card's DOM\n   *\n   * @return {jQuery} Card's DOM.\n   */\n  ;\n\n  _proto.getDOM = function getDOM() {\n    return this.$cardWrapper;\n  }\n  /**\n   * Set no text mode.\n   */\n  ;\n\n  _proto.setNoText = function setNoText() {\n    this.getDOM().addClass('h5p-no-text');\n  }\n  /**\n   * Get card's text.\n   *\n   * @return {string} Card's text.\n   */\n  ;\n\n  _proto.getText = function getText() {\n    return this.card.front.text;\n  }\n  /**\n   * Get card's answer.\n   *\n   * @return {string} Card's answer.\n   */\n  ;\n\n  _proto.getAnswer = function getAnswer() {\n    return this.card.back.text;\n  }\n  /**\n   * Get card's image wrapper.\n   *\n   * @return {jQuery} Card's image.\n   */\n  ;\n\n  _proto.getImageWrapper = function getImageWrapper() {\n    return this.$imageWrapper;\n  }\n  /**\n   * Set card image height.\n   * @param {string} height CSS height value.\n   */\n  ;\n\n  _proto.setImageHeight = function setImageHeight(height) {\n    this.$imageWrapper.css('height', height);\n  }\n  /**\n   * Get card's Audio.\n   *\n   * @return {Element} Card's audio.\n   */\n  ;\n\n  _proto.getAudio = function getAudio() {\n    return this.isTurned() ? this.$audioWrappers.back : this.$audioWrappers.front;\n  }\n  /**\n   * Detect whether card is turned.\n   * @return {boolean} True, if card is turned.\n   */\n  ;\n\n  _proto.isTurned = function isTurned() {\n    return this.getDOM().find('.h5p-dialogcards-card-content').hasClass('h5p-dialogcards-turned');\n  }\n  /**\n   * Reset card.\n   */\n  ;\n\n  _proto.reset = function reset() {\n    var $card = this.getDOM();\n    $card.removeClass('h5p-dialogcards-previous');\n    $card.removeClass('h5p-dialogcards-current');\n    this.changeText(this.getText());\n    var $cardContent = $card.find('.h5p-dialogcards-card-content');\n    $cardContent.removeClass('h5p-dialogcards-turned');\n    this.addTipToCard($cardContent, 'front', this.id);\n\n    if (!this.params.behaviour.quickProgression) {\n      $card.find('.h5p-dialogcards-answer-button').removeClass('h5p-dialogcards-quick-progression');\n    }\n\n    this.hideSummaryButton();\n  };\n\n  return Card;\n}(); // Constants\n\n\nCard.SCALEINTERVAL = 0.2;\nCard.MAXSCALE = 16;\nCard.MINSCALE = 4;\n/* harmony default export */ __webpack_exports__[\"default\"] = (Card);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvc2NyaXB0cy9oNXAtZGlhbG9nY2FyZHMtY2FyZC5qcy5qcyIsIm1hcHBpbmdzIjoiO0FBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUdBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFIQTs7QUFLQTtBQUNBO0FBQ0E7O0FBRUE7QUFBQTtBQUFBO0FBR0E7QUFHQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQUNBO0FBQ0E7QUFDQTtBQURBOztBQUtBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFEQTtBQUlBO0FBQ0E7QUFEQTtBQUlBO0FBQ0E7QUFEQTs7QUFLQTs7QUFJQTtBQUdBO0FBQ0E7QUFEQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFNQTtBQUdBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFIQTs7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUFBO0FBQ0E7O0FBSUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFLQTtBQUNBO0FBQ0E7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUlBO0FBQ0E7O0FBRUE7QUFDQTs7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUZBO0FBS0E7QUFDQTtBQUNBO0FBRkE7QUFLQTtBQUNBO0FBQ0E7QUFGQTtBQVFBO0FBQ0E7QUFDQTtBQUZBO0FBUUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUFBOztBQUNBO0FBR0E7QUFDQTtBQUNBOztBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFFQTtBQUdBO0FBQ0E7QUFFQTtBQUdBO0FBQ0E7QUFDQTs7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7O0FBTUE7QUFHQTtBQUNBO0FBQUE7QUFHQTtBQUVBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBTUE7QUFHQTtBQUVBO0FBRUE7QUFDQTtBQUNBOzs7QUFDQTtBQUFBOztBQUNBO0FBQ0E7QUFDQTs7QUFHQTtBQUVBO0FBQ0E7QUFDQTs7O0FBR0E7QUFFQTs7QUFDQTtBQUlBOzs7QUFDQTs7O0FBR0E7QUFDQTs7QUFHQTtBQUNBO0FBR0E7QUFDQTtBQUdBOzs7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOzs7QUFHQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBSUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBQ0E7O0FBRUE7QUFDQTs7QUFHQTtBQUNBOztBQUNBO0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFFQTs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTs7QUFDQTtBQUNBOztBQUdBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBOztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFJQTtBQUNBO0FBQ0E7OztBQUdBOztBQUdBOztBQUNBO0FBQ0E7QUFFQTtBQURBO0FBR0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBOzs7QUFDQTtBQUFBOztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTs7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFHQTtBQUVBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBQ0E7QUFDQTs7O0FBR0E7OztBQUNBO0FBQ0E7QUFDQTtBQUVBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vaDVwLWRpYWxvZ2NhcmRzLy4vc3JjL3NjcmlwdHMvaDVwLWRpYWxvZ2NhcmRzLWNhcmQuanM/ZTA4MiJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCAkID0gSDVQLmpRdWVyeTtcblxuY2xhc3MgQ2FyZCB7XG4gIC8qKlxuICAgKiBAY29uc3RydWN0b3JcbiAgICpcbiAgICogQHBhcmFtIHtvYmplY3R9IGNhcmQgQ2FyZCBwYXJhbWV0ZXJzXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBwYXJhbXMgUGFyZW50J3MgcGFyYW1zXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBpZCBDYXJkIG51bWJlciBpbiBvcmRlciBvZiBhcHBlYXJhbmNlXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBbY2FsbGJhY2tzXSBDYWxsYmFja3MuXG4gICAqIEBwYXJhbSB7ZnVuY3Rpb259IFtjYWxsYmFja3Mub25DYXJkU2l6ZV0gQ2FsbCB3aGVuIGNhcmQgbmVlZHMgcmVzaXplLlxuICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBbY2FsbGJhY2tzLm9uQ2FyZFR1cm5lZF0gQ2FsbCB3aGVuIGNhcmQgd2FzIHR1cm5lZC5cbiAgICovXG4gIGNvbnN0cnVjdG9yKGNhcmQsIHBhcmFtcywgaWQsIGNvbnRlbnRJZCwgY2FsbGJhY2tzID0ge30pIHtcbiAgICB0aGlzLmNhcmQgPSBjYXJkO1xuICAgIHRoaXMucGFyYW1zID0gcGFyYW1zIHx8IHt9O1xuICAgIHRoaXMuaWQgPSBpZDtcbiAgICB0aGlzLmNvbnRlbnRJZCA9IGNvbnRlbnRJZDtcbiAgICB0aGlzLmNhbGxiYWNrcyA9IGNhbGxiYWNrcztcblxuICAgIC8vIENoZWNrIGlmIHRvIHVzZSBmcm9udCBzZXR0aW5ncyBmb3IgYmFjaywgdG9vXG4gICAgaWYgKHRoaXMuY2FyZC5iYWNrLnVzZUltYWdlRnJvbUZyb250KSB7XG4gICAgICB0aGlzLmNhcmQuYmFjay5pbWFnZSA9IHRoaXMuY2FyZC5mcm9udC5pbWFnZTtcbiAgICAgIHRoaXMuY2FyZC5iYWNrLmltYWdlQWx0VGV4dCA9IHRoaXMuY2FyZC5mcm9udC5pbWFnZUFsdFRleHQ7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuY2FyZC5iYWNrLnVzZUF1ZGlvRnJvbUZyb250KSB7XG4gICAgICB0aGlzLmNhcmQuYmFjay5hdWRpbyA9IHRoaXMuY2FyZC5mcm9udC5hdWRpbztcbiAgICB9XG5cbiAgICB0aGlzLmF1ZGlvcyA9IHt9O1xuICAgIHRoaXMuJGF1ZGlvV3JhcHBlcnMgPSB7fTtcblxuICAgIHRoaXMuJGNhcmRXcmFwcGVyID0gJCgnPGRpdj4nLCB7XG4gICAgICAnY2xhc3MnOiAnaDVwLWRpYWxvZ2NhcmRzLWNhcmR3cmFwJyxcbiAgICAgICdyb2xlJzogJ2dyb3VwJyxcbiAgICAgICd0YWJpbmRleCc6ICctMSdcbiAgICB9KTtcbiAgICBpZiAodGhpcy5wYXJhbXMubW9kZSAhPT0gJ3JlcGV0aXRpb24nKSB7XG4gICAgICB0aGlzLiRjYXJkV3JhcHBlci5hdHRyKCdhcmlhLWxhYmVsbGVkYnknLCAnaDVwLWRpYWxvZ2NhcmRzLXByb2dyZXNzLScgKyBINVAuRGlhbG9nY2FyZHMuaWRDb3VudGVyKTtcbiAgICB9XG5cbiAgICB0aGlzLiRjYXJkSG9sZGVyID0gJCgnPGRpdj4nLCB7J2NsYXNzJzogJ2g1cC1kaWFsb2djYXJkcy1jYXJkaG9sZGVyJ30pXG4gICAgICAuYXBwZW5kVG8odGhpcy4kY2FyZFdyYXBwZXIpO1xuXG4gICAgdGhpcy5jcmVhdGVDYXJkQ29udGVudChjYXJkKVxuICAgICAgLmFwcGVuZFRvKHRoaXMuJGNhcmRIb2xkZXIpO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGNvbnRlbnQgZm9yIGEgY2FyZFxuICAgKlxuICAgKiBAcGFyYW0ge29iamVjdH0gY2FyZCBDYXJkIHBhcmFtZXRlcnNcbiAgICogQHJldHVybnMgeyp8alF1ZXJ5fEhUTUxFbGVtZW50fSBDYXJkIGNvbnRlbnQgd3JhcHBlclxuICAgKi9cbiAgY3JlYXRlQ2FyZENvbnRlbnQoY2FyZCkge1xuICAgIGNvbnN0ICRjYXJkQ29udGVudCA9ICQoJzxkaXY+Jywge1xuICAgICAgJ2NsYXNzJzogJ2g1cC1kaWFsb2djYXJkcy1jYXJkLWNvbnRlbnQnXG4gICAgfSk7XG5cbiAgICAvLyBJbWFnZXNcbiAgICB0aGlzLiRpbWFnZVdyYXBwZXIgPSAkKCc8ZGl2PicsIHtcbiAgICAgICdjbGFzcyc6ICdoNXAtZGlhbG9nY2FyZHMtaW1hZ2Utd3JhcHBlcidcbiAgICB9KTtcbiAgICB0aGlzLmNyZWF0ZUNhcmRJbWFnZShjYXJkLCAnZnJvbnQnKS5hcHBlbmRUbyh0aGlzLiRpbWFnZVdyYXBwZXIpO1xuICAgIHRoaXMuY3JlYXRlQ2FyZEltYWdlKGNhcmQsICdiYWNrJykuYXBwZW5kVG8odGhpcy4kaW1hZ2VXcmFwcGVyKTtcbiAgICB0aGlzLiRpbWFnZVdyYXBwZXIuYXBwZW5kVG8oJGNhcmRDb250ZW50KTtcblxuICAgIGNvbnN0ICRjYXJkVGV4dFdyYXBwZXIgPSAkKCc8ZGl2PicsIHtcbiAgICAgICdjbGFzcyc6ICdoNXAtZGlhbG9nY2FyZHMtY2FyZC10ZXh0LXdyYXBwZXInXG4gICAgfSkuYXBwZW5kVG8oJGNhcmRDb250ZW50KTtcblxuICAgIGNvbnN0ICRjYXJkVGV4dElubmVyID0gJCgnPGRpdj4nLCB7XG4gICAgICAnY2xhc3MnOiAnaDVwLWRpYWxvZ2NhcmRzLWNhcmQtdGV4dC1pbm5lcidcbiAgICB9KS5hcHBlbmRUbygkY2FyZFRleHRXcmFwcGVyKTtcblxuICAgIGNvbnN0ICRjYXJkVGV4dElubmVyQ29udGVudCA9ICQoJzxkaXY+Jywge1xuICAgICAgJ2NsYXNzJzogJ2g1cC1kaWFsb2djYXJkcy1jYXJkLXRleHQtaW5uZXItY29udGVudCdcbiAgICB9KS5hcHBlbmRUbygkY2FyZFRleHRJbm5lcik7XG5cbiAgICAvLyBGcm9udCBhdWRpb1xuICAgIHRoaXMuJGF1ZGlvV3JhcHBlcnMuZnJvbnQgPSB0aGlzLmNyZWF0ZUNhcmRBdWRpbyhjYXJkLCAnZnJvbnQnKVxuICAgICAgLmFwcGVuZFRvKCRjYXJkVGV4dElubmVyQ29udGVudCk7XG5cbiAgICAvLyBCYWNrIGF1ZGlvXG4gICAgdGhpcy4kYXVkaW9XcmFwcGVycy5iYWNrID0gdGhpcy5jcmVhdGVDYXJkQXVkaW8oY2FyZCwgJ2JhY2snKVxuICAgICAgLmFwcGVuZFRvKCRjYXJkVGV4dElubmVyQ29udGVudCk7XG5cbiAgICBjb25zdCAkY2FyZFRleHQgPSAkKCc8ZGl2PicsIHtcbiAgICAgICdjbGFzcyc6ICdoNXAtZGlhbG9nY2FyZHMtY2FyZC10ZXh0J1xuICAgIH0pLmFwcGVuZFRvKCRjYXJkVGV4dElubmVyQ29udGVudCk7XG5cbiAgICB0aGlzLiRjYXJkVGV4dEFyZWEgPSAkKCc8ZGl2PicsIHtcbiAgICAgICdjbGFzcyc6ICdoNXAtZGlhbG9nY2FyZHMtY2FyZC10ZXh0LWFyZWEnLFxuICAgICAgJ3RhYmluZGV4JzogJy0xJyxcbiAgICAgICdodG1sJzogY2FyZC5mcm9udC50ZXh0XG4gICAgfSkuYXBwZW5kVG8oJGNhcmRUZXh0KTtcblxuICAgIHRoaXMuY3JlYXRlQ2FyZEZvb3RlcigpXG4gICAgICAuYXBwZW5kVG8oJGNhcmRUZXh0V3JhcHBlcik7XG5cbiAgICByZXR1cm4gJGNhcmRDb250ZW50O1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBjYXJkIGltYWdlXG4gICAqXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBjYXJkIENhcmQgcGFyYW1ldGVyc1xuICAgKiBAcGFyYW0ge3N0cmluZ30gc2lkZSBTaWRlLCBlaXRoZXIgZnJvbnQgb3IgYmFjay5cbiAgICogQHJldHVybnMgeyp8alF1ZXJ5fEhUTUxFbGVtZW50fSBDYXJkIGltYWdlIHdyYXBwZXJcbiAgICovXG4gIGNyZWF0ZUNhcmRJbWFnZShjYXJkLCBzaWRlKSB7XG4gICAgbGV0ICRpbWFnZTtcblxuICAgIGlmIChjYXJkW3NpZGVdLmltYWdlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICRpbWFnZSA9ICQoJzxpbWcgY2xhc3M9XCJoNXAtZGlhbG9nY2FyZHMtaW1hZ2VcIiBzcmM9XCInICsgSDVQLmdldFBhdGgoY2FyZFtzaWRlXS5pbWFnZS5wYXRoLCB0aGlzLmNvbnRlbnRJZCkgKyAnXCIvPicpO1xuICAgICAgJGltYWdlLmFkZENsYXNzKGBoNXAtZGlhbG9nY2FyZHMtaW1hZ2UtJHtzaWRlfWApO1xuXG4gICAgICAvLyBLaWRzTG9vcCBjdXN0b21pemF0aW9uIHRvIHByZXZlbnQgZHJhZ2dpbmcgdGhlIGltYWdlXG4gICAgICAkaW1hZ2UuZ2V0KDApLmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdzdGFydCcsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgfSk7XG4gICAgICAvKlxuICAgICAgICogS2lkc0xvb3AgY3VzdG9taXphdGlvbiB0byBwcmV2ZW50IHNhdmluZyBpbWFnZXMgb24gQW5kcm9pZC4gQ2Fubm90XG4gICAgICAgKiB1c2UgQ1NTIGBwb2ludGVyLWV2ZW50czogbm9uZWAsIGJlY2F1c2UgaXQgaW50ZXJmZXJlcyB3aXRoIGRyYWdzdGFydFxuICAgICAgICovXG4gICAgICAkaW1hZ2UuZ2V0KDApLmFkZEV2ZW50TGlzdGVuZXIoJ2NvbnRleHRtZW51JywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH0pO1xuICAgICAgLy8gS2lkc0xvb3AgY3VzdG9taXphdGlvbiB0byBwcmV2ZW50IGRyYWdnaW5nIHRoZSBpbWFnZSBvbiBpT1NcbiAgICAgICRpbWFnZS5jc3Moe1xuICAgICAgICAndXNlci1zZWxlY3QnOiAnbm9uZScsXG4gICAgICAgICctd2Via2l0LXVzZXItc2VsZWN0JzogJ25vbmUnLFxuICAgICAgICAnLXdlYmtpdC10b3VjaC1jYWxsb3V0JzogJ25vbmUnXG4gICAgICB9KTtcblxuICAgICAgaWYgKGNhcmRbc2lkZV0uaW1hZ2VBbHRUZXh0KSB7XG4gICAgICAgICRpbWFnZS5hdHRyKCdhbHQnLCBjYXJkW3NpZGVdLmltYWdlQWx0VGV4dCk7XG4gICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgJGltYWdlID0gJCgnPGRpdiBjbGFzcz1cImg1cC1kaWFsb2djYXJkcy1pbWFnZVwiPjwvZGl2PicpO1xuICAgIH1cblxuICAgIHJldHVybiAkaW1hZ2U7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGNhcmQgYXVkaW8uXG4gICAqXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBjYXJkIENhcmQgcGFyYW1ldGVycy5cbiAgICogQHBhcmFtIHtzdHJpbmd9IHNpZGUgU2lkZSwgZWl0aGVyIGZyb250IG9yIGJhY2suXG4gICAqIEByZXR1cm5zIHsqfGpRdWVyeXxIVE1MRWxlbWVudH0gQ2FyZCBhdWRpbyBlbGVtZW50LlxuICAgKi9cbiAgY3JlYXRlQ2FyZEF1ZGlvKGNhcmQsIHNpZGUgPSAnZnJvbnQnKSB7XG4gICAgY29uc3QgJGF1ZGlvV3JhcHBlciA9ICQoJzxkaXY+JylcbiAgICAgIC5hZGRDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLWF1ZGlvLXdyYXBwZXInKVxuICAgICAgLmFkZENsYXNzKGBoNXAtZGlhbG9nY2FyZHMtYXVkaW8td3JhcHBlci0ke3NpZGV9YCk7XG5cbiAgICBpZiAoIWNhcmRbc2lkZV0udGV4dCB8fCBjYXJkW3NpZGVdLnRleHQgPT09ICcnKSB7XG4gICAgICAkYXVkaW9XcmFwcGVyLmFkZENsYXNzKCdoNXAtbm8tdGV4dCcpO1xuICAgIH1cblxuICAgIGlmIChjYXJkW3NpZGVdLmF1ZGlvICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGNvbnN0IGF1ZGlvRGVmYXVsdHMgPSB7XG4gICAgICAgIGZpbGVzOiBjYXJkW3NpZGVdLmF1ZGlvLFxuICAgICAgICBhdWRpb05vdFN1cHBvcnRlZDogdGhpcy5wYXJhbXMuYXVkaW9Ob3RTdXBwb3J0ZWRcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IGF1ZGlvID0gbmV3IEg1UC5BdWRpbyhhdWRpb0RlZmF1bHRzLCB0aGlzLmNvbnRlbnRJZCk7XG4gICAgICB0aGlzLmF1ZGlvc1tzaWRlXSA9IGF1ZGlvO1xuICAgICAgYXVkaW8uYXR0YWNoKCRhdWRpb1dyYXBwZXIpO1xuXG4gICAgICAvLyBIYXZlIHRvIHN0b3AgZWxzZSBhdWRpbyB3aWxsIHRha2UgdXAgYSBzb2NrZXQgcGVuZGluZyBmb3JldmVyIGluIGNocm9tZS5cbiAgICAgIGlmIChhdWRpby5hdWRpbyAmJiBhdWRpby5hdWRpby5wcmVsb2FkKSB7XG4gICAgICAgIGF1ZGlvLmF1ZGlvLnByZWxvYWQgPSAnbm9uZSc7XG4gICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgJGF1ZGlvV3JhcHBlci5hZGRDbGFzcygnaGlkZScpO1xuICAgIH1cblxuICAgIHJldHVybiAkYXVkaW9XcmFwcGVyO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBjYXJkIGZvb3RlclxuICAgKlxuICAgKiBAcmV0dXJucyB7KnxqUXVlcnl8SFRNTEVsZW1lbnR9IENhcmQgZm9vdGVyIGVsZW1lbnRcbiAgICovXG4gIGNyZWF0ZUNhcmRGb290ZXIoKSB7XG4gICAgY29uc3QgJGNhcmRGb290ZXIgPSAkKCc8ZGl2PicsIHtcbiAgICAgICdjbGFzcyc6ICdoNXAtZGlhbG9nY2FyZHMtY2FyZC1mb290ZXInXG4gICAgfSk7XG5cbiAgICBsZXQgY2xhc3Nlc1JlcGV0aXRpb24gPSAnaDVwLWRpYWxvZ2NhcmRzLWJ1dHRvbi1oaWRkZW4nO1xuICAgIGxldCBhdHRyaWJ1dGVUYWJpbmRleCA9ICctMSc7XG5cbiAgICBpZiAodGhpcy5wYXJhbXMubW9kZSA9PT0gJ3JlcGV0aXRpb24nKSB7XG4gICAgICBjbGFzc2VzUmVwZXRpdGlvbiA9ICcnO1xuICAgICAgaWYgKHRoaXMucGFyYW1zLmJlaGF2aW91ci5xdWlja1Byb2dyZXNzaW9uKSB7XG4gICAgICAgIGNsYXNzZXNSZXBldGl0aW9uID0gJ2g1cC1kaWFsb2djYXJkcy1xdWljay1wcm9ncmVzc2lvbic7XG4gICAgICAgIGF0dHJpYnV0ZVRhYmluZGV4ID0gJzAnO1xuICAgICAgfVxuXG4gICAgICAkY2FyZEZvb3Rlci5hZGRDbGFzcygnaDVwLXJlcGV0aXRpb24nKTtcbiAgICB9XG5cbiAgICB0aGlzLiRidXR0b25UdXJuID0gSDVQLkpvdWJlbFVJLmNyZWF0ZUJ1dHRvbih7XG4gICAgICAnY2xhc3MnOiAnaDVwLWRpYWxvZ2NhcmRzLXR1cm4nLFxuICAgICAgJ2h0bWwnOiB0aGlzLnBhcmFtcy5hbnN3ZXJcbiAgICB9KS5hcHBlbmRUbygkY2FyZEZvb3Rlcik7XG5cbiAgICB0aGlzLiRidXR0b25TaG93U3VtbWFyeSA9IEg1UC5Kb3ViZWxVSS5jcmVhdGVCdXR0b24oe1xuICAgICAgJ2NsYXNzJzogJ2g1cC1kaWFsb2djYXJkcy1zaG93LXN1bW1hcnkgaDVwLWRpYWxvZ2NhcmRzLWJ1dHRvbi1nb25lJyxcbiAgICAgICdodG1sJzogdGhpcy5wYXJhbXMuc2hvd1N1bW1hcnlcbiAgICB9KS5hcHBlbmRUbygkY2FyZEZvb3Rlcik7XG5cbiAgICB0aGlzLiRidXR0b25JbmNvcnJlY3QgPSBINVAuSm91YmVsVUkuY3JlYXRlQnV0dG9uKHtcbiAgICAgICdjbGFzcyc6ICdoNXAtZGlhbG9nY2FyZHMtYW5zd2VyLWJ1dHRvbicsXG4gICAgICAnaHRtbCc6IHRoaXMucGFyYW1zLmluY29ycmVjdEFuc3dlclxuICAgIH0pLmFkZENsYXNzKCdpbmNvcnJlY3QnKVxuICAgICAgLmFkZENsYXNzKGNsYXNzZXNSZXBldGl0aW9uKVxuICAgICAgLmF0dHIoJ3RhYmluZGV4JywgYXR0cmlidXRlVGFiaW5kZXgpXG4gICAgICAuYXBwZW5kVG8oJGNhcmRGb290ZXIpO1xuXG4gICAgdGhpcy4kYnV0dG9uQ29ycmVjdCA9IEg1UC5Kb3ViZWxVSS5jcmVhdGVCdXR0b24oe1xuICAgICAgJ2NsYXNzJzogJ2g1cC1kaWFsb2djYXJkcy1hbnN3ZXItYnV0dG9uJyxcbiAgICAgICdodG1sJzogdGhpcy5wYXJhbXMuY29ycmVjdEFuc3dlclxuICAgIH0pLmFkZENsYXNzKCdjb3JyZWN0JylcbiAgICAgIC5hZGRDbGFzcyhjbGFzc2VzUmVwZXRpdGlvbilcbiAgICAgIC5hdHRyKCd0YWJpbmRleCcsIGF0dHJpYnV0ZVRhYmluZGV4KVxuICAgICAgLmFwcGVuZFRvKCRjYXJkRm9vdGVyKTtcblxuICAgIHJldHVybiAkY2FyZEZvb3RlcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYnV0dG9uIGxpc3RlbmVycy5cbiAgICogV2lsbCBiZSBsb3N0IHdoZW4gdGhlIGVsZW1lbnQgaXMgcmVtb3ZlZCBmcm9tIERPTS5cbiAgICovXG4gIGNyZWF0ZUJ1dHRvbkxpc3RlbmVycygpIHtcbiAgICB0aGlzLiRidXR0b25JbmNvcnJlY3RcbiAgICAgIC51bmJpbmQoJ2NsaWNrJylcbiAgICAgIC5jbGljayhldmVudCA9PiB7XG4gICAgICAgIGlmICghZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnaDVwLWRpYWxvZ2NhcmRzLXF1aWNrLXByb2dyZXNzaW9uJykpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jYWxsYmFja3Mub25OZXh0Q2FyZCh7Y2FyZElkOiB0aGlzLmlkLCByZXN1bHQ6IGZhbHNlfSk7XG4gICAgICB9KTtcblxuICAgIHRoaXMuJGJ1dHRvblR1cm5cbiAgICAgIC51bmJpbmQoJ2NsaWNrJylcbiAgICAgIC5jbGljaygoKSA9PiB7XG4gICAgICAgIHRoaXMudHVybkNhcmQoKTtcbiAgICAgIH0pO1xuXG4gICAgdGhpcy4kYnV0dG9uQ29ycmVjdFxuICAgICAgLnVuYmluZCgnY2xpY2snKVxuICAgICAgLmNsaWNrKGV2ZW50ID0+IHtcbiAgICAgICAgaWYgKCFldmVudC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdoNXAtZGlhbG9nY2FyZHMtcXVpY2stcHJvZ3Jlc3Npb24nKSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNhbGxiYWNrcy5vbk5leHRDYXJkKHtjYXJkSWQ6IHRoaXMuaWQsIHJlc3VsdDogdHJ1ZX0pO1xuICAgICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogU2hvdyBzdW1tYXJ5IGJ1dHRvbiBvbiBsYXN0IGNhcmQuXG4gICAqXG4gICAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGNhbGxlZCBvbiBidXR0b24gY2xpY2suXG4gICAqL1xuICBzaG93U3VtbWFyeUJ1dHRvbihjYWxsYmFjaykge1xuICAgIC8vIEhpZGUgYW5zd2VyIGJ1dHRvbnNcbiAgICB0aGlzLmdldERPTSgpXG4gICAgICAuZmluZCgnLmg1cC1kaWFsb2djYXJkcy1hbnN3ZXItYnV0dG9uJylcbiAgICAgIC5hZGRDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLWJ1dHRvbi1oaWRkZW4nKVxuICAgICAgLmF0dHIoJ3RhYmluZGV4JywgJy0xJyk7XG5cbiAgICAvLyBTd2FwIHR1cm4gYnV0dG9uIHdpdGggc2hvdyBzdW1tYXJ5IGJ1dHRvblxuICAgIHRoaXMuJGJ1dHRvblR1cm5cbiAgICAgIC5hZGRDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLWJ1dHRvbi1nb25lJyk7XG5cbiAgICB0aGlzLiRidXR0b25TaG93U3VtbWFyeVxuICAgICAgLmNsaWNrKCgpID0+IGNhbGxiYWNrKCkpXG4gICAgICAucmVtb3ZlQ2xhc3MoJ2g1cC1kaWFsb2djYXJkcy1idXR0b24tZ29uZScpXG4gICAgICAuZm9jdXMoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIaWRlIHN1bW1hcnkgYnV0dG9uIGFuZCBzaG93IGFuc3dlciBidXR0b25zIGFnYWluLlxuICAgKi9cbiAgaGlkZVN1bW1hcnlCdXR0b24oKSB7XG4gICAgaWYgKHRoaXMucGFyYW1zLm1vZGUgPT09ICdub3JtYWwnKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5nZXRET00oKVxuICAgICAgLmZpbmQoJy5oNXAtZGlhbG9nY2FyZHMtYW5zd2VyLWJ1dHRvbicpXG4gICAgICAucmVtb3ZlQ2xhc3MoJ2g1cC1kaWFsb2djYXJkcy1idXR0b24taGlkZGVuJylcbiAgICAgIC5hdHRyKCd0YWJpbmRleCcsICcwJyk7XG5cbiAgICAvLyBTd2FwIHR1cm4gYnV0dG9uIHdpdGggc2hvdyBzdW1tYXJ5IGJ1dHRvblxuICAgIHRoaXMuJGJ1dHRvblR1cm5cbiAgICAgIC5yZW1vdmVDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLWJ1dHRvbi1nb25lJyk7XG5cbiAgICB0aGlzLiRidXR0b25TaG93U3VtbWFyeVxuICAgICAgLmFkZENsYXNzKCdoNXAtZGlhbG9nY2FyZHMtYnV0dG9uLWdvbmUnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTaG93IHRoZSBvcHBvc2l0ZSBzaWRlIG9mIHRoZSBjYXJkLlxuICAgKi9cbiAgdHVybkNhcmQoKSB7XG4gICAgY29uc3QgJGNhcmQgPSB0aGlzLmdldERPTSgpO1xuICAgIGNvbnN0ICRjID0gJGNhcmQuZmluZCgnLmg1cC1kaWFsb2djYXJkcy1jYXJkLWNvbnRlbnQnKTtcbiAgICBjb25zdCAkY2ggPSAkY2FyZC5maW5kKCcuaDVwLWRpYWxvZ2NhcmRzLWNhcmRob2xkZXInKS5hZGRDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLWNvbGxhcHNlJyk7XG5cbiAgICAvLyBSZW1vdmVzIHRpcCwgc2luY2UgaXQgZGVzdHJveXMgdGhlIGFuaW1hdGlvbjpcbiAgICAkYy5maW5kKCcuam91YmVsLXRpcC1jb250YWluZXInKS5yZW1vdmUoKTtcblxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgLy8gQ2hlY2sgaWYgY2FyZCBoYXMgYmVlbiB0dXJuZWQgYmVmb3JlXG4gICAgICBjb25zdCB0dXJuZWQgPSB0aGlzLmlzVHVybmVkKCk7XG5cbiAgICAgIC8vIFVwZGF0ZSBIVE1MIGNsYXNzIGZvciBjYXJkXG4gICAgICAkYy50b2dnbGVDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLXR1cm5lZCcsICF0dXJuZWQpO1xuXG4gICAgICAkY2gucmVtb3ZlQ2xhc3MoJ2g1cC1kaWFsb2djYXJkcy1jb2xsYXBzZScpO1xuICAgICAgdGhpcy5jaGFuZ2VUZXh0KHR1cm5lZCA/IHRoaXMuZ2V0VGV4dCgpIDogdGhpcy5nZXRBbnN3ZXIoKSk7XG5cbiAgICAgIC8vIEltYWdlIHNob3duL2hpZGRlbiB2aWEgQ1NTXG5cbiAgICAgIC8vIEF1ZGlvIGJ1dHRvbnMgc2hvd24vaGlkZGVuIHZpYSBDU1NcbiAgICAgIHRoaXMuc3RvcEF1ZGlvKCk7XG5cbiAgICAgIC8vIFRvZ2dsZSBzdGF0ZSBmb3Iga25vd2xlZGdlIGNvbmZpcm1hdGlvbiBidXR0b25zXG4gICAgICBpZiAodGhpcy5wYXJhbXMubW9kZSA9PT0gJ3JlcGV0aXRpb24nICYmICF0aGlzLnBhcmFtcy5iZWhhdmlvdXIucXVpY2tQcm9ncmVzc2lvbikge1xuICAgICAgICBjb25zdCAkYW5zd2VyQnV0dG9ucyA9ICRjYXJkLmZpbmQoJy5oNXAtZGlhbG9nY2FyZHMtYW5zd2VyLWJ1dHRvbicpO1xuXG4gICAgICAgIC8vIERvbid0IHJldm9rZSBxdWljayBwcm9ncmVzc2lvbiBhZnRlciBjYXJkIHdhcyB0dXJuZWQuXG4gICAgICAgIGlmICgkYW5zd2VyQnV0dG9ucy5oYXNDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLXF1aWNrLXByb2dyZXNzaW9uJykgPT09IGZhbHNlKSB7XG4gICAgICAgICAgJGFuc3dlckJ1dHRvbnNcbiAgICAgICAgICAgIC5hZGRDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLXF1aWNrLXByb2dyZXNzaW9uJylcbiAgICAgICAgICAgIC5hdHRyKCd0YWJpbmRleCcsIDApO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIEFkZCBiYWNrc2lkZSB0aXBcbiAgICAgIC8vIEhhZCB0byB3YWl0IGEgbGl0dGxlLCBpZiBub3QgQ2hyb21lIHdpbGwgZGlzcGxhY2UgdGlwIGljb25cbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICB0aGlzLmFkZFRpcFRvQ2FyZCgkYywgdHVybmVkID8gJ2Zyb250JyA6ICdiYWNrJyk7XG5cbiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLmNhbGxiYWNrcy5vbkNhcmRUdXJuZWQgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICB0aGlzLmNhbGxiYWNrcy5vbkNhcmRUdXJuZWQodHVybmVkKTtcbiAgICAgICAgfVxuICAgICAgfSwgMjAwKTtcblxuICAgICAgdGhpcy5yZXNpemVPdmVyZmxvd2luZ1RleHQoKTtcblxuICAgICAgLy8gRm9jdXMgdGV4dFxuICAgICAgdGhpcy4kY2FyZFRleHRBcmVhLmZvY3VzKCk7XG4gICAgfSwgMjAwKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGFuZ2UgdGV4dCBvZiBjYXJkLCB1c2VkIHdoZW4gdHVybmluZyBjYXJkcy5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IHRleHQgVGV4dCB0byBzZXQuXG4gICAqL1xuICBjaGFuZ2VUZXh0KHRleHQpIHtcbiAgICB0aGlzLiRjYXJkVGV4dEFyZWEuaHRtbCh0ZXh0KTtcbiAgICB0aGlzLiRjYXJkVGV4dEFyZWEudG9nZ2xlQ2xhc3MoJ2hpZGUnLCAoIXRleHQgfHwgIXRleHQubGVuZ3RoKSk7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHByb2dyZXNzIGZvciBhc3Npc3RpdmUgdGVjaG5vbG9naWVzLlxuICAgKiBAcGFyYW0ge251bWJlcn0gcG9zaXRpb24gUG9zaXRpb24uXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBtYXggTWF4aW11bSBwb3NpdGlvbi5cbiAgICovXG4gIHNldFByb2dyZXNzVGV4dChwb3NpdGlvbiwgdG90YWwpIHtcbiAgICBpZiAodGhpcy5wYXJhbXMubW9kZSAhPT0gJ3JlcGV0aXRpb24nKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgcHJvZ3Jlc3NUZXh0ID0gdGhpcy5wYXJhbXMucHJvZ3Jlc3NUZXh0XG4gICAgICAucmVwbGFjZSgnQGNhcmQnLCAocG9zaXRpb24pLnRvU3RyaW5nKCkpXG4gICAgICAucmVwbGFjZSgnQHRvdGFsJywgKHRvdGFsKS50b1N0cmluZygpKTtcblxuICAgIHRoaXMuJGNhcmRXcmFwcGVyLmF0dHIoJ2FyaWEtbGFiZWwnLCBwcm9ncmVzc1RleHQpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlc2l6ZSB0aGUgZm9udC1zaXplIG9mIHRleHQgYXJlYXMgdGhhdCB0ZW5kIHRvIG92ZXJmbG93IHdoZW4gZGlhbG9nIGNhcmRzXG4gICAqIGlzIHNxdWVlemVkIGludG8gYSB0aW55IGNvbnRhaW5lci5cbiAgICovXG4gIHJlc2l6ZU92ZXJmbG93aW5nVGV4dCgpIHtcbiAgICBpZiAoIXRoaXMucGFyYW1zLmJlaGF2aW91ci5zY2FsZVRleHROb3RDYXJkKSB7XG4gICAgICByZXR1cm47IC8vIE5vIHRleHQgc2NhbGluZyB0b2RheVxuICAgIH1cblxuICAgIC8vIFJlc2l6ZSBjYXJkIHRleHQgaWYgbmVlZGVkXG4gICAgY29uc3QgJHRleHRDb250YWluZXIgPSB0aGlzLmdldERPTSgpLmZpbmQoJy5oNXAtZGlhbG9nY2FyZHMtY2FyZC10ZXh0Jyk7XG4gICAgY29uc3QgJHRleHQgPSAkdGV4dENvbnRhaW5lci5jaGlsZHJlbigpO1xuICAgIHRoaXMucmVzaXplVGV4dFRvRml0Q29udGFpbmVyKCR0ZXh0Q29udGFpbmVyLCAkdGV4dCk7XG4gIH1cblxuICAvKipcbiAgICogSW5jcmVhc2Ugb3IgZGVjcmVhc2UgZm9udCBzaXplIHNvIHRleHQgd2lsIGZpdCBpbnNpZGUgY29udGFpbmVyLlxuICAgKlxuICAgKiBAcGFyYW0ge2pRdWVyeX0gJHRleHRDb250YWluZXIgT3V0ZXIgY29udGFpbmVyLCBtdXN0IGhhdmUgYSBzZXQgc2l6ZS5cbiAgICogQHBhcmFtIHtqUXVlcnl9ICR0ZXh0IElubmVyIHRleHQgY29udGFpbmVyXG4gICAqL1xuICByZXNpemVUZXh0VG9GaXRDb250YWluZXIoJHRleHRDb250YWluZXIsICR0ZXh0KSB7XG4gICAgLy8gUmVzZXQgdGV4dCBzaXplXG4gICAgJHRleHQuY3NzKCdmb250LXNpemUnLCAnJyk7XG5cbiAgICBpZiAod2luZG93Lm9yaWVudGF0aW9uID09PSA5MCkge1xuICAgICAgY29uc3QgdGV4dElubmVyID0gdGhpcy5nZXRET00oKS5maW5kKCcuaDVwLWRpYWxvZ2NhcmRzLWNhcmQtdGV4dC1pbm5lcicpLmdldCgwKTtcblxuICAgICAgaWYgKHRleHRJbm5lci5jbGllbnRIZWlnaHQgPCB0ZXh0SW5uZXIuc2Nyb2xsSGVpZ2h0KSB7XG4gICAgICAgIGxldCBmb250U2l6ZSA9IHBhcnNlRmxvYXQoJHRleHQuY3NzKCdmb250LXNpemUnKSk7XG4gICAgICAgIHdoaWxlIChmb250U2l6ZSA+IENhcmQuTUlOU0NBTEUgJiYgdGV4dElubmVyLmNsaWVudEhlaWdodCA8IHRleHRJbm5lci5zY3JvbGxIZWlnaHQpIHtcbiAgICAgICAgICBmb250U2l6ZSAtPSBDYXJkLlNDQUxFSU5URVJWQUw7XG4gICAgICAgICAgJHRleHQuY3NzKCdmb250LXNpemUnLCBgJHtmb250U2l6ZX1weGApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgLy8gTWVhc3VyZSBjb250YWluZXIgYW5kIHRleHQgaGVpZ2h0XG4gICAgICBjb25zdCBjdXJyZW50VGV4dENvbnRhaW5lckhlaWdodCA9ICR0ZXh0Q29udGFpbmVyLmdldCgwKS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5oZWlnaHQ7XG4gICAgICBsZXQgY3VycmVudFRleHRIZWlnaHQgPSAkdGV4dC5nZXQoMCkuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkuaGVpZ2h0O1xuICAgICAgY29uc3QgcGFyZW50Rm9udFNpemUgPSBwYXJzZUZsb2F0KCR0ZXh0Q29udGFpbmVyLmNzcygnZm9udC1zaXplJykpO1xuICAgICAgbGV0IGZvbnRTaXplID0gcGFyc2VGbG9hdCgkdGV4dC5jc3MoJ2ZvbnQtc2l6ZScpKTtcblxuICAgICAgY29uc3QgJGlubmVyID0gdGhpcy5nZXRET00oKS5jbG9zZXN0KCcuaDVwLWNvbnRhaW5lcicpO1xuICAgICAgY29uc3QgbWFpbkZvbnRTaXplID0gcGFyc2VGbG9hdCgkaW5uZXIuY3NzKCdmb250LXNpemUnKSk7XG5cbiAgICAgIC8vIERlY3JlYXNlIGZvbnQgc2l6ZVxuICAgICAgaWYgKGN1cnJlbnRUZXh0SGVpZ2h0ID4gY3VycmVudFRleHRDb250YWluZXJIZWlnaHQpIHtcbiAgICAgICAgbGV0IGRlY3JlYXNlRm9udFNpemUgPSB0cnVlO1xuICAgICAgICB3aGlsZSAoZGVjcmVhc2VGb250U2l6ZSkge1xuXG4gICAgICAgICAgZm9udFNpemUgLT0gQ2FyZC5TQ0FMRUlOVEVSVkFMO1xuXG4gICAgICAgICAgaWYgKGZvbnRTaXplIDwgQ2FyZC5NSU5TQ0FMRSkge1xuICAgICAgICAgICAgZGVjcmVhc2VGb250U2l6ZSA9IGZhbHNlO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgJHRleHQuY3NzKCdmb250LXNpemUnLCAoZm9udFNpemUgLyBwYXJlbnRGb250U2l6ZSkgKyAnZW0nKTtcblxuICAgICAgICAgIGN1cnJlbnRUZXh0SGVpZ2h0ID0gJHRleHQuZ2V0KDApLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmhlaWdodDtcbiAgICAgICAgICBpZiAoY3VycmVudFRleHRIZWlnaHQgPD0gY3VycmVudFRleHRDb250YWluZXJIZWlnaHQpIHtcbiAgICAgICAgICAgIGRlY3JlYXNlRm9udFNpemUgPSBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgfVxuICAgICAgZWxzZSB7IC8vIEluY3JlYXNlIGZvbnQgc2l6ZVxuICAgICAgICBsZXQgaW5jcmVhc2VGb250U2l6ZSA9IHRydWU7XG4gICAgICAgIHdoaWxlIChpbmNyZWFzZUZvbnRTaXplKSB7XG4gICAgICAgICAgZm9udFNpemUgKz0gQ2FyZC5TQ0FMRUlOVEVSVkFMO1xuXG4gICAgICAgICAgLy8gQ2FwIGF0ICAxNnB4XG4gICAgICAgICAgaWYgKGZvbnRTaXplID4gbWFpbkZvbnRTaXplKSB7XG4gICAgICAgICAgICBpbmNyZWFzZUZvbnRTaXplID0gZmFsc2U7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBTZXQgcmVsYXRpdmUgZm9udCBzaXplIHRvIHNjYWxlIHdpdGggZnVsbCBzY3JlZW4uXG4gICAgICAgICAgJHRleHQuY3NzKCdmb250LXNpemUnLCBmb250U2l6ZSAvIHBhcmVudEZvbnRTaXplICsgJ2VtJyk7XG4gICAgICAgICAgY3VycmVudFRleHRIZWlnaHQgPSAkdGV4dC5nZXQoMCkuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkuaGVpZ2h0O1xuICAgICAgICAgIGlmIChjdXJyZW50VGV4dEhlaWdodCA+PSBjdXJyZW50VGV4dENvbnRhaW5lckhlaWdodCkge1xuICAgICAgICAgICAgaW5jcmVhc2VGb250U2l6ZSA9IGZhbHNlO1xuICAgICAgICAgICAgZm9udFNpemUgPSBmb250U2l6ZSAtIENhcmQuU0NBTEVJTlRFUlZBTDtcbiAgICAgICAgICAgICR0ZXh0LmNzcygnZm9udC1zaXplJywgZm9udFNpemUgLyBwYXJlbnRGb250U2l6ZSArICdlbScpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBBZGRzIHRpcCB0byBhIGNhcmRcbiAgICpcbiAgICogQHBhcmFtIHtqUXVlcnl9ICRjYXJkIFRoZSBjYXJkXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBbc2lkZT1mcm9udF0gV2hpY2ggc2lkZSBvZiB0aGUgY2FyZFxuICAgKiBAcGFyYW0ge051bWJlcn0gW2luZGV4XSBJbmRleCBvZiBjYXJkXG4gICAqL1xuICBhZGRUaXBUb0NhcmQoJGNhcmQsIHNpZGUsIGluZGV4KSB7XG4gICAgLy8gTWFrZSBzdXJlIHdlIGhhdmUgYSBzaWRlXG4gICAgaWYgKHNpZGUgIT09ICdiYWNrJykge1xuICAgICAgc2lkZSA9ICdmcm9udCc7XG4gICAgfVxuXG4gICAgLy8gTWFrZSBzdXJlIHdlIGhhdmUgYW4gaW5kZXhcblxuICAgIGlmIChpbmRleCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBpbmRleCA9IHRoaXMuaWQ7XG4gICAgfVxuXG4gICAgLy8gUmVtb3ZlIGFueSBvbGQgdGlwc1xuICAgICRjYXJkLmZpbmQoJy5qb3ViZWwtdGlwLWNvbnRhaW5lcicpLnJlbW92ZSgpO1xuXG4gICAgLy8gQWRkIG5ldyB0aXAgaWYgc2V0IGFuZCBoYXMgbGVuZ3RoIGFmdGVyIHRyaW1cbiAgICBjb25zdCB0aXAgPSAodGhpcy5jYXJkW3NpZGVdLnRpcCB8fCAnJykudHJpbSgpO1xuICAgIGlmICh0aXAubGVuZ3RoKSB7XG4gICAgICAkY2FyZC5maW5kKCcuaDVwLWRpYWxvZ2NhcmRzLWNhcmQtdGV4dC13cmFwcGVyIC5oNXAtZGlhbG9nY2FyZHMtY2FyZC10ZXh0LWlubmVyJylcbiAgICAgICAgLmFmdGVyKEg1UC5Kb3ViZWxVSS5jcmVhdGVUaXAodGlwLCB7XG4gICAgICAgICAgdGlwTGFiZWw6IHRoaXMucGFyYW1zLnRpcEJ1dHRvbkxhYmVsXG4gICAgICAgIH0pKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2V0IGZvY3VzIHRvIGEgZ2l2ZW4gY2FyZC5cbiAgICogQHBhcmFtIHtib29sZWFufSBmb3JjZSBJZiB0cnVlLCBkb24ndCB3YWl0IGZvciB0cmFuc2l0aW9uLlxuICAgKi9cbiAgc2V0Q2FyZEZvY3VzKGZvcmNlKSB7XG4gICAgaWYgKGZvcmNlID09PSB0cnVlKSB7XG4gICAgICB0aGlzLiRjYXJkVGV4dEFyZWEuZm9jdXMoKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAvLyBXYWl0IGZvciB0cmFuc2l0aW9uLCB0aGVuIHNldCBmb2N1c1xuICAgICAgY29uc3QgJGNhcmQgPSB0aGlzLmdldERPTSgpO1xuICAgICAgJGNhcmQub25lKCd0cmFuc2l0aW9uZW5kJywgKCkgPT4ge1xuICAgICAgICAkY2FyZC5mb2N1cygpO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFN0b3AgYXVkaW8gb2YgY2FyZC5cbiAgICovXG4gIHN0b3BBdWRpbygpIHtcbiAgICBjb25zdCBzaWRlcyA9IFsnZnJvbnQnLCAnYmFjayddO1xuICAgIHNpZGVzLmZvckVhY2goc2lkZSA9PiB7XG4gICAgICBpZiAoIXRoaXMuYXVkaW9zW3NpZGVdIHx8ICF0aGlzLmF1ZGlvc1tzaWRlXS5hdWRpbykge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8qXG4gICAgICAgKiBXZSBuZWVkIHRvIHJlc2V0IHRoZSBhdWRpbyBidXR0b24gdG8gaXRzIGluaXRpYWwgdmlzdWFsIHN0YXRlLCBidXQgaXRcbiAgICAgICAqIGRvZXNuJ3QgaGF2ZSBhIGZ1bmN0aW9uIHRvIHRvIHRoYXQgLT4gZm9yY2UgZW5kZWQgZXZlbnQgYW5kIHJlbG9hZC5cbiAgICAgICAqL1xuICAgICAgaWYgKHRoaXMuYXVkaW9zW3NpZGVdLmF1ZGlvLmR1cmF0aW9uID4gMCkge1xuICAgICAgICB0aGlzLmF1ZGlvc1tzaWRlXS5hdWRpby5wYXVzZSgpO1xuICAgICAgICB0aGlzLmF1ZGlvc1tzaWRlXS5hdWRpby5jdXJyZW50VGltZSA9IE1hdGguZmxvb3IodGhpcy5hdWRpb3Nbc2lkZV0uYXVkaW8uZHVyYXRpb24pO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5hdWRpb3Nbc2lkZV0uYXVkaW8ubG9hZCkge1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICB0aGlzLmF1ZGlvc1tzaWRlXS5hdWRpby5sb2FkKCk7XG4gICAgICAgIH0sIDEwMCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGNhcmQncyBET01cbiAgICpcbiAgICogQHJldHVybiB7alF1ZXJ5fSBDYXJkJ3MgRE9NLlxuICAgKi9cbiAgZ2V0RE9NKCkge1xuICAgIHJldHVybiB0aGlzLiRjYXJkV3JhcHBlcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgbm8gdGV4dCBtb2RlLlxuICAgKi9cbiAgc2V0Tm9UZXh0KCkge1xuICAgIHRoaXMuZ2V0RE9NKCkuYWRkQ2xhc3MoJ2g1cC1uby10ZXh0Jyk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGNhcmQncyB0ZXh0LlxuICAgKlxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IENhcmQncyB0ZXh0LlxuICAgKi9cbiAgZ2V0VGV4dCgpIHtcbiAgICByZXR1cm4gdGhpcy5jYXJkLmZyb250LnRleHQ7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGNhcmQncyBhbnN3ZXIuXG4gICAqXG4gICAqIEByZXR1cm4ge3N0cmluZ30gQ2FyZCdzIGFuc3dlci5cbiAgICovXG4gIGdldEFuc3dlcigpIHtcbiAgICByZXR1cm4gdGhpcy5jYXJkLmJhY2sudGV4dDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgY2FyZCdzIGltYWdlIHdyYXBwZXIuXG4gICAqXG4gICAqIEByZXR1cm4ge2pRdWVyeX0gQ2FyZCdzIGltYWdlLlxuICAgKi9cbiAgZ2V0SW1hZ2VXcmFwcGVyKCkge1xuICAgIHJldHVybiB0aGlzLiRpbWFnZVdyYXBwZXI7XG4gIH1cblxuICAvKipcbiAgICogU2V0IGNhcmQgaW1hZ2UgaGVpZ2h0LlxuICAgKiBAcGFyYW0ge3N0cmluZ30gaGVpZ2h0IENTUyBoZWlnaHQgdmFsdWUuXG4gICAqL1xuICBzZXRJbWFnZUhlaWdodChoZWlnaHQpIHtcbiAgICB0aGlzLiRpbWFnZVdyYXBwZXIuY3NzKCdoZWlnaHQnLCBoZWlnaHQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjYXJkJ3MgQXVkaW8uXG4gICAqXG4gICAqIEByZXR1cm4ge0VsZW1lbnR9IENhcmQncyBhdWRpby5cbiAgICovXG4gIGdldEF1ZGlvKCkge1xuICAgIHJldHVybiB0aGlzLmlzVHVybmVkKCkgPyB0aGlzLiRhdWRpb1dyYXBwZXJzLmJhY2sgOiB0aGlzLiRhdWRpb1dyYXBwZXJzLmZyb250O1xuICB9XG5cbiAgLyoqXG4gICAqIERldGVjdCB3aGV0aGVyIGNhcmQgaXMgdHVybmVkLlxuICAgKiBAcmV0dXJuIHtib29sZWFufSBUcnVlLCBpZiBjYXJkIGlzIHR1cm5lZC5cbiAgICovXG4gIGlzVHVybmVkKCkge1xuICAgIHJldHVybiB0aGlzLmdldERPTSgpXG4gICAgICAuZmluZCgnLmg1cC1kaWFsb2djYXJkcy1jYXJkLWNvbnRlbnQnKVxuICAgICAgLmhhc0NsYXNzKCdoNXAtZGlhbG9nY2FyZHMtdHVybmVkJyk7XG4gIH1cblxuICAvKipcbiAgICogUmVzZXQgY2FyZC5cbiAgICovXG4gIHJlc2V0KCkge1xuICAgIGNvbnN0ICRjYXJkID0gdGhpcy5nZXRET00oKTtcblxuICAgICRjYXJkLnJlbW92ZUNsYXNzKCdoNXAtZGlhbG9nY2FyZHMtcHJldmlvdXMnKTtcbiAgICAkY2FyZC5yZW1vdmVDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLWN1cnJlbnQnKTtcblxuICAgIHRoaXMuY2hhbmdlVGV4dCh0aGlzLmdldFRleHQoKSk7XG5cbiAgICBjb25zdCAkY2FyZENvbnRlbnQgPSAkY2FyZC5maW5kKCcuaDVwLWRpYWxvZ2NhcmRzLWNhcmQtY29udGVudCcpO1xuICAgICRjYXJkQ29udGVudC5yZW1vdmVDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLXR1cm5lZCcpO1xuICAgIHRoaXMuYWRkVGlwVG9DYXJkKCRjYXJkQ29udGVudCwgJ2Zyb250JywgdGhpcy5pZCk7XG5cbiAgICBpZiAoIXRoaXMucGFyYW1zLmJlaGF2aW91ci5xdWlja1Byb2dyZXNzaW9uKSB7XG4gICAgICAkY2FyZC5maW5kKCcuaDVwLWRpYWxvZ2NhcmRzLWFuc3dlci1idXR0b24nKS5yZW1vdmVDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLXF1aWNrLXByb2dyZXNzaW9uJyk7XG4gICAgfVxuICAgIHRoaXMuaGlkZVN1bW1hcnlCdXR0b24oKTtcbiAgfVxufVxuXG4vLyBDb25zdGFudHNcbkNhcmQuU0NBTEVJTlRFUlZBTCA9IDAuMjtcbkNhcmQuTUFYU0NBTEUgPSAxNjtcbkNhcmQuTUlOU0NBTEUgPSA0O1xuXG5leHBvcnQgZGVmYXVsdCBDYXJkO1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/scripts/h5p-dialogcards-card.js\n");

/***/ }),

/***/ "./src/scripts/h5p-dialogcards-summary-screen.js":
/*!*******************************************************!*\
  !*** ./src/scripts/h5p-dialogcards-summary-screen.js ***!
  \*******************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\nvar SummaryScreen = /*#__PURE__*/function () {\n  /**\n   * @constructor\n   */\n  function SummaryScreen(params, callbacks) {\n    var _this = this;\n\n    this.params = params;\n    this.callbacks = callbacks;\n    this.currentCallback = callbacks.nextRound;\n    this.fields = [];\n    this.container = document.createElement('div');\n    this.container.classList.add('h5p-dialogcards-summary-screen');\n    var containerRound = this.createContainerDOM(params.summary);\n    this.fields['round'] = containerRound.getElementsByClassName('h5p-dialogcards-summary-subheader')[0];\n    this.fields['h5p-dialogcards-round-cards-right'] = this.addTableRow(containerRound, {\n      category: this.params.summaryCardsRight,\n      symbol: 'h5p-dialogcards-check'\n    });\n    this.fields['h5p-dialogcards-round-cards-wrong'] = this.addTableRow(containerRound, {\n      category: this.params.summaryCardsWrong,\n      symbol: 'h5p-dialogcards-times'\n    });\n    this.fields['h5p-dialogcards-round-cards-not-shown'] = this.addTableRow(containerRound, {\n      category: this.params.summaryCardsNotShown\n    });\n    var containerOverall = this.createContainerDOM(params.summaryOverallScore);\n    this.fields['h5p-dialogcards-overall-cards-completed'] = this.addTableRow(containerOverall, {\n      category: this.params.summaryCardsCompleted,\n      symbol: 'h5p-dialogcards-check'\n    });\n    this.fields['h5p-dialogcards-overall-completed-rounds'] = this.addTableRow(containerOverall, {\n      category: this.params.summaryCompletedRounds,\n      symbol: ''\n    });\n    var message = document.createElement('div');\n    message.classList.add('h5p-dialogcards-summary-message');\n    this.fields['message'] = message;\n    var buttonNextRound = H5P.JoubelUI.createButton({\n      'class': 'h5p-dialogcards-buttonNextRound',\n      'title': this.params.nextRound.replace('@round', 2),\n      'html': this.params.nextRound.replace('@round', 2)\n    }).click(this.currentCallback).get(0);\n    this.fields['button'] = buttonNextRound; // Button to start over including confirmation dialog\n\n    var buttonStartOver = H5P.JoubelUI.createButton({\n      'class': 'h5p-dialogcards-button-restart',\n      'title': this.params.startOver,\n      'html': this.params.startOver\n    }).get(0);\n    var confirmationDialog = this.createConfirmationDialog({\n      l10n: this.params.confirmStartingOver,\n      instance: this\n    }, function () {\n      // Stop interference with confirm dialog animation and goto animation\n      setTimeout(function () {\n        _this.callbacks.retry();\n      }, 100);\n    });\n    /*\n     * For some reason, using $.click to add the listener in the line above\n     * leads to losing the listener when button reappears on next summary screen\n     */\n\n    buttonStartOver.addEventListener('click', function (event) {\n      confirmationDialog.show(event.target.offsetTop);\n    });\n    this.fields['buttonStartOver'] = buttonStartOver; // Footer\n\n    var footer = document.createElement('div');\n    footer.classList.add('h5p-dialogcards-summary-footer');\n    footer.appendChild(buttonStartOver);\n    footer.appendChild(buttonNextRound);\n    this.container.appendChild(containerRound);\n    this.container.appendChild(containerOverall);\n    this.container.appendChild(message);\n    this.container.appendChild(footer);\n    this.hide();\n    return this;\n  }\n  /**\n   * Get DOM of summary screen.\n   * @return {object} Summary screen DOM.\n   */\n\n\n  var _proto = SummaryScreen.prototype;\n\n  _proto.getDOM = function getDOM() {\n    return this.container;\n  }\n  /**\n   * Create container DOM.\n   * @param {string} headerText Header text.\n   * @param {string} [subheaderText=''] Sub-Header text.\n   * @return {object} Container DOM.\n   */\n  ;\n\n  _proto.createContainerDOM = function createContainerDOM(headerText) {\n    var subheaderText = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n    var container = document.createElement('div');\n    container.classList.add('h5p-dialogcards-summary-container');\n    var header = document.createElement('div');\n    header.classList.add('h5p-dialogcards-summary-header');\n    header.innerHTML = headerText;\n    container.appendChild(header);\n    var subheader = document.createElement('div');\n    subheader.classList.add('h5p-dialogcards-summary-subheader');\n    subheader.innerHTML = subheaderText;\n    container.appendChild(subheader);\n    var table = document.createElement('table');\n    table.classList.add('h5p-dialogcards-summary-table');\n    container.appendChild(table);\n    return container;\n  }\n  /**\n   * Add row to a table.\n   * @param {object} container Container to add table to.\n   * @param {object} cols Columns.\n   * @param {string} cols.category Category text.\n   * @param {string} [cols.symbol=''] Symbol.\n   * @param {object} [cols.score] Score value and maximum value.\n   * @param {number|string} [cols.score.value=''] Value.\n   * @param {number|string} [cols.score.max] Maximum value.\n   * @return {object} Score field for updating later.\n   */\n  ;\n\n  _proto.addTableRow = function addTableRow(container, cols) {\n    var table = container.getElementsByClassName('h5p-dialogcards-summary-table')[0];\n    var row = document.createElement('tr');\n    var category = document.createElement('td');\n    category.classList.add('h5p-dialogcards-summary-table-row-category');\n    category.innerHTML = cols.category;\n    row.appendChild(category);\n    var symbol = document.createElement('td');\n    symbol.classList.add('h5p-dialogcards-summary-table-row-symbol');\n\n    if (cols.symbol !== undefined && cols.symbol !== '') {\n      symbol.classList.add(cols.symbol);\n    }\n\n    row.appendChild(symbol);\n    var score = document.createElement('td');\n    score.classList.add('h5p-dialogcards-summary-table-row-score');\n    row.appendChild(score);\n    table.appendChild(row);\n    return score;\n  }\n  /**\n   * Update fields.\n   * @param {object} [args] Arguments.\n   * @param {boolean} [args.done] If true, learner is done.\n   * @param {number} [args.round] Round number.\n   * @param {string} [args.message] Message text.\n   * @param {object[]} [args.results] Results.\n   * @param {string} [args.results.field] Field identifier.\n   * @param {object} [args.results.score] Score for field.\n   * @param {number} [args.results.score.value] Score value for field.\n   * @param {number} [args.results.score.max] Score max value for field.\n   */\n  ;\n\n  _proto.update = function update() {\n    var _this2 = this;\n\n    var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n        _ref$done = _ref.done,\n        done = _ref$done === void 0 ? false : _ref$done,\n        _ref$round = _ref.round,\n        round = _ref$round === void 0 ? undefined : _ref$round,\n        _ref$message = _ref.message,\n        message = _ref$message === void 0 ? undefined : _ref$message,\n        _ref$results = _ref.results,\n        results = _ref$results === void 0 ? [] : _ref$results;\n\n    if (done === true) {\n      this.fields['buttonStartOver'].classList.add('h5p-dialogcards-button-gone');\n\n      if (this.params.behaviour.enableRetry) {\n        this.fields['button'].classList.remove('h5p-dialogcards-button-next-round');\n        this.fields['button'].classList.add('h5p-dialogcards-button-restart');\n        this.fields['button'].innerHTML = this.params.retry;\n        this.fields['button'].title = this.params.retry;\n        this.currentCallback = this.callbacks.retry;\n      } else {\n        this.fields['button'].classList.add('h5p-dialogcards-button-gone');\n      }\n    } else {\n      this.fields['buttonStartOver'].classList.remove('h5p-dialogcards-button-gone');\n      this.fields['button'].classList.add('h5p-dialogcards-button-next-round');\n      this.fields['button'].classList.remove('h5p-dialogcards-button-restart');\n      this.fields['button'].innerHTML = this.params.nextRound;\n      this.fields['button'].title = this.params.nextRound;\n      this.currentCallback = this.callbacks.nextRound;\n    }\n\n    H5P.jQuery(this.fields['button']).unbind('click').click(this.currentCallback);\n    this.fields['round'].innerHTML = this.params.round.replace('@round', round);\n\n    if (!done && round !== undefined) {\n      this.fields['button'].innerHTML = this.params.nextRound.replace('@round', round + 1);\n      this.fields['button'].title = this.params.nextRound.replace('@round', round + 1);\n    }\n\n    if (done && message !== undefined && message !== '') {\n      this.fields['message'].classList.remove('h5p-dialogcards-gone');\n      this.fields['message'].innerHTML = message;\n    } else {\n      this.fields['message'].classList.add('h5p-dialogcards-gone');\n    }\n\n    results.forEach(function (result) {\n      var scoreHTML = result.score.value !== undefined ? result.score.value : '';\n\n      if (result.score.max !== undefined) {\n        scoreHTML = \"\".concat(scoreHTML, \"&nbsp;<span class=\\\"h5p-dialogcards-summary-table-row-score-divider\\\">/</span>&nbsp;\").concat(result.score.max);\n      }\n\n      _this2.fields[result.field].innerHTML = scoreHTML;\n    });\n  }\n  /**\n   * Show DOM.\n   */\n  ;\n\n  _proto.show = function show() {\n    this.container.classList.remove('h5p-dialogcards-gone');\n    this.fields['button'].focus();\n  }\n  /**\n   * Hide DOM.\n   */\n  ;\n\n  _proto.hide = function hide() {\n    this.container.classList.add('h5p-dialogcards-gone');\n  }\n  /**\n   * Add confirmation dialog to button.\n   * @param {object} options Dialog options.\n   * @param {function} clicked Callback for confirmation button.\n   * @return {H5P.ConfirmationDialog|undefined} Confirmation dialog.\n   */\n  ;\n\n  _proto.createConfirmationDialog = function createConfirmationDialog(options, clicked) {\n    options = options || {};\n    var confirmationDialog = new H5P.ConfirmationDialog({\n      instance: options.instance,\n      headerText: options.l10n.header,\n      dialogText: options.l10n.body,\n      cancelText: options.l10n.cancelLabel,\n      confirmText: options.l10n.confirmLabel\n    });\n    confirmationDialog.on('confirmed', function () {\n      clicked();\n    });\n    confirmationDialog.appendTo(this.getContainer());\n    return confirmationDialog;\n  }\n  /**\n   * Find container to attach dialogs to.\n   * @return {HTMLElement} Container to attach dialogs to.\n   */\n  ;\n\n  _proto.getContainer = function getContainer() {\n    var $content = H5P.jQuery('[data-content-id=\"' + self.contentId + '\"].h5p-content');\n    var $containerParents = $content.parents('.h5p-container');\n    var $container;\n\n    if ($containerParents.length !== 0) {\n      // use parent highest up if any\n      $container = $containerParents.last();\n    } else if ($content.length !== 0) {\n      $container = $content;\n    } else {\n      $container = H5P.jQuery(document.body);\n    }\n\n    return $container.get(0);\n  };\n\n  return SummaryScreen;\n}();\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (SummaryScreen);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvc2NyaXB0cy9oNXAtZGlhbG9nY2FyZHMtc3VtbWFyeS1zY3JlZW4uanMuanMiLCJtYXBwaW5ncyI6IjtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTs7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFNQTs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBTUE7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBQ0E7QUFDQTtBQUNBO0FBRUE7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTs7QUFDQTtBQUNBO0FBQ0E7O0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQUE7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBOztBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFDQTtBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUNBO0FBQ0E7QUFDQTs7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFMQTtBQVFBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFFQTs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBOztBQUVBO0FBQ0E7Ozs7O0FBR0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9oNXAtZGlhbG9nY2FyZHMvLi9zcmMvc2NyaXB0cy9oNXAtZGlhbG9nY2FyZHMtc3VtbWFyeS1zY3JlZW4uanM/YjFmZSJdLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBTdW1tYXJ5U2NyZWVuIHtcbiAgLyoqXG4gICAqIEBjb25zdHJ1Y3RvclxuICAgKi9cbiAgY29uc3RydWN0b3IocGFyYW1zLCBjYWxsYmFja3MpIHtcbiAgICB0aGlzLnBhcmFtcyA9IHBhcmFtcztcbiAgICB0aGlzLmNhbGxiYWNrcyA9IGNhbGxiYWNrcztcblxuICAgIHRoaXMuY3VycmVudENhbGxiYWNrID0gY2FsbGJhY2tzLm5leHRSb3VuZDtcblxuICAgIHRoaXMuZmllbGRzID0gW107XG5cbiAgICB0aGlzLmNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2g1cC1kaWFsb2djYXJkcy1zdW1tYXJ5LXNjcmVlbicpO1xuXG4gICAgY29uc3QgY29udGFpbmVyUm91bmQgPSB0aGlzLmNyZWF0ZUNvbnRhaW5lckRPTShwYXJhbXMuc3VtbWFyeSk7XG4gICAgdGhpcy5maWVsZHNbJ3JvdW5kJ10gPSBjb250YWluZXJSb3VuZC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdoNXAtZGlhbG9nY2FyZHMtc3VtbWFyeS1zdWJoZWFkZXInKVswXTtcblxuICAgIHRoaXMuZmllbGRzWydoNXAtZGlhbG9nY2FyZHMtcm91bmQtY2FyZHMtcmlnaHQnXSA9IHRoaXMuYWRkVGFibGVSb3coXG4gICAgICBjb250YWluZXJSb3VuZCwge2NhdGVnb3J5OiB0aGlzLnBhcmFtcy5zdW1tYXJ5Q2FyZHNSaWdodCwgc3ltYm9sOiAnaDVwLWRpYWxvZ2NhcmRzLWNoZWNrJ30pO1xuICAgIHRoaXMuZmllbGRzWydoNXAtZGlhbG9nY2FyZHMtcm91bmQtY2FyZHMtd3JvbmcnXSA9IHRoaXMuYWRkVGFibGVSb3coXG4gICAgICBjb250YWluZXJSb3VuZCwge2NhdGVnb3J5OiB0aGlzLnBhcmFtcy5zdW1tYXJ5Q2FyZHNXcm9uZywgc3ltYm9sOiAnaDVwLWRpYWxvZ2NhcmRzLXRpbWVzJ30pO1xuICAgIHRoaXMuZmllbGRzWydoNXAtZGlhbG9nY2FyZHMtcm91bmQtY2FyZHMtbm90LXNob3duJ10gPSB0aGlzLmFkZFRhYmxlUm93KFxuICAgICAgY29udGFpbmVyUm91bmQsIHtjYXRlZ29yeTogdGhpcy5wYXJhbXMuc3VtbWFyeUNhcmRzTm90U2hvd259KTtcblxuICAgIGNvbnN0IGNvbnRhaW5lck92ZXJhbGwgPSB0aGlzLmNyZWF0ZUNvbnRhaW5lckRPTShwYXJhbXMuc3VtbWFyeU92ZXJhbGxTY29yZSk7XG4gICAgdGhpcy5maWVsZHNbJ2g1cC1kaWFsb2djYXJkcy1vdmVyYWxsLWNhcmRzLWNvbXBsZXRlZCddID0gdGhpcy5hZGRUYWJsZVJvdyhcbiAgICAgIGNvbnRhaW5lck92ZXJhbGwsIHtjYXRlZ29yeTogdGhpcy5wYXJhbXMuc3VtbWFyeUNhcmRzQ29tcGxldGVkLCBzeW1ib2w6ICdoNXAtZGlhbG9nY2FyZHMtY2hlY2snfSk7XG4gICAgdGhpcy5maWVsZHNbJ2g1cC1kaWFsb2djYXJkcy1vdmVyYWxsLWNvbXBsZXRlZC1yb3VuZHMnXSA9IHRoaXMuYWRkVGFibGVSb3coXG4gICAgICBjb250YWluZXJPdmVyYWxsLCB7Y2F0ZWdvcnk6IHRoaXMucGFyYW1zLnN1bW1hcnlDb21wbGV0ZWRSb3VuZHMsIHN5bWJvbDogJyd9KTtcblxuICAgIGNvbnN0IG1lc3NhZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBtZXNzYWdlLmNsYXNzTGlzdC5hZGQoJ2g1cC1kaWFsb2djYXJkcy1zdW1tYXJ5LW1lc3NhZ2UnKTtcblxuICAgIHRoaXMuZmllbGRzWydtZXNzYWdlJ10gPSBtZXNzYWdlO1xuXG4gICAgY29uc3QgYnV0dG9uTmV4dFJvdW5kID0gSDVQLkpvdWJlbFVJLmNyZWF0ZUJ1dHRvbih7XG4gICAgICAnY2xhc3MnOiAnaDVwLWRpYWxvZ2NhcmRzLWJ1dHRvbk5leHRSb3VuZCcsXG4gICAgICAndGl0bGUnOiB0aGlzLnBhcmFtcy5uZXh0Um91bmQucmVwbGFjZSgnQHJvdW5kJywgMiksXG4gICAgICAnaHRtbCc6IHRoaXMucGFyYW1zLm5leHRSb3VuZC5yZXBsYWNlKCdAcm91bmQnLCAyKVxuICAgIH0pLmNsaWNrKHRoaXMuY3VycmVudENhbGxiYWNrKS5nZXQoMCk7XG5cbiAgICB0aGlzLmZpZWxkc1snYnV0dG9uJ10gPSBidXR0b25OZXh0Um91bmQ7XG5cbiAgICAvLyBCdXR0b24gdG8gc3RhcnQgb3ZlciBpbmNsdWRpbmcgY29uZmlybWF0aW9uIGRpYWxvZ1xuICAgIGNvbnN0IGJ1dHRvblN0YXJ0T3ZlciA9IEg1UC5Kb3ViZWxVSS5jcmVhdGVCdXR0b24oe1xuICAgICAgJ2NsYXNzJzogJ2g1cC1kaWFsb2djYXJkcy1idXR0b24tcmVzdGFydCcsXG4gICAgICAndGl0bGUnOiB0aGlzLnBhcmFtcy5zdGFydE92ZXIsXG4gICAgICAnaHRtbCc6IHRoaXMucGFyYW1zLnN0YXJ0T3ZlclxuICAgIH0pLmdldCgwKTtcblxuICAgIGNvbnN0IGNvbmZpcm1hdGlvbkRpYWxvZyA9IHRoaXMuY3JlYXRlQ29uZmlybWF0aW9uRGlhbG9nKHtcbiAgICAgIGwxMG46IHRoaXMucGFyYW1zLmNvbmZpcm1TdGFydGluZ092ZXIsXG4gICAgICBpbnN0YW5jZTogdGhpc1xuICAgIH0sICgpID0+IHtcbiAgICAgIC8vIFN0b3AgaW50ZXJmZXJlbmNlIHdpdGggY29uZmlybSBkaWFsb2cgYW5pbWF0aW9uIGFuZCBnb3RvIGFuaW1hdGlvblxuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHRoaXMuY2FsbGJhY2tzLnJldHJ5KCk7XG4gICAgICB9LCAxMDApO1xuICAgIH0pO1xuXG4gICAgLypcbiAgICAgKiBGb3Igc29tZSByZWFzb24sIHVzaW5nICQuY2xpY2sgdG8gYWRkIHRoZSBsaXN0ZW5lciBpbiB0aGUgbGluZSBhYm92ZVxuICAgICAqIGxlYWRzIHRvIGxvc2luZyB0aGUgbGlzdGVuZXIgd2hlbiBidXR0b24gcmVhcHBlYXJzIG9uIG5leHQgc3VtbWFyeSBzY3JlZW5cbiAgICAgKi9cbiAgICBidXR0b25TdGFydE92ZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXZlbnQpID0+IHtcbiAgICAgIGNvbmZpcm1hdGlvbkRpYWxvZy5zaG93KGV2ZW50LnRhcmdldC5vZmZzZXRUb3ApO1xuICAgIH0pO1xuXG4gICAgdGhpcy5maWVsZHNbJ2J1dHRvblN0YXJ0T3ZlciddID0gYnV0dG9uU3RhcnRPdmVyO1xuXG4gICAgLy8gRm9vdGVyXG4gICAgY29uc3QgZm9vdGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgZm9vdGVyLmNsYXNzTGlzdC5hZGQoJ2g1cC1kaWFsb2djYXJkcy1zdW1tYXJ5LWZvb3RlcicpO1xuICAgIGZvb3Rlci5hcHBlbmRDaGlsZChidXR0b25TdGFydE92ZXIpO1xuICAgIGZvb3Rlci5hcHBlbmRDaGlsZChidXR0b25OZXh0Um91bmQpO1xuXG4gICAgdGhpcy5jb250YWluZXIuYXBwZW5kQ2hpbGQoY29udGFpbmVyUm91bmQpO1xuICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKGNvbnRhaW5lck92ZXJhbGwpO1xuICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKG1lc3NhZ2UpO1xuICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKGZvb3Rlcik7XG5cbiAgICB0aGlzLmhpZGUoKTtcblxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBET00gb2Ygc3VtbWFyeSBzY3JlZW4uXG4gICAqIEByZXR1cm4ge29iamVjdH0gU3VtbWFyeSBzY3JlZW4gRE9NLlxuICAgKi9cbiAgZ2V0RE9NKCkge1xuICAgIHJldHVybiB0aGlzLmNvbnRhaW5lcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgY29udGFpbmVyIERPTS5cbiAgICogQHBhcmFtIHtzdHJpbmd9IGhlYWRlclRleHQgSGVhZGVyIHRleHQuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBbc3ViaGVhZGVyVGV4dD0nJ10gU3ViLUhlYWRlciB0ZXh0LlxuICAgKiBAcmV0dXJuIHtvYmplY3R9IENvbnRhaW5lciBET00uXG4gICAqL1xuICBjcmVhdGVDb250YWluZXJET00oaGVhZGVyVGV4dCwgc3ViaGVhZGVyVGV4dCA9ICcnKSB7XG4gICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2g1cC1kaWFsb2djYXJkcy1zdW1tYXJ5LWNvbnRhaW5lcicpO1xuXG4gICAgY29uc3QgaGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgaGVhZGVyLmNsYXNzTGlzdC5hZGQoJ2g1cC1kaWFsb2djYXJkcy1zdW1tYXJ5LWhlYWRlcicpO1xuICAgIGhlYWRlci5pbm5lckhUTUwgPSBoZWFkZXJUZXh0O1xuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChoZWFkZXIpO1xuXG4gICAgY29uc3Qgc3ViaGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgc3ViaGVhZGVyLmNsYXNzTGlzdC5hZGQoJ2g1cC1kaWFsb2djYXJkcy1zdW1tYXJ5LXN1YmhlYWRlcicpO1xuICAgIHN1YmhlYWRlci5pbm5lckhUTUwgPSBzdWJoZWFkZXJUZXh0O1xuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChzdWJoZWFkZXIpO1xuXG4gICAgY29uc3QgdGFibGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0YWJsZScpO1xuICAgIHRhYmxlLmNsYXNzTGlzdC5hZGQoJ2g1cC1kaWFsb2djYXJkcy1zdW1tYXJ5LXRhYmxlJyk7XG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHRhYmxlKTtcblxuICAgIHJldHVybiBjb250YWluZXI7XG4gIH1cblxuICAvKipcbiAgICogQWRkIHJvdyB0byBhIHRhYmxlLlxuICAgKiBAcGFyYW0ge29iamVjdH0gY29udGFpbmVyIENvbnRhaW5lciB0byBhZGQgdGFibGUgdG8uXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBjb2xzIENvbHVtbnMuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBjb2xzLmNhdGVnb3J5IENhdGVnb3J5IHRleHQuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBbY29scy5zeW1ib2w9JyddIFN5bWJvbC5cbiAgICogQHBhcmFtIHtvYmplY3R9IFtjb2xzLnNjb3JlXSBTY29yZSB2YWx1ZSBhbmQgbWF4aW11bSB2YWx1ZS5cbiAgICogQHBhcmFtIHtudW1iZXJ8c3RyaW5nfSBbY29scy5zY29yZS52YWx1ZT0nJ10gVmFsdWUuXG4gICAqIEBwYXJhbSB7bnVtYmVyfHN0cmluZ30gW2NvbHMuc2NvcmUubWF4XSBNYXhpbXVtIHZhbHVlLlxuICAgKiBAcmV0dXJuIHtvYmplY3R9IFNjb3JlIGZpZWxkIGZvciB1cGRhdGluZyBsYXRlci5cbiAgICovXG4gIGFkZFRhYmxlUm93KGNvbnRhaW5lciwgY29scykge1xuICAgIGNvbnN0IHRhYmxlID0gY29udGFpbmVyLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2g1cC1kaWFsb2djYXJkcy1zdW1tYXJ5LXRhYmxlJylbMF07XG5cbiAgICBjb25zdCByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpO1xuXG4gICAgY29uc3QgY2F0ZWdvcnkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuICAgIGNhdGVnb3J5LmNsYXNzTGlzdC5hZGQoJ2g1cC1kaWFsb2djYXJkcy1zdW1tYXJ5LXRhYmxlLXJvdy1jYXRlZ29yeScpO1xuICAgIGNhdGVnb3J5LmlubmVySFRNTCA9IGNvbHMuY2F0ZWdvcnk7XG4gICAgcm93LmFwcGVuZENoaWxkKGNhdGVnb3J5KTtcblxuICAgIGNvbnN0IHN5bWJvbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG4gICAgc3ltYm9sLmNsYXNzTGlzdC5hZGQoJ2g1cC1kaWFsb2djYXJkcy1zdW1tYXJ5LXRhYmxlLXJvdy1zeW1ib2wnKTtcbiAgICBpZiAoY29scy5zeW1ib2wgIT09IHVuZGVmaW5lZCAmJiBjb2xzLnN5bWJvbCAhPT0gJycpIHtcbiAgICAgIHN5bWJvbC5jbGFzc0xpc3QuYWRkKGNvbHMuc3ltYm9sKTtcbiAgICB9XG4gICAgcm93LmFwcGVuZENoaWxkKHN5bWJvbCk7XG5cbiAgICBjb25zdCBzY29yZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG4gICAgc2NvcmUuY2xhc3NMaXN0LmFkZCgnaDVwLWRpYWxvZ2NhcmRzLXN1bW1hcnktdGFibGUtcm93LXNjb3JlJyk7XG4gICAgcm93LmFwcGVuZENoaWxkKHNjb3JlKTtcblxuICAgIHRhYmxlLmFwcGVuZENoaWxkKHJvdyk7XG5cbiAgICByZXR1cm4gc2NvcmU7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIGZpZWxkcy5cbiAgICogQHBhcmFtIHtvYmplY3R9IFthcmdzXSBBcmd1bWVudHMuXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2FyZ3MuZG9uZV0gSWYgdHJ1ZSwgbGVhcm5lciBpcyBkb25lLlxuICAgKiBAcGFyYW0ge251bWJlcn0gW2FyZ3Mucm91bmRdIFJvdW5kIG51bWJlci5cbiAgICogQHBhcmFtIHtzdHJpbmd9IFthcmdzLm1lc3NhZ2VdIE1lc3NhZ2UgdGV4dC5cbiAgICogQHBhcmFtIHtvYmplY3RbXX0gW2FyZ3MucmVzdWx0c10gUmVzdWx0cy5cbiAgICogQHBhcmFtIHtzdHJpbmd9IFthcmdzLnJlc3VsdHMuZmllbGRdIEZpZWxkIGlkZW50aWZpZXIuXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBbYXJncy5yZXN1bHRzLnNjb3JlXSBTY29yZSBmb3IgZmllbGQuXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBbYXJncy5yZXN1bHRzLnNjb3JlLnZhbHVlXSBTY29yZSB2YWx1ZSBmb3IgZmllbGQuXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBbYXJncy5yZXN1bHRzLnNjb3JlLm1heF0gU2NvcmUgbWF4IHZhbHVlIGZvciBmaWVsZC5cbiAgICovXG4gIHVwZGF0ZSh7ZG9uZSA9IGZhbHNlLCByb3VuZCA9IHVuZGVmaW5lZCwgbWVzc2FnZSA9IHVuZGVmaW5lZCwgcmVzdWx0cyA9IFtdfSA9IHt9KSB7XG4gICAgaWYgKGRvbmUgPT09IHRydWUpIHtcbiAgICAgIHRoaXMuZmllbGRzWydidXR0b25TdGFydE92ZXInXS5jbGFzc0xpc3QuYWRkKCdoNXAtZGlhbG9nY2FyZHMtYnV0dG9uLWdvbmUnKTtcblxuICAgICAgaWYgKHRoaXMucGFyYW1zLmJlaGF2aW91ci5lbmFibGVSZXRyeSkge1xuICAgICAgICB0aGlzLmZpZWxkc1snYnV0dG9uJ10uY2xhc3NMaXN0LnJlbW92ZSgnaDVwLWRpYWxvZ2NhcmRzLWJ1dHRvbi1uZXh0LXJvdW5kJyk7XG4gICAgICAgIHRoaXMuZmllbGRzWydidXR0b24nXS5jbGFzc0xpc3QuYWRkKCdoNXAtZGlhbG9nY2FyZHMtYnV0dG9uLXJlc3RhcnQnKTtcbiAgICAgICAgdGhpcy5maWVsZHNbJ2J1dHRvbiddLmlubmVySFRNTCA9IHRoaXMucGFyYW1zLnJldHJ5O1xuICAgICAgICB0aGlzLmZpZWxkc1snYnV0dG9uJ10udGl0bGUgPSB0aGlzLnBhcmFtcy5yZXRyeTtcbiAgICAgICAgdGhpcy5jdXJyZW50Q2FsbGJhY2sgPSB0aGlzLmNhbGxiYWNrcy5yZXRyeTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICB0aGlzLmZpZWxkc1snYnV0dG9uJ10uY2xhc3NMaXN0LmFkZCgnaDVwLWRpYWxvZ2NhcmRzLWJ1dHRvbi1nb25lJyk7XG4gICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgdGhpcy5maWVsZHNbJ2J1dHRvblN0YXJ0T3ZlciddLmNsYXNzTGlzdC5yZW1vdmUoJ2g1cC1kaWFsb2djYXJkcy1idXR0b24tZ29uZScpO1xuXG4gICAgICB0aGlzLmZpZWxkc1snYnV0dG9uJ10uY2xhc3NMaXN0LmFkZCgnaDVwLWRpYWxvZ2NhcmRzLWJ1dHRvbi1uZXh0LXJvdW5kJyk7XG4gICAgICB0aGlzLmZpZWxkc1snYnV0dG9uJ10uY2xhc3NMaXN0LnJlbW92ZSgnaDVwLWRpYWxvZ2NhcmRzLWJ1dHRvbi1yZXN0YXJ0Jyk7XG4gICAgICB0aGlzLmZpZWxkc1snYnV0dG9uJ10uaW5uZXJIVE1MID0gdGhpcy5wYXJhbXMubmV4dFJvdW5kO1xuICAgICAgdGhpcy5maWVsZHNbJ2J1dHRvbiddLnRpdGxlID0gdGhpcy5wYXJhbXMubmV4dFJvdW5kO1xuICAgICAgdGhpcy5jdXJyZW50Q2FsbGJhY2sgPSB0aGlzLmNhbGxiYWNrcy5uZXh0Um91bmQ7XG4gICAgfVxuICAgIEg1UC5qUXVlcnkodGhpcy5maWVsZHNbJ2J1dHRvbiddKS51bmJpbmQoJ2NsaWNrJykuY2xpY2sodGhpcy5jdXJyZW50Q2FsbGJhY2spO1xuXG4gICAgdGhpcy5maWVsZHNbJ3JvdW5kJ10uaW5uZXJIVE1MID0gdGhpcy5wYXJhbXMucm91bmQucmVwbGFjZSgnQHJvdW5kJywgcm91bmQpO1xuXG4gICAgaWYgKCFkb25lICYmIHJvdW5kICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHRoaXMuZmllbGRzWydidXR0b24nXS5pbm5lckhUTUwgPSB0aGlzLnBhcmFtcy5uZXh0Um91bmQucmVwbGFjZSgnQHJvdW5kJywgcm91bmQgKyAxKTtcbiAgICAgIHRoaXMuZmllbGRzWydidXR0b24nXS50aXRsZSA9IHRoaXMucGFyYW1zLm5leHRSb3VuZC5yZXBsYWNlKCdAcm91bmQnLCByb3VuZCArIDEpO1xuICAgIH1cblxuICAgIGlmIChkb25lICYmIG1lc3NhZ2UgIT09IHVuZGVmaW5lZCAmJiBtZXNzYWdlICE9PSAnJykge1xuICAgICAgdGhpcy5maWVsZHNbJ21lc3NhZ2UnXS5jbGFzc0xpc3QucmVtb3ZlKCdoNXAtZGlhbG9nY2FyZHMtZ29uZScpO1xuICAgICAgdGhpcy5maWVsZHNbJ21lc3NhZ2UnXS5pbm5lckhUTUwgPSBtZXNzYWdlO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHRoaXMuZmllbGRzWydtZXNzYWdlJ10uY2xhc3NMaXN0LmFkZCgnaDVwLWRpYWxvZ2NhcmRzLWdvbmUnKTtcbiAgICB9XG5cbiAgICByZXN1bHRzLmZvckVhY2gocmVzdWx0ID0+IHtcbiAgICAgIGxldCBzY29yZUhUTUwgPSAocmVzdWx0LnNjb3JlLnZhbHVlICE9PSB1bmRlZmluZWQpID8gcmVzdWx0LnNjb3JlLnZhbHVlIDogJyc7XG4gICAgICBpZiAocmVzdWx0LnNjb3JlLm1heCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHNjb3JlSFRNTCA9IGAke3Njb3JlSFRNTH0mbmJzcDs8c3BhbiBjbGFzcz1cImg1cC1kaWFsb2djYXJkcy1zdW1tYXJ5LXRhYmxlLXJvdy1zY29yZS1kaXZpZGVyXCI+Lzwvc3Bhbj4mbmJzcDske3Jlc3VsdC5zY29yZS5tYXh9YDtcbiAgICAgIH1cbiAgICAgIHRoaXMuZmllbGRzW3Jlc3VsdC5maWVsZF0uaW5uZXJIVE1MID0gc2NvcmVIVE1MO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFNob3cgRE9NLlxuICAgKi9cbiAgc2hvdygpIHtcbiAgICB0aGlzLmNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCdoNXAtZGlhbG9nY2FyZHMtZ29uZScpO1xuICAgIHRoaXMuZmllbGRzWydidXR0b24nXS5mb2N1cygpO1xuICB9XG5cbiAgLyoqXG4gICAqIEhpZGUgRE9NLlxuICAgKi9cbiAgaGlkZSgpIHtcbiAgICB0aGlzLmNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdoNXAtZGlhbG9nY2FyZHMtZ29uZScpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBjb25maXJtYXRpb24gZGlhbG9nIHRvIGJ1dHRvbi5cbiAgICogQHBhcmFtIHtvYmplY3R9IG9wdGlvbnMgRGlhbG9nIG9wdGlvbnMuXG4gICAqIEBwYXJhbSB7ZnVuY3Rpb259IGNsaWNrZWQgQ2FsbGJhY2sgZm9yIGNvbmZpcm1hdGlvbiBidXR0b24uXG4gICAqIEByZXR1cm4ge0g1UC5Db25maXJtYXRpb25EaWFsb2d8dW5kZWZpbmVkfSBDb25maXJtYXRpb24gZGlhbG9nLlxuICAgKi9cbiAgY3JlYXRlQ29uZmlybWF0aW9uRGlhbG9nKG9wdGlvbnMsIGNsaWNrZWQpIHtcbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcblxuICAgIHZhciBjb25maXJtYXRpb25EaWFsb2cgPSBuZXcgSDVQLkNvbmZpcm1hdGlvbkRpYWxvZyh7XG4gICAgICBpbnN0YW5jZTogb3B0aW9ucy5pbnN0YW5jZSxcbiAgICAgIGhlYWRlclRleHQ6IG9wdGlvbnMubDEwbi5oZWFkZXIsXG4gICAgICBkaWFsb2dUZXh0OiBvcHRpb25zLmwxMG4uYm9keSxcbiAgICAgIGNhbmNlbFRleHQ6IG9wdGlvbnMubDEwbi5jYW5jZWxMYWJlbCxcbiAgICAgIGNvbmZpcm1UZXh0OiBvcHRpb25zLmwxMG4uY29uZmlybUxhYmVsXG4gICAgfSk7XG5cbiAgICBjb25maXJtYXRpb25EaWFsb2cub24oJ2NvbmZpcm1lZCcsICgpID0+IHtcbiAgICAgIGNsaWNrZWQoKTtcbiAgICB9KTtcblxuICAgIGNvbmZpcm1hdGlvbkRpYWxvZy5hcHBlbmRUbyh0aGlzLmdldENvbnRhaW5lcigpKTtcblxuICAgIHJldHVybiBjb25maXJtYXRpb25EaWFsb2c7XG4gIH1cblxuICAvKipcbiAgICogRmluZCBjb250YWluZXIgdG8gYXR0YWNoIGRpYWxvZ3MgdG8uXG4gICAqIEByZXR1cm4ge0hUTUxFbGVtZW50fSBDb250YWluZXIgdG8gYXR0YWNoIGRpYWxvZ3MgdG8uXG4gICAqL1xuICBnZXRDb250YWluZXIoKSB7XG4gICAgY29uc3QgJGNvbnRlbnQgPSBINVAualF1ZXJ5KCdbZGF0YS1jb250ZW50LWlkPVwiJyArIHNlbGYuY29udGVudElkICsgJ1wiXS5oNXAtY29udGVudCcpO1xuICAgIGNvbnN0ICRjb250YWluZXJQYXJlbnRzID0gJGNvbnRlbnQucGFyZW50cygnLmg1cC1jb250YWluZXInKTtcblxuICAgIGxldCAkY29udGFpbmVyO1xuICAgIGlmICgkY29udGFpbmVyUGFyZW50cy5sZW5ndGggIT09IDApIHtcbiAgICAgIC8vIHVzZSBwYXJlbnQgaGlnaGVzdCB1cCBpZiBhbnlcbiAgICAgICRjb250YWluZXIgPSAkY29udGFpbmVyUGFyZW50cy5sYXN0KCk7XG4gICAgfVxuICAgIGVsc2UgaWYgKCRjb250ZW50Lmxlbmd0aCAhPT0gMCkge1xuICAgICAgJGNvbnRhaW5lciA9ICRjb250ZW50O1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICRjb250YWluZXIgPSBINVAualF1ZXJ5KGRvY3VtZW50LmJvZHkpO1xuICAgIH1cblxuICAgIHJldHVybiAkY29udGFpbmVyLmdldCgwKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBTdW1tYXJ5U2NyZWVuO1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/scripts/h5p-dialogcards-summary-screen.js\n");

/***/ }),

/***/ "./src/scripts/h5p-dialogcards.js":
/*!****************************************!*\
  !*** ./src/scripts/h5p-dialogcards.js ***!
  \****************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _h5p_dialogcards_card_manager__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./h5p-dialogcards-card-manager */ \"./src/scripts/h5p-dialogcards-card-manager.js\");\n/* harmony import */ var _h5p_dialogcards_summary_screen__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./h5p-dialogcards-summary-screen */ \"./src/scripts/h5p-dialogcards-summary-screen.js\");\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\n\n\nvar $ = H5P.jQuery;\nvar JoubelUI = H5P.JoubelUI;\n\nvar Dialogcards = /*#__PURE__*/function (_H5P$EventDispatcher) {\n  _inheritsLoose(Dialogcards, _H5P$EventDispatcher);\n\n  /**\n   * Initialize module.\n   *\n   * @constructor\n   *\n   * @param {Object} params Parameters.\n   * @param {Number} id Content id.\n   * @param {Object} contentData Content data, e.g. for saveContentState\n   * @returns {DialogCards} self\n   */\n  function Dialogcards(params, id, contentData) {\n    var _this;\n\n    Dialogcards.idCounter++;\n    _this = _H5P$EventDispatcher.call(this) || this;\n    _this.contentId = _this.id = id;\n    _this.previousState = contentData.previousState || {}; // Var cardOrder stores order of cards to allow resuming of card set.\n    // Var progress stores current card index.\n\n    _this.contentData = contentData || {}; // Strip cards with empty sides\n\n    params.dialogs = params.dialogs || [];\n    params.dialogs = params.dialogs.filter(function (dialog) {\n      if (!dialog.front || !dialog.back) {\n        return false;\n      } // Empty front?\n\n\n      if (!dialog.front.text && !dialog.front.image && !dialog.front.audio) {\n        return false;\n      } // Empty back?\n\n\n      var noBackText = !dialog.back.text;\n      var noBackImage = dialog.back.useImageFromFront && !dialog.front.image || !dialog.back.useImageFromFront && !dialog.back.image;\n      var noBackAudio = dialog.back.useAudioFromFront && !dialog.front.audio || !dialog.back.useAudioFromFront && !dialog.back.audio;\n\n      if (noBackText && noBackImage && noBackAudio) {\n        return false;\n      }\n\n      return true;\n    }); // Set default behavior.\n\n    _this.params = $.extend(true, {\n      title: '',\n      mode: 'normal',\n      description: \"Sit in pairs and make up sentences where you include the expressions below.<br/>Example: I should have said yes, HOWEVER I kept my mouth shut.\",\n      next: \"Next\",\n      prev: \"Previous\",\n      retry: \"Retry\",\n      answer: \"Turn\",\n      correctAnswer: 'I got it right!',\n      incorrectAnswer: 'I got it wrong',\n      round: 'Round @round',\n      cardsLeft: 'Cards left: @number',\n      nextRound: 'Proceed to round @round',\n      startOver: 'Start over',\n      showSummary: 'Next',\n      summary: 'Summary',\n      summaryCardsRight: 'Cards you got right:',\n      summaryCardsWrong: 'Cards you got wrong:',\n      summaryCardsNotShown: 'Cards in pool not shown:',\n      summaryOverallScore: 'Overall Score',\n      summaryCardsCompleted: 'Cards you have completed learning:',\n      summaryCompletedRounds: 'Completed rounds:',\n      summaryAllDone: 'Well done! You got all @cards cards correct @max times in a row each!',\n      progressText: \"Card @card of @total\",\n      cardFrontLabel: \"Card front\",\n      cardBackLabel: \"Card back\",\n      tipButtonLabel: 'Show tip',\n      audioNotSupported: 'Your browser does not support this audio',\n      confirmStartingOver: {\n        header: 'Start over?',\n        body: 'All progress will be lost. Are you sure you want to start over?',\n        cancelLabel: 'Cancel',\n        confirmLabel: 'Start over'\n      },\n      dialogs: [{\n        front: {\n          text: 'Horse'\n        },\n        back: {\n          text: 'Hest',\n          useImageFromFront: true,\n          useAudioFromFront: false\n        }\n      } // {\n      //   front: {\n      //     text: 'Cow'\n      //   },\n      //   back: {\n      //     text: 'Ku',\n      //     useImageFromFront: true,\n      //     useAudioFromFront: false\n      //   }\n      // }\n      ],\n      behaviour: {\n        enableRetry: true,\n        disableBackwardsNavigation: false,\n        scaleTextNotCard: false,\n        randomCards: false,\n        maxProficiency: 5,\n        quickProgression: false\n      }\n    }, params); // Check for no texts at all\n\n    _this.hasNoTexts = _this.params.dialogs.every(function (dialog) {\n      return dialog.front.text === '' && dialog.back.text === '';\n    }); // Check for no audios at all\n\n    _this.hasNoAudios = !_this.params.dialogs.some(function (dialog) {\n      return dialog.front.audio || dialog.back.audio && !dialog.back.useAudioFromFront;\n    }); // TODO: Translations\n\n    _this.cards = [];\n    _this.currentCardId = 0;\n    _this.round = 0; // 0 indicates that DOM needs to be set up\n\n    _this.results = _this.previousState.results || []; // Workaround for iOS\n\n    if (screen.orientation) {\n      screen.orientation.addEventListener('change', function () {\n        _this.handleOrientationChange();\n      });\n    } else {\n      window.addEventListener('orientationchange', function () {\n        _this.handleOrientationChange();\n      });\n    }\n    /*\n     * Workaround (hopefully temporary) for KidsLoopLive that for whatever\n     * reason does not use h5p-resizer.js.\n     */\n\n\n    window.addEventListener('resize', function () {\n      _this.resize();\n    });\n    /**\n     * Attach h5p inside the given container.\n     *\n     * @param {jQuery} $container Container.\n     */\n\n    _this.attach = function ($container) {\n      _this.$inner = $container.addClass('h5p-dialogcards');\n\n      if (_this.params.behaviour.scaleTextNotCard) {\n        $container.addClass('h5p-text-scaling');\n      } // KidsLoop customization to prevent dragging the image\n\n\n      _this.$inner.get(0).addEventListener('dragstart', function (event) {\n        event.preventDefault();\n      }); // Only pass what's necessary\n\n\n      var managerParams = {\n        mode: _this.params.mode,\n        dialogs: _this.params.dialogs,\n        audioNotSupported: _this.params.audioNotSupported,\n        answer: _this.params.answer,\n        showSummary: _this.params.showSummary,\n        incorrectAnswer: _this.params.incorrectAnswer,\n        correctAnswer: _this.params.correctAnswer,\n        progressText: _this.params.progressText,\n        tipButtonLabel: _this.params.tipButtonLabel,\n        behaviour: {\n          scaleTextNotCard: _this.params.behaviour.scaleTextNotCard,\n          maxProficiency: _this.params.behaviour.maxProficiency,\n          quickProgression: _this.params.behaviour.quickProgression\n        },\n        cardPiles: _this.previousState.cardPiles\n      };\n      _this.cardManager = new _h5p_dialogcards_card_manager__WEBPACK_IMPORTED_MODULE_0__[\"default\"](managerParams, _this.id, {\n        onCardTurned: _this.handleCardTurned,\n        onNextCard: _this.nextCard\n      });\n\n      _this.createDOM(_this.round === 0);\n      /*\n       * Goto previously viewed card. It was possible to also recover the turned\n       * state, but it feels sensible to let the previously viewed card be\n       * reviewed starting with the front.\n       */\n\n\n      if (_this.previousState.currentCardId !== undefined) {\n        _this.gotoCard(_this.previousState.currentCardId); // Show summary if previous round was completed but next round not started.\n\n\n        if (_this.params.mode === 'repetition' && _this.results.length === _this.cardIds.length) {\n          _this.showSummary(true);\n        }\n      }\n\n      _this.updateNavigation();\n\n      _this.trigger('resize');\n    };\n    /**\n     * Create DOM.\n     * @param {boolean} firstCall Is first call?\n     */\n\n\n    _this.createDOM = function (firstCall) {\n      _this.cardIds = firstCall && _this.previousState.cardIds ? _this.previousState.cardIds : _this.cardManager.createSelection();\n      _this.cardPoolSize = _this.cardPoolSize || _this.cardManager.getSize();\n\n      if (firstCall === true) {\n        var title = $('<div>' + _this.params.title + '</div>').text().trim();\n        _this.$header = $((title ? '<div class=\"h5p-dialogcards-title\"><div class=\"h5p-dialogcards-title-inner\">' + _this.params.title + '</div></div>' : '') + '<div class=\"h5p-dialogcards-description\">' + _this.params.description + '</div>');\n        _this.summaryScreen = new _h5p_dialogcards_summary_screen__WEBPACK_IMPORTED_MODULE_1__[\"default\"](_this.params, {\n          nextRound: _this.nextRound,\n          retry: _this.restartRepetition\n        });\n      }\n\n      if (firstCall === true) {\n        _this.$cardwrapperSet = _this.initCards(_this.cardIds);\n      } else {\n        _this.$cardwrapperSet.detach();\n\n        _this.$cardwrapperSet = _this.initCards(_this.cardIds);\n\n        _this.$cardSideAnnouncer.before(_this.$cardwrapperSet);\n      }\n\n      _this.$cardwrapperSet.prepend(_this.summaryScreen.getDOM());\n\n      if (firstCall === true) {\n        _this.$cardSideAnnouncer = $('<div>', {\n          html: _this.params.cardFrontLabel,\n          'class': 'h5p-dialogcards-card-side-announcer',\n          'aria-live': 'polite',\n          'aria-hidden': 'true'\n        });\n        _this.$footer = _this.createFooter();\n        _this.$mainContent = $('<div>').append(_this.$header).append(_this.$cardwrapperSet).append(_this.$cardSideAnnouncer).append(_this.$footer).appendTo(_this.$inner); // No card has texts\n\n        if (_this.hasNoTexts) {\n          _this.cards.forEach(function (card) {\n            card.setNoText();\n          });\n        }\n\n        _this.on('reset', function () {\n          this.reset();\n        });\n\n        _this.on('resize', _this.resize); // Set round to previous state if available\n\n\n        _this.round = _this.previousState.round !== undefined ? _this.previousState.round : 1;\n      }\n    };\n    /**\n     * Create footer/navigation line\n     *\n     * @returns {*|jQuery|HTMLElement} Footer element\n     */\n\n\n    _this.createFooter = function () {\n      var $footer = $('<nav>', {\n        'class': 'h5p-dialogcards-footer',\n        'role': 'navigation'\n      });\n\n      if (_this.params.mode === 'normal') {\n        _this.$prev = JoubelUI.createButton({\n          'class': 'h5p-dialogcards-footer-button h5p-dialogcards-prev truncated',\n          'aria-label': _this.params.prev,\n          'title': _this.params.prev\n        }).click(function () {\n          _this.prevCard();\n        }).appendTo($footer);\n        _this.$next = JoubelUI.createButton({\n          'class': 'h5p-dialogcards-footer-button h5p-dialogcards-next truncated',\n          'aria-label': _this.params.next,\n          'title': _this.params.next\n        }).click(function () {\n          _this.nextCard();\n        }).appendTo($footer);\n        _this.$retry = JoubelUI.createButton({\n          'class': 'h5p-dialogcards-footer-button h5p-dialogcards-retry h5p-dialogcards-disabled',\n          'title': _this.params.retry,\n          'html': _this.params.retry\n        }).click(function () {\n          _this.trigger('reset');\n        }).appendTo($footer);\n        _this.$progress = $('<div>', {\n          'id': 'h5p-dialogcards-progress-' + Dialogcards.idCounter,\n          'class': 'h5p-dialogcards-progress',\n          'aria-live': 'assertive'\n        }).appendTo($footer);\n      } else {\n        _this.$round = $('<div>', {\n          'class': 'h5p-dialogcards-round'\n        }).appendTo($footer);\n        _this.$progress = $('<div>', {\n          'class': 'h5p-dialogcards-cards-left',\n          'aria-live': 'assertive'\n        }).appendTo($footer);\n      }\n\n      return $footer;\n    };\n    /**\n     * Called when all cards has been loaded.\n     */\n\n\n    _this.updateImageSize = function () {\n      // Find highest card content\n      var relativeHeightCap = 15;\n      var height = 0;\n\n      var $currentCardContent = _this.cards[_this.currentCardId].getDOM().find('.h5p-dialogcards-card-content');\n\n      _this.params.dialogs.forEach(function (dialog) {\n        var imageHeight;\n\n        if (dialog.front.image) {\n          imageHeight = dialog.front.image.height / dialog.front.image.width * $currentCardContent.get(0).getBoundingClientRect().width;\n\n          if (imageHeight > height) {\n            height = imageHeight;\n          }\n        }\n\n        if (dialog.back.image) {\n          imageHeight = dialog.back.image.height / dialog.back.image.width * $currentCardContent.get(0).getBoundingClientRect().width;\n\n          if (imageHeight > height) {\n            height = imageHeight;\n          }\n        }\n      });\n\n      if (height > 0) {\n        var relativeImageHeight = height / parseFloat(_this.$inner.css('font-size'));\n\n        if (relativeImageHeight > relativeHeightCap) {\n          relativeImageHeight = relativeHeightCap;\n        }\n\n        _this.cards.forEach(function (card) {\n          card.setImageHeight(\"\".concat(relativeImageHeight, \"em\"));\n        });\n      }\n    };\n    /**\n     * Creates all cards and appends them to card wrapper.\n     *\n     * @param {object[]} cardIds Card ids.\n     * @returns {*|jQuery|HTMLElement} Card wrapper set\n     */\n\n\n    _this.initCards = function (cardIds) {\n      var initLoad = 2;\n      _this.cards = [];\n      _this.currentCardId = 0; // Randomize cards order\n\n      if (_this.params.behaviour.randomCards) {\n        cardIds = H5P.shuffleArray(cardIds);\n      }\n\n      var $cardwrapperSet = $('<div>', {\n        'class': 'h5p-dialogcards-cardwrap-set'\n      });\n\n      for (var i = 0; i < cardIds.length; i++) {\n        // Load cards progressively\n        if (i >= initLoad) {\n          break;\n        }\n\n        var card = _this.getCard(cardIds[i]);\n\n        card.setProgressText(i + 1, cardIds.length);\n\n        _this.cards.push(card);\n\n        var $cardWrapper = card.getDOM(); // Set current card\n\n        if (i === _this.currentCardId) {\n          $cardWrapper.addClass('h5p-dialogcards-current');\n          _this.$current = $cardWrapper;\n        }\n\n        card.addTipToCard($cardWrapper.find('.h5p-dialogcards-card-content'), 'front', i);\n        $cardwrapperSet.append($cardWrapper);\n      }\n\n      return $cardwrapperSet;\n    };\n    /**\n     * Handle card turned.\n     *\n     * @param {boolean} turned - True, if card is turned.\n     */\n\n\n    _this.handleCardTurned = function (turned) {\n      // a11y notification\n      _this.$cardSideAnnouncer.html(turned ? _this.params.cardFrontLabel : _this.params.cardBackLabel); // retry button\n\n\n      if (_this.params.behaviour.enableRetry && _this.currentCardId + 1 === _this.cardIds.length) {\n        if (_this.$retry) {\n          _this.$retry.removeClass('h5p-dialogcards-disabled');\n\n          _this.truncateRetryButton();\n        }\n      }\n    };\n    /**\n     * Update navigation text and show or hide buttons.\n     */\n\n\n    _this.updateNavigation = function () {\n      if (_this.params.mode === 'normal') {\n        // Final card\n        if (_this.getCurrentSelectionIndex() < _this.cardIds.length - 1) {\n          _this.$next.removeClass('h5p-dialogcards-disabled');\n\n          _this.$retry.addClass('h5p-dialogcards-disabled');\n        } else {\n          _this.$next.addClass('h5p-dialogcards-disabled');\n        } // First card\n\n\n        if (_this.currentCardId > 0 && !_this.params.behaviour.disableBackwardsNavigation) {\n          _this.$prev.removeClass('h5p-dialogcards-disabled');\n        } else {\n          _this.$prev.addClass('h5p-dialogcards-disabled');\n        }\n\n        _this.$progress.text(_this.params.progressText.replace('@card', _this.getCurrentSelectionIndex() + 1).replace('@total', _this.cardIds.length)); // Looks strange, but the Ids get mixed up elsewhere\n\n\n        _this.cards[_this.findCardPosition(_this.cards[_this.currentCardId].id)].resizeOverflowingText();\n      } else {\n        _this.$round.text(_this.params.round.replace('@round', _this.round));\n\n        var selectionIndex = _this.getCurrentSelectionIndex();\n\n        _this.$progress.text(_this.params.cardsLeft.replace('@number', _this.cardIds.length - selectionIndex));\n      }\n\n      _this.trigger('resize');\n    };\n    /**\n     * Show summary screen.\n     * @param {boolean} [previousState = false] If true, piles will not be updated.\n     */\n\n\n    _this.showSummary = function () {\n      var previousState = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n      // Update piles and retrieve the new pile sizes\n      var newPileSizes = previousState ? _this.cardManager.getPileSizes() : _this.cardManager.updatePiles(_this.results);\n\n      var right = _this.results.filter(function (result) {\n        return result.result === true;\n      }).length;\n\n      var wrong = _this.results.length - right;\n      var notShown = _this.cardPoolSize - right - wrong;\n      var completed = newPileSizes.slice(-1)[0];\n      var done = completed === _this.cardPoolSize;\n      var summary = {\n        round: _this.round,\n        results: [{\n          field: 'h5p-dialogcards-round-cards-right',\n          score: {\n            value: right,\n            max: wrong + right\n          }\n        }, {\n          field: 'h5p-dialogcards-round-cards-wrong',\n          score: {\n            value: wrong,\n            max: wrong + right\n          }\n        }, {\n          field: 'h5p-dialogcards-round-cards-not-shown',\n          score: {\n            value: notShown\n          }\n        }, {\n          field: 'h5p-dialogcards-overall-cards-completed',\n          score: {\n            value: completed,\n            max: _this.cardPoolSize\n          }\n        }, {\n          field: 'h5p-dialogcards-overall-completed-rounds',\n          score: {\n            value: _this.round\n          }\n        }]\n      };\n\n      if (done) {\n        summary.done = true;\n        summary.message = _this.params.summaryAllDone.replace('@cards', _this.cardPoolSize).replace('@max', _this.params.behaviour.maxProficiency - 1);\n      }\n\n      _this.summaryScreen.update(summary);\n\n      _this.summaryScreen.show();\n\n      _this.hideCards();\n\n      _this.trigger('resize');\n    };\n    /**\n     * Show main content.\n     */\n\n\n    _this.showCards = function () {\n      _this.$cardwrapperSet.find('.h5p-dialogcards-cardwrap').removeClass('h5p-dialogcards-gone');\n\n      _this.$footer.removeClass('h5p-dialogcards-gone');\n\n      _this.cardsShown = true;\n    };\n    /**\n     * Hide main content.\n     */\n\n\n    _this.hideCards = function () {\n      _this.$cardwrapperSet.find('.h5p-dialogcards-cardwrap').addClass('h5p-dialogcards-gone');\n\n      _this.$footer.addClass('h5p-dialogcards-gone');\n\n      _this.cardsShown = false;\n    };\n    /**\n     * Show next card.\n     *\n     * @param {object} [result] Optional result of repetition mode.\n     */\n\n\n    _this.nextCard = function (result) {\n      if (typeof result !== 'undefined') {\n        _this.results.push(result);\n      }\n\n      _this.cards[_this.currentCardId].stopAudio(); // On final card\n\n\n      if (_this.cardIds.length - _this.getCurrentSelectionIndex() === 1) {\n        if (_this.params.mode === 'repetition') {\n          _this.$progress.text(_this.params.cardsLeft.replace('@number', 0));\n\n          _this.cards[_this.currentCardId].showSummaryButton(_this.showSummary);\n        }\n\n        return;\n      }\n\n      _this.gotoCard(_this.getCurrentSelectionIndex() + 1);\n    };\n    /**\n     * Get card from card manager.\n     * @param {number} id Card's Id.\n     * @return {object} Card.\n     */\n\n\n    _this.getCard = function (id) {\n      var card = _this.cardManager.getCard(id);\n\n      card.createButtonListeners();\n      return card;\n    };\n    /**\n     * Find the position of a loaded card.\n     * @param {number} cardId CardId to look for.\n     * @return {number} Position or undefined.\n     */\n\n\n    _this.findCardPosition = function (cardId) {\n      var position;\n\n      _this.cards.forEach(function (card, index) {\n        if (!position && card.id === cardId) {\n          position = index;\n        }\n      });\n\n      return position;\n    };\n    /**\n     * Insert a card into the DOM.\n     * @param {Card} card Card to insert.\n     * @param {number} [index] Position to insert card at.\n     */\n\n\n    _this.insertCardToDOM = function (card, index) {\n      var $node = card.getDOM(); // Put at appropriate position.\n\n      if (index === undefined) {\n        $node.appendTo(_this.$cardwrapperSet);\n      } else if (index === 0) {\n        _this.$cardwrapperSet.prepend($node);\n      } else {\n        _this.$cardwrapperSet.children().eq(index).after($node);\n      } // Add hints\n\n\n      card.addTipToCard($node.find('.h5p-dialogcards-card-content'), 'front', index);\n    };\n    /**\n     * Go to a specific card in the selection. Cards may need to be loaded.\n     * @param {number} targetPosition Target card position.\n     */\n\n\n    _this.gotoCard = function (targetPosition) {\n      if (targetPosition < 0 || targetPosition >= _this.cardIds.length) {\n        return;\n      } // Stop action on current card\n\n\n      var currentCard = _this.cards[_this.currentCardId];\n      currentCard.stopAudio();\n      currentCard.getDOM().removeClass('h5p-dialogcards-current'); // Get card positions to check for being loaded\n\n      var checkLoaded = [];\n\n      if (targetPosition > 0) {\n        checkLoaded.push(targetPosition - 1);\n      }\n\n      checkLoaded.push(targetPosition);\n\n      if (targetPosition + 1 < _this.cardIds.length) {\n        checkLoaded.push(targetPosition + 1);\n      } // Load and insert target card, predecessor and successor if required.\n\n\n      checkLoaded.forEach(function (position) {\n        var loadedPosition = _this.findCardPosition(_this.cardIds[position]);\n\n        if (loadedPosition === undefined) {\n          // Card has not been loaded. Load now.\n          var card = _this.getCard(_this.cardIds[position]);\n\n          card.setProgressText(position + 1, _this.cardIds.length);\n          /*\n           * Try to find successor card in loaded pile and insert before\n           * or put to the end of the loaded pile.\n           */\n\n          var successorId = Math.min(position + 1, _this.cardIds.length - 1);\n\n          var successor = _this.findCardPosition(_this.cardIds[successorId]);\n\n          var insertPosition = successor || _this.cards.length;\n\n          _this.cards.splice(insertPosition, 0, card);\n\n          _this.insertCardToDOM(card, insertPosition);\n        }\n      });\n\n      _this.resize(); // Retrieve position of id now in *loaded cards*\n\n\n      targetPosition = _this.findCardPosition(_this.cardIds[targetPosition]); // Set classes for card order/display\n\n      _this.cards.forEach(function (card, index) {\n        if (index < targetPosition) {\n          card.getDOM().addClass('h5p-dialogcards-previous');\n        } else {\n          card.getDOM().removeClass('h5p-dialogcards-previous');\n\n          if (index === targetPosition) {\n            card.getDOM().addClass('h5p-dialogcards-current');\n          }\n        }\n      });\n\n      _this.currentCardId = targetPosition;\n\n      _this.updateNavigation();\n\n      _this.cards[_this.currentCardId].setCardFocus();\n    };\n    /**\n     * Show previous card.\n     */\n\n\n    _this.prevCard = function () {\n      _this.gotoCard(_this.getCurrentSelectionIndex() - 1);\n    };\n    /**\n     * Show all audio buttons\n     */\n\n\n    _this.showAllAudio = function () {\n      _this.$cardwrapperSet.find('.h5p-audio-inner').removeClass('hide');\n    };\n\n    _this.restartRepetition = function () {\n      _this.cardManager.reset();\n\n      _this.round = 0;\n\n      _this.nextRound();\n    };\n\n    _this.nextRound = function () {\n      _this.round++;\n\n      _this.summaryScreen.hide();\n\n      _this.showCards();\n\n      _this.reset();\n\n      _this.createDOM();\n\n      _this.updateNavigation();\n\n      _this.cards[_this.currentCardId].setCardFocus(true);\n\n      _this.trigger('resize');\n    };\n    /**\n     * Reset the task so that the user can do it again.\n     */\n\n\n    _this.reset = function () {\n      _this.results = [];\n\n      _this.cards[_this.currentCardId].stopAudio(_this.$current.index()); // Turn all cards to front\n\n\n      _this.cards.forEach(function (card) {\n        card.reset();\n      }); // Show first card\n\n\n      _this.currentCardId = 0;\n\n      if (_this.params.mode === 'normal') {\n        _this.cards[_this.currentCardId].getDOM().addClass('h5p-dialogcards-current');\n      }\n\n      _this.updateNavigation();\n\n      if (_this.$retry) {\n        _this.$retry.addClass('h5p-dialogcards-disabled');\n      }\n\n      _this.showAllAudio();\n\n      _this.cards[_this.currentCardId].resizeOverflowingText();\n\n      _this.cards[_this.currentCardId].setCardFocus();\n    };\n    /**\n     * Update the dimensions of the task when resizing the task.\n     */\n\n\n    _this.resize = function () {\n      var _displayLimits3;\n\n      console.log('DIALOGCARDS: resize');\n      console.log('DIALOGCARDS ($cardWrapperSet)', _this.$cardwrapperSet, _this.$cardwrapperSet.outerHeight());\n      console.log('DIALOGCARDS (container)', _this.$inner, _this.$inner.outerHeight());\n\n      _this.handleOrientationChange();\n\n      var displayLimits = null;\n      var titleHeight = _this.$inner.find('.h5p-dialogcards-title').outerHeight() || 0;\n      var descriptionHeight = _this.$inner.find('.h5p-dialogcards-description').outerHeight(true) || 0;\n      var footerHeight = _this.$footer.outerHeight() || 0;\n      var nonCardHeight = titleHeight + descriptionHeight + footerHeight;\n\n      var isMobileLandscape = _this.isMobileLandscape();\n\n      if (parseInt(_this.$cardwrapperSet.css('height')) === 0) {\n        console.log('DIALOGCARDS (titleHeight, descriptionHeight, footerHeight, nonCardHeight, isMobileLandscape)', titleHeight, descriptionHeight, footerHeight, nonCardHeight, isMobileLandscape);\n      } // Change landscape layout on mobile\n\n\n      if (typeof window.orientation === 'number' && _this.$cardwrapperSet.find('.h5p-dialogcards-summary-screen').hasClass('h5p-dialogcards-gone') && _this.params.behaviour.scaleTextNotCard) {\n        _this.$inner.toggleClass('h5p-landscape', isMobileLandscape);\n\n        if (isMobileLandscape) {\n          var _displayLimits, _displayLimits2;\n\n          displayLimits = _this.isRoot() ? _this.computeDisplayLimitsKLL() : null;\n          var screenHeight = _this.isIOS() && isMobileLandscape ? screen.width : screen.height;\n\n          if (((_displayLimits = displayLimits) === null || _displayLimits === void 0 ? void 0 : _displayLimits.height) === 1) {\n            displayLimits.height = screenHeight;\n          }\n\n          if ((_displayLimits2 = displayLimits) !== null && _displayLimits2 !== void 0 && _displayLimits2.height) {\n            _this.$cardwrapperSet.css('max-height', \"\".concat(displayLimits.height - nonCardHeight, \"px\"));\n          } else {\n            _this.$cardwrapperSet.css('max-height', '');\n          }\n        }\n      } else {\n        _this.$cardwrapperSet.css('max-height', '');\n      }\n\n      var maxHeight = 0;\n\n      if (!displayLimits || !isMobileLandscape || !_this.params.behaviour.scaleTextNotCard) {\n        _this.updateImageSize();\n      } else {\n        _this.cards.forEach(function (card) {\n          card.setImageHeight('');\n        });\n      }\n\n      if (!_this.params.behaviour.scaleTextNotCard && _this.cardsShown !== false) {\n        _this.determineCardSizes();\n      }\n\n      if (!_this.params.behaviour.scaleTextNotCard || !isMobileLandscape || !((_displayLimits3 = displayLimits) !== null && _displayLimits3 !== void 0 && _displayLimits3.height) || !_this.$cardwrapperSet.find('.h5p-dialogcards-summary-screen').hasClass('h5p-dialogcards-gone')) {\n        // Reset card-wrapper-set height\n        _this.$cardwrapperSet.css('height', 'auto'); // Find max required height for all cards\n\n\n        _this.$cardwrapperSet.children(':not(.h5p-dialogcards-gone)').each(function () {\n          var wrapperHeight = $(this).css('height', '').outerHeight();\n          var computedHeight = parseFloat($(this).find('.h5p-dialogcards-card-content').css('padding-top')) + parseFloat($(this).find('.h5p-dialogcards-card-content').css('padding-bottom')) + $(this).find('.h5p-dialogcards-image-wrapper').outerHeight() + $(this).find('.h5p-dialogcards-card-text-wrapper').outerHeight();\n          console.log(wrapperHeight, 'vs', computedHeight);\n          $(this).css('height', 'inherit');\n          maxHeight = Math.max(wrapperHeight, maxHeight); // Check height\n\n          if (!$(this).next('.h5p-dialogcards-cardwrap').length) {\n            var initialHeight = $(this).find('.h5p-dialogcards-cardholder').css('height', 'initial').outerHeight();\n            maxHeight = Math.max(initialHeight, maxHeight);\n            $(this).find('.h5p-dialogcards-cardholder').css('height', 'inherit');\n          }\n        });\n\n        console.log('DIALOGCARDS (height computation)', maxHeight, parseFloat(_this.$cardwrapperSet.css('font-size')));\n        var relativeMaxHeight = maxHeight / parseFloat(_this.$cardwrapperSet.css('font-size'));\n        console.log('DIALOGCARDS (relativeMaxHeight)', relativeMaxHeight + 'em');\n\n        _this.$cardwrapperSet.css('height', relativeMaxHeight + 'em');\n      } else {\n        var _displayLimits4;\n\n        if (((_displayLimits4 = displayLimits) === null || _displayLimits4 === void 0 ? void 0 : _displayLimits4.height) - nonCardHeight > 1) {\n          var _displayLimits5;\n\n          _this.$cardwrapperSet.css('height', \"\".concat(((_displayLimits5 = displayLimits) === null || _displayLimits5 === void 0 ? void 0 : _displayLimits5.height) - nonCardHeight, \"px\"));\n        }\n      }\n\n      _this.scaleToFitHeight();\n\n      _this.truncateRetryButton();\n\n      _this.cards[_this.currentCardId].resizeOverflowingText();\n    };\n    /**\n     * Resizes each card to fit its text\n     */\n\n\n    _this.determineCardSizes = function () {\n      var self = _assertThisInitialized(_this);\n\n      if (_this.cardSizeDetermined === undefined) {\n        // Keep track of which cards we've already determined size for\n        _this.cardSizeDetermined = [];\n      } // Go through each card\n\n\n      _this.$cardwrapperSet.children(':visible').each(function (i) {\n        var cardId = self.cards[i].id;\n\n        if (self.cardSizeDetermined.indexOf(cardId) !== -1) {\n          return; // Already determined, no need to determine again.\n        }\n\n        self.cardSizeDetermined.push(cardId); // Here \"this\" references the jQuery object\n\n        var $content = $('.h5p-dialogcards-card-content', this);\n        var $text = $('.h5p-dialogcards-card-text-inner-content', $content); // Grab size with text\n\n        var textHeight = $text[0].getBoundingClientRect().height; // Change to answer\n\n        var currentCard = self.cards[i];\n        currentCard.changeText(currentCard.getAnswer()); // Grab size with answer\n\n        var answerHeight = $text[0].getBoundingClientRect().height; // Use highest\n\n        var useHeight = textHeight > answerHeight ? textHeight : answerHeight; // Min. limit\n\n        var minHeight = parseFloat($text.parent().parent().css('minHeight'));\n\n        if (useHeight < minHeight) {\n          useHeight = minHeight;\n        } // None of the cards has text, shrink text area, leave space for audio\n\n\n        if (self.hasNoTexts) {\n          var $cardText = $text.find('.h5p-dialogcards-card-text');\n          useHeight = self.hasNoAudios ? 0 : useHeight - parseFloat($cardText.css('height'));\n          $cardText.css('height', 0);\n        } // Convert to em\n\n\n        var fontSize = parseFloat($content.css('fontSize'));\n        useHeight /= fontSize; // Set height\n\n        $text.parent().css('height', useHeight + 'em'); // Change back to text\n\n        currentCard.changeText(currentCard.getText());\n      });\n    };\n    /**\n     * Scales the card contents.\n     */\n\n\n    _this.scaleToFitHeight = function () {\n      if (!_this.$cardwrapperSet || !_this.$cardwrapperSet.is(':visible') || !_this.params.behaviour.scaleTextNotCard) {\n        return;\n      } // Resize font size to fit inside CP\n\n\n      if (_this.$inner.parents('.h5p-course-presentation').length) {\n        var $parentContainer = _this.$inner.parent();\n\n        if (_this.$inner.parents('.h5p-popup-container').length) {\n          $parentContainer = _this.$inner.parents('.h5p-popup-container');\n        }\n\n        var containerHeight = $parentContainer.get(0).getBoundingClientRect().height;\n\n        var getContentHeight = function getContentHeight() {\n          var contentHeight = 0;\n\n          _this.$inner.children().each(function () {\n            // Here \"this\" references the jQuery object\n            var $child = $(this);\n            contentHeight += this.getBoundingClientRect().height + parseFloat($child.css('margin-top')) + parseFloat($child.css('margin-bottom'));\n          });\n\n          return contentHeight;\n        };\n\n        var contentHeight = getContentHeight();\n        var parentFontSize = parseFloat(_this.$inner.parent().css('font-size'));\n        var newFontSize = parseFloat(_this.$inner.css('font-size')); // Decrease font size\n\n        if (containerHeight < contentHeight) {\n          while (containerHeight < contentHeight) {\n            newFontSize -= Dialogcards.SCALEINTERVAL; // Cap at min font size\n\n            if (newFontSize < Dialogcards.MINSCALE) {\n              break;\n            } // Set relative font size to scale with full screen.\n\n\n            _this.$inner.css('font-size', newFontSize / parentFontSize + 'em');\n\n            contentHeight = getContentHeight();\n          }\n        } else {\n          // Increase font size\n          var increaseFontSize = true;\n\n          while (increaseFontSize) {\n            newFontSize += Dialogcards.SCALEINTERVAL; // Cap max font size\n\n            if (newFontSize > Dialogcards.MAXSCALE) {\n              increaseFontSize = false;\n              break;\n            } // Set relative font size to scale with full screen.\n\n\n            var relativeFontSize = newFontSize / parentFontSize;\n\n            _this.$inner.css('font-size', relativeFontSize + 'em');\n\n            contentHeight = getContentHeight();\n\n            if (containerHeight <= contentHeight) {\n              increaseFontSize = false;\n              relativeFontSize = (newFontSize - Dialogcards.SCALEINTERVAL) / parentFontSize;\n\n              _this.$inner.css('font-size', relativeFontSize + 'em');\n            }\n          }\n        }\n      } else {\n        // Resize mobile view\n        _this.cards[_this.currentCardId].resizeOverflowingText();\n      }\n    };\n    /**\n     * Truncate retry button if width is small.\n     */\n\n\n    _this.truncateRetryButton = function () {\n      if (!_this.$retry) {\n        return;\n      } // Reset button to full size\n\n\n      _this.$retry.removeClass('truncated');\n\n      _this.$retry.html(_this.params.retry); // Measure button\n\n\n      var maxWidthPercentages = 0.3;\n      var retryWidth = _this.$retry.get(0).getBoundingClientRect().width + parseFloat(_this.$retry.css('margin-left')) + parseFloat(_this.$retry.css('margin-right'));\n\n      var retryWidthPercentage = retryWidth / _this.$retry.parent().get(0).getBoundingClientRect().width; // Truncate button\n\n\n      if (retryWidthPercentage > maxWidthPercentages) {\n        _this.$retry.addClass('truncated');\n\n        _this.$retry.html('');\n      }\n    };\n    /**\n     * Retrieve index of card in selection, not loaded cards.\n     */\n\n\n    _this.getCurrentSelectionIndex = function () {\n      return _this.cardIds.indexOf(_this.cards[_this.currentCardId].id);\n    };\n    /**\n     * Get the content type title.\n     *\n     * @return {string} title.\n     */\n\n\n    _this.getTitle = function () {\n      return H5P.createTitle(_this.contentData && _this.contentData.metadata && _this.contentData.metadata.title ? _this.contentData.metadata.title : 'Dialog Cards');\n    };\n    /**\n     * Save the current state to be restored later.\n     */\n\n\n    _this.getCurrentState = function () {\n      return {\n        cardPiles: _this.cardManager.getPiles(),\n        cardIds: _this.cardIds,\n        round: _this.round,\n        currentCardId: _this.getCurrentSelectionIndex(),\n        results: _this.results\n      };\n    };\n\n    return _this;\n  }\n  /**\n   * Compute display limits.\n   * @return {object|null} Height and width in px or null if cannot be determined.\n   */\n\n\n  var _proto = Dialogcards.prototype;\n\n  _proto.computeDisplayLimits = function computeDisplayLimits() {\n    var topWindow = this.getTopWindow(); // iOS doesn't change screen dimensions on rotation\n\n    var screenSize = this.isIOS() && this.getOrientation() === 'landscape' ? {\n      height: screen.width,\n      width: screen.height\n    } : {\n      height: screen.height,\n      width: screen.width\n    };\n    topWindow = topWindow || {\n      innerHeight: screenSize.height,\n      innerWidth: screenSize.width\n    }; // Smallest value of viewport and container wins\n\n    return {\n      height: Math.min(topWindow.innerHeight, screenSize.height),\n      width: Math.min(topWindow.innerWidth, this.$inner.get(0).offsetWidth)\n    };\n  }\n  /**\n   * Compute display limits for KidsLoop Live.\n   * @return {object|null} Height and width in px or null if cannot be determined.\n   */\n  ;\n\n  _proto.computeDisplayLimitsKLL = function computeDisplayLimitsKLL() {\n    var displayLimits = this.computeDisplayLimits(); // This only works because KLL enforces height on H5P's iframe\n\n    displayLimits.height = Math.min(displayLimits.height, document.body.offsetHeight);\n    return displayLimits;\n  }\n  /**\n   * Detect whether user is running iOS.\n   * @return {boolean} True, if user is running iOS.\n   */\n  ;\n\n  _proto.isIOS = function isIOS() {\n    return ['iPad Simulator', 'iPhone Simulator', 'iPod Simulator', 'iPad', 'iPhone', 'iPod'].includes(navigator.platform) || navigator.userAgent.includes('Mac') && 'ontouchend' in document;\n  }\n  /**\n   * Determine whether mobile device in landscape orientation.\n   * @return {boolean} True, if mobile device in landscape orientation.\n   */\n  ;\n\n  _proto.isMobileLandscape = function isMobileLandscape() {\n    return this.isMobileDevice() && this.getOrientation() === 'landscape';\n  }\n  /**\n   * Detect mobile devices (http://detectmobilebrowsers.com/)\n   * @returns {boolean} True if running on a mobile device.\n   */\n  ;\n\n  _proto.isMobileDevice = function isMobileDevice() {\n    var check = false;\n\n    (function (a) {\n      if (/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(a.substr(0, 4))) check = true;\n    })(navigator.userAgent || navigator.vendor || window.opera);\n\n    return check;\n  }\n  /**\n   * Get device orientation.\n   * @return {string} 'portrait' or 'landscape'.\n   */\n  ;\n\n  _proto.getOrientation = function getOrientation() {\n    if (screen.orientation && screen.orientation.type) {\n      if (screen.orientation.type.includes('portrait')) {\n        return 'portrait';\n      } else if (screen.orientation.type.includes('landscape')) {\n        return 'landscape';\n      }\n    } // Unreliable, as not clear what device's natural orientation is\n\n\n    if (typeof window.orientation === 'number') {\n      if (window.orientation === 0 || window.orientation === 180) {\n        return 'portrait';\n      } else if (window.orientation === 90 || window.orientation === -90 || window.orientation === 270) {\n        return 'landscape';\n      }\n    }\n\n    return 'landscape'; // Assume default\n  }\n  /**\n  * Get top DOM Window object.\n  * @param {Window} [startWindow=window] Window to start looking from.\n  * @return {Window|null} Top window.\n  */\n  ;\n\n  _proto.getTopWindow = function getTopWindow(startWindow) {\n    var sameOrigin;\n    startWindow = startWindow || window; // H5P iframe may be on different domain than iframe content\n\n    try {\n      sameOrigin = startWindow.parent.location.host === window.location.host;\n    } catch (error) {\n      sameOrigin = null;\n    }\n\n    if (!sameOrigin) {\n      return null;\n    }\n\n    if (startWindow.parent === startWindow || !startWindow.parent) {\n      return startWindow;\n    }\n\n    return this.getTopWindow(startWindow.parent);\n  }\n  /**\n   * Handle orientation change.\n   */\n  ;\n\n  _proto.handleOrientationChange = function handleOrientationChange() {\n    var _this2 = this;\n\n    if (!this.params.behaviour.scaleTextNotCard) {\n      return;\n    }\n\n    var isMobileLandscape = this.isMobileLandscape();\n    this.cards.forEach(function (card) {\n      if (_this2.params.mode === 'repetition') {\n        card.$buttonTurn.text(isMobileLandscape ? '' : _this2.params.answer);\n        card.$buttonCorrect.text(isMobileLandscape ? '' : _this2.params.correctAnswer);\n        card.$buttonIncorrect.text(isMobileLandscape ? '' : _this2.params.incorrectAnswer);\n      }\n\n      if (!isMobileLandscape) {\n        _this2.$cardwrapperSet.css('max-height', '');\n      }\n    });\n  };\n\n  return Dialogcards;\n}(H5P.EventDispatcher);\n\nDialogcards.idCounter = 0; // Constants\n\nDialogcards.SCALEINTERVAL = 0.2;\nDialogcards.MAXSCALE = 16;\nDialogcards.MINSCALE = 4;\n/* harmony default export */ __webpack_exports__[\"default\"] = (Dialogcards);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvc2NyaXB0cy9oNXAtZGlhbG9nY2FyZHMuanMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUVBO0FBQ0E7O0FBRUE7OztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTs7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUdBOztBQUNBOztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBOztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFFQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBSkE7QUFXQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFwQkE7QUFzQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFOQTtBQXhEQTs7QUFtRUE7QUFBQTtBQUFBOztBQUdBO0FBQUE7QUFBQTs7QUFJQTtBQUVBO0FBQ0E7O0FBQ0E7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBQ0E7QUFDQTs7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFmQTtBQWtCQTtBQUNBO0FBQ0E7QUFGQTs7QUFLQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUlBOztBQUVBO0FBQ0E7QUFDQTtBQUdBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBRUE7O0FBQ0E7O0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU9BO0FBRUE7O0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7OztBQUdBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFFQTtBQUNBO0FBREE7QUFJQTtBQUNBO0FBQ0E7QUFGQTtBQUlBOztBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFDQTtBQUNBO0FBQ0E7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBR0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFEQTs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUNBOztBQUVBOztBQUNBOztBQUdBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBQ0E7QUFDQTtBQUVBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7O0FBRUE7OztBQU1BO0FBQ0E7QUFFQTs7QUFDQTs7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFBQTtBQUNBO0FBQ0E7O0FBSUE7QUFBQTtBQUFBOztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUZBO0FBS0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUZBO0FBS0E7QUFDQTtBQUFBO0FBQUE7QUFGQTtBQUtBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFGQTtBQUtBO0FBQ0E7QUFBQTtBQUFBO0FBRkE7QUFuQkE7O0FBMEJBO0FBQ0E7QUFDQTtBQUdBOztBQUVBOztBQUNBOztBQUNBOztBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7O0FBQ0E7O0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTs7QUFDQTs7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7OztBQUdBO0FBQ0E7QUFDQTs7QUFDQTtBQUNBOztBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7O0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBOztBQUdBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBOzs7QUFHQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7O0FBR0E7O0FBQ0E7QUFDQTtBQUNBOztBQUNBOztBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTs7QUFDQTtBQUVBO0FBQ0E7O0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7OztBQUdBOztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFDQTs7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFFQTs7QUFFQTtBQUNBOztBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBOzs7QUFDQTtBQUNBOztBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7OztBQUdBOztBQUNBO0FBQ0E7QUFDQTs7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBQ0E7O0FBRUE7O0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFBQTs7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7OztBQUdBO0FBS0E7O0FBRUE7QUFBQTs7QUFDQTtBQUVBOztBQUlBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUVBO0FBS0E7QUFFQTtBQUNBOztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUVBO0FBQ0E7O0FBQ0E7QUFDQTtBQUNBOztBQUNBO0FBQUE7O0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUNBOztBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUNBOztBQUdBO0FBQ0E7O0FBR0E7O0FBR0E7QUFDQTs7QUFHQTs7QUFHQTs7QUFHQTs7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7O0FBR0E7O0FBR0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTs7QUFDQTtBQUNBO0FBQ0E7O0FBQ0E7O0FBQ0E7QUFDQTs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBOztBQUNBO0FBQ0E7O0FBQ0E7QUFDQTtBQUNBOztBQUdBO0FBQ0E7QUFDQTs7QUFHQTtBQUNBO0FBQ0E7OztBQUdBOztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBQ0E7QUFDQTs7QUFHQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7QUFDQTtBQUNBOztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBOztBQUNBOzs7QUFHQTtBQUNBOztBQUVBOzs7QUFHQTtBQUNBOztBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUxBO0FBT0E7O0FBaGhDQTtBQWloQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUFDQTtBQUNBOztBQUdBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBRkE7O0FBTUE7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBOztBQUdBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBSUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7O0FBQ0E7QUFDQTtBQUNBOztBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTs7QUFHQTtBQUNBO0FBQ0E7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFBQTs7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBNXFDQTs7QUErcUNBOztBQUdBO0FBQ0E7QUFDQTtBQUVBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vaDVwLWRpYWxvZ2NhcmRzLy4vc3JjL3NjcmlwdHMvaDVwLWRpYWxvZ2NhcmRzLmpzPzk3OTQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IENhcmRNYW5hZ2VyIGZyb20gJy4vaDVwLWRpYWxvZ2NhcmRzLWNhcmQtbWFuYWdlcic7XG5pbXBvcnQgU3VtbWFyeVNjcmVlbiBmcm9tICcuL2g1cC1kaWFsb2djYXJkcy1zdW1tYXJ5LXNjcmVlbic7XG5cbmNvbnN0ICQgPSBINVAualF1ZXJ5O1xuY29uc3QgSm91YmVsVUkgPSBINVAuSm91YmVsVUk7XG5cbmNsYXNzIERpYWxvZ2NhcmRzIGV4dGVuZHMgSDVQLkV2ZW50RGlzcGF0Y2hlciB7XG4gIC8qKlxuICAgKiBJbml0aWFsaXplIG1vZHVsZS5cbiAgICpcbiAgICogQGNvbnN0cnVjdG9yXG4gICAqXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBwYXJhbXMgUGFyYW1ldGVycy5cbiAgICogQHBhcmFtIHtOdW1iZXJ9IGlkIENvbnRlbnQgaWQuXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBjb250ZW50RGF0YSBDb250ZW50IGRhdGEsIGUuZy4gZm9yIHNhdmVDb250ZW50U3RhdGVcbiAgICogQHJldHVybnMge0RpYWxvZ0NhcmRzfSBzZWxmXG4gICAqL1xuICBjb25zdHJ1Y3RvcihwYXJhbXMsIGlkLCBjb250ZW50RGF0YSkge1xuICAgIERpYWxvZ2NhcmRzLmlkQ291bnRlcisrO1xuICAgIHN1cGVyKCk7XG5cbiAgICB0aGlzLmNvbnRlbnRJZCA9IHRoaXMuaWQgPSBpZDtcbiAgICB0aGlzLnByZXZpb3VzU3RhdGUgPSBjb250ZW50RGF0YS5wcmV2aW91c1N0YXRlIHx8IHt9O1xuXG4gICAgLy8gVmFyIGNhcmRPcmRlciBzdG9yZXMgb3JkZXIgb2YgY2FyZHMgdG8gYWxsb3cgcmVzdW1pbmcgb2YgY2FyZCBzZXQuXG4gICAgLy8gVmFyIHByb2dyZXNzIHN0b3JlcyBjdXJyZW50IGNhcmQgaW5kZXguXG4gICAgdGhpcy5jb250ZW50RGF0YSA9IGNvbnRlbnREYXRhIHx8IHt9O1xuXG4gICAgLy8gU3RyaXAgY2FyZHMgd2l0aCBlbXB0eSBzaWRlc1xuICAgIHBhcmFtcy5kaWFsb2dzID0gcGFyYW1zLmRpYWxvZ3MgfHwgW107XG4gICAgcGFyYW1zLmRpYWxvZ3MgPSBwYXJhbXMuZGlhbG9ncy5maWx0ZXIoZGlhbG9nID0+IHtcbiAgICAgIGlmICghZGlhbG9nLmZyb250IHx8ICFkaWFsb2cuYmFjaykge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIC8vIEVtcHR5IGZyb250P1xuICAgICAgaWYgKCFkaWFsb2cuZnJvbnQudGV4dCAmJiAhZGlhbG9nLmZyb250LmltYWdlICYmICFkaWFsb2cuZnJvbnQuYXVkaW8pIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuXG4gICAgICAvLyBFbXB0eSBiYWNrP1xuICAgICAgY29uc3Qgbm9CYWNrVGV4dCA9ICFkaWFsb2cuYmFjay50ZXh0O1xuICAgICAgY29uc3Qgbm9CYWNrSW1hZ2UgPSAoKGRpYWxvZy5iYWNrLnVzZUltYWdlRnJvbUZyb250ICYmICFkaWFsb2cuZnJvbnQuaW1hZ2UpIHx8ICghZGlhbG9nLmJhY2sudXNlSW1hZ2VGcm9tRnJvbnQgJiYgIWRpYWxvZy5iYWNrLmltYWdlKSk7XG4gICAgICBjb25zdCBub0JhY2tBdWRpbyA9ICgoZGlhbG9nLmJhY2sudXNlQXVkaW9Gcm9tRnJvbnQgJiYgIWRpYWxvZy5mcm9udC5hdWRpbykgfHwgKCFkaWFsb2cuYmFjay51c2VBdWRpb0Zyb21Gcm9udCAmJiAhZGlhbG9nLmJhY2suYXVkaW8pKTtcbiAgICAgIGlmIChub0JhY2tUZXh0ICYmIG5vQmFja0ltYWdlICYmIG5vQmFja0F1ZGlvKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSk7XG5cbiAgICAvLyBTZXQgZGVmYXVsdCBiZWhhdmlvci5cbiAgICB0aGlzLnBhcmFtcyA9ICQuZXh0ZW5kKHRydWUsIHtcbiAgICAgIHRpdGxlOiAnJyxcbiAgICAgIG1vZGU6ICdub3JtYWwnLFxuICAgICAgZGVzY3JpcHRpb246IFwiU2l0IGluIHBhaXJzIGFuZCBtYWtlIHVwIHNlbnRlbmNlcyB3aGVyZSB5b3UgaW5jbHVkZSB0aGUgZXhwcmVzc2lvbnMgYmVsb3cuPGJyLz5FeGFtcGxlOiBJIHNob3VsZCBoYXZlIHNhaWQgeWVzLCBIT1dFVkVSIEkga2VwdCBteSBtb3V0aCBzaHV0LlwiLFxuICAgICAgbmV4dDogXCJOZXh0XCIsXG4gICAgICBwcmV2OiBcIlByZXZpb3VzXCIsXG4gICAgICByZXRyeTogXCJSZXRyeVwiLFxuICAgICAgYW5zd2VyOiBcIlR1cm5cIixcbiAgICAgIGNvcnJlY3RBbnN3ZXI6ICdJIGdvdCBpdCByaWdodCEnLFxuICAgICAgaW5jb3JyZWN0QW5zd2VyOiAnSSBnb3QgaXQgd3JvbmcnLFxuICAgICAgcm91bmQ6ICdSb3VuZCBAcm91bmQnLFxuICAgICAgY2FyZHNMZWZ0OiAnQ2FyZHMgbGVmdDogQG51bWJlcicsXG4gICAgICBuZXh0Um91bmQ6ICdQcm9jZWVkIHRvIHJvdW5kIEByb3VuZCcsXG4gICAgICBzdGFydE92ZXI6ICdTdGFydCBvdmVyJyxcbiAgICAgIHNob3dTdW1tYXJ5OiAnTmV4dCcsXG4gICAgICBzdW1tYXJ5OiAnU3VtbWFyeScsXG4gICAgICBzdW1tYXJ5Q2FyZHNSaWdodDogJ0NhcmRzIHlvdSBnb3QgcmlnaHQ6JyxcbiAgICAgIHN1bW1hcnlDYXJkc1dyb25nOiAnQ2FyZHMgeW91IGdvdCB3cm9uZzonLFxuICAgICAgc3VtbWFyeUNhcmRzTm90U2hvd246ICdDYXJkcyBpbiBwb29sIG5vdCBzaG93bjonLFxuICAgICAgc3VtbWFyeU92ZXJhbGxTY29yZTogJ092ZXJhbGwgU2NvcmUnLFxuICAgICAgc3VtbWFyeUNhcmRzQ29tcGxldGVkOiAnQ2FyZHMgeW91IGhhdmUgY29tcGxldGVkIGxlYXJuaW5nOicsXG4gICAgICBzdW1tYXJ5Q29tcGxldGVkUm91bmRzOiAnQ29tcGxldGVkIHJvdW5kczonLFxuICAgICAgc3VtbWFyeUFsbERvbmU6ICdXZWxsIGRvbmUhIFlvdSBnb3QgYWxsIEBjYXJkcyBjYXJkcyBjb3JyZWN0IEBtYXggdGltZXMgaW4gYSByb3cgZWFjaCEnLFxuICAgICAgcHJvZ3Jlc3NUZXh0OiBcIkNhcmQgQGNhcmQgb2YgQHRvdGFsXCIsXG4gICAgICBjYXJkRnJvbnRMYWJlbDogXCJDYXJkIGZyb250XCIsXG4gICAgICBjYXJkQmFja0xhYmVsOiBcIkNhcmQgYmFja1wiLFxuICAgICAgdGlwQnV0dG9uTGFiZWw6ICdTaG93IHRpcCcsXG4gICAgICBhdWRpb05vdFN1cHBvcnRlZDogJ1lvdXIgYnJvd3NlciBkb2VzIG5vdCBzdXBwb3J0IHRoaXMgYXVkaW8nLFxuICAgICAgY29uZmlybVN0YXJ0aW5nT3Zlcjoge1xuICAgICAgICBoZWFkZXI6ICdTdGFydCBvdmVyPycsXG4gICAgICAgIGJvZHk6ICdBbGwgcHJvZ3Jlc3Mgd2lsbCBiZSBsb3N0LiBBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gc3RhcnQgb3Zlcj8nLFxuICAgICAgICBjYW5jZWxMYWJlbDogJ0NhbmNlbCcsXG4gICAgICAgIGNvbmZpcm1MYWJlbDogJ1N0YXJ0IG92ZXInXG4gICAgICB9LFxuICAgICAgZGlhbG9nczogW1xuICAgICAgICB7XG4gICAgICAgICAgZnJvbnQ6IHtcbiAgICAgICAgICAgIHRleHQ6ICdIb3JzZSdcbiAgICAgICAgICB9LFxuICAgICAgICAgIGJhY2s6IHtcbiAgICAgICAgICAgIHRleHQ6ICdIZXN0JyxcbiAgICAgICAgICAgIHVzZUltYWdlRnJvbUZyb250OiB0cnVlLFxuICAgICAgICAgICAgdXNlQXVkaW9Gcm9tRnJvbnQ6IGZhbHNlXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIHtcbiAgICAgICAgLy8gICBmcm9udDoge1xuICAgICAgICAvLyAgICAgdGV4dDogJ0NvdydcbiAgICAgICAgLy8gICB9LFxuICAgICAgICAvLyAgIGJhY2s6IHtcbiAgICAgICAgLy8gICAgIHRleHQ6ICdLdScsXG4gICAgICAgIC8vICAgICB1c2VJbWFnZUZyb21Gcm9udDogdHJ1ZSxcbiAgICAgICAgLy8gICAgIHVzZUF1ZGlvRnJvbUZyb250OiBmYWxzZVxuICAgICAgICAvLyAgIH1cbiAgICAgICAgLy8gfVxuICAgICAgXSxcbiAgICAgIGJlaGF2aW91cjoge1xuICAgICAgICBlbmFibGVSZXRyeTogdHJ1ZSxcbiAgICAgICAgZGlzYWJsZUJhY2t3YXJkc05hdmlnYXRpb246IGZhbHNlLFxuICAgICAgICBzY2FsZVRleHROb3RDYXJkOiBmYWxzZSxcbiAgICAgICAgcmFuZG9tQ2FyZHM6IGZhbHNlLFxuICAgICAgICBtYXhQcm9maWNpZW5jeTogNSxcbiAgICAgICAgcXVpY2tQcm9ncmVzc2lvbjogZmFsc2VcbiAgICAgIH1cbiAgICB9LCBwYXJhbXMpO1xuXG4gICAgLy8gQ2hlY2sgZm9yIG5vIHRleHRzIGF0IGFsbFxuICAgIHRoaXMuaGFzTm9UZXh0cyA9IHRoaXMucGFyYW1zLmRpYWxvZ3MuZXZlcnkoZGlhbG9nID0+IGRpYWxvZy5mcm9udC50ZXh0ID09PSAnJyAmJiBkaWFsb2cuYmFjay50ZXh0ID09PSAnJyk7XG5cbiAgICAvLyBDaGVjayBmb3Igbm8gYXVkaW9zIGF0IGFsbFxuICAgIHRoaXMuaGFzTm9BdWRpb3MgPSAhdGhpcy5wYXJhbXMuZGlhbG9ncy5zb21lKGRpYWxvZyA9PiBkaWFsb2cuZnJvbnQuYXVkaW8gfHwgKGRpYWxvZy5iYWNrLmF1ZGlvICYmICFkaWFsb2cuYmFjay51c2VBdWRpb0Zyb21Gcm9udCkpO1xuXG4gICAgLy8gVE9ETzogVHJhbnNsYXRpb25zXG5cbiAgICB0aGlzLmNhcmRzID0gW107XG5cbiAgICB0aGlzLmN1cnJlbnRDYXJkSWQgPSAwO1xuICAgIHRoaXMucm91bmQgPSAwOyAvLyAwIGluZGljYXRlcyB0aGF0IERPTSBuZWVkcyB0byBiZSBzZXQgdXBcbiAgICB0aGlzLnJlc3VsdHMgPSB0aGlzLnByZXZpb3VzU3RhdGUucmVzdWx0cyB8fCBbXTtcblxuICAgIC8vIFdvcmthcm91bmQgZm9yIGlPU1xuICAgIGlmIChzY3JlZW4ub3JpZW50YXRpb24pIHtcbiAgICAgIHNjcmVlbi5vcmllbnRhdGlvbi5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoKSA9PiB7XG4gICAgICAgIHRoaXMuaGFuZGxlT3JpZW50YXRpb25DaGFuZ2UoKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdvcmllbnRhdGlvbmNoYW5nZScsICgpID0+IHtcbiAgICAgICAgdGhpcy5oYW5kbGVPcmllbnRhdGlvbkNoYW5nZSgpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLypcbiAgICAgKiBXb3JrYXJvdW5kIChob3BlZnVsbHkgdGVtcG9yYXJ5KSBmb3IgS2lkc0xvb3BMaXZlIHRoYXQgZm9yIHdoYXRldmVyXG4gICAgICogcmVhc29uIGRvZXMgbm90IHVzZSBoNXAtcmVzaXplci5qcy5cbiAgICAgKi9cbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgKCkgPT4ge1xuICAgICAgdGhpcy5yZXNpemUoKTtcbiAgICB9KTtcblxuICAgIC8qKlxuICAgICAqIEF0dGFjaCBoNXAgaW5zaWRlIHRoZSBnaXZlbiBjb250YWluZXIuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2pRdWVyeX0gJGNvbnRhaW5lciBDb250YWluZXIuXG4gICAgICovXG4gICAgdGhpcy5hdHRhY2ggPSAoJGNvbnRhaW5lcikgPT4ge1xuICAgICAgdGhpcy4kaW5uZXIgPSAkY29udGFpbmVyLmFkZENsYXNzKCdoNXAtZGlhbG9nY2FyZHMnKTtcbiAgICAgIGlmICh0aGlzLnBhcmFtcy5iZWhhdmlvdXIuc2NhbGVUZXh0Tm90Q2FyZCkge1xuICAgICAgICAkY29udGFpbmVyLmFkZENsYXNzKCdoNXAtdGV4dC1zY2FsaW5nJyk7XG4gICAgICB9XG5cbiAgICAgIC8vIEtpZHNMb29wIGN1c3RvbWl6YXRpb24gdG8gcHJldmVudCBkcmFnZ2luZyB0aGUgaW1hZ2VcbiAgICAgIHRoaXMuJGlubmVyLmdldCgwKS5hZGRFdmVudExpc3RlbmVyKCdkcmFnc3RhcnQnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyBPbmx5IHBhc3Mgd2hhdCdzIG5lY2Vzc2FyeVxuICAgICAgY29uc3QgbWFuYWdlclBhcmFtcyA9IHtcbiAgICAgICAgbW9kZTogdGhpcy5wYXJhbXMubW9kZSxcbiAgICAgICAgZGlhbG9nczogdGhpcy5wYXJhbXMuZGlhbG9ncyxcbiAgICAgICAgYXVkaW9Ob3RTdXBwb3J0ZWQ6IHRoaXMucGFyYW1zLmF1ZGlvTm90U3VwcG9ydGVkLFxuICAgICAgICBhbnN3ZXI6IHRoaXMucGFyYW1zLmFuc3dlcixcbiAgICAgICAgc2hvd1N1bW1hcnk6IHRoaXMucGFyYW1zLnNob3dTdW1tYXJ5LFxuICAgICAgICBpbmNvcnJlY3RBbnN3ZXI6IHRoaXMucGFyYW1zLmluY29ycmVjdEFuc3dlcixcbiAgICAgICAgY29ycmVjdEFuc3dlcjogdGhpcy5wYXJhbXMuY29ycmVjdEFuc3dlcixcbiAgICAgICAgcHJvZ3Jlc3NUZXh0OiB0aGlzLnBhcmFtcy5wcm9ncmVzc1RleHQsXG4gICAgICAgIHRpcEJ1dHRvbkxhYmVsOiB0aGlzLnBhcmFtcy50aXBCdXR0b25MYWJlbCxcbiAgICAgICAgYmVoYXZpb3VyOiB7XG4gICAgICAgICAgc2NhbGVUZXh0Tm90Q2FyZDogdGhpcy5wYXJhbXMuYmVoYXZpb3VyLnNjYWxlVGV4dE5vdENhcmQsXG4gICAgICAgICAgbWF4UHJvZmljaWVuY3k6IHRoaXMucGFyYW1zLmJlaGF2aW91ci5tYXhQcm9maWNpZW5jeSxcbiAgICAgICAgICBxdWlja1Byb2dyZXNzaW9uOiB0aGlzLnBhcmFtcy5iZWhhdmlvdXIucXVpY2tQcm9ncmVzc2lvblxuICAgICAgICB9LFxuICAgICAgICBjYXJkUGlsZXM6IHRoaXMucHJldmlvdXNTdGF0ZS5jYXJkUGlsZXNcbiAgICAgIH07XG5cbiAgICAgIHRoaXMuY2FyZE1hbmFnZXIgPSBuZXcgQ2FyZE1hbmFnZXIobWFuYWdlclBhcmFtcywgdGhpcy5pZCwge1xuICAgICAgICBvbkNhcmRUdXJuZWQ6IHRoaXMuaGFuZGxlQ2FyZFR1cm5lZCxcbiAgICAgICAgb25OZXh0Q2FyZDogdGhpcy5uZXh0Q2FyZFxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuY3JlYXRlRE9NKHRoaXMucm91bmQgPT09IDApO1xuXG4gICAgICAvKlxuICAgICAgICogR290byBwcmV2aW91c2x5IHZpZXdlZCBjYXJkLiBJdCB3YXMgcG9zc2libGUgdG8gYWxzbyByZWNvdmVyIHRoZSB0dXJuZWRcbiAgICAgICAqIHN0YXRlLCBidXQgaXQgZmVlbHMgc2Vuc2libGUgdG8gbGV0IHRoZSBwcmV2aW91c2x5IHZpZXdlZCBjYXJkIGJlXG4gICAgICAgKiByZXZpZXdlZCBzdGFydGluZyB3aXRoIHRoZSBmcm9udC5cbiAgICAgICAqL1xuICAgICAgaWYgKHRoaXMucHJldmlvdXNTdGF0ZS5jdXJyZW50Q2FyZElkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGhpcy5nb3RvQ2FyZCh0aGlzLnByZXZpb3VzU3RhdGUuY3VycmVudENhcmRJZCk7XG5cbiAgICAgICAgLy8gU2hvdyBzdW1tYXJ5IGlmIHByZXZpb3VzIHJvdW5kIHdhcyBjb21wbGV0ZWQgYnV0IG5leHQgcm91bmQgbm90IHN0YXJ0ZWQuXG4gICAgICAgIGlmICh0aGlzLnBhcmFtcy5tb2RlID09PSAncmVwZXRpdGlvbicgJiYgdGhpcy5yZXN1bHRzLmxlbmd0aCA9PT0gdGhpcy5jYXJkSWRzLmxlbmd0aCkge1xuICAgICAgICAgIHRoaXMuc2hvd1N1bW1hcnkodHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdGhpcy51cGRhdGVOYXZpZ2F0aW9uKCk7XG4gICAgICB0aGlzLnRyaWdnZXIoJ3Jlc2l6ZScpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgRE9NLlxuICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gZmlyc3RDYWxsIElzIGZpcnN0IGNhbGw/XG4gICAgICovXG4gICAgdGhpcy5jcmVhdGVET00gPSAoZmlyc3RDYWxsKSA9PiB7XG4gICAgICB0aGlzLmNhcmRJZHMgPSAoZmlyc3RDYWxsICYmIHRoaXMucHJldmlvdXNTdGF0ZS5jYXJkSWRzKSA/XG4gICAgICAgIHRoaXMucHJldmlvdXNTdGF0ZS5jYXJkSWRzIDpcbiAgICAgICAgdGhpcy5jYXJkTWFuYWdlci5jcmVhdGVTZWxlY3Rpb24oKTtcblxuICAgICAgdGhpcy5jYXJkUG9vbFNpemUgPSB0aGlzLmNhcmRQb29sU2l6ZSB8fCB0aGlzLmNhcmRNYW5hZ2VyLmdldFNpemUoKTtcblxuICAgICAgaWYgKGZpcnN0Q2FsbCA9PT0gdHJ1ZSkge1xuICAgICAgICBjb25zdCB0aXRsZSA9ICQoJzxkaXY+JyArIHRoaXMucGFyYW1zLnRpdGxlICsgJzwvZGl2PicpLnRleHQoKS50cmltKCk7XG4gICAgICAgIHRoaXMuJGhlYWRlciA9ICQoKHRpdGxlID8gJzxkaXYgY2xhc3M9XCJoNXAtZGlhbG9nY2FyZHMtdGl0bGVcIj48ZGl2IGNsYXNzPVwiaDVwLWRpYWxvZ2NhcmRzLXRpdGxlLWlubmVyXCI+JyArIHRoaXMucGFyYW1zLnRpdGxlICsgJzwvZGl2PjwvZGl2PicgOiAnJykgK1xuICAgICAgICAgICc8ZGl2IGNsYXNzPVwiaDVwLWRpYWxvZ2NhcmRzLWRlc2NyaXB0aW9uXCI+JyArIHRoaXMucGFyYW1zLmRlc2NyaXB0aW9uICsgJzwvZGl2PicpO1xuXG4gICAgICAgIHRoaXMuc3VtbWFyeVNjcmVlbiA9IG5ldyBTdW1tYXJ5U2NyZWVuKHRoaXMucGFyYW1zLCB7bmV4dFJvdW5kOiB0aGlzLm5leHRSb3VuZCwgcmV0cnk6IHRoaXMucmVzdGFydFJlcGV0aXRpb259KTtcbiAgICAgIH1cblxuICAgICAgaWYgKGZpcnN0Q2FsbCA9PT0gdHJ1ZSkge1xuICAgICAgICB0aGlzLiRjYXJkd3JhcHBlclNldCA9IHRoaXMuaW5pdENhcmRzKHRoaXMuY2FyZElkcyk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgdGhpcy4kY2FyZHdyYXBwZXJTZXQuZGV0YWNoKCk7XG4gICAgICAgIHRoaXMuJGNhcmR3cmFwcGVyU2V0ID0gdGhpcy5pbml0Q2FyZHModGhpcy5jYXJkSWRzKTtcbiAgICAgICAgdGhpcy4kY2FyZFNpZGVBbm5vdW5jZXIuYmVmb3JlKHRoaXMuJGNhcmR3cmFwcGVyU2V0KTtcbiAgICAgIH1cblxuICAgICAgdGhpcy4kY2FyZHdyYXBwZXJTZXQucHJlcGVuZCh0aGlzLnN1bW1hcnlTY3JlZW4uZ2V0RE9NKCkpO1xuXG4gICAgICBpZiAoZmlyc3RDYWxsID09PSB0cnVlKSB7XG4gICAgICAgIHRoaXMuJGNhcmRTaWRlQW5ub3VuY2VyID0gJCgnPGRpdj4nLCB7XG4gICAgICAgICAgaHRtbDogdGhpcy5wYXJhbXMuY2FyZEZyb250TGFiZWwsXG4gICAgICAgICAgJ2NsYXNzJzogJ2g1cC1kaWFsb2djYXJkcy1jYXJkLXNpZGUtYW5ub3VuY2VyJyxcbiAgICAgICAgICAnYXJpYS1saXZlJzogJ3BvbGl0ZScsXG4gICAgICAgICAgJ2FyaWEtaGlkZGVuJzogJ3RydWUnXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuJGZvb3RlciA9IHRoaXMuY3JlYXRlRm9vdGVyKCk7XG5cbiAgICAgICAgdGhpcy4kbWFpbkNvbnRlbnQgPSAkKCc8ZGl2PicpXG4gICAgICAgICAgLmFwcGVuZCh0aGlzLiRoZWFkZXIpXG4gICAgICAgICAgLmFwcGVuZCh0aGlzLiRjYXJkd3JhcHBlclNldClcbiAgICAgICAgICAuYXBwZW5kKHRoaXMuJGNhcmRTaWRlQW5ub3VuY2VyKVxuICAgICAgICAgIC5hcHBlbmQodGhpcy4kZm9vdGVyKVxuICAgICAgICAgIC5hcHBlbmRUbyh0aGlzLiRpbm5lcik7XG5cbiAgICAgICAgLy8gTm8gY2FyZCBoYXMgdGV4dHNcbiAgICAgICAgaWYgKHRoaXMuaGFzTm9UZXh0cykge1xuICAgICAgICAgIHRoaXMuY2FyZHMuZm9yRWFjaChjYXJkID0+IHtcbiAgICAgICAgICAgIGNhcmQuc2V0Tm9UZXh0KCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLm9uKCdyZXNldCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICB0aGlzLnJlc2V0KCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMub24oJ3Jlc2l6ZScsIHRoaXMucmVzaXplKTtcblxuICAgICAgICAvLyBTZXQgcm91bmQgdG8gcHJldmlvdXMgc3RhdGUgaWYgYXZhaWxhYmxlXG4gICAgICAgIHRoaXMucm91bmQgPSAodGhpcy5wcmV2aW91c1N0YXRlLnJvdW5kICE9PSB1bmRlZmluZWQpID8gdGhpcy5wcmV2aW91c1N0YXRlLnJvdW5kIDogMTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGZvb3Rlci9uYXZpZ2F0aW9uIGxpbmVcbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHsqfGpRdWVyeXxIVE1MRWxlbWVudH0gRm9vdGVyIGVsZW1lbnRcbiAgICAgKi9cbiAgICB0aGlzLmNyZWF0ZUZvb3RlciA9ICgpID0+IHtcbiAgICAgIGNvbnN0ICRmb290ZXIgPSAkKCc8bmF2PicsIHtcbiAgICAgICAgJ2NsYXNzJzogJ2g1cC1kaWFsb2djYXJkcy1mb290ZXInLFxuICAgICAgICAncm9sZSc6ICduYXZpZ2F0aW9uJ1xuICAgICAgfSk7XG5cbiAgICAgIGlmICh0aGlzLnBhcmFtcy5tb2RlID09PSAnbm9ybWFsJykge1xuICAgICAgICB0aGlzLiRwcmV2ID0gSm91YmVsVUkuY3JlYXRlQnV0dG9uKHtcbiAgICAgICAgICAnY2xhc3MnOiAnaDVwLWRpYWxvZ2NhcmRzLWZvb3Rlci1idXR0b24gaDVwLWRpYWxvZ2NhcmRzLXByZXYgdHJ1bmNhdGVkJyxcbiAgICAgICAgICAnYXJpYS1sYWJlbCc6IHRoaXMucGFyYW1zLnByZXYsXG4gICAgICAgICAgJ3RpdGxlJzogdGhpcy5wYXJhbXMucHJldlxuICAgICAgICB9KS5jbGljaygoKSA9PiB7XG4gICAgICAgICAgdGhpcy5wcmV2Q2FyZCgpO1xuICAgICAgICB9KS5hcHBlbmRUbygkZm9vdGVyKTtcblxuICAgICAgICB0aGlzLiRuZXh0ID0gSm91YmVsVUkuY3JlYXRlQnV0dG9uKHtcbiAgICAgICAgICAnY2xhc3MnOiAnaDVwLWRpYWxvZ2NhcmRzLWZvb3Rlci1idXR0b24gaDVwLWRpYWxvZ2NhcmRzLW5leHQgdHJ1bmNhdGVkJyxcbiAgICAgICAgICAnYXJpYS1sYWJlbCc6IHRoaXMucGFyYW1zLm5leHQsXG4gICAgICAgICAgJ3RpdGxlJzogdGhpcy5wYXJhbXMubmV4dFxuICAgICAgICB9KS5jbGljaygoKSA9PiB7XG4gICAgICAgICAgdGhpcy5uZXh0Q2FyZCgpO1xuICAgICAgICB9KS5hcHBlbmRUbygkZm9vdGVyKTtcblxuICAgICAgICB0aGlzLiRyZXRyeSA9IEpvdWJlbFVJLmNyZWF0ZUJ1dHRvbih7XG4gICAgICAgICAgJ2NsYXNzJzogJ2g1cC1kaWFsb2djYXJkcy1mb290ZXItYnV0dG9uIGg1cC1kaWFsb2djYXJkcy1yZXRyeSBoNXAtZGlhbG9nY2FyZHMtZGlzYWJsZWQnLFxuICAgICAgICAgICd0aXRsZSc6IHRoaXMucGFyYW1zLnJldHJ5LFxuICAgICAgICAgICdodG1sJzogdGhpcy5wYXJhbXMucmV0cnlcbiAgICAgICAgfSkuY2xpY2soKCkgPT4ge1xuICAgICAgICAgIHRoaXMudHJpZ2dlcigncmVzZXQnKTtcbiAgICAgICAgfSkuYXBwZW5kVG8oJGZvb3Rlcik7XG5cbiAgICAgICAgdGhpcy4kcHJvZ3Jlc3MgPSAkKCc8ZGl2PicsIHtcbiAgICAgICAgICAnaWQnOiAnaDVwLWRpYWxvZ2NhcmRzLXByb2dyZXNzLScgKyBEaWFsb2djYXJkcy5pZENvdW50ZXIsXG4gICAgICAgICAgJ2NsYXNzJzogJ2g1cC1kaWFsb2djYXJkcy1wcm9ncmVzcycsXG4gICAgICAgICAgJ2FyaWEtbGl2ZSc6ICdhc3NlcnRpdmUnXG4gICAgICAgIH0pLmFwcGVuZFRvKCRmb290ZXIpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHRoaXMuJHJvdW5kID0gJCgnPGRpdj4nLCB7XG4gICAgICAgICAgJ2NsYXNzJzogJ2g1cC1kaWFsb2djYXJkcy1yb3VuZCdcbiAgICAgICAgfSkuYXBwZW5kVG8oJGZvb3Rlcik7XG5cbiAgICAgICAgdGhpcy4kcHJvZ3Jlc3MgPSAkKCc8ZGl2PicsIHtcbiAgICAgICAgICAnY2xhc3MnOiAnaDVwLWRpYWxvZ2NhcmRzLWNhcmRzLWxlZnQnLFxuICAgICAgICAgICdhcmlhLWxpdmUnOiAnYXNzZXJ0aXZlJ1xuICAgICAgICB9KS5hcHBlbmRUbygkZm9vdGVyKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuICRmb290ZXI7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIENhbGxlZCB3aGVuIGFsbCBjYXJkcyBoYXMgYmVlbiBsb2FkZWQuXG4gICAgICovXG4gICAgdGhpcy51cGRhdGVJbWFnZVNpemUgPSAoKSA9PiB7XG4gICAgICAvLyBGaW5kIGhpZ2hlc3QgY2FyZCBjb250ZW50XG4gICAgICBsZXQgcmVsYXRpdmVIZWlnaHRDYXAgPSAxNTtcbiAgICAgIGxldCBoZWlnaHQgPSAwO1xuXG4gICAgICBjb25zdCAkY3VycmVudENhcmRDb250ZW50ID0gdGhpcy5jYXJkc1t0aGlzLmN1cnJlbnRDYXJkSWRdLmdldERPTSgpLmZpbmQoJy5oNXAtZGlhbG9nY2FyZHMtY2FyZC1jb250ZW50Jyk7XG5cbiAgICAgIHRoaXMucGFyYW1zLmRpYWxvZ3MuZm9yRWFjaChkaWFsb2cgPT4ge1xuICAgICAgICBsZXQgaW1hZ2VIZWlnaHQ7XG5cbiAgICAgICAgaWYgKGRpYWxvZy5mcm9udC5pbWFnZSkge1xuICAgICAgICAgIGltYWdlSGVpZ2h0ID0gZGlhbG9nLmZyb250LmltYWdlLmhlaWdodCAvIGRpYWxvZy5mcm9udC5pbWFnZS53aWR0aCAqICRjdXJyZW50Q2FyZENvbnRlbnQuZ2V0KDApLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoO1xuICAgICAgICAgIGlmIChpbWFnZUhlaWdodCA+IGhlaWdodCkge1xuICAgICAgICAgICAgaGVpZ2h0ID0gaW1hZ2VIZWlnaHQ7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGRpYWxvZy5iYWNrLmltYWdlKSB7XG4gICAgICAgICAgaW1hZ2VIZWlnaHQgPSBkaWFsb2cuYmFjay5pbWFnZS5oZWlnaHQgLyBkaWFsb2cuYmFjay5pbWFnZS53aWR0aCAqICRjdXJyZW50Q2FyZENvbnRlbnQuZ2V0KDApLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoO1xuICAgICAgICAgIGlmIChpbWFnZUhlaWdodCA+IGhlaWdodCkge1xuICAgICAgICAgICAgaGVpZ2h0ID0gaW1hZ2VIZWlnaHQ7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgaWYgKGhlaWdodCA+IDApIHtcbiAgICAgICAgbGV0IHJlbGF0aXZlSW1hZ2VIZWlnaHQgPSBoZWlnaHQgLyBwYXJzZUZsb2F0KHRoaXMuJGlubmVyLmNzcygnZm9udC1zaXplJykpO1xuICAgICAgICBpZiAocmVsYXRpdmVJbWFnZUhlaWdodCA+IHJlbGF0aXZlSGVpZ2h0Q2FwKSB7XG4gICAgICAgICAgcmVsYXRpdmVJbWFnZUhlaWdodCA9IHJlbGF0aXZlSGVpZ2h0Q2FwO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY2FyZHMuZm9yRWFjaChjYXJkID0+IHtcbiAgICAgICAgICBjYXJkLnNldEltYWdlSGVpZ2h0KGAke3JlbGF0aXZlSW1hZ2VIZWlnaHR9ZW1gKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYWxsIGNhcmRzIGFuZCBhcHBlbmRzIHRoZW0gdG8gY2FyZCB3cmFwcGVyLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtvYmplY3RbXX0gY2FyZElkcyBDYXJkIGlkcy5cbiAgICAgKiBAcmV0dXJucyB7KnxqUXVlcnl8SFRNTEVsZW1lbnR9IENhcmQgd3JhcHBlciBzZXRcbiAgICAgKi9cbiAgICB0aGlzLmluaXRDYXJkcyA9IChjYXJkSWRzKSA9PiB7XG4gICAgICBjb25zdCBpbml0TG9hZCA9IDI7XG4gICAgICB0aGlzLmNhcmRzID0gW107XG4gICAgICB0aGlzLmN1cnJlbnRDYXJkSWQgPSAwO1xuXG4gICAgICAvLyBSYW5kb21pemUgY2FyZHMgb3JkZXJcbiAgICAgIGlmICh0aGlzLnBhcmFtcy5iZWhhdmlvdXIucmFuZG9tQ2FyZHMpIHtcbiAgICAgICAgY2FyZElkcyA9IEg1UC5zaHVmZmxlQXJyYXkoY2FyZElkcyk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0ICRjYXJkd3JhcHBlclNldCA9ICQoJzxkaXY+Jywge1xuICAgICAgICAnY2xhc3MnOiAnaDVwLWRpYWxvZ2NhcmRzLWNhcmR3cmFwLXNldCdcbiAgICAgIH0pO1xuXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNhcmRJZHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgLy8gTG9hZCBjYXJkcyBwcm9ncmVzc2l2ZWx5XG4gICAgICAgIGlmIChpID49IGluaXRMb2FkKSB7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBjYXJkID0gdGhpcy5nZXRDYXJkKGNhcmRJZHNbaV0pO1xuICAgICAgICBjYXJkLnNldFByb2dyZXNzVGV4dChpICsgMSwgY2FyZElkcy5sZW5ndGgpO1xuXG4gICAgICAgIHRoaXMuY2FyZHMucHVzaChjYXJkKTtcbiAgICAgICAgY29uc3QgJGNhcmRXcmFwcGVyID0gY2FyZC5nZXRET00oKTtcblxuICAgICAgICAvLyBTZXQgY3VycmVudCBjYXJkXG4gICAgICAgIGlmIChpID09PSB0aGlzLmN1cnJlbnRDYXJkSWQpIHtcbiAgICAgICAgICAkY2FyZFdyYXBwZXIuYWRkQ2xhc3MoJ2g1cC1kaWFsb2djYXJkcy1jdXJyZW50Jyk7XG4gICAgICAgICAgdGhpcy4kY3VycmVudCA9ICRjYXJkV3JhcHBlcjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNhcmQuYWRkVGlwVG9DYXJkKCRjYXJkV3JhcHBlci5maW5kKCcuaDVwLWRpYWxvZ2NhcmRzLWNhcmQtY29udGVudCcpLCAnZnJvbnQnLCBpKTtcblxuICAgICAgICAkY2FyZHdyYXBwZXJTZXQuYXBwZW5kKCRjYXJkV3JhcHBlcik7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiAkY2FyZHdyYXBwZXJTZXQ7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEhhbmRsZSBjYXJkIHR1cm5lZC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gdHVybmVkIC0gVHJ1ZSwgaWYgY2FyZCBpcyB0dXJuZWQuXG4gICAgICovXG4gICAgdGhpcy5oYW5kbGVDYXJkVHVybmVkID0gKHR1cm5lZCkgPT4ge1xuICAgICAgLy8gYTExeSBub3RpZmljYXRpb25cbiAgICAgIHRoaXMuJGNhcmRTaWRlQW5ub3VuY2VyLmh0bWwodHVybmVkID8gdGhpcy5wYXJhbXMuY2FyZEZyb250TGFiZWwgOiB0aGlzLnBhcmFtcy5jYXJkQmFja0xhYmVsKTtcblxuICAgICAgLy8gcmV0cnkgYnV0dG9uXG4gICAgICBpZiAodGhpcy5wYXJhbXMuYmVoYXZpb3VyLmVuYWJsZVJldHJ5ICYmIHRoaXMuY3VycmVudENhcmRJZCArIDEgPT09IHRoaXMuY2FyZElkcy5sZW5ndGgpIHtcbiAgICAgICAgaWYgKHRoaXMuJHJldHJ5KSB7XG4gICAgICAgICAgdGhpcy4kcmV0cnkucmVtb3ZlQ2xhc3MoJ2g1cC1kaWFsb2djYXJkcy1kaXNhYmxlZCcpO1xuICAgICAgICAgIHRoaXMudHJ1bmNhdGVSZXRyeUJ1dHRvbigpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZSBuYXZpZ2F0aW9uIHRleHQgYW5kIHNob3cgb3IgaGlkZSBidXR0b25zLlxuICAgICAqL1xuICAgIHRoaXMudXBkYXRlTmF2aWdhdGlvbiA9ICgpID0+IHtcbiAgICAgIGlmICh0aGlzLnBhcmFtcy5tb2RlID09PSAnbm9ybWFsJykge1xuICAgICAgICAvLyBGaW5hbCBjYXJkXG4gICAgICAgIGlmICh0aGlzLmdldEN1cnJlbnRTZWxlY3Rpb25JbmRleCgpIDwgdGhpcy5jYXJkSWRzLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICB0aGlzLiRuZXh0LnJlbW92ZUNsYXNzKCdoNXAtZGlhbG9nY2FyZHMtZGlzYWJsZWQnKTtcbiAgICAgICAgICB0aGlzLiRyZXRyeS5hZGRDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLWRpc2FibGVkJyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgdGhpcy4kbmV4dC5hZGRDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLWRpc2FibGVkJyk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBGaXJzdCBjYXJkXG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRDYXJkSWQgPiAwICYmICF0aGlzLnBhcmFtcy5iZWhhdmlvdXIuZGlzYWJsZUJhY2t3YXJkc05hdmlnYXRpb24pIHtcbiAgICAgICAgICB0aGlzLiRwcmV2LnJlbW92ZUNsYXNzKCdoNXAtZGlhbG9nY2FyZHMtZGlzYWJsZWQnKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICB0aGlzLiRwcmV2LmFkZENsYXNzKCdoNXAtZGlhbG9nY2FyZHMtZGlzYWJsZWQnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuJHByb2dyZXNzLnRleHQodGhpcy5wYXJhbXMucHJvZ3Jlc3NUZXh0XG4gICAgICAgICAgLnJlcGxhY2UoJ0BjYXJkJywgdGhpcy5nZXRDdXJyZW50U2VsZWN0aW9uSW5kZXgoKSArIDEpXG4gICAgICAgICAgLnJlcGxhY2UoJ0B0b3RhbCcsIHRoaXMuY2FyZElkcy5sZW5ndGgpXG4gICAgICAgICk7XG5cbiAgICAgICAgLy8gTG9va3Mgc3RyYW5nZSwgYnV0IHRoZSBJZHMgZ2V0IG1peGVkIHVwIGVsc2V3aGVyZVxuICAgICAgICB0aGlzLmNhcmRzW3RoaXMuZmluZENhcmRQb3NpdGlvbih0aGlzLmNhcmRzW3RoaXMuY3VycmVudENhcmRJZF0uaWQpXS5yZXNpemVPdmVyZmxvd2luZ1RleHQoKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICB0aGlzLiRyb3VuZC50ZXh0KHRoaXMucGFyYW1zLnJvdW5kLnJlcGxhY2UoJ0Byb3VuZCcsIHRoaXMucm91bmQpKTtcbiAgICAgICAgY29uc3Qgc2VsZWN0aW9uSW5kZXggPSB0aGlzLmdldEN1cnJlbnRTZWxlY3Rpb25JbmRleCgpO1xuICAgICAgICB0aGlzLiRwcm9ncmVzcy50ZXh0KHRoaXMucGFyYW1zLmNhcmRzTGVmdC5yZXBsYWNlKCdAbnVtYmVyJywgdGhpcy5jYXJkSWRzLmxlbmd0aCAtIHNlbGVjdGlvbkluZGV4KSk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMudHJpZ2dlcigncmVzaXplJyk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFNob3cgc3VtbWFyeSBzY3JlZW4uXG4gICAgICogQHBhcmFtIHtib29sZWFufSBbcHJldmlvdXNTdGF0ZSA9IGZhbHNlXSBJZiB0cnVlLCBwaWxlcyB3aWxsIG5vdCBiZSB1cGRhdGVkLlxuICAgICAqL1xuICAgIHRoaXMuc2hvd1N1bW1hcnkgPSAocHJldmlvdXNTdGF0ZSA9IGZhbHNlKSA9PiB7XG4gICAgICAvLyBVcGRhdGUgcGlsZXMgYW5kIHJldHJpZXZlIHRoZSBuZXcgcGlsZSBzaXplc1xuICAgICAgY29uc3QgbmV3UGlsZVNpemVzID0gKHByZXZpb3VzU3RhdGUpID9cbiAgICAgICAgdGhpcy5jYXJkTWFuYWdlci5nZXRQaWxlU2l6ZXMoKSA6XG4gICAgICAgIHRoaXMuY2FyZE1hbmFnZXIudXBkYXRlUGlsZXModGhpcy5yZXN1bHRzKTtcblxuICAgICAgY29uc3QgcmlnaHQgPSB0aGlzLnJlc3VsdHMuZmlsdGVyKHJlc3VsdCA9PiByZXN1bHQucmVzdWx0ID09PSB0cnVlKS5sZW5ndGg7XG4gICAgICBjb25zdCB3cm9uZyA9IHRoaXMucmVzdWx0cy5sZW5ndGggLSByaWdodDtcbiAgICAgIGNvbnN0IG5vdFNob3duID0gdGhpcy5jYXJkUG9vbFNpemUgLSByaWdodCAtIHdyb25nO1xuICAgICAgY29uc3QgY29tcGxldGVkID0gbmV3UGlsZVNpemVzLnNsaWNlKC0xKVswXTtcbiAgICAgIGNvbnN0IGRvbmUgPSBjb21wbGV0ZWQgPT09IHRoaXMuY2FyZFBvb2xTaXplO1xuXG4gICAgICBjb25zdCBzdW1tYXJ5ID0ge1xuICAgICAgICByb3VuZDogdGhpcy5yb3VuZCxcbiAgICAgICAgcmVzdWx0czogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIGZpZWxkOiAnaDVwLWRpYWxvZ2NhcmRzLXJvdW5kLWNhcmRzLXJpZ2h0JyxcbiAgICAgICAgICAgIHNjb3JlOiB7dmFsdWU6IHJpZ2h0LCBtYXg6IHdyb25nICsgcmlnaHR9XG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBmaWVsZDogJ2g1cC1kaWFsb2djYXJkcy1yb3VuZC1jYXJkcy13cm9uZycsXG4gICAgICAgICAgICBzY29yZToge3ZhbHVlOiB3cm9uZywgbWF4OiB3cm9uZyArIHJpZ2h0fVxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgZmllbGQ6ICdoNXAtZGlhbG9nY2FyZHMtcm91bmQtY2FyZHMtbm90LXNob3duJyxcbiAgICAgICAgICAgIHNjb3JlOiB7dmFsdWU6IG5vdFNob3dufVxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgZmllbGQ6ICdoNXAtZGlhbG9nY2FyZHMtb3ZlcmFsbC1jYXJkcy1jb21wbGV0ZWQnLFxuICAgICAgICAgICAgc2NvcmU6IHt2YWx1ZTogY29tcGxldGVkLCBtYXg6IHRoaXMuY2FyZFBvb2xTaXplfVxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgZmllbGQ6ICdoNXAtZGlhbG9nY2FyZHMtb3ZlcmFsbC1jb21wbGV0ZWQtcm91bmRzJyxcbiAgICAgICAgICAgIHNjb3JlOiB7dmFsdWU6IHRoaXMucm91bmR9XG4gICAgICAgICAgfVxuICAgICAgICBdXG4gICAgICB9O1xuXG4gICAgICBpZiAoZG9uZSkge1xuICAgICAgICBzdW1tYXJ5LmRvbmUgPSB0cnVlO1xuICAgICAgICBzdW1tYXJ5Lm1lc3NhZ2UgPSB0aGlzLnBhcmFtcy5zdW1tYXJ5QWxsRG9uZVxuICAgICAgICAgIC5yZXBsYWNlKCdAY2FyZHMnLCB0aGlzLmNhcmRQb29sU2l6ZSlcbiAgICAgICAgICAucmVwbGFjZSgnQG1heCcsIHRoaXMucGFyYW1zLmJlaGF2aW91ci5tYXhQcm9maWNpZW5jeSAtIDEpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLnN1bW1hcnlTY3JlZW4udXBkYXRlKHN1bW1hcnkpO1xuICAgICAgdGhpcy5zdW1tYXJ5U2NyZWVuLnNob3coKTtcbiAgICAgIHRoaXMuaGlkZUNhcmRzKCk7XG5cbiAgICAgIHRoaXMudHJpZ2dlcigncmVzaXplJyk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFNob3cgbWFpbiBjb250ZW50LlxuICAgICAqL1xuICAgIHRoaXMuc2hvd0NhcmRzID0gKCkgPT4ge1xuICAgICAgdGhpcy4kY2FyZHdyYXBwZXJTZXQuZmluZCgnLmg1cC1kaWFsb2djYXJkcy1jYXJkd3JhcCcpLnJlbW92ZUNsYXNzKCdoNXAtZGlhbG9nY2FyZHMtZ29uZScpO1xuICAgICAgdGhpcy4kZm9vdGVyLnJlbW92ZUNsYXNzKCdoNXAtZGlhbG9nY2FyZHMtZ29uZScpO1xuICAgICAgdGhpcy5jYXJkc1Nob3duID0gdHJ1ZTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogSGlkZSBtYWluIGNvbnRlbnQuXG4gICAgICovXG4gICAgdGhpcy5oaWRlQ2FyZHMgPSAoKSA9PiB7XG4gICAgICB0aGlzLiRjYXJkd3JhcHBlclNldC5maW5kKCcuaDVwLWRpYWxvZ2NhcmRzLWNhcmR3cmFwJykuYWRkQ2xhc3MoJ2g1cC1kaWFsb2djYXJkcy1nb25lJyk7XG4gICAgICB0aGlzLiRmb290ZXIuYWRkQ2xhc3MoJ2g1cC1kaWFsb2djYXJkcy1nb25lJyk7XG4gICAgICB0aGlzLmNhcmRzU2hvd24gPSBmYWxzZTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogU2hvdyBuZXh0IGNhcmQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge29iamVjdH0gW3Jlc3VsdF0gT3B0aW9uYWwgcmVzdWx0IG9mIHJlcGV0aXRpb24gbW9kZS5cbiAgICAgKi9cbiAgICB0aGlzLm5leHRDYXJkID0gKHJlc3VsdCkgPT4ge1xuICAgICAgaWYgKHR5cGVvZihyZXN1bHQpICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICB0aGlzLnJlc3VsdHMucHVzaChyZXN1bHQpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmNhcmRzW3RoaXMuY3VycmVudENhcmRJZF0uc3RvcEF1ZGlvKCk7XG5cbiAgICAgIC8vIE9uIGZpbmFsIGNhcmRcbiAgICAgIGlmICh0aGlzLmNhcmRJZHMubGVuZ3RoIC0gdGhpcy5nZXRDdXJyZW50U2VsZWN0aW9uSW5kZXgoKSA9PT0gMSkge1xuICAgICAgICBpZiAodGhpcy5wYXJhbXMubW9kZSA9PT0gJ3JlcGV0aXRpb24nKSB7XG4gICAgICAgICAgdGhpcy4kcHJvZ3Jlc3MudGV4dCh0aGlzLnBhcmFtcy5jYXJkc0xlZnQucmVwbGFjZSgnQG51bWJlcicsIDApKTtcbiAgICAgICAgICB0aGlzLmNhcmRzW3RoaXMuY3VycmVudENhcmRJZF0uc2hvd1N1bW1hcnlCdXR0b24odGhpcy5zaG93U3VtbWFyeSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmdvdG9DYXJkKHRoaXMuZ2V0Q3VycmVudFNlbGVjdGlvbkluZGV4KCkgKyAxKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogR2V0IGNhcmQgZnJvbSBjYXJkIG1hbmFnZXIuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IGlkIENhcmQncyBJZC5cbiAgICAgKiBAcmV0dXJuIHtvYmplY3R9IENhcmQuXG4gICAgICovXG4gICAgdGhpcy5nZXRDYXJkID0gKGlkKSA9PiB7XG4gICAgICBjb25zdCBjYXJkID0gdGhpcy5jYXJkTWFuYWdlci5nZXRDYXJkKGlkKTtcbiAgICAgIGNhcmQuY3JlYXRlQnV0dG9uTGlzdGVuZXJzKCk7XG5cbiAgICAgIHJldHVybiBjYXJkO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBGaW5kIHRoZSBwb3NpdGlvbiBvZiBhIGxvYWRlZCBjYXJkLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBjYXJkSWQgQ2FyZElkIHRvIGxvb2sgZm9yLlxuICAgICAqIEByZXR1cm4ge251bWJlcn0gUG9zaXRpb24gb3IgdW5kZWZpbmVkLlxuICAgICAqL1xuICAgIHRoaXMuZmluZENhcmRQb3NpdGlvbiA9IChjYXJkSWQpID0+IHtcbiAgICAgIGxldCBwb3NpdGlvbjtcblxuICAgICAgdGhpcy5jYXJkcy5mb3JFYWNoKChjYXJkLCBpbmRleCkgPT4ge1xuICAgICAgICBpZiAoIXBvc2l0aW9uICYmIGNhcmQuaWQgPT09IGNhcmRJZCkge1xuICAgICAgICAgIHBvc2l0aW9uID0gaW5kZXg7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gcG9zaXRpb247XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEluc2VydCBhIGNhcmQgaW50byB0aGUgRE9NLlxuICAgICAqIEBwYXJhbSB7Q2FyZH0gY2FyZCBDYXJkIHRvIGluc2VydC5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW2luZGV4XSBQb3NpdGlvbiB0byBpbnNlcnQgY2FyZCBhdC5cbiAgICAgKi9cbiAgICB0aGlzLmluc2VydENhcmRUb0RPTSA9IChjYXJkLCBpbmRleCkgPT4ge1xuICAgICAgY29uc3QgJG5vZGUgPSBjYXJkLmdldERPTSgpO1xuXG4gICAgICAvLyBQdXQgYXQgYXBwcm9wcmlhdGUgcG9zaXRpb24uXG4gICAgICBpZiAoaW5kZXggPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAkbm9kZS5hcHBlbmRUbyh0aGlzLiRjYXJkd3JhcHBlclNldCk7XG4gICAgICB9XG4gICAgICBlbHNlIGlmIChpbmRleCA9PT0gMCkge1xuICAgICAgICB0aGlzLiRjYXJkd3JhcHBlclNldC5wcmVwZW5kKCRub2RlKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICB0aGlzLiRjYXJkd3JhcHBlclNldC5jaGlsZHJlbigpLmVxKGluZGV4KS5hZnRlcigkbm9kZSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEFkZCBoaW50c1xuICAgICAgY2FyZC5hZGRUaXBUb0NhcmQoJG5vZGUuZmluZCgnLmg1cC1kaWFsb2djYXJkcy1jYXJkLWNvbnRlbnQnKSwgJ2Zyb250JywgaW5kZXgpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBHbyB0byBhIHNwZWNpZmljIGNhcmQgaW4gdGhlIHNlbGVjdGlvbi4gQ2FyZHMgbWF5IG5lZWQgdG8gYmUgbG9hZGVkLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSB0YXJnZXRQb3NpdGlvbiBUYXJnZXQgY2FyZCBwb3NpdGlvbi5cbiAgICAgKi9cbiAgICB0aGlzLmdvdG9DYXJkID0gKHRhcmdldFBvc2l0aW9uKSA9PiB7XG4gICAgICBpZiAodGFyZ2V0UG9zaXRpb24gPCAwIHx8IHRhcmdldFBvc2l0aW9uID49IHRoaXMuY2FyZElkcy5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICAvLyBTdG9wIGFjdGlvbiBvbiBjdXJyZW50IGNhcmRcbiAgICAgIGNvbnN0IGN1cnJlbnRDYXJkID0gdGhpcy5jYXJkc1t0aGlzLmN1cnJlbnRDYXJkSWRdO1xuICAgICAgY3VycmVudENhcmQuc3RvcEF1ZGlvKCk7XG4gICAgICBjdXJyZW50Q2FyZC5nZXRET00oKS5yZW1vdmVDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLWN1cnJlbnQnKTtcblxuICAgICAgLy8gR2V0IGNhcmQgcG9zaXRpb25zIHRvIGNoZWNrIGZvciBiZWluZyBsb2FkZWRcbiAgICAgIGNvbnN0IGNoZWNrTG9hZGVkID0gW107XG4gICAgICBpZiAodGFyZ2V0UG9zaXRpb24gPiAwKSB7XG4gICAgICAgIGNoZWNrTG9hZGVkLnB1c2godGFyZ2V0UG9zaXRpb24gLSAxKTtcbiAgICAgIH1cbiAgICAgIGNoZWNrTG9hZGVkLnB1c2godGFyZ2V0UG9zaXRpb24pO1xuICAgICAgaWYgKHRhcmdldFBvc2l0aW9uICsgMSA8IHRoaXMuY2FyZElkcy5sZW5ndGgpIHtcbiAgICAgICAgY2hlY2tMb2FkZWQucHVzaCh0YXJnZXRQb3NpdGlvbiArIDEpO1xuICAgICAgfVxuXG4gICAgICAvLyBMb2FkIGFuZCBpbnNlcnQgdGFyZ2V0IGNhcmQsIHByZWRlY2Vzc29yIGFuZCBzdWNjZXNzb3IgaWYgcmVxdWlyZWQuXG4gICAgICBjaGVja0xvYWRlZC5mb3JFYWNoKHBvc2l0aW9uID0+IHtcbiAgICAgICAgY29uc3QgbG9hZGVkUG9zaXRpb24gPSB0aGlzLmZpbmRDYXJkUG9zaXRpb24odGhpcy5jYXJkSWRzW3Bvc2l0aW9uXSk7XG4gICAgICAgIGlmIChsb2FkZWRQb3NpdGlvbiA9PT0gdW5kZWZpbmVkKSB7XG5cbiAgICAgICAgICAvLyBDYXJkIGhhcyBub3QgYmVlbiBsb2FkZWQuIExvYWQgbm93LlxuICAgICAgICAgIGNvbnN0IGNhcmQgPSB0aGlzLmdldENhcmQodGhpcy5jYXJkSWRzW3Bvc2l0aW9uXSk7XG4gICAgICAgICAgY2FyZC5zZXRQcm9ncmVzc1RleHQocG9zaXRpb24gKyAxLCB0aGlzLmNhcmRJZHMubGVuZ3RoKTtcblxuICAgICAgICAgIC8qXG4gICAgICAgICAgICogVHJ5IHRvIGZpbmQgc3VjY2Vzc29yIGNhcmQgaW4gbG9hZGVkIHBpbGUgYW5kIGluc2VydCBiZWZvcmVcbiAgICAgICAgICAgKiBvciBwdXQgdG8gdGhlIGVuZCBvZiB0aGUgbG9hZGVkIHBpbGUuXG4gICAgICAgICAgICovXG4gICAgICAgICAgY29uc3Qgc3VjY2Vzc29ySWQgPSBNYXRoLm1pbihwb3NpdGlvbiArIDEsIHRoaXMuY2FyZElkcy5sZW5ndGggLSAxKTtcbiAgICAgICAgICBjb25zdCBzdWNjZXNzb3IgPSB0aGlzLmZpbmRDYXJkUG9zaXRpb24odGhpcy5jYXJkSWRzW3N1Y2Nlc3NvcklkXSk7XG4gICAgICAgICAgY29uc3QgaW5zZXJ0UG9zaXRpb24gPSBzdWNjZXNzb3IgfHwgdGhpcy5jYXJkcy5sZW5ndGg7XG5cbiAgICAgICAgICB0aGlzLmNhcmRzLnNwbGljZShpbnNlcnRQb3NpdGlvbiwgMCwgY2FyZCk7XG4gICAgICAgICAgdGhpcy5pbnNlcnRDYXJkVG9ET00oY2FyZCwgaW5zZXJ0UG9zaXRpb24pO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgdGhpcy5yZXNpemUoKTtcblxuICAgICAgLy8gUmV0cmlldmUgcG9zaXRpb24gb2YgaWQgbm93IGluICpsb2FkZWQgY2FyZHMqXG4gICAgICB0YXJnZXRQb3NpdGlvbiA9IHRoaXMuZmluZENhcmRQb3NpdGlvbih0aGlzLmNhcmRJZHNbdGFyZ2V0UG9zaXRpb25dKTtcblxuICAgICAgLy8gU2V0IGNsYXNzZXMgZm9yIGNhcmQgb3JkZXIvZGlzcGxheVxuICAgICAgdGhpcy5jYXJkcy5mb3JFYWNoKChjYXJkLCBpbmRleCkgPT4ge1xuICAgICAgICBpZiAoaW5kZXggPCB0YXJnZXRQb3NpdGlvbikge1xuICAgICAgICAgIGNhcmQuZ2V0RE9NKCkuYWRkQ2xhc3MoJ2g1cC1kaWFsb2djYXJkcy1wcmV2aW91cycpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIGNhcmQuZ2V0RE9NKCkucmVtb3ZlQ2xhc3MoJ2g1cC1kaWFsb2djYXJkcy1wcmV2aW91cycpO1xuXG4gICAgICAgICAgaWYgKGluZGV4ID09PSB0YXJnZXRQb3NpdGlvbikge1xuICAgICAgICAgICAgY2FyZC5nZXRET00oKS5hZGRDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLWN1cnJlbnQnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLmN1cnJlbnRDYXJkSWQgPSB0YXJnZXRQb3NpdGlvbjtcbiAgICAgIHRoaXMudXBkYXRlTmF2aWdhdGlvbigpO1xuICAgICAgdGhpcy5jYXJkc1t0aGlzLmN1cnJlbnRDYXJkSWRdLnNldENhcmRGb2N1cygpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBTaG93IHByZXZpb3VzIGNhcmQuXG4gICAgICovXG4gICAgdGhpcy5wcmV2Q2FyZCA9ICgpID0+IHtcbiAgICAgIHRoaXMuZ290b0NhcmQodGhpcy5nZXRDdXJyZW50U2VsZWN0aW9uSW5kZXgoKSAtIDEpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBTaG93IGFsbCBhdWRpbyBidXR0b25zXG4gICAgICovXG4gICAgdGhpcy5zaG93QWxsQXVkaW8gPSAoKSA9PiB7XG4gICAgICB0aGlzLiRjYXJkd3JhcHBlclNldC5maW5kKCcuaDVwLWF1ZGlvLWlubmVyJylcbiAgICAgICAgLnJlbW92ZUNsYXNzKCdoaWRlJyk7XG4gICAgfTtcblxuICAgIHRoaXMucmVzdGFydFJlcGV0aXRpb24gPSAoKSA9PiB7XG4gICAgICB0aGlzLmNhcmRNYW5hZ2VyLnJlc2V0KCk7XG4gICAgICB0aGlzLnJvdW5kID0gMDtcblxuICAgICAgdGhpcy5uZXh0Um91bmQoKTtcbiAgICB9O1xuXG4gICAgdGhpcy5uZXh0Um91bmQgPSAoKSA9PiB7XG4gICAgICB0aGlzLnJvdW5kKys7XG4gICAgICB0aGlzLnN1bW1hcnlTY3JlZW4uaGlkZSgpO1xuICAgICAgdGhpcy5zaG93Q2FyZHMoKTtcblxuICAgICAgdGhpcy5yZXNldCgpO1xuICAgICAgdGhpcy5jcmVhdGVET00oKTtcblxuICAgICAgdGhpcy51cGRhdGVOYXZpZ2F0aW9uKCk7XG4gICAgICB0aGlzLmNhcmRzW3RoaXMuY3VycmVudENhcmRJZF0uc2V0Q2FyZEZvY3VzKHRydWUpO1xuXG4gICAgICB0aGlzLnRyaWdnZXIoJ3Jlc2l6ZScpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBSZXNldCB0aGUgdGFzayBzbyB0aGF0IHRoZSB1c2VyIGNhbiBkbyBpdCBhZ2Fpbi5cbiAgICAgKi9cbiAgICB0aGlzLnJlc2V0ID0gKCkgPT4ge1xuICAgICAgdGhpcy5yZXN1bHRzID0gW107XG4gICAgICB0aGlzLmNhcmRzW3RoaXMuY3VycmVudENhcmRJZF0uc3RvcEF1ZGlvKHRoaXMuJGN1cnJlbnQuaW5kZXgoKSk7XG5cbiAgICAgIC8vIFR1cm4gYWxsIGNhcmRzIHRvIGZyb250XG4gICAgICB0aGlzLmNhcmRzLmZvckVhY2goY2FyZCA9PiB7XG4gICAgICAgIGNhcmQucmVzZXQoKTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyBTaG93IGZpcnN0IGNhcmRcbiAgICAgIHRoaXMuY3VycmVudENhcmRJZCA9IDA7XG4gICAgICBpZiAodGhpcy5wYXJhbXMubW9kZSA9PT0gJ25vcm1hbCcpIHtcbiAgICAgICAgdGhpcy5jYXJkc1t0aGlzLmN1cnJlbnRDYXJkSWRdLmdldERPTSgpLmFkZENsYXNzKCdoNXAtZGlhbG9nY2FyZHMtY3VycmVudCcpO1xuICAgICAgfVxuICAgICAgdGhpcy51cGRhdGVOYXZpZ2F0aW9uKCk7XG5cbiAgICAgIGlmICh0aGlzLiRyZXRyeSkge1xuICAgICAgICB0aGlzLiRyZXRyeS5hZGRDbGFzcygnaDVwLWRpYWxvZ2NhcmRzLWRpc2FibGVkJyk7XG4gICAgICB9XG4gICAgICB0aGlzLnNob3dBbGxBdWRpbygpO1xuXG4gICAgICB0aGlzLmNhcmRzW3RoaXMuY3VycmVudENhcmRJZF0ucmVzaXplT3ZlcmZsb3dpbmdUZXh0KCk7XG4gICAgICB0aGlzLmNhcmRzW3RoaXMuY3VycmVudENhcmRJZF0uc2V0Q2FyZEZvY3VzKCk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZSB0aGUgZGltZW5zaW9ucyBvZiB0aGUgdGFzayB3aGVuIHJlc2l6aW5nIHRoZSB0YXNrLlxuICAgICAqL1xuICAgIHRoaXMucmVzaXplID0gKCkgPT4ge1xuICAgICAgY29uc29sZS5sb2coJ0RJQUxPR0NBUkRTOiByZXNpemUnKTtcbiAgICAgIGNvbnNvbGUubG9nKCdESUFMT0dDQVJEUyAoJGNhcmRXcmFwcGVyU2V0KScsIHRoaXMuJGNhcmR3cmFwcGVyU2V0LCB0aGlzLiRjYXJkd3JhcHBlclNldC5vdXRlckhlaWdodCgpKTtcbiAgICAgIGNvbnNvbGUubG9nKCdESUFMT0dDQVJEUyAoY29udGFpbmVyKScsIHRoaXMuJGlubmVyLCB0aGlzLiRpbm5lci5vdXRlckhlaWdodCgpKTtcblxuICAgICAgdGhpcy5oYW5kbGVPcmllbnRhdGlvbkNoYW5nZSgpO1xuXG4gICAgICBsZXQgZGlzcGxheUxpbWl0cyA9IG51bGw7XG5cbiAgICAgIGNvbnN0IHRpdGxlSGVpZ2h0ID0gdGhpcy4kaW5uZXIuZmluZCgnLmg1cC1kaWFsb2djYXJkcy10aXRsZScpLm91dGVySGVpZ2h0KCkgfHwgMDtcbiAgICAgIGNvbnN0IGRlc2NyaXB0aW9uSGVpZ2h0ID0gdGhpcy4kaW5uZXIuZmluZCgnLmg1cC1kaWFsb2djYXJkcy1kZXNjcmlwdGlvbicpLm91dGVySGVpZ2h0KHRydWUpIHx8IDA7XG4gICAgICBjb25zdCBmb290ZXJIZWlnaHQgPSB0aGlzLiRmb290ZXIub3V0ZXJIZWlnaHQoKSB8fCAwO1xuXG4gICAgICBjb25zdCBub25DYXJkSGVpZ2h0ID0gdGl0bGVIZWlnaHQgKyBkZXNjcmlwdGlvbkhlaWdodCArIGZvb3RlckhlaWdodDtcblxuICAgICAgY29uc3QgaXNNb2JpbGVMYW5kc2NhcGUgPSB0aGlzLmlzTW9iaWxlTGFuZHNjYXBlKCk7XG5cbiAgICAgIGlmIChwYXJzZUludCh0aGlzLiRjYXJkd3JhcHBlclNldC5jc3MoJ2hlaWdodCcpKSA9PT0gMCkge1xuICAgICAgICBjb25zb2xlLmxvZygnRElBTE9HQ0FSRFMgKHRpdGxlSGVpZ2h0LCBkZXNjcmlwdGlvbkhlaWdodCwgZm9vdGVySGVpZ2h0LCBub25DYXJkSGVpZ2h0LCBpc01vYmlsZUxhbmRzY2FwZSknLCB0aXRsZUhlaWdodCwgZGVzY3JpcHRpb25IZWlnaHQsIGZvb3RlckhlaWdodCwgbm9uQ2FyZEhlaWdodCwgaXNNb2JpbGVMYW5kc2NhcGUpO1xuICAgICAgfVxuXG4gICAgICAvLyBDaGFuZ2UgbGFuZHNjYXBlIGxheW91dCBvbiBtb2JpbGVcbiAgICAgIGlmIChcbiAgICAgICAgdHlwZW9mIHdpbmRvdy5vcmllbnRhdGlvbiA9PT0gJ251bWJlcicgJiZcbiAgICAgICAgdGhpcy4kY2FyZHdyYXBwZXJTZXQuZmluZCgnLmg1cC1kaWFsb2djYXJkcy1zdW1tYXJ5LXNjcmVlbicpLmhhc0NsYXNzKCdoNXAtZGlhbG9nY2FyZHMtZ29uZScpICYmXG4gICAgICAgIHRoaXMucGFyYW1zLmJlaGF2aW91ci5zY2FsZVRleHROb3RDYXJkXG4gICAgICApIHtcbiAgICAgICAgdGhpcy4kaW5uZXIudG9nZ2xlQ2xhc3MoJ2g1cC1sYW5kc2NhcGUnLCBpc01vYmlsZUxhbmRzY2FwZSk7XG5cbiAgICAgICAgaWYgKGlzTW9iaWxlTGFuZHNjYXBlKSB7XG4gICAgICAgICAgZGlzcGxheUxpbWl0cyA9ICh0aGlzLmlzUm9vdCgpKSA/IHRoaXMuY29tcHV0ZURpc3BsYXlMaW1pdHNLTEwoKSA6IG51bGw7XG5cbiAgICAgICAgICBjb25zdCBzY3JlZW5IZWlnaHQgPSAodGhpcy5pc0lPUygpICYmIGlzTW9iaWxlTGFuZHNjYXBlKSA/XG4gICAgICAgICAgICBzY3JlZW4ud2lkdGggOlxuICAgICAgICAgICAgc2NyZWVuLmhlaWdodDtcblxuICAgICAgICAgIGlmIChkaXNwbGF5TGltaXRzPy5oZWlnaHQgPT09IDEpIHtcbiAgICAgICAgICAgIGRpc3BsYXlMaW1pdHMuaGVpZ2h0ID0gc2NyZWVuSGVpZ2h0O1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChkaXNwbGF5TGltaXRzPy5oZWlnaHQpIHtcbiAgICAgICAgICAgIHRoaXMuJGNhcmR3cmFwcGVyU2V0LmNzcygnbWF4LWhlaWdodCcsIGAke2Rpc3BsYXlMaW1pdHMuaGVpZ2h0IC0gbm9uQ2FyZEhlaWdodH1weGApO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuJGNhcmR3cmFwcGVyU2V0LmNzcygnbWF4LWhlaWdodCcsICcnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICB0aGlzLiRjYXJkd3JhcHBlclNldC5jc3MoJ21heC1oZWlnaHQnLCAnJyk7XG4gICAgICB9XG5cbiAgICAgIGxldCBtYXhIZWlnaHQgPSAwO1xuXG4gICAgICBpZiAoIWRpc3BsYXlMaW1pdHMgfHwgIWlzTW9iaWxlTGFuZHNjYXBlIHx8ICF0aGlzLnBhcmFtcy5iZWhhdmlvdXIuc2NhbGVUZXh0Tm90Q2FyZCkge1xuICAgICAgICB0aGlzLnVwZGF0ZUltYWdlU2l6ZSgpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHRoaXMuY2FyZHMuZm9yRWFjaChjYXJkID0+IHtcbiAgICAgICAgICBjYXJkLnNldEltYWdlSGVpZ2h0KCcnKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGlmICghdGhpcy5wYXJhbXMuYmVoYXZpb3VyLnNjYWxlVGV4dE5vdENhcmQgJiYgdGhpcy5jYXJkc1Nob3duICE9PSBmYWxzZSkge1xuICAgICAgICB0aGlzLmRldGVybWluZUNhcmRTaXplcygpO1xuICAgICAgfVxuXG4gICAgICBpZiAoIXRoaXMucGFyYW1zLmJlaGF2aW91ci5zY2FsZVRleHROb3RDYXJkIHx8ICFpc01vYmlsZUxhbmRzY2FwZSB8fCAhZGlzcGxheUxpbWl0cz8uaGVpZ2h0IHx8ICF0aGlzLiRjYXJkd3JhcHBlclNldC5maW5kKCcuaDVwLWRpYWxvZ2NhcmRzLXN1bW1hcnktc2NyZWVuJykuaGFzQ2xhc3MoJ2g1cC1kaWFsb2djYXJkcy1nb25lJykpIHtcbiAgICAgICAgLy8gUmVzZXQgY2FyZC13cmFwcGVyLXNldCBoZWlnaHRcbiAgICAgICAgdGhpcy4kY2FyZHdyYXBwZXJTZXQuY3NzKCdoZWlnaHQnLCAnYXV0bycpO1xuXG4gICAgICAgIC8vIEZpbmQgbWF4IHJlcXVpcmVkIGhlaWdodCBmb3IgYWxsIGNhcmRzXG4gICAgICAgIHRoaXMuJGNhcmR3cmFwcGVyU2V0LmNoaWxkcmVuKCc6bm90KC5oNXAtZGlhbG9nY2FyZHMtZ29uZSknKS5lYWNoKCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgY29uc3Qgd3JhcHBlckhlaWdodCA9ICQodGhpcykuY3NzKCdoZWlnaHQnLCAnJykub3V0ZXJIZWlnaHQoKTtcblxuICAgICAgICAgIGNvbnN0IGNvbXB1dGVkSGVpZ2h0ID0gcGFyc2VGbG9hdCgkKHRoaXMpLmZpbmQoJy5oNXAtZGlhbG9nY2FyZHMtY2FyZC1jb250ZW50JykuY3NzKCdwYWRkaW5nLXRvcCcpKSArXG4gICAgICAgICAgICBwYXJzZUZsb2F0KCQodGhpcykuZmluZCgnLmg1cC1kaWFsb2djYXJkcy1jYXJkLWNvbnRlbnQnKS5jc3MoJ3BhZGRpbmctYm90dG9tJykpICtcbiAgICAgICAgICAgICQodGhpcykuZmluZCgnLmg1cC1kaWFsb2djYXJkcy1pbWFnZS13cmFwcGVyJykub3V0ZXJIZWlnaHQoKSArXG4gICAgICAgICAgICAkKHRoaXMpLmZpbmQoJy5oNXAtZGlhbG9nY2FyZHMtY2FyZC10ZXh0LXdyYXBwZXInKS5vdXRlckhlaWdodCgpO1xuXG4gICAgICAgICAgY29uc29sZS5sb2cod3JhcHBlckhlaWdodCwgJ3ZzJywgY29tcHV0ZWRIZWlnaHQpO1xuXG4gICAgICAgICAgJCh0aGlzKS5jc3MoJ2hlaWdodCcsICdpbmhlcml0Jyk7XG4gICAgICAgICAgbWF4SGVpZ2h0ID0gTWF0aC5tYXgod3JhcHBlckhlaWdodCwgbWF4SGVpZ2h0KTtcblxuICAgICAgICAgIC8vIENoZWNrIGhlaWdodFxuICAgICAgICAgIGlmICghJCh0aGlzKS5uZXh0KCcuaDVwLWRpYWxvZ2NhcmRzLWNhcmR3cmFwJykubGVuZ3RoKSB7XG4gICAgICAgICAgICBjb25zdCBpbml0aWFsSGVpZ2h0ID0gJCh0aGlzKS5maW5kKCcuaDVwLWRpYWxvZ2NhcmRzLWNhcmRob2xkZXInKS5jc3MoJ2hlaWdodCcsICdpbml0aWFsJykub3V0ZXJIZWlnaHQoKTtcbiAgICAgICAgICAgIG1heEhlaWdodCA9IE1hdGgubWF4KGluaXRpYWxIZWlnaHQsIG1heEhlaWdodCk7XG4gICAgICAgICAgICAkKHRoaXMpLmZpbmQoJy5oNXAtZGlhbG9nY2FyZHMtY2FyZGhvbGRlcicpLmNzcygnaGVpZ2h0JywgJ2luaGVyaXQnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnNvbGUubG9nKCdESUFMT0dDQVJEUyAoaGVpZ2h0IGNvbXB1dGF0aW9uKScsIG1heEhlaWdodCwgcGFyc2VGbG9hdCh0aGlzLiRjYXJkd3JhcHBlclNldC5jc3MoJ2ZvbnQtc2l6ZScpKSk7XG5cbiAgICAgICAgY29uc3QgcmVsYXRpdmVNYXhIZWlnaHQgPSBtYXhIZWlnaHQgLyBwYXJzZUZsb2F0KHRoaXMuJGNhcmR3cmFwcGVyU2V0LmNzcygnZm9udC1zaXplJykpO1xuICAgICAgICBjb25zb2xlLmxvZygnRElBTE9HQ0FSRFMgKHJlbGF0aXZlTWF4SGVpZ2h0KScsIHJlbGF0aXZlTWF4SGVpZ2h0ICsgJ2VtJyk7XG4gICAgICAgIHRoaXMuJGNhcmR3cmFwcGVyU2V0LmNzcygnaGVpZ2h0JywgcmVsYXRpdmVNYXhIZWlnaHQgKyAnZW0nKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICBpZiAoZGlzcGxheUxpbWl0cz8uaGVpZ2h0IC0gbm9uQ2FyZEhlaWdodCA+IDEpIHtcbiAgICAgICAgICB0aGlzLiRjYXJkd3JhcHBlclNldC5jc3MoJ2hlaWdodCcsIGAke2Rpc3BsYXlMaW1pdHM/LmhlaWdodCAtIG5vbkNhcmRIZWlnaHR9cHhgKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB0aGlzLnNjYWxlVG9GaXRIZWlnaHQoKTtcbiAgICAgIHRoaXMudHJ1bmNhdGVSZXRyeUJ1dHRvbigpO1xuXG4gICAgICB0aGlzLmNhcmRzW3RoaXMuY3VycmVudENhcmRJZF0ucmVzaXplT3ZlcmZsb3dpbmdUZXh0KCk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFJlc2l6ZXMgZWFjaCBjYXJkIHRvIGZpdCBpdHMgdGV4dFxuICAgICAqL1xuICAgIHRoaXMuZGV0ZXJtaW5lQ2FyZFNpemVzID0gKCkgPT4ge1xuICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG5cbiAgICAgIGlmICh0aGlzLmNhcmRTaXplRGV0ZXJtaW5lZCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIC8vIEtlZXAgdHJhY2sgb2Ygd2hpY2ggY2FyZHMgd2UndmUgYWxyZWFkeSBkZXRlcm1pbmVkIHNpemUgZm9yXG4gICAgICAgIHRoaXMuY2FyZFNpemVEZXRlcm1pbmVkID0gW107XG4gICAgICB9XG5cbiAgICAgIC8vIEdvIHRocm91Z2ggZWFjaCBjYXJkXG4gICAgICB0aGlzLiRjYXJkd3JhcHBlclNldC5jaGlsZHJlbignOnZpc2libGUnKS5lYWNoKGZ1bmN0aW9uIChpKSB7XG4gICAgICAgIGNvbnN0IGNhcmRJZCA9IHNlbGYuY2FyZHNbaV0uaWQ7XG5cbiAgICAgICAgaWYgKHNlbGYuY2FyZFNpemVEZXRlcm1pbmVkLmluZGV4T2YoY2FyZElkKSAhPT0gLTEpIHtcbiAgICAgICAgICByZXR1cm47IC8vIEFscmVhZHkgZGV0ZXJtaW5lZCwgbm8gbmVlZCB0byBkZXRlcm1pbmUgYWdhaW4uXG4gICAgICAgIH1cbiAgICAgICAgc2VsZi5jYXJkU2l6ZURldGVybWluZWQucHVzaChjYXJkSWQpO1xuXG4gICAgICAgIC8vIEhlcmUgXCJ0aGlzXCIgcmVmZXJlbmNlcyB0aGUgalF1ZXJ5IG9iamVjdFxuICAgICAgICBjb25zdCAkY29udGVudCA9ICQoJy5oNXAtZGlhbG9nY2FyZHMtY2FyZC1jb250ZW50JywgdGhpcyk7XG4gICAgICAgIGNvbnN0ICR0ZXh0ID0gJCgnLmg1cC1kaWFsb2djYXJkcy1jYXJkLXRleHQtaW5uZXItY29udGVudCcsICRjb250ZW50KTtcblxuICAgICAgICAvLyBHcmFiIHNpemUgd2l0aCB0ZXh0XG4gICAgICAgIGNvbnN0IHRleHRIZWlnaHQgPSAkdGV4dFswXS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5oZWlnaHQ7XG5cbiAgICAgICAgLy8gQ2hhbmdlIHRvIGFuc3dlclxuICAgICAgICBjb25zdCBjdXJyZW50Q2FyZCA9IHNlbGYuY2FyZHNbaV07XG4gICAgICAgIGN1cnJlbnRDYXJkLmNoYW5nZVRleHQoY3VycmVudENhcmQuZ2V0QW5zd2VyKCkpO1xuXG4gICAgICAgIC8vIEdyYWIgc2l6ZSB3aXRoIGFuc3dlclxuICAgICAgICBjb25zdCBhbnN3ZXJIZWlnaHQgPSAkdGV4dFswXS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5oZWlnaHQ7XG5cbiAgICAgICAgLy8gVXNlIGhpZ2hlc3RcbiAgICAgICAgbGV0IHVzZUhlaWdodCA9ICh0ZXh0SGVpZ2h0ID4gYW5zd2VySGVpZ2h0ID8gdGV4dEhlaWdodCA6IGFuc3dlckhlaWdodCk7XG5cbiAgICAgICAgLy8gTWluLiBsaW1pdFxuICAgICAgICBjb25zdCBtaW5IZWlnaHQgPSBwYXJzZUZsb2F0KCR0ZXh0LnBhcmVudCgpLnBhcmVudCgpLmNzcygnbWluSGVpZ2h0JykpO1xuICAgICAgICBpZiAodXNlSGVpZ2h0IDwgbWluSGVpZ2h0KSB7XG4gICAgICAgICAgdXNlSGVpZ2h0ID0gIG1pbkhlaWdodDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIE5vbmUgb2YgdGhlIGNhcmRzIGhhcyB0ZXh0LCBzaHJpbmsgdGV4dCBhcmVhLCBsZWF2ZSBzcGFjZSBmb3IgYXVkaW9cbiAgICAgICAgaWYgKHNlbGYuaGFzTm9UZXh0cykge1xuICAgICAgICAgIGNvbnN0ICRjYXJkVGV4dCA9ICR0ZXh0LmZpbmQoJy5oNXAtZGlhbG9nY2FyZHMtY2FyZC10ZXh0Jyk7XG4gICAgICAgICAgdXNlSGVpZ2h0ID0gc2VsZi5oYXNOb0F1ZGlvcyA/IDAgOiB1c2VIZWlnaHQgLSBwYXJzZUZsb2F0KCRjYXJkVGV4dC5jc3MoJ2hlaWdodCcpKTtcbiAgICAgICAgICAkY2FyZFRleHQuY3NzKCdoZWlnaHQnLCAwKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENvbnZlcnQgdG8gZW1cbiAgICAgICAgY29uc3QgZm9udFNpemUgPSBwYXJzZUZsb2F0KCRjb250ZW50LmNzcygnZm9udFNpemUnKSk7XG4gICAgICAgIHVzZUhlaWdodCAvPSBmb250U2l6ZTtcblxuICAgICAgICAvLyBTZXQgaGVpZ2h0XG4gICAgICAgICR0ZXh0LnBhcmVudCgpLmNzcygnaGVpZ2h0JywgdXNlSGVpZ2h0ICsgJ2VtJyk7XG5cbiAgICAgICAgLy8gQ2hhbmdlIGJhY2sgdG8gdGV4dFxuICAgICAgICBjdXJyZW50Q2FyZC5jaGFuZ2VUZXh0KGN1cnJlbnRDYXJkLmdldFRleHQoKSk7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogU2NhbGVzIHRoZSBjYXJkIGNvbnRlbnRzLlxuICAgICAqL1xuICAgIHRoaXMuc2NhbGVUb0ZpdEhlaWdodCA9ICgpID0+IHtcbiAgICAgIGlmICghdGhpcy4kY2FyZHdyYXBwZXJTZXQgfHwgIXRoaXMuJGNhcmR3cmFwcGVyU2V0LmlzKCc6dmlzaWJsZScpIHx8ICF0aGlzLnBhcmFtcy5iZWhhdmlvdXIuc2NhbGVUZXh0Tm90Q2FyZCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIFJlc2l6ZSBmb250IHNpemUgdG8gZml0IGluc2lkZSBDUFxuICAgICAgaWYgKHRoaXMuJGlubmVyLnBhcmVudHMoJy5oNXAtY291cnNlLXByZXNlbnRhdGlvbicpLmxlbmd0aCkge1xuICAgICAgICBsZXQgJHBhcmVudENvbnRhaW5lciA9IHRoaXMuJGlubmVyLnBhcmVudCgpO1xuICAgICAgICBpZiAodGhpcy4kaW5uZXIucGFyZW50cygnLmg1cC1wb3B1cC1jb250YWluZXInKS5sZW5ndGgpIHtcbiAgICAgICAgICAkcGFyZW50Q29udGFpbmVyID0gdGhpcy4kaW5uZXIucGFyZW50cygnLmg1cC1wb3B1cC1jb250YWluZXInKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb250YWluZXJIZWlnaHQgPSAkcGFyZW50Q29udGFpbmVyLmdldCgwKS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5oZWlnaHQ7XG4gICAgICAgIGNvbnN0IGdldENvbnRlbnRIZWlnaHQgPSAoKSA9PiB7XG4gICAgICAgICAgbGV0IGNvbnRlbnRIZWlnaHQgPSAwO1xuICAgICAgICAgIHRoaXMuJGlubmVyLmNoaWxkcmVuKCkuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvLyBIZXJlIFwidGhpc1wiIHJlZmVyZW5jZXMgdGhlIGpRdWVyeSBvYmplY3RcbiAgICAgICAgICAgIGNvbnN0ICRjaGlsZCA9ICQodGhpcyk7XG4gICAgICAgICAgICBjb250ZW50SGVpZ2h0ICs9IHRoaXMuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkuaGVpZ2h0ICtcbiAgICAgICAgICAgIHBhcnNlRmxvYXQoJGNoaWxkLmNzcygnbWFyZ2luLXRvcCcpKSArIHBhcnNlRmxvYXQoJGNoaWxkLmNzcygnbWFyZ2luLWJvdHRvbScpKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXR1cm4gY29udGVudEhlaWdodDtcbiAgICAgICAgfTtcbiAgICAgICAgbGV0IGNvbnRlbnRIZWlnaHQgPSBnZXRDb250ZW50SGVpZ2h0KCk7XG4gICAgICAgIGNvbnN0IHBhcmVudEZvbnRTaXplID0gcGFyc2VGbG9hdCh0aGlzLiRpbm5lci5wYXJlbnQoKS5jc3MoJ2ZvbnQtc2l6ZScpKTtcbiAgICAgICAgbGV0IG5ld0ZvbnRTaXplID0gcGFyc2VGbG9hdCh0aGlzLiRpbm5lci5jc3MoJ2ZvbnQtc2l6ZScpKTtcblxuICAgICAgICAvLyBEZWNyZWFzZSBmb250IHNpemVcbiAgICAgICAgaWYgKGNvbnRhaW5lckhlaWdodCA8IGNvbnRlbnRIZWlnaHQpIHtcbiAgICAgICAgICB3aGlsZSAoY29udGFpbmVySGVpZ2h0IDwgY29udGVudEhlaWdodCkge1xuICAgICAgICAgICAgbmV3Rm9udFNpemUgLT0gRGlhbG9nY2FyZHMuU0NBTEVJTlRFUlZBTDtcblxuICAgICAgICAgICAgLy8gQ2FwIGF0IG1pbiBmb250IHNpemVcbiAgICAgICAgICAgIGlmIChuZXdGb250U2l6ZSA8IERpYWxvZ2NhcmRzLk1JTlNDQUxFKSB7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBTZXQgcmVsYXRpdmUgZm9udCBzaXplIHRvIHNjYWxlIHdpdGggZnVsbCBzY3JlZW4uXG4gICAgICAgICAgICB0aGlzLiRpbm5lci5jc3MoJ2ZvbnQtc2l6ZScsIChuZXdGb250U2l6ZSAvIHBhcmVudEZvbnRTaXplKSArICdlbScpO1xuICAgICAgICAgICAgY29udGVudEhlaWdodCA9IGdldENvbnRlbnRIZWlnaHQoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7IC8vIEluY3JlYXNlIGZvbnQgc2l6ZVxuICAgICAgICAgIGxldCBpbmNyZWFzZUZvbnRTaXplID0gdHJ1ZTtcbiAgICAgICAgICB3aGlsZSAoaW5jcmVhc2VGb250U2l6ZSkge1xuICAgICAgICAgICAgbmV3Rm9udFNpemUgKz0gRGlhbG9nY2FyZHMuU0NBTEVJTlRFUlZBTDtcblxuICAgICAgICAgICAgLy8gQ2FwIG1heCBmb250IHNpemVcbiAgICAgICAgICAgIGlmIChuZXdGb250U2l6ZSA+IERpYWxvZ2NhcmRzLk1BWFNDQUxFKSB7XG4gICAgICAgICAgICAgIGluY3JlYXNlRm9udFNpemUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFNldCByZWxhdGl2ZSBmb250IHNpemUgdG8gc2NhbGUgd2l0aCBmdWxsIHNjcmVlbi5cbiAgICAgICAgICAgIGxldCByZWxhdGl2ZUZvbnRTaXplID0gbmV3Rm9udFNpemUgLyBwYXJlbnRGb250U2l6ZTtcbiAgICAgICAgICAgIHRoaXMuJGlubmVyLmNzcygnZm9udC1zaXplJywgcmVsYXRpdmVGb250U2l6ZSArICdlbScpO1xuICAgICAgICAgICAgY29udGVudEhlaWdodCA9IGdldENvbnRlbnRIZWlnaHQoKTtcbiAgICAgICAgICAgIGlmIChjb250YWluZXJIZWlnaHQgPD0gY29udGVudEhlaWdodCkge1xuICAgICAgICAgICAgICBpbmNyZWFzZUZvbnRTaXplID0gZmFsc2U7XG4gICAgICAgICAgICAgIHJlbGF0aXZlRm9udFNpemUgPSAobmV3Rm9udFNpemUgLSBEaWFsb2djYXJkcy5TQ0FMRUlOVEVSVkFMKSAvIHBhcmVudEZvbnRTaXplO1xuICAgICAgICAgICAgICB0aGlzLiRpbm5lci5jc3MoJ2ZvbnQtc2l6ZScsIHJlbGF0aXZlRm9udFNpemUgKyAnZW0nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGVsc2UgeyAvLyBSZXNpemUgbW9iaWxlIHZpZXdcbiAgICAgICAgdGhpcy5jYXJkc1t0aGlzLmN1cnJlbnRDYXJkSWRdLnJlc2l6ZU92ZXJmbG93aW5nVGV4dCgpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBUcnVuY2F0ZSByZXRyeSBidXR0b24gaWYgd2lkdGggaXMgc21hbGwuXG4gICAgICovXG4gICAgdGhpcy50cnVuY2F0ZVJldHJ5QnV0dG9uID0gKCkgPT4ge1xuICAgICAgaWYgKCF0aGlzLiRyZXRyeSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIFJlc2V0IGJ1dHRvbiB0byBmdWxsIHNpemVcbiAgICAgIHRoaXMuJHJldHJ5LnJlbW92ZUNsYXNzKCd0cnVuY2F0ZWQnKTtcbiAgICAgIHRoaXMuJHJldHJ5Lmh0bWwodGhpcy5wYXJhbXMucmV0cnkpO1xuXG4gICAgICAvLyBNZWFzdXJlIGJ1dHRvblxuICAgICAgY29uc3QgbWF4V2lkdGhQZXJjZW50YWdlcyA9IDAuMztcbiAgICAgIGNvbnN0IHJldHJ5V2lkdGggPSB0aGlzLiRyZXRyeS5nZXQoMCkuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkud2lkdGggK1xuICAgICAgICAgIHBhcnNlRmxvYXQodGhpcy4kcmV0cnkuY3NzKCdtYXJnaW4tbGVmdCcpKSArIHBhcnNlRmxvYXQodGhpcy4kcmV0cnkuY3NzKCdtYXJnaW4tcmlnaHQnKSk7XG4gICAgICBjb25zdCByZXRyeVdpZHRoUGVyY2VudGFnZSA9IHJldHJ5V2lkdGggLyB0aGlzLiRyZXRyeS5wYXJlbnQoKS5nZXQoMCkuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkud2lkdGg7XG5cbiAgICAgIC8vIFRydW5jYXRlIGJ1dHRvblxuICAgICAgaWYgKHJldHJ5V2lkdGhQZXJjZW50YWdlID4gbWF4V2lkdGhQZXJjZW50YWdlcykge1xuICAgICAgICB0aGlzLiRyZXRyeS5hZGRDbGFzcygndHJ1bmNhdGVkJyk7XG4gICAgICAgIHRoaXMuJHJldHJ5Lmh0bWwoJycpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBSZXRyaWV2ZSBpbmRleCBvZiBjYXJkIGluIHNlbGVjdGlvbiwgbm90IGxvYWRlZCBjYXJkcy5cbiAgICAgKi9cbiAgICB0aGlzLmdldEN1cnJlbnRTZWxlY3Rpb25JbmRleCA9ICgpID0+IHRoaXMuY2FyZElkcy5pbmRleE9mKHRoaXMuY2FyZHNbdGhpcy5jdXJyZW50Q2FyZElkXS5pZCk7XG5cbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIGNvbnRlbnQgdHlwZSB0aXRsZS5cbiAgICAgKlxuICAgICAqIEByZXR1cm4ge3N0cmluZ30gdGl0bGUuXG4gICAgICovXG4gICAgdGhpcy5nZXRUaXRsZSA9ICgpID0+IHtcbiAgICAgIHJldHVybiBINVAuY3JlYXRlVGl0bGUoKHRoaXMuY29udGVudERhdGEgJiYgdGhpcy5jb250ZW50RGF0YS5tZXRhZGF0YSAmJiB0aGlzLmNvbnRlbnREYXRhLm1ldGFkYXRhLnRpdGxlKSA/IHRoaXMuY29udGVudERhdGEubWV0YWRhdGEudGl0bGUgOiAnRGlhbG9nIENhcmRzJyk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFNhdmUgdGhlIGN1cnJlbnQgc3RhdGUgdG8gYmUgcmVzdG9yZWQgbGF0ZXIuXG4gICAgICovXG4gICAgdGhpcy5nZXRDdXJyZW50U3RhdGUgPSAoKSA9PiB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBjYXJkUGlsZXM6IHRoaXMuY2FyZE1hbmFnZXIuZ2V0UGlsZXMoKSxcbiAgICAgICAgY2FyZElkczogdGhpcy5jYXJkSWRzLFxuICAgICAgICByb3VuZDogdGhpcy5yb3VuZCxcbiAgICAgICAgY3VycmVudENhcmRJZDogdGhpcy5nZXRDdXJyZW50U2VsZWN0aW9uSW5kZXgoKSxcbiAgICAgICAgcmVzdWx0czogdGhpcy5yZXN1bHRzXG4gICAgICB9O1xuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogQ29tcHV0ZSBkaXNwbGF5IGxpbWl0cy5cbiAgICogQHJldHVybiB7b2JqZWN0fG51bGx9IEhlaWdodCBhbmQgd2lkdGggaW4gcHggb3IgbnVsbCBpZiBjYW5ub3QgYmUgZGV0ZXJtaW5lZC5cbiAgICovXG4gIGNvbXB1dGVEaXNwbGF5TGltaXRzKCkge1xuICAgIGxldCB0b3BXaW5kb3cgPSB0aGlzLmdldFRvcFdpbmRvdygpO1xuXG4gICAgLy8gaU9TIGRvZXNuJ3QgY2hhbmdlIHNjcmVlbiBkaW1lbnNpb25zIG9uIHJvdGF0aW9uXG4gICAgbGV0IHNjcmVlblNpemUgPSAodGhpcy5pc0lPUygpICYmIHRoaXMuZ2V0T3JpZW50YXRpb24oKSA9PT0gJ2xhbmRzY2FwZScpID9cbiAgICAgIHsgaGVpZ2h0OiBzY3JlZW4ud2lkdGgsIHdpZHRoOiBzY3JlZW4uaGVpZ2h0IH0gOlxuICAgICAgeyBoZWlnaHQ6IHNjcmVlbi5oZWlnaHQsIHdpZHRoOiBzY3JlZW4ud2lkdGggfTtcblxuICAgIHRvcFdpbmRvdyA9IHRvcFdpbmRvdyB8fCB7XG4gICAgICBpbm5lckhlaWdodDogc2NyZWVuU2l6ZS5oZWlnaHQsXG4gICAgICBpbm5lcldpZHRoOiBzY3JlZW5TaXplLndpZHRoXG4gICAgfTtcblxuICAgIC8vIFNtYWxsZXN0IHZhbHVlIG9mIHZpZXdwb3J0IGFuZCBjb250YWluZXIgd2luc1xuICAgIHJldHVybiB7XG4gICAgICBoZWlnaHQ6IE1hdGgubWluKHRvcFdpbmRvdy5pbm5lckhlaWdodCwgc2NyZWVuU2l6ZS5oZWlnaHQpLFxuICAgICAgd2lkdGg6IE1hdGgubWluKHRvcFdpbmRvdy5pbm5lcldpZHRoLCB0aGlzLiRpbm5lci5nZXQoMCkub2Zmc2V0V2lkdGgpXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb21wdXRlIGRpc3BsYXkgbGltaXRzIGZvciBLaWRzTG9vcCBMaXZlLlxuICAgKiBAcmV0dXJuIHtvYmplY3R8bnVsbH0gSGVpZ2h0IGFuZCB3aWR0aCBpbiBweCBvciBudWxsIGlmIGNhbm5vdCBiZSBkZXRlcm1pbmVkLlxuICAgKi9cbiAgY29tcHV0ZURpc3BsYXlMaW1pdHNLTEwoKSB7XG4gICAgY29uc3QgZGlzcGxheUxpbWl0cyA9IHRoaXMuY29tcHV0ZURpc3BsYXlMaW1pdHMoKTtcblxuICAgIC8vIFRoaXMgb25seSB3b3JrcyBiZWNhdXNlIEtMTCBlbmZvcmNlcyBoZWlnaHQgb24gSDVQJ3MgaWZyYW1lXG4gICAgZGlzcGxheUxpbWl0cy5oZWlnaHQgPSBNYXRoLm1pbihkaXNwbGF5TGltaXRzLmhlaWdodCwgZG9jdW1lbnQuYm9keS5vZmZzZXRIZWlnaHQpO1xuICAgIHJldHVybiBkaXNwbGF5TGltaXRzO1xuICB9XG5cbiAgLyoqXG4gICAqIERldGVjdCB3aGV0aGVyIHVzZXIgaXMgcnVubmluZyBpT1MuXG4gICAqIEByZXR1cm4ge2Jvb2xlYW59IFRydWUsIGlmIHVzZXIgaXMgcnVubmluZyBpT1MuXG4gICAqL1xuICBpc0lPUygpIHtcbiAgICByZXR1cm4gKFxuICAgICAgWydpUGFkIFNpbXVsYXRvcicsICdpUGhvbmUgU2ltdWxhdG9yJywgJ2lQb2QgU2ltdWxhdG9yJywgJ2lQYWQnLCAnaVBob25lJywgJ2lQb2QnXS5pbmNsdWRlcyhuYXZpZ2F0b3IucGxhdGZvcm0pIHx8XG4gICAgICAobmF2aWdhdG9yLnVzZXJBZ2VudC5pbmNsdWRlcygnTWFjJykgJiYgJ29udG91Y2hlbmQnIGluIGRvY3VtZW50KVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogRGV0ZXJtaW5lIHdoZXRoZXIgbW9iaWxlIGRldmljZSBpbiBsYW5kc2NhcGUgb3JpZW50YXRpb24uXG4gICAqIEByZXR1cm4ge2Jvb2xlYW59IFRydWUsIGlmIG1vYmlsZSBkZXZpY2UgaW4gbGFuZHNjYXBlIG9yaWVudGF0aW9uLlxuICAgKi9cbiAgaXNNb2JpbGVMYW5kc2NhcGUoKSB7XG4gICAgcmV0dXJuIHRoaXMuaXNNb2JpbGVEZXZpY2UoKSAmJiB0aGlzLmdldE9yaWVudGF0aW9uKCkgPT09ICdsYW5kc2NhcGUnO1xuICB9XG5cbiAgLyoqXG4gICAqIERldGVjdCBtb2JpbGUgZGV2aWNlcyAoaHR0cDovL2RldGVjdG1vYmlsZWJyb3dzZXJzLmNvbS8pXG4gICAqIEByZXR1cm5zIHtib29sZWFufSBUcnVlIGlmIHJ1bm5pbmcgb24gYSBtb2JpbGUgZGV2aWNlLlxuICAgKi9cbiAgaXNNb2JpbGVEZXZpY2UoKSB7XG4gICAgbGV0IGNoZWNrID0gZmFsc2U7XG4gICAgKGZ1bmN0aW9uIChhKSB7XG4gICAgICBpZiAoLyhhbmRyb2lkfGJiXFxkK3xtZWVnbykuK21vYmlsZXxhdmFudGdvfGJhZGFcXC98YmxhY2tiZXJyeXxibGF6ZXJ8Y29tcGFsfGVsYWluZXxmZW5uZWN8aGlwdG9wfGllbW9iaWxlfGlwKGhvbmV8b2QpfGlyaXN8a2luZGxlfGxnZSB8bWFlbW98bWlkcHxtbXB8bW9iaWxlLitmaXJlZm94fG5ldGZyb250fG9wZXJhIG0ob2J8aW4paXxwYWxtKCBvcyk/fHBob25lfHAoaXhpfHJlKVxcL3xwbHVja2VyfHBvY2tldHxwc3B8c2VyaWVzKDR8NikwfHN5bWJpYW58dHJlb3x1cFxcLihicm93c2VyfGxpbmspfHZvZGFmb25lfHdhcHx3aW5kb3dzIGNlfHhkYXx4aWluby9pLnRlc3QoYSkgfHwgLzEyMDd8NjMxMHw2NTkwfDNnc298NHRocHw1MFsxLTZdaXw3NzBzfDgwMnN8YSB3YXxhYmFjfGFjKGVyfG9vfHMtKXxhaShrb3xybil8YWwoYXZ8Y2F8Y28pfGFtb2l8YW4oZXh8bnl8eXcpfGFwdHV8YXIoY2h8Z28pfGFzKHRlfHVzKXxhdHR3fGF1KGRpfC1tfHIgfHMgKXxhdmFufGJlKGNrfGxsfG5xKXxiaShsYnxyZCl8YmwoYWN8YXopfGJyKGV8dil3fGJ1bWJ8YnctKG58dSl8YzU1XFwvfGNhcGl8Y2N3YXxjZG0tfGNlbGx8Y2h0bXxjbGRjfGNtZC18Y28obXB8bmQpfGNyYXd8ZGEoaXR8bGx8bmcpfGRidGV8ZGMtc3xkZXZpfGRpY2F8ZG1vYnxkbyhjfHApb3xkcygxMnwtZCl8ZWwoNDl8YWkpfGVtKGwyfHVsKXxlcihpY3xrMCl8ZXNsOHxleihbNC03XTB8b3N8d2F8emUpfGZldGN8Zmx5KC18Xyl8ZzEgdXxnNTYwfGdlbmV8Z2YtNXxnLW1vfGdvKFxcLnd8b2QpfGdyKGFkfHVuKXxoYWllfGhjaXR8aGQtKG18cHx0KXxoZWktfGhpKHB0fHRhKXxocCggaXxpcCl8aHMtY3xodChjKC18IHxffGF8Z3xwfHN8dCl8dHApfGh1KGF3fHRjKXxpLSgyMHxnb3xtYSl8aTIzMHxpYWMoIHwtfFxcLyl8aWJyb3xpZGVhfGlnMDF8aWtvbXxpbTFrfGlubm98aXBhcXxpcmlzfGphKHR8dilhfGpicm98amVtdXxqaWdzfGtkZGl8a2VqaXxrZ3QoIHxcXC8pfGtsb258a3B0IHxrd2MtfGt5byhjfGspfGxlKG5vfHhpKXxsZyggZ3xcXC8oa3xsfHUpfDUwfDU0fC1bYS13XSl8bGlid3xseW54fG0xLXd8bTNnYXxtNTBcXC98bWEodGV8dWl8eG8pfG1jKDAxfDIxfGNhKXxtLWNyfG1lKHJjfHJpKXxtaShvOHxvYXx0cyl8bW1lZnxtbygwMXwwMnxiaXxkZXxkb3x0KC18IHxvfHYpfHp6KXxtdCg1MHxwMXx2ICl8bXdicHxteXdhfG4xMFswLTJdfG4yMFsyLTNdfG4zMCgwfDIpfG41MCgwfDJ8NSl8bjcoMCgwfDEpfDEwKXxuZSgoY3xtKS18b258dGZ8d2Z8d2d8d3QpfG5vayg2fGkpfG56cGh8bzJpbXxvcCh0aXx3dil8b3Jhbnxvd2cxfHA4MDB8cGFuKGF8ZHx0KXxwZHhnfHBnKDEzfC0oWzEtOF18YykpfHBoaWx8cGlyZXxwbChheXx1Yyl8cG4tMnxwbyhja3xydHxzZSl8cHJveHxwc2lvfHB0LWd8cWEtYXxxYygwN3wxMnwyMXwzMnw2MHwtWzItN118aS0pfHF0ZWt8cjM4MHxyNjAwfHJha3N8cmltOXxybyh2ZXx6byl8czU1XFwvfHNhKGdlfG1hfG1tfG1zfG55fHZhKXxzYygwMXxoLXxvb3xwLSl8c2RrXFwvfHNlKGMoLXwwfDEpfDQ3fG1jfG5kfHJpKXxzZ2gtfHNoYXJ8c2llKC18bSl8c2stMHxzbCg0NXxpZCl8c20oYWx8YXJ8YjN8aXR8dDUpfHNvKGZ0fG55KXxzcCgwMXxoLXx2LXx2ICl8c3koMDF8bWIpfHQyKDE4fDUwKXx0NigwMHwxMHwxOCl8dGEoZ3R8bGspfHRjbC18dGRnLXx0ZWwoaXxtKXx0aW0tfHQtbW98dG8ocGx8c2gpfHRzKDcwfG0tfG0zfG01KXx0eC05fHVwKFxcLmJ8ZzF8c2kpfHV0c3R8djQwMHx2NzUwfHZlcml8dmkocmd8dGUpfHZrKDQwfDVbMC0zXXwtdil8dm00MHx2b2RhfHZ1bGN8dngoNTJ8NTN8NjB8NjF8NzB8ODB8ODF8ODN8ODV8OTgpfHczYygtfCApfHdlYmN8d2hpdHx3aShnIHxuY3xudyl8d21sYnx3b251fHg3MDB8eWFzLXx5b3VyfHpldG98enRlLS9pLnRlc3QoYS5zdWJzdHIoMCwgNCkpKSBjaGVjayA9IHRydWU7XG4gICAgfSkobmF2aWdhdG9yLnVzZXJBZ2VudCB8fCBuYXZpZ2F0b3IudmVuZG9yIHx8IHdpbmRvdy5vcGVyYSk7XG4gICAgcmV0dXJuIGNoZWNrO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBkZXZpY2Ugb3JpZW50YXRpb24uXG4gICAqIEByZXR1cm4ge3N0cmluZ30gJ3BvcnRyYWl0JyBvciAnbGFuZHNjYXBlJy5cbiAgICovXG4gIGdldE9yaWVudGF0aW9uKCkge1xuICAgIGlmIChzY3JlZW4ub3JpZW50YXRpb24gJiYgc2NyZWVuLm9yaWVudGF0aW9uLnR5cGUpIHtcbiAgICAgIGlmIChzY3JlZW4ub3JpZW50YXRpb24udHlwZS5pbmNsdWRlcygncG9ydHJhaXQnKSkge1xuICAgICAgICByZXR1cm4gJ3BvcnRyYWl0JztcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKHNjcmVlbi5vcmllbnRhdGlvbi50eXBlLmluY2x1ZGVzKCdsYW5kc2NhcGUnKSkge1xuICAgICAgICByZXR1cm4gJ2xhbmRzY2FwZSc7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gVW5yZWxpYWJsZSwgYXMgbm90IGNsZWFyIHdoYXQgZGV2aWNlJ3MgbmF0dXJhbCBvcmllbnRhdGlvbiBpc1xuICAgIGlmICh0eXBlb2Ygd2luZG93Lm9yaWVudGF0aW9uID09PSAnbnVtYmVyJykge1xuICAgICAgaWYgKHdpbmRvdy5vcmllbnRhdGlvbiA9PT0gMCB8fCB3aW5kb3cub3JpZW50YXRpb24gPT09IDE4MCkge1xuICAgICAgICByZXR1cm4gJ3BvcnRyYWl0JztcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKHdpbmRvdy5vcmllbnRhdGlvbiA9PT0gOTAgfHwgd2luZG93Lm9yaWVudGF0aW9uID09PSAtOTAgfHwgd2luZG93Lm9yaWVudGF0aW9uID09PSAyNzApIHtcbiAgICAgICAgcmV0dXJuICdsYW5kc2NhcGUnO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiAnbGFuZHNjYXBlJzsgLy8gQXNzdW1lIGRlZmF1bHRcbiAgfVxuXG4gIC8qKlxuXHQgKiBHZXQgdG9wIERPTSBXaW5kb3cgb2JqZWN0LlxuXHQgKiBAcGFyYW0ge1dpbmRvd30gW3N0YXJ0V2luZG93PXdpbmRvd10gV2luZG93IHRvIHN0YXJ0IGxvb2tpbmcgZnJvbS5cblx0ICogQHJldHVybiB7V2luZG93fG51bGx9IFRvcCB3aW5kb3cuXG5cdCAqL1xuICBnZXRUb3BXaW5kb3coc3RhcnRXaW5kb3cpIHtcbiAgICB2YXIgc2FtZU9yaWdpbjtcbiAgICBzdGFydFdpbmRvdyA9IHN0YXJ0V2luZG93IHx8IHdpbmRvdztcblxuICAgIC8vIEg1UCBpZnJhbWUgbWF5IGJlIG9uIGRpZmZlcmVudCBkb21haW4gdGhhbiBpZnJhbWUgY29udGVudFxuICAgIHRyeSB7XG4gICAgICBzYW1lT3JpZ2luID0gc3RhcnRXaW5kb3cucGFyZW50LmxvY2F0aW9uLmhvc3QgPT09IHdpbmRvdy5sb2NhdGlvbi5ob3N0O1xuICAgIH1cbiAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHNhbWVPcmlnaW4gPSBudWxsO1xuICAgIH1cblxuICAgIGlmICghc2FtZU9yaWdpbikge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgaWYgKHN0YXJ0V2luZG93LnBhcmVudCA9PT0gc3RhcnRXaW5kb3cgfHwgISBzdGFydFdpbmRvdy5wYXJlbnQpIHtcbiAgICAgIHJldHVybiBzdGFydFdpbmRvdztcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5nZXRUb3BXaW5kb3coc3RhcnRXaW5kb3cucGFyZW50KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGUgb3JpZW50YXRpb24gY2hhbmdlLlxuICAgKi9cbiAgaGFuZGxlT3JpZW50YXRpb25DaGFuZ2UoKSB7XG4gICAgaWYgKCF0aGlzLnBhcmFtcy5iZWhhdmlvdXIuc2NhbGVUZXh0Tm90Q2FyZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGlzTW9iaWxlTGFuZHNjYXBlID0gdGhpcy5pc01vYmlsZUxhbmRzY2FwZSgpO1xuICAgIHRoaXMuY2FyZHMuZm9yRWFjaChjYXJkID0+IHtcbiAgICAgIGlmICh0aGlzLnBhcmFtcy5tb2RlID09PSAncmVwZXRpdGlvbicpIHtcbiAgICAgICAgY2FyZC4kYnV0dG9uVHVybi50ZXh0KGlzTW9iaWxlTGFuZHNjYXBlID8gJycgOiB0aGlzLnBhcmFtcy5hbnN3ZXIpO1xuICAgICAgICBjYXJkLiRidXR0b25Db3JyZWN0LnRleHQoaXNNb2JpbGVMYW5kc2NhcGUgPyAnJyA6IHRoaXMucGFyYW1zLmNvcnJlY3RBbnN3ZXIpO1xuICAgICAgICBjYXJkLiRidXR0b25JbmNvcnJlY3QudGV4dChpc01vYmlsZUxhbmRzY2FwZSA/ICcnIDogdGhpcy5wYXJhbXMuaW5jb3JyZWN0QW5zd2VyKTtcbiAgICAgIH1cblxuICAgICAgaWYgKCFpc01vYmlsZUxhbmRzY2FwZSkge1xuICAgICAgICB0aGlzLiRjYXJkd3JhcHBlclNldC5jc3MoJ21heC1oZWlnaHQnLCAnJyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbn1cblxuRGlhbG9nY2FyZHMuaWRDb3VudGVyID0gMDtcblxuLy8gQ29uc3RhbnRzXG5EaWFsb2djYXJkcy5TQ0FMRUlOVEVSVkFMID0gMC4yO1xuRGlhbG9nY2FyZHMuTUFYU0NBTEUgPSAxNjtcbkRpYWxvZ2NhcmRzLk1JTlNDQUxFID0gNDtcblxuZXhwb3J0IGRlZmF1bHQgRGlhbG9nY2FyZHM7XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/scripts/h5p-dialogcards.js\n");

/***/ }),

/***/ "./src/styles/h5p-dialogcards.css":
/*!****************************************!*\
  !*** ./src/styles/h5p-dialogcards.css ***!
  \****************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n// extracted by mini-css-extract-plugin\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvc3R5bGVzL2g1cC1kaWFsb2djYXJkcy5jc3MuanMiLCJtYXBwaW5ncyI6IjtBQUFBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vaDVwLWRpYWxvZ2NhcmRzLy4vc3JjL3N0eWxlcy9oNXAtZGlhbG9nY2FyZHMuY3NzP2IzZDYiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gZXh0cmFjdGVkIGJ5IG1pbmktY3NzLWV4dHJhY3QtcGx1Z2luXG5leHBvcnQge307Il0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/styles/h5p-dialogcards.css\n");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	!function() {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = function(exports) {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	}();
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module can't be inlined because the eval-source-map devtool is used.
/******/ 	var __webpack_exports__ = __webpack_require__("./src/entries/h5p-dialogcards.js");
/******/ 	
/******/ })()
;